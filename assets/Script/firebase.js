!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).firebase=t()}(this,function(){"use strict";const r=function(t){const r=[];let n=0;for(let i=0;i<t.length;i++){let e=t.charCodeAt(i);e<128?r[n++]=e:(e<2048?r[n++]=e>>6|192:(55296==(64512&e)&&i+1<t.length&&56320==(64512&t.charCodeAt(i+1))?(e=65536+((1023&e)<<10)+(1023&t.charCodeAt(++i)),r[n++]=e>>18|240,r[n++]=e>>12&63|128):r[n++]=e>>12|224,r[n++]=e>>6&63|128),r[n++]=63&e|128)}return r},n={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray(r,e){if(!Array.isArray(r))throw Error("encodeByteArray takes an array as a parameter");this.init_();var n=e?this.byteToCharMapWebSafe_:this.byteToCharMap_;const i=[];for(let l=0;l<r.length;l+=3){var a=r[l],s=l+1<r.length,o=s?r[l+1]:0,c=l+2<r.length,h=c?r[l+2]:0;let e=(15&o)<<2|h>>6,t=63&h;c||(t=64,s||(e=64)),i.push(n[a>>2],n[(3&a)<<4|o>>4],n[e],n[t])}return i.join("")},encodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(e):this.encodeByteArray(r(e),t)},decodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(e):function(e){const t=[];let r=0,n=0;for(;r<e.length;){var i,a,s=e[r++];s<128?t[n++]=String.fromCharCode(s):191<s&&s<224?(i=e[r++],t[n++]=String.fromCharCode((31&s)<<6|63&i)):239<s&&s<365?(a=((7&s)<<18|(63&e[r++])<<12|(63&e[r++])<<6|63&e[r++])-65536,t[n++]=String.fromCharCode(55296+(a>>10)),t[n++]=String.fromCharCode(56320+(1023&a))):(i=e[r++],a=e[r++],t[n++]=String.fromCharCode((15&s)<<12|(63&i)<<6|63&a))}return t.join("")}(this.decodeStringToByteArray(e,t))},decodeStringToByteArray(e,t){this.init_();var r=t?this.charToByteMapWebSafe_:this.charToByteMap_;const n=[];for(let c=0;c<e.length;){var i=r[e.charAt(c++)],a=c<e.length?r[e.charAt(c)]:0;++c;var s=c<e.length?r[e.charAt(c)]:64;++c;var o=c<e.length?r[e.charAt(c)]:64;if(++c,null==i||null==a||null==s||null==o)throw new h;n.push(i<<2|a>>4),64!==s&&(n.push(a<<4&240|s>>2),64!==o&&n.push(s<<6&192|o))}return n},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let e=0;e<this.ENCODED_VALS.length;e++)this.byteToCharMap_[e]=this.ENCODED_VALS.charAt(e),this.charToByteMap_[this.byteToCharMap_[e]]=e,this.byteToCharMapWebSafe_[e]=this.ENCODED_VALS_WEBSAFE.charAt(e),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[e]]=e,e>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(e)]=e,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(e)]=e)}}};class h extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const i=function(e){return e=e,t=r(e),n.encodeByteArray(t,!0).replace(/\./g,"");var t};function c(e,t){if(!(t instanceof Object))return t;switch(t.constructor){case Date:const r=t;return new Date(r.getTime());case Object:void 0===e&&(e={});break;case Array:e=[];break;default:return t}for(const n in t)t.hasOwnProperty(n)&&"__proto__"!==n&&(e[n]=c(e[n],t[n]));return e}const e=()=>function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if("undefined"!=typeof global)return global;throw new Error("Unable to locate global object.")}().__FIREBASE_DEFAULTS__,t=()=>{if("undefined"!=typeof document){let e;try{e=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch(e){return}var t=e&&function(e){try{return n.decodeString(e,!0)}catch(e){console.error("base64Decode failed: ",e)}return null}(e[1]);return t&&JSON.parse(t)}},a=()=>{try{return e()||(()=>{if("undefined"!=typeof process&&void 0!==process.env){var e=process.env.__FIREBASE_DEFAULTS__;return e?JSON.parse(e):void 0}})()||t()}catch(e){return void console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${e}`)}},l=()=>{var e;return null===(e=a())||void 0===e?void 0:e.config};class s{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(r){return(e,t)=>{e?this.reject(e):this.resolve(t),"function"==typeof r&&(this.promise.catch(()=>{}),1===r.length?r(e):r(e,t))}}}class o extends Error{constructor(e,t,r){super(t),this.code=e,this.customData=r,this.name="FirebaseError",Object.setPrototypeOf(this,o.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,d.prototype.create)}}class d{constructor(e,t,r){this.service=e,this.serviceName=t,this.errors=r}create(e,...t){var n,r=t[0]||{},i=`${this.service}/${e}`,a=this.errors[e],a=a?(n=r,a.replace(p,(e,t)=>{var r=n[t];return null!=r?String(r):`<${t}?>`})):"Error",a=`${this.serviceName}: ${a} (${i}).`;return new o(i,a,r)}}const p=/\{\$([^}]+)}/g;function u(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function f(e,t){if(e===t)return 1;const r=Object.keys(e),n=Object.keys(t);for(const s of r){if(!n.includes(s))return;var i=e[s],a=t[s];if(g(i)&&g(a)){if(!f(i,a))return}else if(i!==a)return}for(const o of n)if(!r.includes(o))return;return 1}function g(e){return null!==e&&"object"==typeof e}function m(e,t){const r=new b(e,t);return r.subscribe.bind(r)}class b{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(e=>{this.error(e)})}next(t){this.forEachObserver(e=>{e.next(t)})}error(t){this.forEachObserver(e=>{e.error(t)}),this.close(t)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,r){let n;if(void 0===e&&void 0===t&&void 0===r)throw new Error("Missing Observer.");n=function(e,t){if("object"!=typeof e||null===e)return!1;for(const r of t)if(r in e&&"function"==typeof e[r])return!0;return!1}(e,["next","error","complete"])?e:{next:e,error:t,complete:r},void 0===n.next&&(n.next=v),void 0===n.error&&(n.error=v),void 0===n.complete&&(n.complete=v);var i=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?n.error(this.finalError):n.complete()}catch(e){}}),this.observers.push(n),i}unsubscribeOne(e){void 0!==this.observers&&void 0!==this.observers[e]&&(delete this.observers[e],--this.observerCount,0===this.observerCount&&void 0!==this.onNoObservers&&this.onNoObservers(this))}forEachObserver(t){if(!this.finalized)for(let e=0;e<this.observers.length;e++)this.sendOne(e,t)}sendOne(e,t){this.task.then(()=>{if(void 0!==this.observers&&void 0!==this.observers[e])try{t(this.observers[e])}catch(e){"undefined"!=typeof console&&console.error&&console.error(e)}})}close(e){this.finalized||(this.finalized=!0,void 0!==e&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function v(){}class _{constructor(e,t,r){this.name=e,this.instanceFactory=t,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}const E="[DEFAULT]";class y{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){var t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const n=new s;if(this.instancesDeferred.set(t,n),this.isInitialized(t)||this.shouldAutoInitialize())try{var r=this.getOrInitializeService({instanceIdentifier:t});r&&n.resolve(r)}catch(e){}}return this.instancesDeferred.get(t).promise}getImmediate(e){var t=this.normalizeInstanceIdentifier(null==e?void 0:e.identifier),r=null!==(r=null==e?void 0:e.optional)&&void 0!==r&&r;if(!this.isInitialized(t)&&!this.shouldAutoInitialize()){if(r)return null;throw Error(`Service ${this.name} is not available`)}try{return this.getOrInitializeService({instanceIdentifier:t})}catch(e){if(r)return null;throw e}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,this.shouldAutoInitialize()){if("EAGER"===e.instantiationMode)try{this.getOrInitializeService({instanceIdentifier:E})}catch(e){}for(var[t,r]of this.instancesDeferred.entries()){t=this.normalizeInstanceIdentifier(t);try{var n=this.getOrInitializeService({instanceIdentifier:t});r.resolve(n)}catch(e){}}}}clearInstance(e=E){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(e=>"INTERNAL"in e).map(e=>e.INTERNAL.delete()),...e.filter(e=>"_delete"in e).map(e=>e._delete())])}isComponentSet(){return null!=this.component}isInitialized(e=E){return this.instances.has(e)}getOptions(e=E){return this.instancesOptions.get(e)||{}}initialize(e={}){var{options:t={}}=e,r=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(r))throw Error(`${this.name}(${r}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);var n,i,a=this.getOrInitializeService({instanceIdentifier:r,options:t});for([n,i]of this.instancesDeferred.entries())r===this.normalizeInstanceIdentifier(n)&&i.resolve(a);return a}onInit(e,t){var r=this.normalizeInstanceIdentifier(t);const n=null!==(i=this.onInitCallbacks.get(r))&&void 0!==i?i:new Set;n.add(e),this.onInitCallbacks.set(r,n);var i=this.instances.get(r);return i&&e(i,r),()=>{n.delete(e)}}invokeOnInitCallbacks(e,t){var r=this.onInitCallbacks.get(t);if(r)for(const n of r)try{n(e,t)}catch(e){}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let r=this.instances.get(e);if(!r&&this.component&&(r=this.component.instanceFactory(this.container,{instanceIdentifier:(n=e)===E?void 0:n,options:t}),this.instances.set(e,r),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(r,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,r)}catch(e){}var n;return r||null}normalizeInstanceIdentifier(e=E){return!this.component||this.component.multipleInstances?e:E}shouldAutoInitialize(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}class I{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){const t=this.getProvider(e.name);t.isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);var t=new y(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}const w=[];var C,D,S;(D=C=C||{})[D.DEBUG=0]="DEBUG",D[D.VERBOSE=1]="VERBOSE",D[D.INFO=2]="INFO",D[D.WARN=3]="WARN",D[D.ERROR=4]="ERROR",D[D.SILENT=5]="SILENT";const A={debug:C.DEBUG,verbose:C.VERBOSE,info:C.INFO,warn:C.WARN,error:C.ERROR,silent:C.SILENT},O=C.INFO,L={[C.DEBUG]:"log",[C.VERBOSE]:"log",[C.INFO]:"info",[C.WARN]:"warn",[C.ERROR]:"error"},N=(e,t,...r)=>{if(!(t<e.logLevel)){var n=(new Date).toISOString(),i=L[t];if(!i)throw new Error(`Attempted to log a message with an invalid logType (value: ${t})`);console[i](`[${n}]  ${e.name}:`,...r)}};class B{constructor(e){this.name=e,this._logLevel=O,this._logHandler=N,this._userLogHandler=null,w.push(this)}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in C))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel="string"==typeof e?A[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if("function"!=typeof e)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,C.DEBUG,...e),this._logHandler(this,C.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,C.VERBOSE,...e),this._logHandler(this,C.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,C.INFO,...e),this._logHandler(this,C.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,C.WARN,...e),this._logHandler(this,C.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,C.ERROR,...e),this._logHandler(this,C.ERROR,...e)}}const T=(t,e)=>e.some(e=>t instanceof e);let P,M;const R=new WeakMap,k=new WeakMap,F=new WeakMap,$=new WeakMap,j=new WeakMap;let H={get(e,t,r){if(e instanceof IDBTransaction){if("done"===t)return k.get(e);if("objectStoreNames"===t)return e.objectStoreNames||F.get(e);if("store"===t)return r.objectStoreNames[1]?void 0:r.objectStore(r.objectStoreNames[0])}return z(e[t])},set(e,t,r){return e[t]=r,!0},has(e,t){return e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e}};function V(n){return n!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(M=M||[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey]).includes(n)?function(...e){return n.apply(U(this),e),z(R.get(this))}:function(...e){return z(n.apply(U(this),e))}:function(e,...t){var r=n.call(U(this),e,...t);return F.set(r,e.sort?e.sort():[e]),z(r)}}function x(e){return"function"==typeof e?V(e):(e instanceof IDBTransaction&&(a=e,k.has(a)||(t=new Promise((e,t)=>{const r=()=>{a.removeEventListener("complete",n),a.removeEventListener("error",i),a.removeEventListener("abort",i)},n=()=>{e(),r()},i=()=>{t(a.error||new DOMException("AbortError","AbortError")),r()};a.addEventListener("complete",n),a.addEventListener("error",i),a.addEventListener("abort",i)}),k.set(a,t))),T(e,P=P||[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])?new Proxy(e,H):e);var a,t}function z(e){if(e instanceof IDBRequest)return function(a){const e=new Promise((e,t)=>{const r=()=>{a.removeEventListener("success",n),a.removeEventListener("error",i)},n=()=>{e(z(a.result)),r()},i=()=>{t(a.error),r()};a.addEventListener("success",n),a.addEventListener("error",i)});return e.then(e=>{e instanceof IDBCursor&&R.set(e,a)}).catch(()=>{}),j.set(e,a),e}(e);if($.has(e))return $.get(e);var t=x(e);return t!==e&&($.set(e,t),j.set(t,e)),t}const U=e=>j.get(e);const W=["get","getKey","getAll","getAllKeys","count"],G=["put","add","delete","clear"],J=new Map;function K(e,t){if(e instanceof IDBDatabase&&!(t in e)&&"string"==typeof t){if(J.get(t))return J.get(t);const i=t.replace(/FromIndex$/,""),a=t!==i,s=G.includes(i);if(i in(a?IDBIndex:IDBObjectStore).prototype&&(s||W.includes(i))){var r=async function(e,...t){var r=this.transaction(e,s?"readwrite":"readonly");let n=r.store;return a&&(n=n.index(t.shift())),(await Promise.all([n[i](...t),s&&r.done]))[0]};return J.set(t,r),r}}}H={...S=H,get:(e,t,r)=>K(e,t)||S.get(e,t,r),has:(e,t)=>!!K(e,t)||S.has(e,t)};class Y{constructor(e){this.container=e}getPlatformInfoString(){const e=this.container.getProviders();return e.map(e=>{if("VERSION"!==(null==(t=e.getComponent())?void 0:t.type))return null;var t,t=e.getImmediate();return`${t.library}/${t.version}`}).filter(e=>e).join(" ")}}const X="@firebase/app",q=new B("@firebase/app");var Z;const Q="[DEFAULT]",ee={"@firebase/app":"fire-core","@firebase/app-compat":"fire-core-compat","@firebase/analytics":"fire-analytics","@firebase/analytics-compat":"fire-analytics-compat","@firebase/app-check":"fire-app-check","@firebase/app-check-compat":"fire-app-check-compat","@firebase/auth":"fire-auth","@firebase/auth-compat":"fire-auth-compat","@firebase/database":"fire-rtdb","@firebase/database-compat":"fire-rtdb-compat","@firebase/functions":"fire-fn","@firebase/functions-compat":"fire-fn-compat","@firebase/installations":"fire-iid","@firebase/installations-compat":"fire-iid-compat","@firebase/messaging":"fire-fcm","@firebase/messaging-compat":"fire-fcm-compat","@firebase/performance":"fire-perf","@firebase/performance-compat":"fire-perf-compat","@firebase/remote-config":"fire-rc","@firebase/remote-config-compat":"fire-rc-compat","@firebase/storage":"fire-gcs","@firebase/storage-compat":"fire-gcs-compat","@firebase/firestore":"fire-fst","@firebase/firestore-compat":"fire-fst-compat","fire-js":"fire-js",firebase:"fire-js-all"},te=new Map,re=new Map;function ne(t,r){try{t.container.addComponent(r)}catch(e){q.debug(`Component ${r.name} failed to register with FirebaseApp ${t.name}`,e)}}function ie(e,t){e.container.addOrOverwriteComponent(t)}function ae(e){var t=e.name;if(re.has(t))return q.debug(`There were multiple attempts to register component ${t}.`),!1;re.set(t,e);for(const r of te.values())ne(r,e);return!0}function se(e,t){const r=e.container.getProvider("heartbeat").getImmediate({optional:!0});return r&&r.triggerHeartbeat(),e.container.getProvider(t)}const oe=new d("app","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call Firebase App.initializeApp()","bad-app-name":"Illegal App name: '{$appName}","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}."});class ce{constructor(e,t,r){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},t),this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=r,this.container.addComponent(new _("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw oe.create("app-deleted",{appName:this._name})}}const he="9.21.0";function le(e,t={}){let r=e;if("object"!=typeof t){const i=t;t={name:i}}var n=Object.assign({name:Q,automaticDataCollectionEnabled:!1},t);const i=n.name;if("string"!=typeof i||!i)throw oe.create("bad-app-name",{appName:String(i)});if(r=r||l(),!r)throw oe.create("no-options");var a=te.get(i);if(a){if(f(r,a.options)&&f(n,a.config))return a;throw oe.create("duplicate-app",{appName:i})}const s=new I(i);for(const o of re.values())s.addComponent(o);n=new ce(r,n,s);return te.set(i,n),n}async function de(e){var t=e.name;te.has(t)&&(te.delete(t),await Promise.all(e.container.getProviders().map(e=>e.delete())),e.isDeleted=!0)}function pe(e,t,r){let n=null!==(a=ee[e])&&void 0!==a?a:e;r&&(n+=`-${r}`);var i=n.match(/\s|\//),a=t.match(/\s|\//);if(i||a){const s=[`Unable to register library "${n}" with version "${t}":`];return i&&s.push(`library name "${n}" contains illegal characters (whitespace or "/")`),i&&a&&s.push("and"),a&&s.push(`version name "${t}" contains illegal characters (whitespace or "/")`),void q.warn(s.join(" "))}ae(new _(`${n}-version`,()=>({library:n,version:t}),"VERSION"))}function ue(e,t){if(null!==e&&"function"!=typeof e)throw oe.create("invalid-log-argument");!function(a,e){for(const t of w){let i=null;e&&e.level&&(i=A[e.level]),t.userLogHandler=null===a?null:(e,t,...r)=>{var n=r.map(e=>{if(null==e)return null;if("string"==typeof e)return e;if("number"==typeof e||"boolean"==typeof e)return e.toString();if(e instanceof Error)return e.message;try{return JSON.stringify(e)}catch(e){return null}}).filter(e=>e).join(" ");t>=(null!==i&&void 0!==i?i:e.logLevel)&&a({level:C[t].toLowerCase(),message:n,args:r,type:e.name})}}}(e,t)}function fe(e){var t;t=e,w.forEach(e=>{e.setLogLevel(t)})}const ge="firebase-heartbeat-database",me=1,be="firebase-heartbeat-store";let ve=null;function _e(){return ve=ve||function(e,t,{blocked:r,upgrade:n,blocking:i,terminated:a}){const s=indexedDB.open(e,t),o=z(s);return n&&s.addEventListener("upgradeneeded",e=>{n(z(s.result),e.oldVersion,e.newVersion,z(s.transaction),e)}),r&&s.addEventListener("blocked",e=>r(e.oldVersion,e.newVersion,e)),o.then(e=>{a&&e.addEventListener("close",()=>a()),i&&e.addEventListener("versionchange",e=>i(e.oldVersion,e.newVersion,e))}).catch(()=>{}),o}(ge,me,{upgrade:(e,t)=>{0===t&&e.createObjectStore(be)}}).catch(e=>{throw oe.create("idb-open",{originalErrorMessage:e.message})}),ve}async function Ee(e,t){try{const n=await _e(),i=n.transaction(be,"readwrite"),a=i.objectStore(be);return await a.put(t,ye(e)),i.done}catch(e){var r;e instanceof o?q.warn(e.message):(r=oe.create("idb-set",{originalErrorMessage:null==e?void 0:e.message}),q.warn(r.message))}}function ye(e){return`${e.name}!${e.options.appId}`}class Ie{constructor(e){this.container=e,this._heartbeatsCache=null;var t=this.container.getProvider("app").getImmediate();this._storage=new Ce(t),this._heartbeatsCachePromise=this._storage.read().then(e=>this._heartbeatsCache=e)}async triggerHeartbeat(){const e=this.container.getProvider("platform-logger").getImmediate();var t=e.getPlatformInfoString();const r=we();if(null===this._heartbeatsCache&&(this._heartbeatsCache=await this._heartbeatsCachePromise),this._heartbeatsCache.lastSentHeartbeatDate!==r&&!this._heartbeatsCache.heartbeats.some(e=>e.date===r))return this._heartbeatsCache.heartbeats.push({date:r,agent:t}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter(e=>{var t=new Date(e.date).valueOf();return Date.now()-t<=2592e6}),this._storage.overwrite(this._heartbeatsCache)}async getHeartbeatsHeader(){if(null===this._heartbeatsCache&&await this._heartbeatsCachePromise,null===this._heartbeatsCache||0===this._heartbeatsCache.heartbeats.length)return"";var e=we(),{heartbeatsToSend:t,unsentEntries:r}=function(e,t=1024){const r=[];let n=e.slice();for(const i of e){const a=r.find(e=>e.agent===i.agent);if(a){if(a.dates.push(i.date),De(r)>t){a.dates.pop();break}}else if(r.push({agent:i.agent,dates:[i.date]}),De(r)>t){r.pop();break}n=n.slice(1)}return{heartbeatsToSend:r,unsentEntries:n}}(this._heartbeatsCache.heartbeats),t=i(JSON.stringify({version:2,heartbeats:t}));return this._heartbeatsCache.lastSentHeartbeatDate=e,0<r.length?(this._heartbeatsCache.heartbeats=r,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),t}}function we(){const e=new Date;return e.toISOString().substring(0,10)}class Ce{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return!!function(){try{return"object"==typeof indexedDB}catch(e){return}}()&&new Promise((t,r)=>{try{let e=!0;const n="validate-browser-context-for-indexeddb-analytics-module",i=self.indexedDB.open(n);i.onsuccess=()=>{i.result.close(),e||self.indexedDB.deleteDatabase(n),t(!0)},i.onupgradeneeded=()=>{e=!1},i.onerror=()=>{var e;r((null===(e=i.error)||void 0===e?void 0:e.message)||"")}}catch(e){r(e)}}).then(()=>!0).catch(()=>!1)}async read(){return await this._canUseIndexedDBPromise&&await async function(e){try{const r=await _e();return r.transaction(be).objectStore(be).get(ye(e))}catch(e){var t;e instanceof o?q.warn(e.message):(t=oe.create("idb-get",{originalErrorMessage:null==e?void 0:e.message}),q.warn(t.message))}}(this.app)||{heartbeats:[]}}async overwrite(e){var t;if(await this._canUseIndexedDBPromise){var r=await this.read();return Ee(this.app,{lastSentHeartbeatDate:null!==(t=e.lastSentHeartbeatDate)&&void 0!==t?t:r.lastSentHeartbeatDate,heartbeats:e.heartbeats})}}async add(e){var t;if(await this._canUseIndexedDBPromise){var r=await this.read();return Ee(this.app,{lastSentHeartbeatDate:null!==(t=e.lastSentHeartbeatDate)&&void 0!==t?t:r.lastSentHeartbeatDate,heartbeats:[...r.heartbeats,...e.heartbeats]})}}}function De(e){return i(JSON.stringify({version:2,heartbeats:e})).length}Z="",ae(new _("platform-logger",e=>new Y(e),"PRIVATE")),ae(new _("heartbeat",e=>new Ie(e),"PRIVATE")),pe(X,"0.9.9",Z),pe(X,"0.9.9","esm2017"),pe("fire-js","");var Se=Object.freeze({__proto__:null,SDK_VERSION:he,_DEFAULT_ENTRY_NAME:Q,_addComponent:ne,_addOrOverwriteComponent:ie,_apps:te,_clearComponents:function(){re.clear()},_components:re,_getProvider:se,_registerComponent:ae,_removeServiceInstance:function(e,t,r=Q){se(e,t).clearInstance(r)},deleteApp:de,getApp:function(e=Q){var t=te.get(e);if(!t&&e===Q)return le();if(!t)throw oe.create("no-app",{appName:e});return t},getApps:function(){return Array.from(te.values())},initializeApp:le,onLog:ue,registerVersion:pe,setLogLevel:fe,FirebaseError:o});class Ae{constructor(e,t){this._delegate=e,this.firebase=t,ne(e,new _("app-compat",()=>this,"PUBLIC")),this.container=e.container}get automaticDataCollectionEnabled(){return this._delegate.automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this._delegate.automaticDataCollectionEnabled=e}get name(){return this._delegate.name}get options(){return this._delegate.options}delete(){return new Promise(e=>{this._delegate.checkDestroyed(),e()}).then(()=>(this.firebase.INTERNAL.removeApp(this.name),de(this._delegate)))}_getService(e,t=Q){var r;this._delegate.checkDestroyed();const n=this._delegate.container.getProvider(e);return n.isInitialized()||"EXPLICIT"!==(null===(r=n.getComponent())||void 0===r?void 0:r.instantiationMode)||n.initialize(),n.getImmediate({identifier:t})}_removeServiceInstance(e,t=Q){this._delegate.container.getProvider(e).clearInstance(t)}_addComponent(e){ne(this._delegate,e)}_addOrOverwriteComponent(e){ie(this._delegate,e)}toJSON(){return{name:this.name,automaticDataCollectionEnabled:this.automaticDataCollectionEnabled,options:this.options}}}const Oe=new d("app-compat","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call Firebase App.initializeApp()","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance."});function Le(i){const a={},s={__esModule:!0,initializeApp:function(e,t={}){var r=le(e,t);if(u(a,r.name))return a[r.name];var n=new i(r,s);return a[r.name]=n},app:o,registerVersion:pe,setLogLevel:fe,onLog:ue,apps:null,SDK_VERSION:he,INTERNAL:{registerComponent:function(r){const n=r.name,t=n.replace("-compat","");{var e;ae(r)&&"PUBLIC"===r.type&&(e=(e=o())=>{if("function"!=typeof e[t])throw Oe.create("invalid-app-argument",{appName:n});return e[t]()},void 0!==r.serviceProps&&c(e,r.serviceProps),s[t]=e,i.prototype[t]=function(...e){const t=this._getService.bind(this,n);return t.apply(this,r.multipleInstances?e:[])})}return"PUBLIC"===r.type?s[t]:null},removeApp:function(e){delete a[e]},useAsService:function(e,t){if("serverAuth"===t)return null;var r=t;return r},modularAPIs:Se}};function o(e){if(e=e||Q,!u(a,e))throw Oe.create("no-app",{appName:e});return a[e]}return s.default=s,Object.defineProperty(s,"apps",{get:function(){return Object.keys(a).map(e=>a[e])}}),o.App=i,s}var Ne=function e(){const t=Le(Ae);return t.INTERNAL=Object.assign(Object.assign({},t.INTERNAL),{createFirebaseNamespace:e,extendNamespace:function(e){c(t,e)},createSubscribe:m,ErrorFactory:d,deepExtend:c}),t}();const Be=new B("@firebase/app-compat");if("object"==typeof self&&self.self===self&&void 0!==self.firebase){Be.warn(`
    Warning: Firebase is already defined in the global scope. Please make sure
    Firebase library is only loaded once.
  `);const Pe=self.firebase.SDK_VERSION;Pe&&0<=Pe.indexOf("LITE")&&Be.warn(`
    Warning: You are trying to load Firebase while using Firebase Performance standalone script.
    You should load Firebase Performance with this instance of Firebase to avoid loading duplicate code.
    `)}const Te=Ne;pe("@firebase/app-compat","0.2.9",void 0);return Te.registerVersion("firebase","9.21.0","app-compat-cdn"),Te});
//# sourceMappingURL=firebase-app-compat.js.map

!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(require("@firebase/app-compat"),require("@firebase/app")):"function"==typeof define&&define.amd?define(["@firebase/app-compat","@firebase/app"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).firebase,e.firebase.INTERNAL.modularAPIs)}(this,function(bi,ki){"use strict";try{!(function(){function e(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var i=e(bi);const t={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray(n,e){if(!Array.isArray(n))throw Error("encodeByteArray takes an array as a parameter");this.init_();var r=e?this.byteToCharMapWebSafe_:this.byteToCharMap_;const i=[];for(let u=0;u<n.length;u+=3){var s=n[u],a=u+1<n.length,o=a?n[u+1]:0,c=u+2<n.length,l=c?n[u+2]:0;let e=(15&o)<<2|l>>6,t=63&l;c||(t=64,a||(e=64)),i.push(r[s>>2],r[(3&s)<<4|o>>4],r[e],r[t])}return i.join("")},encodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(e):this.encodeByteArray(function(t){const n=[];let r=0;for(let i=0;i<t.length;i++){let e=t.charCodeAt(i);e<128?n[r++]=e:(e<2048?n[r++]=e>>6|192:(55296==(64512&e)&&i+1<t.length&&56320==(64512&t.charCodeAt(i+1))?(e=65536+((1023&e)<<10)+(1023&t.charCodeAt(++i)),n[r++]=e>>18|240,n[r++]=e>>12&63|128):n[r++]=e>>12|224,n[r++]=e>>6&63|128),n[r++]=63&e|128)}return n}(e),t)},decodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(e):function(e){const t=[];let n=0,r=0;for(;n<e.length;){var i,s,a=e[n++];a<128?t[r++]=String.fromCharCode(a):191<a&&a<224?(i=e[n++],t[r++]=String.fromCharCode((31&a)<<6|63&i)):239<a&&a<365?(s=((7&a)<<18|(63&e[n++])<<12|(63&e[n++])<<6|63&e[n++])-65536,t[r++]=String.fromCharCode(55296+(s>>10)),t[r++]=String.fromCharCode(56320+(1023&s))):(i=e[n++],s=e[n++],t[r++]=String.fromCharCode((15&a)<<12|(63&i)<<6|63&s))}return t.join("")}(this.decodeStringToByteArray(e,t))},decodeStringToByteArray(e,t){this.init_();var n=t?this.charToByteMapWebSafe_:this.charToByteMap_;const r=[];for(let c=0;c<e.length;){var i=n[e.charAt(c++)],s=c<e.length?n[e.charAt(c)]:0;++c;var a=c<e.length?n[e.charAt(c)]:64;++c;var o=c<e.length?n[e.charAt(c)]:64;if(++c,null==i||null==s||null==a||null==o)throw new l;r.push(i<<2|s>>4),64!==a&&(r.push(s<<4&240|a>>2),64!==o&&r.push(a<<6&192|o))}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let e=0;e<this.ENCODED_VALS.length;e++)this.byteToCharMap_[e]=this.ENCODED_VALS.charAt(e),this.charToByteMap_[this.byteToCharMap_[e]]=e,this.byteToCharMapWebSafe_[e]=this.ENCODED_VALS_WEBSAFE.charAt(e),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[e]]=e,e>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(e)]=e,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(e)]=e)}}};class l extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const s=function(e){try{return t.decodeString(e,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};const n=()=>function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if("undefined"!=typeof global)return global;throw new Error("Unable to locate global object.")}().__FIREBASE_DEFAULTS__,r=()=>{if("undefined"!=typeof process&&void 0!==process.env){var e=process.env.__FIREBASE_DEFAULTS__;return e?JSON.parse(e):void 0}},a=()=>{if("undefined"!=typeof document){let e;try{e=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch(e){return}var t=e&&s(e[1]);return t&&JSON.parse(t)}},o=()=>{try{return n()||r()||a()}catch(e){return void console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${e}`)}};var c,u;function d(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}function h(){var e=null===(e=o())||void 0===e?void 0:e.forceEnvironment;if("node"===e)return!0;if("browser"===e)return!1;try{return"[object process]"===Object.prototype.toString.call(global.process)}catch(e){return!1}}function p(){var e="object"==typeof chrome?chrome.runtime:"object"==typeof browser?browser.runtime:void 0;return"object"==typeof e&&void 0!==e.id}function f(){return"object"==typeof navigator&&"ReactNative"===navigator.product}function v(){const e=d();return 0<=e.indexOf("MSIE ")||0<=e.indexOf("Trident/")}function g(){try{return"object"==typeof indexedDB}catch(e){return!1}}class m extends Error{constructor(e,t,n){super(t),this.code=e,this.customData=n,this.name="FirebaseError",Object.setPrototypeOf(this,m.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,_.prototype.create)}}class _{constructor(e,t,n){this.service=e,this.serviceName=t,this.errors=n}create(e,...t){var r,n=t[0]||{},i=`${this.service}/${e}`,s=this.errors[e],s=s?(r=n,s.replace(y,(e,t)=>{var n=r[t];return null!=n?String(n):`<${t}?>`})):"Error",s=`${this.serviceName}: ${s} (${i}).`;return new m(i,s,n)}}const y=/\{\$([^}]+)}/g;function I(e){const t=[];for(const[n,r]of Object.entries(e))Array.isArray(r)?r.forEach(e=>{t.push(encodeURIComponent(n)+"="+encodeURIComponent(e))}):t.push(encodeURIComponent(n)+"="+encodeURIComponent(r));return t.length?"&"+t.join("&"):""}function w(e){const r={},t=e.replace(/^\?/,"").split("&");return t.forEach(e=>{var t,n;e&&([t,n]=e.split("="),r[decodeURIComponent(t)]=decodeURIComponent(n))}),r}function T(e){var t=e.indexOf("?");if(!t)return"";var n=e.indexOf("#",t);return e.substring(t,0<n?n:void 0)}class b{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(e=>{this.error(e)})}next(t){this.forEachObserver(e=>{e.next(t)})}error(t){this.forEachObserver(e=>{e.error(t)}),this.close(t)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,n){let r;if(void 0===e&&void 0===t&&void 0===n)throw new Error("Missing Observer.");r=function(e,t){if("object"!=typeof e||null===e)return!1;for(const n of t)if(n in e&&"function"==typeof e[n])return!0;return!1}(e,["next","error","complete"])?e:{next:e,error:t,complete:n},void 0===r.next&&(r.next=k),void 0===r.error&&(r.error=k),void 0===r.complete&&(r.complete=k);var i=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?r.error(this.finalError):r.complete()}catch(e){}}),this.observers.push(r),i}unsubscribeOne(e){void 0!==this.observers&&void 0!==this.observers[e]&&(delete this.observers[e],--this.observerCount,0===this.observerCount&&void 0!==this.onNoObservers&&this.onNoObservers(this))}forEachObserver(t){if(!this.finalized)for(let e=0;e<this.observers.length;e++)this.sendOne(e,t)}sendOne(e,t){this.task.then(()=>{if(void 0!==this.observers&&void 0!==this.observers[e])try{t(this.observers[e])}catch(e){"undefined"!=typeof console&&console.error&&console.error(e)}})}close(e){this.finalized||(this.finalized=!0,void 0!==e&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function k(){}function E(e){return e&&e._delegate?e._delegate:e}function R(e,t){var n={};for(i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols)for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n}(u=c=c||{})[u.DEBUG=0]="DEBUG",u[u.VERBOSE=1]="VERBOSE",u[u.INFO=2]="INFO",u[u.WARN=3]="WARN",u[u.ERROR=4]="ERROR",u[u.SILENT=5]="SILENT";const A={debug:c.DEBUG,verbose:c.VERBOSE,info:c.INFO,warn:c.WARN,error:c.ERROR,silent:c.SILENT},S=c.INFO,C={[c.DEBUG]:"log",[c.VERBOSE]:"log",[c.INFO]:"info",[c.WARN]:"warn",[c.ERROR]:"error"},P=(e,t,...n)=>{if(!(t<e.logLevel)){var r=(new Date).toISOString(),i=C[t];if(!i)throw new Error(`Attempted to log a message with an invalid logType (value: ${t})`);console[i](`[${r}]  ${e.name}:`,...n)}};class N{constructor(e,t,n){this.name=e,this.instanceFactory=t,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}const O={FACEBOOK:"facebook.com",GITHUB:"github.com",GOOGLE:"google.com",PASSWORD:"password",PHONE:"phone",TWITTER:"twitter.com"},L={EMAIL_SIGNIN:"EMAIL_SIGNIN",PASSWORD_RESET:"PASSWORD_RESET",RECOVER_EMAIL:"RECOVER_EMAIL",REVERT_SECOND_FACTOR_ADDITION:"REVERT_SECOND_FACTOR_ADDITION",VERIFY_AND_CHANGE_EMAIL:"VERIFY_AND_CHANGE_EMAIL",VERIFY_EMAIL:"VERIFY_EMAIL"};function D(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}function M(){return{"admin-restricted-operation":"This operation is restricted to administrators only.","argument-error":"","app-not-authorized":"This app, identified by the domain where it's hosted, is not authorized to use Firebase Authentication with the provided API key. Review your key configuration in the Google API console.","app-not-installed":"The requested mobile application corresponding to the identifier (Android package name or iOS bundle ID) provided is not installed on this device.","captcha-check-failed":"The reCAPTCHA response token provided is either invalid, expired, already used or the domain associated with it does not match the list of whitelisted domains.","code-expired":"The SMS code has expired. Please re-send the verification code to try again.","cordova-not-ready":"Cordova framework is not ready.","cors-unsupported":"This browser is not supported.","credential-already-in-use":"This credential is already associated with a different user account.","custom-token-mismatch":"The custom token corresponds to a different audience.","requires-recent-login":"This operation is sensitive and requires recent authentication. Log in again before retrying this request.","dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK.","dynamic-link-not-activated":"Please activate Dynamic Links in the Firebase Console and agree to the terms and conditions.","email-change-needs-verification":"Multi-factor users must always have a verified email.","email-already-in-use":"The email address is already in use by another account.","emulator-config-failed":'Auth instance has already been used to make a network call. Auth can no longer be configured to use the emulator. Try calling "connectAuthEmulator()" sooner.',"expired-action-code":"The action code has expired.","cancelled-popup-request":"This operation has been cancelled due to another conflicting popup being opened.","internal-error":"An internal AuthError has occurred.","invalid-app-credential":"The phone verification request contains an invalid application verifier. The reCAPTCHA token response is either invalid or expired.","invalid-app-id":"The mobile app identifier is not registed for the current project.","invalid-user-token":"This user's credential isn't valid for this project. This can happen if the user's token has been tampered with, or if the user isn't for the project associated with this API key.","invalid-auth-event":"An internal AuthError has occurred.","invalid-verification-code":"The SMS verification code used to create the phone auth credential is invalid. Please resend the verification code sms and be sure to use the verification code provided by the user.","invalid-continue-uri":"The continue URL provided in the request is invalid.","invalid-cordova-configuration":"The following Cordova plugins must be installed to enable OAuth sign-in: cordova-plugin-buildinfo, cordova-universal-links-plugin, cordova-plugin-browsertab, cordova-plugin-inappbrowser and cordova-plugin-customurlscheme.","invalid-custom-token":"The custom token format is incorrect. Please check the documentation.","invalid-dynamic-link-domain":"The provided dynamic link domain is not configured or authorized for the current project.","invalid-email":"The email address is badly formatted.","invalid-emulator-scheme":"Emulator URL must start with a valid scheme (http:// or https://).","invalid-api-key":"Your API key is invalid, please check you have copied it correctly.","invalid-cert-hash":"The SHA-1 certificate hash provided is invalid.","invalid-credential":"The supplied auth credential is malformed or has expired.","invalid-message-payload":"The email template corresponding to this action contains invalid characters in its message. Please fix by going to the Auth email templates section in the Firebase Console.","invalid-multi-factor-session":"The request does not contain a valid proof of first factor successful sign-in.","invalid-oauth-provider":"EmailAuthProvider is not supported for this operation. This operation only supports OAuth providers.","invalid-oauth-client-id":"The OAuth client ID provided is either invalid or does not match the specified API key.","unauthorized-domain":"This domain is not authorized for OAuth operations for your Firebase project. Edit the list of authorized domains from the Firebase console.","invalid-action-code":"The action code is invalid. This can happen if the code is malformed, expired, or has already been used.","wrong-password":"The password is invalid or the user does not have a password.","invalid-persistence-type":"The specified persistence type is invalid. It can only be local, session or none.","invalid-phone-number":"The format of the phone number provided is incorrect. Please enter the phone number in a format that can be parsed into E.164 format. E.164 phone numbers are written in the format [+][country code][subscriber number including area code].","invalid-provider-id":"The specified provider ID is invalid.","invalid-recipient-email":"The email corresponding to this action failed to send as the provided recipient email address is invalid.","invalid-sender":"The email template corresponding to this action contains an invalid sender email or name. Please fix by going to the Auth email templates section in the Firebase Console.","invalid-verification-id":"The verification ID used to create the phone auth credential is invalid.","invalid-tenant-id":"The Auth instance's tenant ID is invalid.","login-blocked":"Login blocked by user-provided method: {$originalMessage}","missing-android-pkg-name":"An Android Package Name must be provided if the Android App is required to be installed.","auth-domain-config-required":"Be sure to include authDomain when calling firebase.initializeApp(), by following the instructions in the Firebase console.","missing-app-credential":"The phone verification request is missing an application verifier assertion. A reCAPTCHA response token needs to be provided.","missing-verification-code":"The phone auth credential was created with an empty SMS verification code.","missing-continue-uri":"A continue URL must be provided in the request.","missing-iframe-start":"An internal AuthError has occurred.","missing-ios-bundle-id":"An iOS Bundle ID must be provided if an App Store ID is provided.","missing-or-invalid-nonce":"The request does not contain a valid nonce. This can occur if the SHA-256 hash of the provided raw nonce does not match the hashed nonce in the ID token payload.","missing-password":"A non-empty password must be provided","missing-multi-factor-info":"No second factor identifier is provided.","missing-multi-factor-session":"The request is missing proof of first factor successful sign-in.","missing-phone-number":"To send verification codes, provide a phone number for the recipient.","missing-verification-id":"The phone auth credential was created with an empty verification ID.","app-deleted":"This instance of FirebaseApp has been deleted.","multi-factor-info-not-found":"The user does not have a second factor matching the identifier provided.","multi-factor-auth-required":"Proof of ownership of a second factor is required to complete sign-in.","account-exists-with-different-credential":"An account already exists with the same email address but different sign-in credentials. Sign in using a provider associated with this email address.","network-request-failed":"A network AuthError (such as timeout, interrupted connection or unreachable host) has occurred.","no-auth-event":"An internal AuthError has occurred.","no-such-provider":"User was not linked to an account with the given provider.","null-user":"A null user object was provided as the argument for an operation which requires a non-null user object.","operation-not-allowed":"The given sign-in provider is disabled for this Firebase project. Enable it in the Firebase console, under the sign-in method tab of the Auth section.","operation-not-supported-in-this-environment":'This operation is not supported in the environment this application is running on. "location.protocol" must be http, https or chrome-extension and web storage must be enabled.',"popup-blocked":"Unable to establish a connection with the popup. It may have been blocked by the browser.","popup-closed-by-user":"The popup has been closed by the user before finalizing the operation.","provider-already-linked":"User can only be linked to one identity for the given provider.","quota-exceeded":"The project's quota for this operation has been exceeded.","redirect-cancelled-by-user":"The redirect operation has been cancelled by the user before finalizing.","redirect-operation-pending":"A redirect sign-in operation is already pending.","rejected-credential":"The request contains malformed or mismatching credentials.","second-factor-already-in-use":"The second factor is already enrolled on this account.","maximum-second-factor-count-exceeded":"The maximum allowed number of second factors on a user has been exceeded.","tenant-id-mismatch":"The provided tenant ID does not match the Auth instance's tenant ID",timeout:"The operation has timed out.","user-token-expired":"The user's credential is no longer valid. The user must sign in again.","too-many-requests":"We have blocked all requests from this device due to unusual activity. Try again later.","unauthorized-continue-uri":"The domain of the continue URL is not whitelisted.  Please whitelist the domain in the Firebase console.","unsupported-first-factor":"Enrolling a second factor or signing in with a multi-factor account requires sign-in with a supported first factor.","unsupported-persistence-type":"The current environment does not support the specified persistence type.","unsupported-tenant-operation":"This operation is not supported in a multi-tenant context.","unverified-email":"The operation requires a verified email.","user-cancelled":"The user did not grant your application the permissions it requested.","user-not-found":"There is no user record corresponding to this identifier. The user may have been deleted.","user-disabled":"The user account has been disabled by an administrator.","user-mismatch":"The supplied credentials do not correspond to the previously signed in user.","user-signed-out":"","weak-password":"The password must be 6 characters long or more.","web-storage-unsupported":"This browser is not supported or 3rd party cookies and data may be disabled.","already-initialized":"initializeAuth() has already been called with different options. To avoid this error, call initializeAuth() with the same options as when it was originally called, or call getAuth() to return the already initialized instance.","missing-recaptcha-token":"The reCAPTCHA token is missing when sending request to the backend.","invalid-recaptcha-token":"The reCAPTCHA token is invalid when sending request to the backend.","invalid-recaptcha-action":"The reCAPTCHA action is invalid when sending request to the backend.","recaptcha-not-enabled":"reCAPTCHA Enterprise integration is not enabled for this project.","missing-client-type":"The reCAPTCHA client type is missing when sending request to the backend.","missing-recaptcha-version":"The reCAPTCHA version is missing when sending request to the backend.","invalid-req-type":"Invalid request parameters.","invalid-recaptcha-version":"The reCAPTCHA version is invalid when sending request to the backend."}}const U=D,F=new _("auth","Firebase",D()),V=new class{constructor(e){this.name=e,this._logLevel=S,this._logHandler=P,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in c))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel="string"==typeof e?A[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if("function"!=typeof e)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,c.DEBUG,...e),this._logHandler(this,c.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,c.VERBOSE,...e),this._logHandler(this,c.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,c.INFO,...e),this._logHandler(this,c.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,c.WARN,...e),this._logHandler(this,c.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,c.ERROR,...e),this._logHandler(this,c.ERROR,...e)}}("@firebase/auth");function x(e,...t){V.logLevel<=c.ERROR&&V.error(`Auth (${ki.SDK_VERSION}): ${e}`,...t)}function j(e,...t){throw z(e,...t)}function H(e,...t){return z(e,...t)}function W(e,t,n){var r=Object.assign(Object.assign({},U()),{[t]:n});const i=new _("auth","Firebase",r);return i.create(t,{appName:e.name})}function q(e,t,n){if(!(t instanceof n))throw n.name!==t.constructor.name&&j(e,"argument-error"),W(e,"argument-error",`Type of ${t.constructor.name} does not match expected instance.`+"Did you pass a reference from a different Auth SDK?")}function z(e,...t){if("string"==typeof e)return F.create(e,...t);{var n=t[0];const r=[...t.slice(1)];return r[0]&&(r[0].appName=e.name),e._errorFactory.create(n,...r)}}function B(e,t,...n){if(!e)throw z(t,...n)}function G(e){var t="INTERNAL ASSERTION FAILED: "+e;throw x(t),new Error(t)}function K(e,t){e||G(t)}function $(){var e;return"undefined"!=typeof self&&(null===(e=self.location)||void 0===e?void 0:e.href)||""}function J(){return"http:"===Y()||"https:"===Y()}function Y(){var e;return"undefined"!=typeof self&&(null===(e=self.location)||void 0===e?void 0:e.protocol)||null}class X{constructor(e,t){K((this.shortDelay=e)<(this.longDelay=t),"Short delay should be less than long delay!"),this.isMobile="undefined"!=typeof window&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(d())||f()}get(){return"undefined"!=typeof navigator&&navigator&&"onLine"in navigator&&"boolean"==typeof navigator.onLine&&(J()||p()||"connection"in navigator)&&!navigator.onLine?Math.min(5e3,this.shortDelay):this.isMobile?this.longDelay:this.shortDelay}}function Q(e,t){K(e.emulator,"Emulator should always be set here");var n=e.emulator["url"];return t?`${n}${t.startsWith("/")?t.slice(1):t}`:n}class Z{static initialize(e,t,n){this.fetchImpl=e,t&&(this.headersImpl=t),n&&(this.responseImpl=n)}static fetch(){return this.fetchImpl||("undefined"!=typeof self&&"fetch"in self?self.fetch:void G("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill"))}static headers(){return this.headersImpl||("undefined"!=typeof self&&"Headers"in self?self.Headers:void G("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill"))}static response(){return this.responseImpl||("undefined"!=typeof self&&"Response"in self?self.Response:void G("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill"))}}const ee={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"},te=new X(3e4,6e4);function ne(e,t){return e.tenantId&&!t.tenantId?Object.assign(Object.assign({},t),{tenantId:e.tenantId}):t}async function re(i,s,a,o,e={}){return ie(i,e,async()=>{let e={},t={};o&&("GET"===s?t=o:e={body:JSON.stringify(o)});var n=I(Object.assign({key:i.config.apiKey},t)).slice(1);const r=await i._getAdditionalHeaders();return r["Content-Type"]="application/json",i.languageCode&&(r["X-Firebase-Locale"]=i.languageCode),Z.fetch()(ae(i,i.config.apiHost,a,n),Object.assign({method:s,headers:r,referrerPolicy:"no-referrer"},e))})}async function ie(t,e,n){t._canInitEmulator=!1;var r=Object.assign(Object.assign({},ee),e);try{const a=new oe(t),o=await Promise.race([n(),a.promise]);a.clearNetworkTimeout();var i=await o.json();if("needConfirmation"in i)throw ce(t,"account-exists-with-different-credential",i);if(o.ok&&!("errorMessage"in i))return i;{const c=o.ok?i.errorMessage:i.error.message,[l,u]=c.split(" : ");if("FEDERATED_USER_ID_ALREADY_LINKED"===l)throw ce(t,"credential-already-in-use",i);if("EMAIL_EXISTS"===l)throw ce(t,"email-already-in-use",i);if("USER_DISABLED"===l)throw ce(t,"user-disabled",i);var s=r[l]||l.toLowerCase().replace(/[_\s]+/g,"-");if(u)throw W(t,s,u);j(t,s)}}catch(e){if(e instanceof m)throw e;j(t,"network-request-failed",{message:String(e)})}}async function se(e,t,n,r,i={}){var s=await re(e,t,n,r,i);return"mfaPendingCredential"in s&&j(e,"multi-factor-auth-required",{_serverResponse:s}),s}function ae(e,t,n,r){var i=`${t}${n}?${r}`;return e.config.emulator?Q(e.config,i):`${e.config.apiScheme}://${i}`}class oe{constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((e,t)=>{this.timer=setTimeout(()=>t(H(this.auth,"network-request-failed")),te.get())})}clearNetworkTimeout(){clearTimeout(this.timer)}}function ce(e,t,n){const r={appName:e.name};n.email&&(r.email=n.email),n.phoneNumber&&(r.phoneNumber=n.phoneNumber);const i=H(e,t,r);return i.customData._tokenResponse=n,i}function le(e){if(e)try{const t=new Date(Number(e));if(!isNaN(t.getTime()))return t.toUTCString()}catch(e){}}function ue(e){return 1e3*Number(e)}function de(e){var[t,n,r]=e.split(".");if(void 0===t||void 0===n||void 0===r)return x("JWT malformed, contained fewer than 3 sections"),null;try{var i=s(n);return i?JSON.parse(i):(x("Failed to decode base64 JWT payload"),null)}catch(e){return x("Caught error parsing JWT payload as JSON",null==e?void 0:e.toString()),null}}async function he(t,n,e=!1){if(e)return n;try{return n}catch(e){throw e instanceof m&&(n=[e["code"]][0],"auth/user-disabled"===n||"auth/user-token-expired"===n)&&t.auth.currentUser===t&&await t.auth.signOut(),e}}class pe{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,null!==this.timerId&&clearTimeout(this.timerId))}getInterval(e){if(e){var t=this.errorBackoff;return this.errorBackoff=Math.min(2*this.errorBackoff,96e4),t}this.errorBackoff=3e4;t=(null!==(t=this.user.stsTokenManager.expirationTime)&&void 0!==t?t:0)-Date.now()-3e5;return Math.max(0,t)}schedule(e=!1){var t;this.isRunning&&(t=this.getInterval(e),this.timerId=setTimeout(async()=>{await this.iteration()},t))}async iteration(){try{await this.user.getIdToken(!0)}catch(e){return void("auth/network-request-failed"===(null==e?void 0:e.code)&&this.schedule(!0))}this.schedule()}}class fe{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=le(this.lastLoginAt),this.creationTime=le(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}async function ve(e){var t=e.auth,n=await e.getIdToken(),r=await he(e,async function(e,t){return re(e,"POST","/v1/accounts:lookup",t)}(t,{idToken:n}));B(null==r?void 0:r.users.length,t,"internal-error");var i=r.users[0];e._notifyReloadListener(i);var s,a,t=null!==(n=i.providerUserInfo)&&void 0!==n&&n.length?i.providerUserInfo.map(e=>{var t=e["providerId"],n=R(e,["providerId"]);return{providerId:t,uid:n.rawId||"",displayName:n.displayName||null,email:n.email||null,phoneNumber:n.phoneNumber||null,photoURL:n.photoUrl||null}}):[],r=(s=e.providerData,a=t,[...s.filter(t=>!a.some(e=>e.providerId===t.providerId)),...a]),n=e.isAnonymous,t=!(e.email&&i.passwordHash||null!==r&&r.length),t=!!n&&t,t={uid:i.localId,displayName:i.displayName||null,photoURL:i.photoUrl||null,email:i.email||null,emailVerified:i.emailVerified||!1,phoneNumber:i.phoneNumber||null,tenantId:i.tenantId||null,providerData:r,metadata:new fe(i.createdAt,i.lastLoginAt),isAnonymous:t};Object.assign(e,t)}class ge{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){B(e.idToken,"internal-error"),B(void 0!==e.idToken,"internal-error"),B(void 0!==e.refreshToken,"internal-error");var t,n,n="expiresIn"in e&&void 0!==e.expiresIn?Number(e.expiresIn):(t=e.idToken,B(n=de(t),"internal-error"),B(void 0!==n.exp,"internal-error"),B(void 0!==n.iat,"internal-error"),Number(n.exp)-Number(n.iat));this.updateTokensAndExpiration(e.idToken,e.refreshToken,n)}async getToken(e,t=!1){return B(!this.accessToken||this.refreshToken,e,"user-token-expired"),t||!this.accessToken||this.isExpired?this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null:this.accessToken}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){var i,s,{accessToken:n,refreshToken:r,expiresIn:a}=(s=t,await{accessToken:(a=await ie(i=e,{},async()=>{var e=I({grant_type:"refresh_token",refresh_token:s}).slice(1),{tokenApiHost:t,apiKey:n}=i.config,n=ae(i,t,"/v1/token",`key=${n}`);const r=await i._getAdditionalHeaders();return r["Content-Type"]="application/x-www-form-urlencoded",Z.fetch()(n,{method:"POST",headers:r,body:e})})).access_token,expiresIn:a.expires_in,refreshToken:a.refresh_token});this.updateTokensAndExpiration(n,r,Number(a))}updateTokensAndExpiration(e,t,n){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+1e3*n}static fromJSON(e,t){var{refreshToken:n,accessToken:r,expirationTime:i}=t;const s=new ge;return n&&(B("string"==typeof n,"internal-error",{appName:e}),s.refreshToken=n),r&&(B("string"==typeof r,"internal-error",{appName:e}),s.accessToken=r),i&&(B("number"==typeof i,"internal-error",{appName:e}),s.expirationTime=i),s}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new ge,this.toJSON())}_performRefresh(){return G("not implemented")}}function me(e,t){B("string"==typeof e||void 0===e,"internal-error",{appName:t})}class _e{constructor(e){var{uid:t,auth:n,stsTokenManager:r}=e,i=R(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new pe(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=t,this.auth=n,this.stsTokenManager=r,this.accessToken=r.accessToken,this.displayName=i.displayName||null,this.email=i.email||null,this.emailVerified=i.emailVerified||!1,this.phoneNumber=i.phoneNumber||null,this.photoURL=i.photoURL||null,this.isAnonymous=i.isAnonymous||!1,this.tenantId=i.tenantId||null,this.providerData=i.providerData?[...i.providerData]:[],this.metadata=new fe(i.createdAt||void 0,i.lastLoginAt||void 0)}async getIdToken(e){var t=await he(this,this.stsTokenManager.getToken(this.auth,e));return B(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return async function(e,t=!1){const n=E(e);var r=await n.getIdToken(t),i=de(r);B(i&&i.exp&&i.auth_time&&i.iat,n.auth,"internal-error");var s="object"==typeof i.firebase?i.firebase:void 0,a=null==s?void 0:s.sign_in_provider;return{claims:i,token:r,authTime:le(ue(i.auth_time)),issuedAtTime:le(ue(i.iat)),expirationTime:le(ue(i.exp)),signInProvider:a||null,signInSecondFactor:(null==s?void 0:s.sign_in_second_factor)||null}}(this,e)}reload(){return async function(e){const t=E(e);await ve(t),await t.auth._persistUserIfCurrent(t),t.auth._notifyListenersIfCurrent(t)}(this)}_assign(e){this!==e&&(B(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(e=>Object.assign({},e)),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const t=new _e(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}));return t.metadata._copy(this.metadata),t}_onReload(e){B(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,t=!1){let n=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),n=!0),t&&await ve(this),await this.auth._persistUserIfCurrent(this),n&&this.auth._notifyListenersIfCurrent(this)}async delete(){var e=await this.getIdToken();return await he(this,async function(e,t){return re(e,"POST","/v1/accounts:delete",t)}(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>Object.assign({},e)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){var n=null!==(a=t.displayName)&&void 0!==a?a:void 0,r=null!==(v=t.email)&&void 0!==v?v:void 0,i=null!==(o=t.phoneNumber)&&void 0!==o?o:void 0,s=null!==(l=t.photoURL)&&void 0!==l?l:void 0,a=null!==(c=t.tenantId)&&void 0!==c?c:void 0,o=null!==(v=t._redirectEventId)&&void 0!==v?v:void 0,c=null!==(l=t.createdAt)&&void 0!==l?l:void 0,l=null!==(v=t.lastLoginAt)&&void 0!==v?v:void 0;const{uid:u,emailVerified:d,isAnonymous:h,providerData:p,stsTokenManager:f}=t;B(u&&f,e,"internal-error");var v=ge.fromJSON(this.name,f);B("string"==typeof u,e,"internal-error"),me(n,e.name),me(r,e.name),B("boolean"==typeof d,e,"internal-error"),B("boolean"==typeof h,e,"internal-error"),me(i,e.name),me(s,e.name),me(a,e.name),me(o,e.name),me(c,e.name),me(l,e.name);const g=new _e({uid:u,auth:e,email:r,emailVerified:d,displayName:n,isAnonymous:h,photoURL:s,phoneNumber:i,tenantId:a,stsTokenManager:v,createdAt:c,lastLoginAt:l});return p&&Array.isArray(p)&&(g.providerData=p.map(e=>Object.assign({},e))),o&&(g._redirectEventId=o),g}static async _fromIdTokenResponse(e,t,n=!1){const r=new ge;r.updateFromServerResponse(t);var i=new _e({uid:t.localId,auth:e,stsTokenManager:r,isAnonymous:n});return await ve(i),i}}const ye=new Map;function Ie(e){K(e instanceof Function,"Expected a class definition");let t=ye.get(e);return t?K(t instanceof e,"Instance stored in cache mismatched with class"):(t=new e,ye.set(e,t)),t}class we{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){var t=this.storage[e];return void 0===t?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}we.type="NONE";const Te=we;function be(e,t,n){return`firebase:${e}:${t}:${n}`}class ke{constructor(e,t,n){this.persistence=e,this.auth=t,this.userKey=n;var{config:r,name:i}=this.auth;this.fullUserKey=be(this.userKey,r.apiKey,i),this.fullPersistenceKey=be("persistence",r.apiKey,i),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){var e=await this.persistence._get(this.fullUserKey);return e?_e._fromJSON(this.auth,e):null}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence!==e){var t=await this.getCurrentUser();return await this.removeCurrentUser(),this.persistence=e,t?this.setCurrentUser(t):void 0}}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t,n="authUser"){if(!t.length)return new ke(Ie(Te),e,n);const r=(await Promise.all(t.map(async e=>{if(await e._isAvailable())return e}))).filter(e=>e);let i=r[0]||Ie(Te);const s=be(n,e.config.apiKey,e.name);let a=null;for(const u of t)try{var o=await u._get(s);if(o){var c=_e._fromJSON(e,o);u!==i&&(a=c),i=u;break}}catch(e){}var l=r.filter(e=>e._shouldAllowMigration);return i._shouldAllowMigration&&l.length&&(i=l[0],a&&await i._set(s,a.toJSON()),await Promise.all(t.map(async e=>{if(e!==i)try{await e._remove(s)}catch(e){}}))),new ke(i,e,n)}}function Ee(e){const t=e.toLowerCase();if(t.includes("opera/")||t.includes("opr/")||t.includes("opios/"))return"Opera";if(Ce(t))return"IEMobile";if(t.includes("msie")||t.includes("trident/"))return"IE";if(t.includes("edge/"))return"Edge";if(Re(t))return"Firefox";if(t.includes("silk/"))return"Silk";if(Ne(t))return"Blackberry";if(Oe(t))return"Webos";if(Ae(t))return"Safari";if((t.includes("chrome/")||Se(t))&&!t.includes("edge/"))return"Chrome";if(Pe(t))return"Android";var n=e.match(/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/);return 2===(null==n?void 0:n.length)?n[1]:"Other"}function Re(e=d()){return/firefox\//i.test(e)}function Ae(e=d()){const t=e.toLowerCase();return t.includes("safari/")&&!t.includes("chrome/")&&!t.includes("crios/")&&!t.includes("android")}function Se(e=d()){return/crios\//i.test(e)}function Ce(e=d()){return/iemobile/i.test(e)}function Pe(e=d()){return/android/i.test(e)}function Ne(e=d()){return/blackberry/i.test(e)}function Oe(e=d()){return/webos/i.test(e)}function Le(e=d()){return/iphone|ipad|ipod/i.test(e)||/macintosh/i.test(e)&&/mobile/i.test(e)}function De(e=d()){return Le(e)||Pe(e)||Oe(e)||Ne(e)||/windows phone/i.test(e)||Ce(e)}function Me(e,t=[]){let n;switch(e){case"Browser":n=Ee(d());break;case"Worker":n=`${Ee(d())}-${e}`;break;default:n=e}var r=t.length?t.join(","):"FirebaseCore-web";return`${n}/JsCore/${ki.SDK_VERSION}/${r}`}async function Ue(e,t){return re(e,"GET","/v2/recaptchaConfig",ne(e,t))}function Fe(e){return void 0!==e&&void 0!==e.getResponse}function Ve(e){return void 0!==e&&void 0!==e.enterprise}class xe{constructor(e){if(this.siteKey="",this.emailPasswordEnabled=!1,void 0===e.recaptchaKey)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.emailPasswordEnabled=e.recaptchaEnforcementState.some(e=>"EMAIL_PASSWORD_PROVIDER"===e.provider&&"OFF"!==e.enforcementState)}}function je(i){return new Promise((e,n)=>{const t=document.createElement("script");var r;t.setAttribute("src",i),t.onload=e,t.onerror=e=>{const t=H("internal-error");t.customData=e,n(t)},t.type="text/javascript",t.charset="UTF-8",(null!==(r=null===(r=document.getElementsByTagName("head"))||void 0===r?void 0:r[0])&&void 0!==r?r:document).appendChild(t)})}function He(e){return`__${e}${Math.floor(1e6*Math.random())}`}class We{constructor(e){this.type="recaptcha-enterprise",this.auth=Ge(e)}async verify(i="verify",r=!1){function s(e,t,n){const r=window.grecaptcha;Ve(r)?r.enterprise.ready(()=>{r.enterprise.execute(e,{action:i}).then(e=>{t(e)}).catch(()=>{t("NO_RECAPTCHA")})}):n(Error("No reCAPTCHA enterprise script loaded."))}return new Promise((t,n)=>{!async function(i){if(!r){if(null==i.tenantId&&null!=i._agentRecaptchaConfig)return i._agentRecaptchaConfig.siteKey;if(null!=i.tenantId&&void 0!==i._tenantRecaptchaConfigs[i.tenantId])return i._tenantRecaptchaConfigs[i.tenantId].siteKey}return new Promise(async(n,r)=>{Ue(i,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(e=>{if(void 0!==e.recaptchaKey){var t=new xe(e);return null==i.tenantId?i._agentRecaptchaConfig=t:i._tenantRecaptchaConfigs[i.tenantId]=t,n(t.siteKey)}r(new Error("recaptcha Enterprise site key undefined"))}).catch(e=>{r(e)})})}(this.auth).then(e=>{!r&&Ve(window.grecaptcha)?s(e,t,n):"undefined"!=typeof window?je("https://www.google.com/recaptcha/enterprise.js?render="+e).then(()=>{s(e,t,n)}).catch(e=>{n(e)}):n(new Error("RecaptchaVerifier is only supported in browser"))}).catch(e=>{n(e)})})}}async function qe(e,t,n,r=!1){const i=new We(e);let s;try{s=await i.verify(n)}catch(e){s=await i.verify(n,!0)}var a=Object.assign({},t);return r?Object.assign(a,{captchaResp:s}):Object.assign(a,{captchaResponse:s}),Object.assign(a,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(a,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),a}class ze{constructor(e){this.auth=e,this.queue=[]}pushCallback(r,e){var t=n=>new Promise((e,t)=>{try{e(r(n))}catch(e){t(e)}});t.onAbort=e,this.queue.push(t);const n=this.queue.length-1;return()=>{this.queue[n]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser!==e){const t=[];try{for(const n of this.queue)await n(e),n.onAbort&&t.push(n.onAbort)}catch(e){t.reverse();for(const r of t)try{r()}catch(e){}throw this.auth._errorFactory.create("login-blocked",{originalMessage:null==e?void 0:e.message})}}}}class Be{constructor(e,t,n,r){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=n,this.config=r,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new Ke(this),this.idTokenSubscription=new Ke(this),this.beforeStateQueue=new ze(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=F,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=r.sdkClientVersion}_initializeWithPersistence(t,n){return n&&(this._popupRedirectResolver=Ie(n)),this._initializationPromise=this.queue(async()=>{var e;if(!this._deleted&&(this.persistenceManager=await ke.create(this,t),!this._deleted)){if(null!==(e=this._popupRedirectResolver)&&void 0!==e&&e._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch(e){}await this.initializeCurrentUser(n),this.lastNotifiedUid=(null===(e=this.currentUser)||void 0===e?void 0:e.uid)||null,this._deleted||(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(!this._deleted){var e=await this.assertedPersistence.getCurrentUser();if(this.currentUser||e)return this.currentUser&&e&&this.currentUser.uid===e.uid?(this._currentUser._assign(e),void await this.currentUser.getIdToken()):void await this._updateCurrentUser(e,!0)}}async initializeCurrentUser(e){var t,n,r,i=await this.assertedPersistence.getCurrentUser();let s=i,a=!1;if(e&&this.config.authDomain&&(await this.getOrInitRedirectPersistenceManager(),t=null===(r=this.redirectUser)||void 0===r?void 0:r._redirectEventId,n=null===s||void 0===s?void 0:s._redirectEventId,r=await this.tryRedirectSignIn(e),t&&t!==n||null==r||!r.user||(s=r.user,a=!0)),!s)return this.directlySetCurrentUser(null);if(s._redirectEventId)return B(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===s._redirectEventId?this.directlySetCurrentUser(s):this.reloadAndSetCurrentUserOrClear(s);if(a)try{await this.beforeStateQueue.runMiddleware(s)}catch(e){s=i,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(e))}return s?this.reloadAndSetCurrentUserOrClear(s):this.directlySetCurrentUser(null)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch(e){await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await ve(e)}catch(e){if("auth/network-request-failed"!==(null==e?void 0:e.code))return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=function(){if("undefined"==typeof navigator)return null;var e=navigator;return e.languages&&e.languages[0]||e.language||null}()}async _delete(){this._deleted=!0}async updateCurrentUser(e){const t=e?E(e):null;return t&&B(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e,t=!1){if(!this._deleted)return e&&B(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0)}setPersistence(e){return this.queue(async()=>{await this.assertedPersistence.setPersistence(Ie(e))})}async initializeRecaptchaConfig(){var e=await Ue(this,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}),e=new xe(e);if(null==this.tenantId?this._agentRecaptchaConfig=e:this._tenantRecaptchaConfigs[this.tenantId]=e,e.emailPasswordEnabled){const t=new We(this);t.verify()}}_getRecaptchaConfig(){return null==this.tenantId?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(e){this._errorFactory=new _("auth","Firebase",e())}onAuthStateChanged(e,t,n){return this.registerStateListener(this.authStateSubscription,e,t,n)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,n){return this.registerStateListener(this.idTokenSubscription,e,t,n)}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:null===(e=this._currentUser)||void 0===e?void 0:e.toJSON()}}async _setRedirectUser(e,t){const n=await this.getOrInitRedirectPersistenceManager(t);return null===e?n.removeCurrentUser():n.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){var t;return this.redirectPersistenceManager||(B(t=e&&Ie(e)||this._popupRedirectResolver,this,"argument-error"),this.redirectPersistenceManager=await ke.create(this,[Ie(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()),this.redirectPersistenceManager}async _redirectUserForId(e){var t;return this._isInitialized&&await this.queue(async()=>{}),(null===(t=this._currentUser)||void 0===t?void 0:t._redirectEventId)===e?this._currentUser:(null===(t=this.redirectUser)||void 0===t?void 0:t._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e;this._isInitialized&&(this.idTokenSubscription.next(this.currentUser),e=null!==(e=null===(e=this.currentUser)||void 0===e?void 0:e.uid)&&void 0!==e?e:null,this.lastNotifiedUid!==e&&(this.lastNotifiedUid=e,this.authStateSubscription.next(this.currentUser)))}registerStateListener(e,t,n,r){if(this._deleted)return()=>{};const i="function"==typeof t?t:t.next.bind(t),s=this._isInitialized?Promise.resolve():this._initializationPromise;return B(s,this,"internal-error"),s.then(()=>i(this.currentUser)),"function"==typeof t?e.addObserver(t,n,r):e.addObserver(t)}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),(this.currentUser=e)?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return B(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){e&&!this.frameworks.includes(e)&&(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=Me(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){const e={"X-Client-Version":this.clientVersion};this.app.options.appId&&(e["X-Firebase-gmpid"]=this.app.options.appId);var t=await(null===(t=this.heartbeatServiceProvider.getImmediate({optional:!0}))||void 0===t?void 0:t.getHeartbeatsHeader());t&&(e["X-Firebase-Client"]=t);t=await this._getAppCheckToken();return t&&(e["X-Firebase-AppCheck"]=t),e}async _getAppCheckToken(){var e,t,n=await(null===(n=this.appCheckServiceProvider.getImmediate({optional:!0}))||void 0===n?void 0:n.getToken());return null!=n&&n.error&&(e=`Error while retrieving App Check token: ${n.error}`,t=[],V.logLevel<=c.WARN&&V.warn(`Auth (${ki.SDK_VERSION}): ${e}`,...t)),null==n?void 0:n.token}}function Ge(e){return E(e)}class Ke{constructor(e){this.auth=e,this.observer=null,this.addObserver=function(e,t){const n=new b(e,t);return n.subscribe.bind(n)}(e=>this.observer=e)}get next(){return B(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}function $e(e,t,n){const r=Ge(e);B(r._canInitEmulator,r,"emulator-config-failed"),B(/^https?:\/\//.test(t),r,"invalid-emulator-scheme");var i=!(null==n||!n.disableWarnings);const s=Je(t);var{host:a,port:o}=function(e){const t=Je(e),n=/(\/\/)?([^?#/]+)/.exec(e.substr(t.length));if(!n)return{host:"",port:null};const r=n[2].split("@").pop()||"",i=/^(\[[^\]]+\])(:|$)/.exec(r);{if(i){var s=i[1];return{host:s,port:Ye(r.substr(s.length+1))}}var[a,s]=r.split(":");return{host:a,port:Ye(s)}}}(t);r.config.emulator={url:`${s}//${a}${null===o?"":`:${o}`}/`},r.settings.appVerificationDisabledForTesting=!0,r.emulatorConfig=Object.freeze({host:a,port:o,protocol:s.replace(":",""),options:Object.freeze({disableWarnings:i})}),i||function(){function e(){const e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}"undefined"!=typeof console&&"function"==typeof console.info&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials.");"undefined"!=typeof window&&"undefined"!=typeof document&&("loading"===document.readyState?window.addEventListener("DOMContentLoaded",e):e())}()}function Je(e){var t=e.indexOf(":");return t<0?"":e.substr(0,t+1)}function Ye(e){if(!e)return null;var t=Number(e);return isNaN(t)?null:t}class Xe{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return G("not implemented")}_getIdTokenResponse(e){return G("not implemented")}_linkToIdToken(e,t){return G("not implemented")}_getReauthenticationResolver(e){return G("not implemented")}}async function Qe(e,t){return re(e,"POST","/v1/accounts:resetPassword",ne(e,t))}async function Ze(e,t){return re(e,"POST","/v1/accounts:update",t)}async function et(e,t){return se(e,"POST","/v1/accounts:signInWithPassword",ne(e,t))}async function tt(e,t){return re(e,"POST","/v1/accounts:sendOobCode",ne(e,t))}async function nt(e,t){return tt(e,t)}async function rt(e,t){return tt(e,t)}class it extends Xe{constructor(e,t,n,r=null){super("password",n),this._email=e,this._password=t,this._tenantId=r}static _fromEmailAndPassword(e,t){return new it(e,t,"password")}static _fromEmailAndCode(e,t,n=null){return new it(e,t,"emailLink",n)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){var t="string"==typeof e?JSON.parse(e):e;if(null!=t&&t.email&&null!=t&&t.password){if("password"===t.signInMethod)return this._fromEmailAndPassword(t.email,t.password);if("emailLink"===t.signInMethod)return this._fromEmailAndCode(t.email,t.password,t.tenantId)}return null}async _getIdTokenResponse(n){switch(this.signInMethod){case"password":const r={returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};if(null!==(e=n._getRecaptchaConfig())&&void 0!==e&&e.emailPasswordEnabled){var e=await qe(n,r,"signInWithPassword");return et(n,e)}return et(n,r).catch(async e=>{if("auth/missing-recaptcha-token"!==e.code)return Promise.reject(e);console.log("Sign-in with email address and password is protected by reCAPTCHA for this project. Automatically triggering the reCAPTCHA flow and restarting the sign-in flow.");var t=await qe(n,r,"signInWithPassword");return et(n,t)});case"emailLink":return async function(e,t){return se(e,"POST","/v1/accounts:signInWithEmailLink",ne(e,t))}(n,{email:this._email,oobCode:this._password});default:j(n,"internal-error")}}async _linkToIdToken(e,t){switch(this.signInMethod){case"password":return Ze(e,{idToken:t,returnSecureToken:!0,email:this._email,password:this._password});case"emailLink":return async function(e,t){return se(e,"POST","/v1/accounts:signInWithEmailLink",ne(e,t))}(e,{idToken:t,email:this._email,oobCode:this._password});default:j(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}async function st(e,t){return se(e,"POST","/v1/accounts:signInWithIdp",ne(e,t))}class at extends Xe{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const t=new at(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):j("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){var t="string"==typeof e?JSON.parse(e):e,{providerId:n,signInMethod:r}=t,t=R(t,["providerId","signInMethod"]);if(!n||!r)return null;const i=new at(n,r);return i.idToken=t.idToken||void 0,i.accessToken=t.accessToken||void 0,i.secret=t.secret,i.nonce=t.nonce,i.pendingToken=t.pendingToken||null,i}_getIdTokenResponse(e){return st(e,this.buildRequest())}_linkToIdToken(e,t){const n=this.buildRequest();return n.idToken=t,st(e,n)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,st(e,t)}buildRequest(){const e={requestUri:"http://localhost",returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=I(t)}return e}}const ot={USER_NOT_FOUND:"user-not-found"};class ct extends Xe{constructor(e){super("phone","phone"),this.params=e}static _fromVerification(e,t){return new ct({verificationId:e,verificationCode:t})}static _fromTokenResponse(e,t){return new ct({phoneNumber:e,temporaryProof:t})}_getIdTokenResponse(e){return async function(e,t){return se(e,"POST","/v1/accounts:signInWithPhoneNumber",ne(e,t))}(e,this._makeVerificationRequest())}_linkToIdToken(e,t){return async function(e,t){var n=await se(e,"POST","/v1/accounts:signInWithPhoneNumber",ne(e,t));if(n.temporaryProof)throw ce(e,"account-exists-with-different-credential",n);return n}(e,Object.assign({idToken:t},this._makeVerificationRequest()))}_getReauthenticationResolver(e){return async function(e,t){return se(e,"POST","/v1/accounts:signInWithPhoneNumber",ne(e,Object.assign(Object.assign({},t),{operation:"REAUTH"})),ot)}(e,this._makeVerificationRequest())}_makeVerificationRequest(){var{temporaryProof:e,phoneNumber:t,verificationId:n,verificationCode:r}=this.params;return e&&t?{temporaryProof:e,phoneNumber:t}:{sessionInfo:n,code:r}}toJSON(){const e={providerId:this.providerId};return this.params.phoneNumber&&(e.phoneNumber=this.params.phoneNumber),this.params.temporaryProof&&(e.temporaryProof=this.params.temporaryProof),this.params.verificationCode&&(e.verificationCode=this.params.verificationCode),this.params.verificationId&&(e.verificationId=this.params.verificationId),e}static fromJSON(e){var{verificationId:t,verificationCode:n,phoneNumber:r,temporaryProof:i}=e="string"==typeof e?JSON.parse(e):e;return n||t||r||i?new ct({verificationId:t,verificationCode:n,phoneNumber:r,temporaryProof:i}):null}}class lt{constructor(e){var t=w(T(e)),n=null!==(r=t.apiKey)&&void 0!==r?r:null,r=null!==(i=t.oobCode)&&void 0!==i?i:null,i=function(e){switch(e){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}(null!==(i=t.mode)&&void 0!==i?i:null);B(n&&r&&i,"argument-error"),this.apiKey=n,this.operation=i,this.code=r,this.continueUrl=null!==(r=t.continueUrl)&&void 0!==r?r:null,this.languageCode=null!==(r=t.languageCode)&&void 0!==r?r:null,this.tenantId=null!==(t=t.tenantId)&&void 0!==t?t:null}static parseLink(e){var t,n,r,t=(t=w(T(e=e)).link,n=t?w(T(t)).deep_link_id:null,((r=w(T(e)).deep_link_id)?w(T(r)).link:null)||r||n||t||e);try{return new lt(t)}catch(e){return null}}}class ut{constructor(){this.providerId=ut.PROVIDER_ID}static credential(e,t){return it._fromEmailAndPassword(e,t)}static credentialWithLink(e,t){var n=lt.parseLink(t);return B(n,"argument-error"),it._fromEmailAndCode(e,n.code,n.tenantId)}}ut.PROVIDER_ID="password",ut.EMAIL_PASSWORD_SIGN_IN_METHOD="password",ut.EMAIL_LINK_SIGN_IN_METHOD="emailLink";class dt{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}class ht extends dt{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}class pt extends ht{static credentialFromJSON(e){var t="string"==typeof e?JSON.parse(e):e;return B("providerId"in t&&"signInMethod"in t,"argument-error"),at._fromParams(t)}credential(e){return this._credential(Object.assign(Object.assign({},e),{nonce:e.rawNonce}))}_credential(e){return B(e.idToken||e.accessToken,"argument-error"),at._fromParams(Object.assign(Object.assign({},e),{providerId:this.providerId,signInMethod:this.providerId}))}static credentialFromResult(e){return pt.oauthCredentialFromTaggedObject(e)}static credentialFromError(e){return pt.oauthCredentialFromTaggedObject(e.customData||{})}static oauthCredentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;var{oauthIdToken:t,oauthAccessToken:n,oauthTokenSecret:r,pendingToken:i,nonce:s,providerId:a}=e;if(!(n||r||t||i))return null;if(!a)return null;try{return new pt(a)._credential({idToken:t,accessToken:n,nonce:s,pendingToken:i})}catch(e){return null}}}class ft extends ht{constructor(){super("facebook.com")}static credential(e){return at._fromParams({providerId:ft.PROVIDER_ID,signInMethod:ft.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return ft.credentialFromTaggedObject(e)}static credentialFromError(e){return ft.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!(e&&"oauthAccessToken"in e))return null;if(!e.oauthAccessToken)return null;try{return ft.credential(e.oauthAccessToken)}catch(e){return null}}}ft.FACEBOOK_SIGN_IN_METHOD="facebook.com",ft.PROVIDER_ID="facebook.com";class vt extends ht{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return at._fromParams({providerId:vt.PROVIDER_ID,signInMethod:vt.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return vt.credentialFromTaggedObject(e)}static credentialFromError(e){return vt.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;var{oauthIdToken:t,oauthAccessToken:n}=e;if(!t&&!n)return null;try{return vt.credential(t,n)}catch(e){return null}}}vt.GOOGLE_SIGN_IN_METHOD="google.com",vt.PROVIDER_ID="google.com";class gt extends ht{constructor(){super("github.com")}static credential(e){return at._fromParams({providerId:gt.PROVIDER_ID,signInMethod:gt.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return gt.credentialFromTaggedObject(e)}static credentialFromError(e){return gt.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!(e&&"oauthAccessToken"in e))return null;if(!e.oauthAccessToken)return null;try{return gt.credential(e.oauthAccessToken)}catch(e){return null}}}gt.GITHUB_SIGN_IN_METHOD="github.com",gt.PROVIDER_ID="github.com";class mt extends Xe{constructor(e,t){super(e,e),this.pendingToken=t}_getIdTokenResponse(e){return st(e,this.buildRequest())}_linkToIdToken(e,t){const n=this.buildRequest();return n.idToken=t,st(e,n)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,st(e,t)}toJSON(){return{signInMethod:this.signInMethod,providerId:this.providerId,pendingToken:this.pendingToken}}static fromJSON(e){var{providerId:t,signInMethod:n,pendingToken:r}="string"==typeof e?JSON.parse(e):e;return t&&n&&r&&t===n?new mt(t,r):null}static _create(e,t){return new mt(e,t)}buildRequest(){return{requestUri:"http://localhost",returnSecureToken:!0,pendingToken:this.pendingToken}}}class _t extends dt{constructor(e){B(e.startsWith("saml."),"argument-error"),super(e)}static credentialFromResult(e){return _t.samlCredentialFromTaggedObject(e)}static credentialFromError(e){return _t.samlCredentialFromTaggedObject(e.customData||{})}static credentialFromJSON(e){var t=mt.fromJSON(e);return B(t,"argument-error"),t}static samlCredentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;var{pendingToken:t,providerId:n}=e;if(!t||!n)return null;try{return mt._create(n,t)}catch(e){return null}}}class yt extends ht{constructor(){super("twitter.com")}static credential(e,t){return at._fromParams({providerId:yt.PROVIDER_ID,signInMethod:yt.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return yt.credentialFromTaggedObject(e)}static credentialFromError(e){return yt.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;var{oauthAccessToken:t,oauthTokenSecret:n}=e;if(!t||!n)return null;try{return yt.credential(t,n)}catch(e){return null}}}async function It(e,t){return se(e,"POST","/v1/accounts:signUp",ne(e,t))}yt.TWITTER_SIGN_IN_METHOD="twitter.com",yt.PROVIDER_ID="twitter.com";class wt{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,n,r=!1){var i=await _e._fromIdTokenResponse(e,n,r),s=Tt(n);return new wt({user:i,providerId:s,_tokenResponse:n,operationType:t})}static async _forOperation(e,t,n){await e._updateTokensIfNecessary(n,!0);var r=Tt(n);return new wt({user:e,providerId:r,_tokenResponse:n,operationType:t})}}function Tt(e){return e.providerId||("phoneNumber"in e?"phone":null)}class bt extends m{constructor(e,t,n,r){var i;super(t.code,t.message),this.operationType=n,this.user=r,Object.setPrototypeOf(this,bt.prototype),this.customData={appName:e.name,tenantId:null!==(i=e.tenantId)&&void 0!==i?i:void 0,_serverResponse:t.customData._serverResponse,operationType:n}}static _fromErrorAndOperation(e,t,n,r){return new bt(e,t,n,r)}}function kt(t,n,e,r){const i="reauthenticate"===n?e._getReauthenticationResolver(t):e._getIdTokenResponse(t);return i.catch(e=>{if("auth/multi-factor-auth-required"===e.code)throw bt._fromErrorAndOperation(t,e,n,r);throw e})}function Et(e){return new Set(e.map(({providerId:e})=>e).filter(e=>!!e))}async function Rt(e,t){const n=E(e);await St(!0,n,t);var r=(e=n.auth,t={idToken:await n.getIdToken(),deleteProvider:[t]},await re(e,"POST","/v1/accounts:update",t))["providerUserInfo"];const i=Et(r||[]);return n.providerData=n.providerData.filter(e=>i.has(e.providerId)),i.has("phone")||(n.phoneNumber=null),await n.auth._persistUserIfCurrent(n),n}async function At(e,t,n=!1){var r=await he(e,t._linkToIdToken(e.auth,await e.getIdToken()),n);return wt._forOperation(e,"link",r)}async function St(e,t,n){await ve(t);const r=Et(t.providerData);var i=!1===e?"provider-already-linked":"no-such-provider";B(r.has(n)===e,t.auth,i)}async function Ct(e,t,n=!1){var r=e["auth"],i="reauthenticate";try{var s=await he(e,kt(r,i,t,e),n);B(s.idToken,r,"internal-error");var a=de(s.idToken);B(a,r,"internal-error");var o=a["sub"];return B(e.uid===o,r,"user-mismatch"),wt._forOperation(e,i,s)}catch(e){throw"auth/user-not-found"===(null==e?void 0:e.code)&&j(r,"user-mismatch"),e}}async function Pt(e,t,n=!1){var r=await kt(e,"signIn",t),r=await wt._fromIdTokenResponse(e,"signIn",r);return n||await e._updateCurrentUser(r.user),r}async function Nt(e,t){return Pt(Ge(e),t)}async function Ot(e,t){var n=E(e);return await St(!1,n,t.providerId),At(n,t)}async function Lt(e,t){return Ct(E(e),t)}async function Dt(e,t){const n=Ge(e);var r=await se(n,"POST","/v1/accounts:signInWithCustomToken",ne(n,{token:t,returnSecureToken:!0})),r=await wt._fromIdTokenResponse(n,"signIn",r);return await n._updateCurrentUser(r.user),r}class Mt{constructor(e,t){this.factorId=e,this.uid=t.mfaEnrollmentId,this.enrollmentTime=new Date(t.enrolledAt).toUTCString(),this.displayName=t.displayName}static _fromServerResponse(e,t){return"phoneInfo"in t?Ut._fromServerResponse(e,t):"totpInfo"in t?Ft._fromServerResponse(e,t):j(e,"internal-error")}}class Ut extends Mt{constructor(e){super("phone",e),this.phoneNumber=e.phoneInfo}static _fromServerResponse(e,t){return new Ut(t)}}class Ft extends Mt{constructor(e){super("totp",e)}static _fromServerResponse(e,t){return new Ft(t)}}function Vt(e,t,n){var r;B(0<(null===(r=n.url)||void 0===r?void 0:r.length),e,"invalid-continue-uri"),B(void 0===n.dynamicLinkDomain||0<n.dynamicLinkDomain.length,e,"invalid-dynamic-link-domain"),t.continueUrl=n.url,t.dynamicLinkDomain=n.dynamicLinkDomain,t.canHandleCodeInApp=n.handleCodeInApp,n.iOS&&(B(0<n.iOS.bundleId.length,e,"missing-ios-bundle-id"),t.iOSBundleId=n.iOS.bundleId),n.android&&(B(0<n.android.packageName.length,e,"missing-android-pkg-name"),t.androidInstallApp=n.android.installApp,t.androidMinimumVersionCode=n.android.minimumVersion,t.androidPackageName=n.android.packageName)}async function xt(e,t){await re(e=E(e),"POST","/v1/accounts:update",ne(e,{oobCode:t}))}async function jt(e,t){var n=E(e),r=await Qe(n,{oobCode:t}),i=r.requestType;switch(B(i,n,"internal-error"),i){case"EMAIL_SIGNIN":break;case"VERIFY_AND_CHANGE_EMAIL":B(r.newEmail,n,"internal-error");break;case"REVERT_SECOND_FACTOR_ADDITION":B(r.mfaInfo,n,"internal-error");default:B(r.email,n,"internal-error")}let s=null;return r.mfaInfo&&(s=Mt._fromServerResponse(Ge(n),r.mfaInfo)),{data:{email:("VERIFY_AND_CHANGE_EMAIL"===r.requestType?r.newEmail:r.email)||null,previousEmail:("VERIFY_AND_CHANGE_EMAIL"===r.requestType?r.email:r.newEmail)||null,multiFactorInfo:s},operation:i}}async function Ht(e,t){var n=J()?$():"http://localhost",n=(await re(e=E(e),"POST","/v1/accounts:createAuthUri",ne(e,{identifier:t,continueUri:n})))["signinMethods"];return n||[]}async function Wt(e,t){var n=E(e),r={requestType:"VERIFY_EMAIL",idToken:await e.getIdToken()};t&&Vt(n.auth,r,t);var r=(await tt(n.auth,r))["email"];r!==e.email&&await e.reload()}async function qt(e,t,n){var r=E(e),i={requestType:"VERIFY_AND_CHANGE_EMAIL",idToken:await e.getIdToken(),newEmail:t};n&&Vt(r.auth,i,n);var i=(await tt(r.auth,i))["email"];i!==e.email&&await e.reload()}async function zt(e,{displayName:t,photoURL:n}){if(void 0!==t||void 0!==n){const i=E(e);var r=await i.getIdToken(),r=await he(i,async function(e,t){return re(e,"POST","/v1/accounts:update",t)}(i.auth,{idToken:r,displayName:t,photoUrl:n,returnSecureToken:!0}));i.displayName=r.displayName||null,i.photoURL=r.photoUrl||null;const s=i.providerData.find(({providerId:e})=>"password"===e);s&&(s.displayName=i.displayName,s.photoURL=i.photoURL),await i._updateTokensIfNecessary(r)}}async function Bt(e,t,n){var r=e["auth"];const i={idToken:await e.getIdToken(),returnSecureToken:!0};t&&(i.email=t),n&&(i.password=n);r=await he(e,Ze(r,i));await e._updateTokensIfNecessary(r,!0)}class Gt{constructor(e,t,n={}){this.isNewUser=e,this.providerId=t,this.profile=n}}class Kt extends Gt{constructor(e,t,n,r){super(e,t,n),this.username=r}}class $t extends Gt{constructor(e,t){super(e,"facebook.com",t)}}class Jt extends Kt{constructor(e,t){super(e,"github.com",t,"string"==typeof(null==t?void 0:t.login)?null==t?void 0:t.login:null)}}class Yt extends Gt{constructor(e,t){super(e,"google.com",t)}}class Xt extends Kt{constructor(e,t,n){super(e,"twitter.com",t,n)}}function Qt(e){var{user:t,_tokenResponse:n}=e;return t.isAnonymous&&!n?{providerId:null,isNewUser:!1,profile:null}:function(e){if(!e)return null;var t=e["providerId"],n=e.rawUserInfo?JSON.parse(e.rawUserInfo):{},r=e.isNewUser||"identitytoolkit#SignupNewUserResponse"===e.kind;if(!t&&null!=e&&e.idToken){var i=null===(i=null===(i=de(e.idToken))||void 0===i?void 0:i.firebase)||void 0===i?void 0:i.sign_in_provider;if(i){i="anonymous"!==i&&"custom"!==i?i:null;return new Gt(r,i)}}if(!t)return null;switch(t){case"facebook.com":return new $t(r,n);case"github.com":return new Jt(r,n);case"google.com":return new Yt(r,n);case"twitter.com":return new Xt(r,n,e.screenName||null);case"custom":case"anonymous":return new Gt(r,null);default:return new Gt(r,t,n)}}(n)}class Zt{constructor(e,t,n){this.type=e,this.credential=t,this.auth=n}static _fromIdtoken(e,t){return new Zt("enroll",e,t)}static _fromMfaPendingCredential(e){return new Zt("signin",e)}toJSON(){return{multiFactorSession:{["enroll"===this.type?"idToken":"pendingCredential"]:this.credential}}}static fromJSON(e){var t;if(null!=e&&e.multiFactorSession){if(null!==(t=e.multiFactorSession)&&void 0!==t&&t.pendingCredential)return Zt._fromMfaPendingCredential(e.multiFactorSession.pendingCredential);if(null!==(t=e.multiFactorSession)&&void 0!==t&&t.idToken)return Zt._fromIdtoken(e.multiFactorSession.idToken)}return null}}class en{constructor(e,t,n){this.session=e,this.hints=t,this.signInResolver=n}static _fromError(e,i){const s=Ge(e),a=i.customData._serverResponse;var t=(a.mfaInfo||[]).map(e=>Mt._fromServerResponse(s,e));B(a.mfaPendingCredential,s,"internal-error");const o=Zt._fromMfaPendingCredential(a.mfaPendingCredential);return new en(o,t,async e=>{var t=await e._process(s,o);delete a.mfaInfo,delete a.mfaPendingCredential;var n=Object.assign(Object.assign({},a),{idToken:t.idToken,refreshToken:t.refreshToken});switch(i.operationType){case"signIn":var r=await wt._fromIdTokenResponse(s,i.operationType,n);return await s._updateCurrentUser(r.user),r;case"reauthenticate":return B(i.user,s,"internal-error"),wt._forOperation(i.user,i.operationType,n);default:j(s,"internal-error")}})}async resolveSignIn(e){return this.signInResolver(e)}}class tn{constructor(t){this.user=t,this.enrolledFactors=[],t._onReload(e=>{e.mfaInfo&&(this.enrolledFactors=e.mfaInfo.map(e=>Mt._fromServerResponse(t.auth,e)))})}static _fromUser(e){return new tn(e)}async getSession(){return Zt._fromIdtoken(await this.user.getIdToken(),this.user.auth)}async enroll(e,t){const n=e;var r=await this.getSession(),r=await he(this.user,n._process(this.user.auth,r,t));return await this.user._updateTokensIfNecessary(r),this.user.reload()}async unenroll(e){const t="string"==typeof e?e:e.uid;var n,r,i=await this.user.getIdToken();try{var s=await he(this.user,(n=this.user.auth,r={idToken:i,mfaEnrollmentId:t},re(n,"POST","/v2/accounts/mfaEnrollment:withdraw",ne(n,r))));this.enrolledFactors=this.enrolledFactors.filter(({uid:e})=>e!==t),await this.user._updateTokensIfNecessary(s),await this.user.reload()}catch(e){throw e}}}const nn=new WeakMap;const rn="__sak";class sn{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(rn,"1"),this.storage.removeItem(rn),Promise.resolve(!0)):Promise.resolve(!1)}catch(e){return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){var t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}class an extends sn{constructor(){var e;super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.safariLocalStorageNotSynced=(Ae(e=d())||Le(e))&&function(){try{return!(!window||window===window.top)}catch(e){return!1}}(),this.fallbackToPolling=De(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const r of Object.keys(this.listeners)){var t=this.storage.getItem(r),n=this.localCache[r];t!==n&&e(r,n,t)}}onStorageEvent(e,t=!1){if(e.key){const r=e.key;if(t?this.detachListener():this.stopPolling(),this.safariLocalStorageNotSynced){const i=this.storage.getItem(r);if(e.newValue!==i)null!==e.newValue?this.storage.setItem(r,e.newValue):this.storage.removeItem(r);else if(this.localCache[r]===e.newValue&&!t)return}var n=()=>{var e=this.storage.getItem(r);!t&&this.localCache[r]===e||this.notifyListeners(r,e)};const i=this.storage.getItem(r);v()&&10===document.documentMode&&i!==e.newValue&&e.newValue!==e.oldValue?setTimeout(n,10):n()}else this.forAllChangedKeys((e,t,n)=>{this.notifyListeners(e,n)})}notifyListeners(e,t){this.localCache[e]=t;var n=this.listeners[e];if(n)for(const r of Array.from(n))r(t&&JSON.parse(t))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,t,n)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:n}),!0)})},1e3)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){0===Object.keys(this.listeners).length&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size&&delete this.listeners[e]),0===Object.keys(this.listeners).length&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){var t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}}an.type="LOCAL";const on=an;class cn extends sn{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,t){}_removeListener(e,t){}}cn.type="SESSION";const ln=cn;class un{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(t){var e=this.receivers.find(e=>e.isListeningto(t));if(e)return e;e=new un(t);return this.receivers.push(e),e}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const t=e,{eventId:n,eventType:r,data:i}=t.data;var s=this.handlersMap[r];null!=s&&s.size&&(t.ports[0].postMessage({status:"ack",eventId:n,eventType:r}),s=Array.from(s).map(async e=>e(t.origin,i)),s=await Promise.all(s.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(e){return{fulfilled:!1,reason:e}}})),t.ports[0].postMessage({status:"done",eventId:n,eventType:r,response:s}))}_subscribe(e,t){0===Object.keys(this.handlersMap).length&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),t&&0!==this.handlersMap[e].size||delete this.handlersMap[e],0===Object.keys(this.handlersMap).length&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}function dn(e="",t=10){let n="";for(let r=0;r<t;r++)n+=Math.floor(10*Math.random());return e+n}un.receivers=[];class hn{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,t,a=50){const o="undefined"!=typeof MessageChannel?new MessageChannel:null;if(!o)throw new Error("connection_unavailable");let c,l;return new Promise((n,r)=>{const i=dn("",20);o.port1.start();const s=setTimeout(()=>{r(new Error("unsupported_event"))},a);l={messageChannel:o,onMessage(e){var t=e;if(t.data.eventId===i)switch(t.data.status){case"ack":clearTimeout(s),c=setTimeout(()=>{r(new Error("timeout"))},3e3);break;case"done":clearTimeout(c),n(t.data.response);break;default:clearTimeout(s),clearTimeout(c),r(new Error("invalid_response"))}}},this.handlers.add(l),o.port1.addEventListener("message",l.onMessage),this.target.postMessage({eventType:e,eventId:i,data:t},[o.port2])}).finally(()=>{l&&this.removeMessageHandler(l)})}}function pn(){return window}function fn(){return void 0!==pn().WorkerGlobalScope&&"function"==typeof pn().importScripts}const vn="firebaseLocalStorageDb",gn="firebaseLocalStorage",mn="fbase_key";class _n{constructor(e){this.request=e}toPromise(){return new Promise((e,t)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{t(this.request.error)})})}}function yn(e,t){return e.transaction([gn],t?"readwrite":"readonly").objectStore(gn)}function In(){const r=indexedDB.open(vn,1);return new Promise((n,t)=>{r.addEventListener("error",()=>{t(r.error)}),r.addEventListener("upgradeneeded",()=>{const e=r.result;try{e.createObjectStore(gn,{keyPath:mn})}catch(e){t(e)}}),r.addEventListener("success",async()=>{const e=r.result;var t;e.objectStoreNames.contains(gn)?n(e):(e.close(),t=indexedDB.deleteDatabase(vn),await new _n(t).toPromise(),n(await In()))})})}async function wn(e,t,n){var r=yn(e,!0).put({fbase_key:t,value:n});return new _n(r).toPromise()}function Tn(e,t){var n=yn(e,!0).delete(t);return new _n(n).toPromise()}class bn{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db||(this.db=await In(),this.db)}async _withRetries(e){let t=0;for(;;)try{return e(await this._openDb())}catch(e){if(3<t++)throw e;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return fn()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=un._getInstance(fn()?self:null),this.receiver._subscribe("keyChanged",async(e,t)=>{const n=await this._poll();return{keyProcessed:n.includes(t.key)}}),this.receiver._subscribe("ping",async(e,t)=>["keyChanged"])}async initializeSender(){var e,t,n;this.activeServiceWorker=await async function(){if(null===navigator||void 0===navigator||!navigator.serviceWorker)return null;try{return(await navigator.serviceWorker.ready).active}catch(e){return null}}(),this.activeServiceWorker&&(this.sender=new hn(this.activeServiceWorker),(n=await this.sender._send("ping",{},800))&&null!==(e=n[0])&&void 0!==e&&e.fulfilled&&null!==(t=n[0])&&void 0!==t&&t.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0))}async notifyServiceWorker(e){var t;if(this.sender&&this.activeServiceWorker&&((null===(t=null===navigator||void 0===navigator?void 0:navigator.serviceWorker)||void 0===t?void 0:t.controller)||null)===this.activeServiceWorker)try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch(e){}}async _isAvailable(){try{if(!indexedDB)return!1;var e=await In();return await wn(e,rn,"1"),await Tn(e,rn),!0}catch(e){}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(t,n){return this._withPendingWrite(async()=>(await this._withRetries(e=>wn(e,t,n)),this.localCache[t]=n,this.notifyServiceWorker(t)))}async _get(t){var e=await this._withRetries(e=>async function(e,t){var n=yn(e,!1).get(t);return void 0===(n=await new _n(n).toPromise())?null:n.value}(e,t));return this.localCache[t]=e}async _remove(t){return this._withPendingWrite(async()=>(await this._withRetries(e=>Tn(e,t)),delete this.localCache[t],this.notifyServiceWorker(t)))}async _poll(){var e,t,n=await this._withRetries(e=>{var t=yn(e,!1).getAll();return new _n(t).toPromise()});if(!n)return[];if(0!==this.pendingWrites)return[];const r=[],i=new Set;for({fbase_key:e,value:t}of n)i.add(e),JSON.stringify(this.localCache[e])!==JSON.stringify(t)&&(this.notifyListeners(e,t),r.push(e));for(const s of Object.keys(this.localCache))this.localCache[s]&&!i.has(s)&&(this.notifyListeners(s,null),r.push(s));return r}notifyListeners(e,t){this.localCache[e]=t;var n=this.listeners[e];if(n)for(const r of Array.from(n))r(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),800)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){0===Object.keys(this.listeners).length&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size&&delete this.listeners[e]),0===Object.keys(this.listeners).length&&this.stopPolling()}}bn.type="LOCAL";const kn=bn;class En{constructor(e){this.auth=e,this.counter=1e12,this._widgets=new Map}render(e,t){var n=this.counter;return this._widgets.set(n,new Rn(e,this.auth.name,t||{})),this.counter++,n}reset(e){var t,n=e||1e12;null===(t=this._widgets.get(n))||void 0===t||t.delete(),this._widgets.delete(n)}getResponse(e){var t;return(null===(t=this._widgets.get(e||1e12))||void 0===t?void 0:t.getResponse())||""}async execute(e){var t;return null===(t=this._widgets.get(e||1e12))||void 0===t||t.execute(),""}}class Rn{constructor(e,t,n){this.params=n,this.timerId=null,this.deleted=!1,this.responseToken=null,this.clickHandler=()=>{this.execute()};var r="string"==typeof e?document.getElementById(e):e;B(r,"argument-error",{appName:t}),this.container=r,this.isVisible="invisible"!==this.params.size,this.isVisible?this.execute():this.container.addEventListener("click",this.clickHandler)}getResponse(){return this.checkIfDeleted(),this.responseToken}delete(){this.checkIfDeleted(),this.deleted=!0,this.timerId&&(clearTimeout(this.timerId),this.timerId=null),this.container.removeEventListener("click",this.clickHandler)}execute(){this.checkIfDeleted(),this.timerId||(this.timerId=window.setTimeout(()=>{this.responseToken=function(e){const t=[],n="1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";for(let r=0;r<e;r++)t.push(n.charAt(Math.floor(Math.random()*n.length)));return t.join("")}(50);const{callback:e,"expired-callback":t}=this.params;if(e)try{e(this.responseToken)}catch(e){}this.timerId=window.setTimeout(()=>{if(this.timerId=null,this.responseToken=null,t)try{t()}catch(e){}this.isVisible&&this.execute()},6e4)},500))}checkIfDeleted(){if(this.deleted)throw new Error("reCAPTCHA mock was already deleted!")}}const An=He("rcb"),Sn=new X(3e4,6e4);class Cn{constructor(){var e;this.hostLanguage="",this.counter=0,this.librarySeparatelyLoaded=!(null===(e=pn().grecaptcha)||void 0===e||!e.render)}load(s,a=""){var e;return B((e=a).length<=6&&/^\s*[a-zA-Z0-9\-]*\s*$/.test(e),s,"argument-error"),this.shouldResolveImmediately(a)&&Fe(pn().grecaptcha)?Promise.resolve(pn().grecaptcha):new Promise((t,n)=>{const i=pn().setTimeout(()=>{n(H(s,"network-request-failed"))},Sn.get());pn()[An]=()=>{pn().clearTimeout(i),delete pn()[An];const e=pn().grecaptcha;if(e&&Fe(e)){const r=e.render;e.render=(e,t)=>{var n=r(e,t);return this.counter++,n},this.hostLanguage=a,t(e)}else n(H(s,"internal-error"))},je(`https://www.google.com/recaptcha/api.js??${I({onload:An,render:"explicit",hl:a})}`).catch(()=>{clearTimeout(i),n(H(s,"internal-error"))})})}clearedOneInstance(){this.counter--}shouldResolveImmediately(e){var t;return!(null===(t=pn().grecaptcha)||void 0===t||!t.render)&&(e===this.hostLanguage||0<this.counter||this.librarySeparatelyLoaded)}}class Pn{async load(e){return new En(e)}clearedOneInstance(){}}const Nn="recaptcha",On={theme:"light",type:"image"};class Ln{constructor(e,t=Object.assign({},On),n){this.parameters=t,this.type=Nn,this.destroyed=!1,this.widgetId=null,this.tokenChangeListeners=new Set,this.renderPromise=null,this.recaptcha=null,this.auth=Ge(n),this.isInvisible="invisible"===this.parameters.size,B("undefined"!=typeof document,this.auth,"operation-not-supported-in-this-environment");var r="string"==typeof e?document.getElementById(e):e;B(r,this.auth,"argument-error"),this.container=r,this.parameters.callback=this.makeTokenCallback(this.parameters.callback),this._recaptchaLoader=new(this.auth.settings.appVerificationDisabledForTesting?Pn:Cn),this.validateStartingState()}async verify(){this.assertNotDestroyed();const e=await this.render(),r=this.getAssertedRecaptcha();var t=r.getResponse(e);return t||new Promise(t=>{const n=e=>{e&&(this.tokenChangeListeners.delete(n),t(e))};this.tokenChangeListeners.add(n),this.isInvisible&&r.execute(e)})}render(){try{this.assertNotDestroyed()}catch(e){return Promise.reject(e)}return this.renderPromise||(this.renderPromise=this.makeRenderPromise().catch(e=>{throw this.renderPromise=null,e}),this.renderPromise)}_reset(){this.assertNotDestroyed(),null!==this.widgetId&&this.getAssertedRecaptcha().reset(this.widgetId)}clear(){this.assertNotDestroyed(),this.destroyed=!0,this._recaptchaLoader.clearedOneInstance(),this.isInvisible||this.container.childNodes.forEach(e=>{this.container.removeChild(e)})}validateStartingState(){B(!this.parameters.sitekey,this.auth,"argument-error"),B(this.isInvisible||!this.container.hasChildNodes(),this.auth,"argument-error"),B("undefined"!=typeof document,this.auth,"operation-not-supported-in-this-environment")}makeTokenCallback(n){return t=>{if(this.tokenChangeListeners.forEach(e=>e(t)),"function"==typeof n)n(t);else if("string"==typeof n){const e=pn()[n];"function"==typeof e&&e(t)}}}assertNotDestroyed(){B(!this.destroyed,this.auth,"internal-error")}async makeRenderPromise(){if(await this.init(),!this.widgetId){let e=this.container;var t;this.isInvisible||(t=document.createElement("div"),e.appendChild(t),e=t),this.widgetId=this.getAssertedRecaptcha().render(e,this.parameters)}return this.widgetId}async init(){B(J()&&!fn(),this.auth,"internal-error"),await function(){let t=null;return new Promise(e=>{"complete"!==document.readyState?(t=()=>e(),window.addEventListener("load",t)):e()}).catch(e=>{throw t&&window.removeEventListener("load",t),e})}(),this.recaptcha=await this._recaptchaLoader.load(this.auth,this.auth.languageCode||void 0);var e=await((await re(this.auth,"GET","/v1/recaptchaParams")).recaptchaSiteKey||"");B(e,this.auth,"internal-error"),this.parameters.sitekey=e}getAssertedRecaptcha(){return B(this.recaptcha,this.auth,"internal-error"),this.recaptcha}}class Dn{constructor(e,t){this.verificationId=e,this.onConfirmation=t}confirm(e){var t=ct._fromVerification(this.verificationId,e);return this.onConfirmation(t)}}async function Mn(t,n,r){var i,s,a,o,c,l,u=await r.verify();try{B("string"==typeof u,t,"argument-error"),B(r.type===Nn,t,"argument-error");let e;if(e="string"==typeof n?{phoneNumber:n}:n,"session"in e){var d=e.session;if("phoneNumber"in e)return B("enroll"===d.type,t,"internal-error"),(c=t,l={idToken:d.credential,phoneEnrollmentInfo:{phoneNumber:e.phoneNumber,recaptchaToken:u}},await re(c,"POST","/v2/accounts/mfaEnrollment:start",ne(c,l))).phoneSessionInfo.sessionInfo;B("signin"===d.type,t,"internal-error");var h=(null===(i=e.multiFactorHint)||void 0===i?void 0:i.uid)||e.multiFactorUid;return B(h,t,"missing-multi-factor-info"),(o={mfaPendingCredential:d.credential,mfaEnrollmentId:h,phoneSignInInfo:{recaptchaToken:u}},await re(t,"POST","/v2/accounts/mfaSignIn:start",ne(t,o))).phoneResponseInfo.sessionInfo}var p=(s=t,a={phoneNumber:e.phoneNumber,recaptchaToken:u},await re(s,"POST","/v1/accounts:sendVerificationCode",ne(s,a)))["sessionInfo"];return p}finally{r._reset()}}class Un{constructor(e){this.providerId=Un.PROVIDER_ID,this.auth=Ge(e)}verifyPhoneNumber(e,t){return Mn(this.auth,e,E(t))}static credential(e,t){return ct._fromVerification(e,t)}static credentialFromResult(e){var t=e;return Un.credentialFromTaggedObject(t)}static credentialFromError(e){return Un.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;var{phoneNumber:t,temporaryProof:n}=e;return t&&n?ct._fromTokenResponse(t,n):null}}function Fn(e,t){return t?Ie(t):(B(e._popupRedirectResolver,e,"argument-error"),e._popupRedirectResolver)}Un.PROVIDER_ID="phone",Un.PHONE_SIGN_IN_METHOD="phone";class Vn extends Xe{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return st(e,this._buildIdpRequest())}_linkToIdToken(e,t){return st(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return st(e,this._buildIdpRequest())}_buildIdpRequest(e){const t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function xn(e){return Pt(e.auth,new Vn(e),e.bypassAuthState)}function jn(e){var{auth:t,user:n}=e;return B(n,t,"internal-error"),Ct(n,new Vn(e),e.bypassAuthState)}async function Hn(e){var{auth:t,user:n}=e;return B(n,t,"internal-error"),At(n,new Vn(e),e.bypassAuthState)}class Wn{constructor(e,t,n,r,i=!1){this.auth=e,this.resolver=n,this.user=r,this.bypassAuthState=i,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise(async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(e){this.reject(e)}})}async onAuthEvent(e){var{urlResponse:t,sessionId:n,postBody:r,tenantId:i,error:s,type:a}=e;if(s)this.reject(s);else{r={auth:this.auth,requestUri:t,sessionId:n,tenantId:i||void 0,postBody:r||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(a)(r))}catch(e){this.reject(e)}}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return xn;case"linkViaPopup":case"linkViaRedirect":return Hn;case"reauthViaPopup":case"reauthViaRedirect":return jn;default:j(this.auth,"internal-error")}}resolve(e){K(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){K(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}const qn=new X(2e3,1e4);class zn extends Wn{constructor(e,t,n,r,i){super(e,t,r,i),this.provider=n,this.authWindow=null,this.pollId=null,zn.currentPopupAction&&zn.currentPopupAction.cancel(),zn.currentPopupAction=this}async executeNotNull(){var e=await this.execute();return B(e,this.auth,"internal-error"),e}async onExecution(){K(1===this.filter.length,"Popup operations only handle one event");var e=dn();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(e=>{this.reject(e)}),this.resolver._isIframeWebStorageSupported(this.auth,e=>{e||this.reject(H(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var e;return(null===(e=this.authWindow)||void 0===e?void 0:e.associatedEvent)||null}cancel(){this.reject(H(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,zn.currentPopupAction=null}pollUserCancellation(){const t=()=>{var e;null!==(e=null===(e=this.authWindow)||void 0===e?void 0:e.window)&&void 0!==e&&e.closed?this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(H(this.auth,"popup-closed-by-user"))},8e3):this.pollId=window.setTimeout(t,qn.get())};t()}}zn.currentPopupAction=null;const Bn="pendingRedirect",Gn=new Map;class Kn extends Wn{constructor(e,t,n=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,n),this.eventId=null}async execute(){let t=Gn.get(this.auth._key());if(!t){try{const e=await async function(e,t){const n=Xn(t),r=Yn(e);if(!await r._isAvailable())return!1;var i="true"===await r._get(n);return await r._remove(n),i}(this.resolver,this.auth)?await super.execute():null;t=()=>Promise.resolve(e)}catch(e){t=()=>Promise.reject(e)}Gn.set(this.auth._key(),t)}return this.bypassAuthState||Gn.set(this.auth._key(),()=>Promise.resolve(null)),t()}async onAuthEvent(e){if("signInViaRedirect"===e.type)return super.onAuthEvent(e);if("unknown"!==e.type){if(e.eventId){var t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}else this.resolve(null)}async onExecution(){}cleanUp(){}}async function $n(e,t){return Yn(e)._set(Xn(t),"true")}function Jn(e,t){Gn.set(e._key(),t)}function Yn(e){return Ie(e._redirectPersistence)}function Xn(e){return be(Bn,e.config.apiKey,e.name)}function Qn(e,t,n){return async function(e,t,n){var r=Ge(e);q(e,t,dt),await r._initializationPromise;const i=Fn(r,n);return await $n(i,r),i._openRedirect(r,t,"signInViaRedirect")}(e,t,n)}function Zn(e,t,n){return async function(e,t,n){var r=E(e);q(r.auth,t,dt),await r.auth._initializationPromise;const i=Fn(r.auth,n);await $n(i,r.auth);var s=await nr(r);return i._openRedirect(r.auth,t,"reauthViaRedirect",s)}(e,t,n)}function er(e,t,n){return async function(e,t,n){var r=E(e);q(r.auth,t,dt),await r.auth._initializationPromise;const i=Fn(r.auth,n);await St(!1,r,t.providerId),await $n(i,r.auth);var s=await nr(r);return i._openRedirect(r.auth,t,"linkViaRedirect",s)}(e,t,n)}async function tr(e,t,n=!1){const r=Ge(e);var i=Fn(r,t);const s=new Kn(r,i,n),a=await s.execute();return a&&!n&&(delete a.user._redirectEventId,await r._persistUserIfCurrent(a.user),await r._setRedirectUser(null,t)),a}async function nr(e){var t=dn(`${e.uid}:::`);return e._redirectEventId=t,await e.auth._setRedirectUser(e),await e.auth._persistUserIfCurrent(e),t}class rr{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(t){if(this.hasEventBeenHandled(t))return!1;let n=!1;return this.consumers.forEach(e=>{this.isEventForConsumer(t,e)&&(n=!0,this.sendToConsumer(t,e),this.saveEventToCache(t))}),this.hasHandledPotentialRedirect||!function(e){switch(e.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return sr(e);default:return!1}}(t)||(this.hasHandledPotentialRedirect=!0,n||(this.queuedRedirectEvent=t,n=!0)),n}sendToConsumer(e,t){var n;e.error&&!sr(e)?(n=(null===(n=e.error.code)||void 0===n?void 0:n.split("auth/")[1])||"internal-error",t.onError(H(this.auth,n))):t.onAuthEvent(e)}isEventForConsumer(e,t){var n=null===t.eventId||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&n}hasEventBeenHandled(e){return 6e5<=Date.now()-this.lastProcessedEventTime&&this.cachedEventUids.clear(),this.cachedEventUids.has(ir(e))}saveEventToCache(e){this.cachedEventUids.add(ir(e)),this.lastProcessedEventTime=Date.now()}}function ir(e){return[e.type,e.eventId,e.sessionId,e.tenantId].filter(e=>e).join("-")}function sr({type:e,error:t}){return"unknown"===e&&"auth/no-auth-event"===(null==t?void 0:t.code)}async function ar(e,t={}){return re(e,"GET","/v1/projects",t)}const or=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,cr=/^https?/;async function lr(e){if(!e.config.emulator){var t=(await ar(e))["authorizedDomains"];for(const n of t)try{if(function(e){const t=$(),{protocol:n,hostname:r}=new URL(t);if(e.startsWith("chrome-extension://")){var i=new URL(e);return""===i.hostname&&""===r?"chrome-extension:"===n&&e.replace("chrome-extension://","")===t.replace("chrome-extension://",""):"chrome-extension:"===n&&i.hostname===r}if(!cr.test(n))return!1;if(or.test(e))return r===e;const s=e.replace(/\./g,"\\."),a=new RegExp("^(.+\\."+s+"|"+s+")$","i");return a.test(r)}(n))return}catch(e){}j(e,"unauthorized-domain")}}const ur=new X(3e4,6e4);function dr(){const t=pn().___jsl;if(null!==t&&void 0!==t&&t.H)for(const n of Object.keys(t.H))if(t.H[n].r=t.H[n].r||[],t.H[n].L=t.H[n].L||[],t.H[n].r=[...t.H[n].L],t.CP)for(let e=0;e<t.CP.length;e++)t.CP[e]=null}let hr=null;function pr(e){var i;return hr=hr||(i=e,new Promise((e,t)=>{function n(){dr(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{dr(),t(H(i,"network-request-failed"))},timeout:ur.get()})}if(null!==(r=null===(r=pn().gapi)||void 0===r?void 0:r.iframes)&&void 0!==r&&r.Iframe)e(gapi.iframes.getContext());else{if(null===(r=pn().gapi)||void 0===r||!r.load){var r=He("iframefcb");return pn()[r]=()=>{gapi.load?n():t(H(i,"network-request-failed"))},je(`https://apis.google.com/js/api.js?onload=${r}`).catch(e=>t(e))}n()}}).catch(e=>{throw hr=null,e})),hr}const fr=new X(5e3,15e3),vr="__/auth/iframe",gr="emulator/auth/iframe",mr={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},_r=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);async function yr(a){const e=await pr(a);var t=pn().gapi;return B(t,a,"internal-error"),e.open({where:document.body,url:function(e){var t=e.config;B(t.authDomain,e,"auth-domain-config-required");var n=t.emulator?Q(t,gr):`https://${e.config.authDomain}/${vr}`;const r={apiKey:t.apiKey,appName:e.name,v:ki.SDK_VERSION};(t=_r.get(e.config.apiHost))&&(r.eid=t);const i=e._getFrameworks();return i.length&&(r.fw=i.join(",")),`${n}?${I(r).slice(1)}`}(a),messageHandlersFilter:t.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:mr,dontclear:!0},s=>new Promise(async(e,t)=>{await s.restyle({setHideOnLeave:!1});const n=H(a,"network-request-failed"),r=pn().setTimeout(()=>{t(n)},fr.get());function i(){pn().clearTimeout(r),e(s)}s.ping(i).then(i,()=>{t(n)})}))}const Ir={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"};class wr{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch(e){}}}function Tr(e,t,n,r=500,i=600){var s=Math.max((window.screen.availHeight-i)/2,0).toString(),a=Math.max((window.screen.availWidth-r)/2,0).toString();let o="";const c=Object.assign(Object.assign({},Ir),{width:r.toString(),height:i.toString(),top:s,left:a});s=d().toLowerCase();n&&(o=Se(s)?"_blank":n),Re(s)&&(t=t||"http://localhost",c.scrollbars="yes");var l,a=Object.entries(c).reduce((e,[t,n])=>`${e}${t}=${n},`,"");if([n=d()]=[s],Le(n)&&null!==(l=window.navigator)&&void 0!==l&&l.standalone&&"_self"!==o)return function(e,t){const n=document.createElement("a");n.href=e,n.target=t;const r=document.createEvent("MouseEvent");r.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),n.dispatchEvent(r)}(t||"",o),new wr(null);const u=window.open(t||"",o,a);B(u,e,"popup-blocked");try{u.focus()}catch(e){}return new wr(u)}const br="__/auth/handler",kr="emulator/auth/handler",Er=encodeURIComponent("fac");async function Rr(e,t,n,r,i,s){B(e.config.authDomain,e,"auth-domain-config-required"),B(e.config.apiKey,e,"invalid-api-key");const a={apiKey:e.config.apiKey,appName:e.name,authType:n,redirectUrl:r,v:ki.SDK_VERSION,eventId:i};if(t instanceof dt){t.setDefaultLanguage(e.languageCode),a.providerId=t.providerId||"",function(e){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t))return;return 1}(t.getCustomParameters())||(a.customParameters=JSON.stringify(t.getCustomParameters()));for(var[o,c]of Object.entries(s||{}))a[o]=c}if(t instanceof ht){const d=t.getScopes().filter(e=>""!==e);0<d.length&&(a.scopes=d.join(","))}e.tenantId&&(a.tid=e.tenantId);const l=a;for(const h of Object.keys(l))void 0===l[h]&&delete l[h];var u=await e._getAppCheckToken(),u=u?`#${Er}=${encodeURIComponent(u)}`:"";return`${e=[e["config"]][0],e.emulator?Q(e,kr):`https://${e.authDomain}/${br}`}?${I(l).slice(1)}${u}`}const Ar="webStorageSupport";const Sr=class{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=ln,this._completeRedirectFn=tr,this._overrideRedirectResult=Jn}async _openPopup(e,t,n,r){var i;return K(null===(i=this.eventManagers[e._key()])||void 0===i?void 0:i.manager,"_initialize() not called before _openPopup()"),Tr(e,await Rr(e,t,n,$(),r),dn())}async _openRedirect(e,t,n,r){await this._originValidation(e);var i=await Rr(e,t,n,$(),r);return pn().location.href=i,new Promise(()=>{})}_initialize(e){const t=e._key();if(this.eventManagers[t]){const{manager:r,promise:n}=this.eventManagers[t];return r?Promise.resolve(r):(K(n,"If manager is not set, promise should be"),n)}const n=this.initAndGetManager(e);return this.eventManagers[t]={promise:n},n.catch(()=>{delete this.eventManagers[t]}),n}async initAndGetManager(t){const e=await yr(t),n=new rr(t);return e.register("authEvent",e=>{return B(null==e?void 0:e.authEvent,t,"invalid-auth-event"),{status:n.onEvent(e.authEvent)?"ACK":"ERROR"}},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[t._key()]={manager:n},this.iframes[t._key()]=e,n}_isIframeWebStorageSupported(n,r){const e=this.iframes[n._key()];e.send(Ar,{type:Ar},e=>{var t=null===(t=null==e?void 0:e[0])||void 0===t?void 0:t[Ar];void 0!==t&&r(!!t),j(n,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){var t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=lr(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return De()||Ae()||Le()}};class Cr extends class{constructor(e){this.factorId=e}_process(e,t,n){switch(t.type){case"enroll":return this._finalizeEnroll(e,t.credential,n);case"signin":return this._finalizeSignIn(e,t.credential);default:return G("unexpected MultiFactorSessionType")}}}{constructor(e){super("phone"),this.credential=e}static _fromCredential(e){return new Cr(e)}_finalizeEnroll(e,t,n){return e=e,n={idToken:t,displayName:n,phoneVerificationInfo:this.credential._makeVerificationRequest()},re(e,"POST","/v2/accounts/mfaEnrollment:finalize",ne(e,n))}_finalizeSignIn(e,t){return e=e,t={mfaPendingCredential:t,phoneVerificationInfo:this.credential._makeVerificationRequest()},re(e,"POST","/v2/accounts/mfaSignIn:finalize",ne(e,t))}}class Pr{constructor(){}static assertion(e){return Cr._fromCredential(e)}}Pr.FACTOR_ID="phone";var Nr="@firebase/auth";class Or{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),(null===(e=this.auth.currentUser)||void 0===e?void 0:e.uid)||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(t){var e;this.assertAuthConfigured(),this.internalListeners.has(t)||(e=this.auth.onIdTokenChanged(e=>{t((null==e?void 0:e.stsTokenManager.accessToken)||null)}),this.internalListeners.set(t,e),this.updateProactiveRefresh())}removeAuthTokenListener(e){this.assertAuthConfigured();const t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){B(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){0<this.internalListeners.size?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}var Lr,Dr,Mr;function Ur(){return window}Lr="authIdTokenMaxAge",null===(Dr=o())||void 0===Dr||Dr[`_${Lr}`],Mr="Browser",ki._registerComponent(new N("auth",(e,{options:t})=>{var n=e.getProvider("app").getImmediate(),r=e.getProvider("heartbeat"),i=e.getProvider("app-check-internal");const{apiKey:s,authDomain:a}=n.options;B(s&&!s.includes(":"),"invalid-api-key",{appName:n.name}),B(!(null!==a&&void 0!==a&&a.includes(":")),"argument-error",{appName:n.name});var o={apiKey:s,authDomain:a,clientPlatform:Mr,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:Me(Mr)},o=new Be(n,r,i,o);return function(e,t){const n=(null==t?void 0:t.persistence)||[];var r=(Array.isArray(n)?n:[n]).map(Ie);null!=t&&t.errorMap&&e._updateErrorMap(t.errorMap),e._initializeWithPersistence(r,null==t?void 0:t.popupRedirectResolver)}(o,t),o},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,n)=>{const r=e.getProvider("auth-internal");r.initialize()})),ki._registerComponent(new N("auth-internal",e=>{var t=Ge(e.getProvider("auth").getImmediate());return e=t,new Or(e)},"PRIVATE").setInstantiationMode("EXPLICIT")),ki.registerVersion(Nr,"0.23.1",function(e){switch(e){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";default:return}}(Mr)),ki.registerVersion(Nr,"0.23.1","esm2017");async function Fr(e,t,n){var r=Ur()["BuildInfo"];K(t.sessionId,"AuthEvent did not contain a session ID");var i=await async function(e){const t=function(e){if(K(/[0-9a-zA-Z]+/.test(e),"Can only convert alpha-numeric strings"),"undefined"!=typeof TextEncoder)return(new TextEncoder).encode(e);const t=new ArrayBuffer(e.length),n=new Uint8Array(t);for(let r=0;r<e.length;r++)n[r]=e.charCodeAt(r);return n}(e),n=await crypto.subtle.digest("SHA-256",t),r=Array.from(new Uint8Array(n));return r.map(e=>e.toString(16).padStart(2,"0")).join("")}(t.sessionId);const s={};return Le()?s.ibi=r.packageName:Pe()?s.apn=r.packageName:j(e,"operation-not-supported-in-this-environment"),r.displayName&&(s.appDisplayName=r.displayName),s.sessionId=i,Rr(e,n,t.type,void 0,null!==(i=t.eventId)&&void 0!==i?i:void 0,s)}function Vr(r){const i=Ur()["cordova"];return new Promise(n=>{i.plugins.browsertab.isAvailable(e=>{let t=null;e?i.plugins.browsertab.openUrl(r):t=i.InAppBrowser.open(r,(e=d(),/(iPad|iPhone|iPod).*OS 7_\d/i.test(e)||/(iPad|iPhone|iPod).*OS 8_\d/i.test(e)?"_blank":"_system"),"location=yes"),n(t)})})}const xr=20;class jr extends rr{constructor(){super(...arguments),this.passiveListeners=new Set,this.initPromise=new Promise(e=>{this.resolveInialized=e})}addPassiveListener(e){this.passiveListeners.add(e)}removePassiveListener(e){this.passiveListeners.delete(e)}resetRedirect(){this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1}onEvent(t){return this.resolveInialized(),this.passiveListeners.forEach(e=>e(t)),super.onEvent(t)}async initialized(){await this.initPromise}}function Hr(e,t,n=null){return{type:t,eventId:n,urlResponse:null,sessionId:function(){const e=[],t="1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";for(let r=0;r<xr;r++){var n=Math.floor(Math.random()*t.length);e.push(t.charAt(n))}return e.join("")}(),postBody:null,tenantId:e.tenantId,error:H(e,"no-auth-event")}}async function Wr(e){var t=await zr()._get(Br(e));return t&&await zr()._remove(Br(e)),t}function qr(e,t){var n,r,i;const s=(n=Gr(t=t),a=n.link?decodeURIComponent(n.link):void 0,r=Gr(a).link,i=n.deep_link_id?decodeURIComponent(n.deep_link_id):void 0,(n=Gr(i).link)||i||r||a||t);if(s.includes("/__/auth/callback")){var a=Gr(s),a=a.firebaseError?function(e){try{return JSON.parse(e)}catch(e){return null}}(decodeURIComponent(a.firebaseError)):null,a=null===(a=null===(a=null==a?void 0:a.code)||void 0===a?void 0:a.split("auth/"))||void 0===a?void 0:a[1],a=a?H(a):null;return a?{type:e.type,eventId:e.eventId,tenantId:e.tenantId,error:a,urlResponse:null,sessionId:null,postBody:null}:{type:e.type,eventId:e.eventId,tenantId:e.tenantId,sessionId:e.sessionId,urlResponse:s,postBody:null}}return null}function zr(){return Ie(on)}function Br(e){return be("authEvent",e.config.apiKey,e.name)}function Gr(e){if(null==e||!e.includes("?"))return{};const[,...t]=e.split("?");return w(t.join("?"))}const Kr=class{constructor(){this._redirectPersistence=ln,this._shouldInitProactively=!0,this.eventManagers=new Map,this.originValidationPromises={},this._completeRedirectFn=tr,this._overrideRedirectResult=Jn}async _initialize(e){var t=e._key();let n=this.eventManagers.get(t);return n||(n=new jr(e),this.eventManagers.set(t,n),this.attachCallbackListeners(e,n)),n}_openPopup(e){j(e,"operation-not-supported-in-this-environment")}async _openRedirect(e,t,n,r){var i,s;i=e,o=Ur(),B("function"==typeof(null===(s=null==o?void 0:o.universalLinks)||void 0===s?void 0:s.subscribe),i,"invalid-cordova-configuration",{missingPlugin:"cordova-universal-links-plugin-fix"}),B(void 0!==(null===(s=null==o?void 0:o.BuildInfo)||void 0===s?void 0:s.packageName),i,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-buildInfo"}),B("function"==typeof(null===(s=null===(s=null===(s=null==o?void 0:o.cordova)||void 0===s?void 0:s.plugins)||void 0===s?void 0:s.browsertab)||void 0===s?void 0:s.openUrl),i,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-browsertab"}),B("function"==typeof(null===(s=null===(s=null===(s=null==o?void 0:o.cordova)||void 0===s?void 0:s.plugins)||void 0===s?void 0:s.browsertab)||void 0===s?void 0:s.isAvailable),i,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-browsertab"}),B("function"==typeof(null===(o=null===(o=null==o?void 0:o.cordova)||void 0===o?void 0:o.InAppBrowser)||void 0===o?void 0:o.open),i,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-inappbrowser"});const a=await this._initialize(e);await a.initialized(),a.resetRedirect(),Gn.clear(),await this._originValidation(e);var o=Hr(e,n,r);n=e,r=o,await zr()._set(Br(n),r);o=await Vr(await Fr(e,o,t));return async function(a,o,c){const l=Ur()["cordova"];let u=()=>{};try{await new Promise((n,e)=>{let t=null;function r(){var e;n();const t=null===(e=l.plugins.browsertab)||void 0===e?void 0:e.close;"function"==typeof t&&t(),"function"==typeof(null==c?void 0:c.close)&&c.close()}function i(){t=t||window.setTimeout(()=>{e(H(a,"redirect-cancelled-by-user"))},2e3)}function s(){"visible"===(null===document||void 0===document?void 0:document.visibilityState)&&i()}o.addPassiveListener(r),document.addEventListener("resume",i,!1),Pe()&&document.addEventListener("visibilitychange",s,!1),u=()=>{o.removePassiveListener(r),document.removeEventListener("resume",i,!1),document.removeEventListener("visibilitychange",s,!1),t&&window.clearTimeout(t)}})}finally{u()}}(e,a,o)}_isIframeWebStorageSupported(e,t){throw new Error("Method not implemented.")}_originValidation(e){var t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=async function(e){var t=Ur()["BuildInfo"];const n={};Le()?n.iosBundleId=t.packageName:Pe()?n.androidPackageName=t.packageName:j(e,"operation-not-supported-in-this-environment"),await ar(e,n)}(e)),this.originValidationPromises[t]}attachCallbackListeners(r,i){const{universalLinks:e,handleOpenURL:t,BuildInfo:n}=Ur(),s=setTimeout(async()=>{await Wr(r),i.onEvent($r())},500),a=async e=>{clearTimeout(s);var t=await Wr(r);let n=null;t&&null!=e&&e.url&&(n=qr(t,e.url)),i.onEvent(n||$r())};void 0!==e&&"function"==typeof e.subscribe&&e.subscribe(null,a);const o=t,c=`${n.packageName.toLowerCase()}://`;Ur().handleOpenURL=async e=>{if(e.toLowerCase().startsWith(c)&&a({url:e}),"function"==typeof o)try{o(e)}catch(e){console.error(e)}}}};function $r(){return{type:"unknown",eventId:null,sessionId:null,urlResponse:null,postBody:null,tenantId:null,error:H("no-auth-event")}}var Jr;function Yr(){var e;return(null===(e=null===self||void 0===self?void 0:self.location)||void 0===e?void 0:e.protocol)||null}function Xr(e=d()){return!("file:"!==Yr()&&"ionic:"!==Yr()&&"capacitor:"!==Yr()||!e.toLowerCase().match(/iphone|ipad|ipod|android/))}function Qr(e=d()){return v()&&11===(null===document||void 0===document?void 0:document.documentMode)||([e=d()]=[e],/Edge\/\d+/.test(e))}function Zr(){try{const t=self.localStorage;var e=dn();if(t)return t.setItem(e,"1"),t.removeItem(e),!Qr()||g()}catch(e){return ei()&&g()}return!1}function ei(){return"undefined"!=typeof global&&"WorkerGlobalScope"in global&&"importScripts"in global}function ti(){return("http:"===Yr()||"https:"===Yr()||p()||Xr())&&!(f()||h())&&Zr()&&!ei()}function ni(){return Xr()&&"undefined"!=typeof document}const ri={LOCAL:"local",NONE:"none",SESSION:"session"},ii=B,si="persistence";async function ai(e){await e._initializationPromise;const t=oi();var n=be(si,e.config.apiKey,e.name);t&&t.setItem(n,e._getPersistence())}function oi(){var e;try{return(null===(e="undefined"!=typeof window?window:null)?void 0:e.sessionStorage)||null}catch(e){return null}}const ci=B;class li{constructor(){this.browserResolver=Ie(Sr),this.cordovaResolver=Ie(Kr),this.underlyingResolver=null,this._redirectPersistence=ln,this._completeRedirectFn=tr,this._overrideRedirectResult=Jn}async _initialize(e){return await this.selectUnderlyingResolver(),this.assertedUnderlyingResolver._initialize(e)}async _openPopup(e,t,n,r){return await this.selectUnderlyingResolver(),this.assertedUnderlyingResolver._openPopup(e,t,n,r)}async _openRedirect(e,t,n,r){return await this.selectUnderlyingResolver(),this.assertedUnderlyingResolver._openRedirect(e,t,n,r)}_isIframeWebStorageSupported(e,t){this.assertedUnderlyingResolver._isIframeWebStorageSupported(e,t)}_originValidation(e){return this.assertedUnderlyingResolver._originValidation(e)}get _shouldInitProactively(){return ni()||this.browserResolver._shouldInitProactively}get assertedUnderlyingResolver(){return ci(this.underlyingResolver,"internal-error"),this.underlyingResolver}async selectUnderlyingResolver(){var e;this.underlyingResolver||(e=await(!!ni()&&new Promise(e=>{const t=setTimeout(()=>{e(!1)},1e3);document.addEventListener("deviceready",()=>{clearTimeout(t),e(!0)})})),this.underlyingResolver=e?this.cordovaResolver:this.browserResolver)}}function ui(e){return e.unwrap()}function di(e,t){var n,r,i,s=null===(r=t.customData)||void 0===r?void 0:r._tokenResponse;if("auth/multi-factor-auth-required"===(null==t?void 0:t.code)){const o=t;o.resolver=new vi(e,(n=t,i=E(e),B((a=n).customData.operationType,i,"argument-error"),B(null===(r=a.customData._serverResponse)||void 0===r?void 0:r.mfaPendingCredential,i,"argument-error"),en._fromError(i,a)))}else if(s){var a=hi(t);const c=t;a&&(c.credential=a,c.tenantId=s.tenantId||void 0,c.email=s.email||void 0,c.phoneNumber=s.phoneNumber||void 0)}}function hi(e){var t=(e instanceof m?e.customData:e)["_tokenResponse"];if(!t)return null;if(!(e instanceof m)&&"temporaryProof"in t&&"phoneNumber"in t)return Un.credentialFromResult(e);const n=t.providerId;if(!n||n===O.PASSWORD)return null;let r;switch(n){case O.GOOGLE:r=vt;break;case O.FACEBOOK:r=ft;break;case O.GITHUB:r=gt;break;case O.TWITTER:r=yt;break;default:var{oauthIdToken:i,oauthAccessToken:s,oauthTokenSecret:a,pendingToken:o,nonce:c}=t;return s||a||i||o?o?n.startsWith("saml.")?mt._create(n,o):at._fromParams({providerId:n,signInMethod:n,pendingToken:o,idToken:i,accessToken:s}):new pt(n).credential({idToken:i,accessToken:s,rawNonce:c}):null}return e instanceof m?r.credentialFromError(e):r.credentialFromResult(e)}function pi(t,e){return e.catch(e=>{throw e instanceof m&&di(t,e),e}).then(e=>{var t=e.operationType,n=e.user;return{operationType:t,credential:hi(e),additionalUserInfo:Qt(e),user:gi.getOrCreate(n)}})}async function fi(t,e){const n=await e;return{verificationId:n.verificationId,confirm:e=>pi(t,n.confirm(e))}}class vi{constructor(e,t){this.resolver=t,this.auth=e.wrapped()}get session(){return this.resolver.session}get hints(){return this.resolver.hints}resolveSignIn(e){return pi(ui(this.auth),this.resolver.resolveSignIn(e))}}class gi{constructor(e){var t;this._delegate=e,this.multiFactor=(t=E(e),nn.has(t)||nn.set(t,tn._fromUser(t)),nn.get(t))}static getOrCreate(e){return gi.USER_MAP.has(e)||gi.USER_MAP.set(e,new gi(e)),gi.USER_MAP.get(e)}delete(){return this._delegate.delete()}reload(){return this._delegate.reload()}toJSON(){return this._delegate.toJSON()}getIdTokenResult(e){return this._delegate.getIdTokenResult(e)}getIdToken(e){return this._delegate.getIdToken(e)}linkAndRetrieveDataWithCredential(e){return this.linkWithCredential(e)}async linkWithCredential(e){return pi(this.auth,Ot(this._delegate,e))}async linkWithPhoneNumber(e,t){return fi(this.auth,async function(e,t,n){const r=E(e);await St(!1,r,"phone");var i=await Mn(r.auth,t,E(n));return new Dn(i,e=>Ot(r,e))}(this._delegate,e,t))}async linkWithPopup(e){return pi(this.auth,async function(e,t,n){var r=E(e);q(r.auth,t,dt);var i=Fn(r.auth,n);const s=new zn(r.auth,"linkViaPopup",t,i,r);return s.executeNotNull()}(this._delegate,e,li))}async linkWithRedirect(e){return await ai(Ge(this.auth)),er(this._delegate,e,li)}reauthenticateAndRetrieveDataWithCredential(e){return this.reauthenticateWithCredential(e)}async reauthenticateWithCredential(e){return pi(this.auth,Lt(this._delegate,e))}reauthenticateWithPhoneNumber(e,t){return fi(this.auth,async function(e,t,n){const r=E(e);var i=await Mn(r.auth,t,E(n));return new Dn(i,e=>Lt(r,e))}(this._delegate,e,t))}reauthenticateWithPopup(e){return pi(this.auth,async function(e,t,n){var r=E(e);q(r.auth,t,dt);var i=Fn(r.auth,n);const s=new zn(r.auth,"reauthViaPopup",t,i,r);return s.executeNotNull()}(this._delegate,e,li))}async reauthenticateWithRedirect(e){return await ai(Ge(this.auth)),Zn(this._delegate,e,li)}sendEmailVerification(e){return Wt(this._delegate,e)}async unlink(e){return await Rt(this._delegate,e),this}updateEmail(e){return Bt(E(this._delegate),e,null)}updatePassword(e){return Bt(E(this._delegate),null,e)}updatePhoneNumber(e){return async function(e,t){await At(E(e),t)}(this._delegate,e)}updateProfile(e){return zt(this._delegate,e)}verifyBeforeUpdateEmail(e,t){return qt(this._delegate,e,t)}get emailVerified(){return this._delegate.emailVerified}get isAnonymous(){return this._delegate.isAnonymous}get metadata(){return this._delegate.metadata}get phoneNumber(){return this._delegate.phoneNumber}get providerData(){return this._delegate.providerData}get refreshToken(){return this._delegate.refreshToken}get tenantId(){return this._delegate.tenantId}get displayName(){return this._delegate.displayName}get email(){return this._delegate.email}get photoURL(){return this._delegate.photoURL}get providerId(){return this._delegate.providerId}get uid(){return this._delegate.uid}get auth(){return this._delegate.auth}}gi.USER_MAP=new WeakMap;const mi=B;class _i{constructor(e,t){if(this.app=e,t.isInitialized())return this._delegate=t.getImmediate(),void this.linkUnderlyingAuth();var n=e.options["apiKey"];mi(n,"invalid-api-key",{appName:e.name}),mi(n,"invalid-api-key",{appName:e.name});var r="undefined"!=typeof window?li:void 0;this._delegate=t.initialize({options:{persistence:function(e,t){const n=function(e,t){const n=oi();if(!n)return[];var r=be(si,e,t);switch(n.getItem(r)){case ri.NONE:return[Te];case ri.LOCAL:return[kn,ln];case ri.SESSION:return[ln];default:return[]}}(e,t);"undefined"==typeof self||n.includes(kn)||n.push(kn);if("undefined"!=typeof window)for(const r of[on,ln])n.includes(r)||n.push(r);n.includes(Te)||n.push(Te);return n}(n,e.name),popupRedirectResolver:r}}),this._delegate._updateErrorMap(M),this.linkUnderlyingAuth()}get emulatorConfig(){return this._delegate.emulatorConfig}get currentUser(){return this._delegate.currentUser?gi.getOrCreate(this._delegate.currentUser):null}get languageCode(){return this._delegate.languageCode}set languageCode(e){this._delegate.languageCode=e}get settings(){return this._delegate.settings}get tenantId(){return this._delegate.tenantId}set tenantId(e){this._delegate.tenantId=e}useDeviceLanguage(){this._delegate.useDeviceLanguage()}signOut(){return this._delegate.signOut()}useEmulator(e,t){$e(this._delegate,e,t)}applyActionCode(e){return xt(this._delegate,e)}checkActionCode(e){return jt(this._delegate,e)}confirmPasswordReset(e,t){return async function(e,t,n){await Qe(E(e),{oobCode:t,newPassword:n})}(this._delegate,e,t)}async createUserWithEmailAndPassword(e,t){return pi(this._delegate,async function(e,t,n){var r;const i=Ge(e),s={returnSecureToken:!0,email:t,password:n,clientType:"CLIENT_TYPE_WEB"};let a;a=null!==(r=i._getRecaptchaConfig())&&void 0!==r&&r.emailPasswordEnabled?(o=await qe(i,s,"signUpPassword"),It(i,o)):It(i,s).catch(async e=>{if("auth/missing-recaptcha-token"!==e.code)return Promise.reject(e);console.log("Sign-up is protected by reCAPTCHA for this project. Automatically triggering the reCAPTCHA flow and restarting the sign-up flow.");var t=await qe(i,s,"signUpPassword");return It(i,t)});var o=await a.catch(e=>Promise.reject(e)),o=await wt._fromIdTokenResponse(i,"signIn",o);return await i._updateCurrentUser(o.user),o}(this._delegate,e,t))}fetchProvidersForEmail(e){return this.fetchSignInMethodsForEmail(e)}fetchSignInMethodsForEmail(e){return Ht(this._delegate,e)}isSignInWithEmailLink(e){return this._delegate,e=e,"EMAIL_SIGNIN"===(null==(t=lt.parseLink(e))?void 0:t.operation);var t}async getRedirectResult(){mi(ti(),this._delegate,"operation-not-supported-in-this-environment");var e,t,n=(e=this._delegate,t=li,await Ge(e)._initializationPromise,await tr(e,t,!1));return n?pi(this._delegate,Promise.resolve(n)):{credential:null,user:null}}addFrameworkForLogging(e){Ge(this._delegate)._logFramework(e)}onAuthStateChanged(e,t,n){var{next:r,error:i,complete:s}=yi(e,t,n);return this._delegate.onAuthStateChanged(r,i,s)}onIdTokenChanged(e,t,n){var{next:r,error:i,complete:s}=yi(e,t,n);return this._delegate.onIdTokenChanged(r,i,s)}sendSignInLinkToEmail(e,t){return async function(e,t,n){var r;const i=Ge(e),s={requestType:"EMAIL_SIGNIN",email:t,clientType:"CLIENT_TYPE_WEB"};function a(e,t){B(t.handleCodeInApp,i,"argument-error"),t&&Vt(i,e,t)}null!==(r=i._getRecaptchaConfig())&&void 0!==r&&r.emailPasswordEnabled?(a(r=await qe(i,s,"getOobCode",!0),n),await rt(i,r)):(a(s,n),await rt(i,s).catch(async e=>{if("auth/missing-recaptcha-token"!==e.code)return Promise.reject(e);console.log("Email link sign-in is protected by reCAPTCHA for this project. Automatically triggering the reCAPTCHA flow and restarting the sign-in flow.");var t=await qe(i,s,"getOobCode",!0);a(t,n),await rt(i,t)}))}(this._delegate,e,t)}sendPasswordResetEmail(e,t){return async function(e,t,n){var r;const i=Ge(e),s={requestType:"PASSWORD_RESET",email:t,clientType:"CLIENT_TYPE_WEB"};null!==(r=i._getRecaptchaConfig())&&void 0!==r&&r.emailPasswordEnabled?(r=await qe(i,s,"getOobCode",!0),n&&Vt(i,r,n),await nt(i,r)):(n&&Vt(i,s,n),await nt(i,s).catch(async e=>{if("auth/missing-recaptcha-token"!==e.code)return Promise.reject(e);console.log("Password resets are protected by reCAPTCHA for this project. Automatically triggering the reCAPTCHA flow and restarting the password reset flow.");var t=await qe(i,s,"getOobCode",!0);n&&Vt(i,t,n),await nt(i,t)}))}(this._delegate,e,t||void 0)}async setPersistence(e){var t,n;t=this._delegate,n=e,ii(Object.values(ri).includes(n),t,"invalid-persistence-type"),f()?ii(n!==ri.SESSION,t,"unsupported-persistence-type"):h()?ii(n===ri.NONE,t,"unsupported-persistence-type"):ei()?ii(n===ri.NONE||n===ri.LOCAL&&g(),t,"unsupported-persistence-type"):ii(n===ri.NONE||Zr(),t,"unsupported-persistence-type");let r;switch(e){case ri.SESSION:r=ln;break;case ri.LOCAL:var i=await Ie(kn)._isAvailable();r=i?kn:on;break;case ri.NONE:r=Te;break;default:return j("argument-error",{appName:this._delegate.name})}return this._delegate.setPersistence(r)}signInAndRetrieveDataWithCredential(e){return this.signInWithCredential(e)}signInAnonymously(){return pi(this._delegate,async function(e){const t=Ge(e);if(await t._initializationPromise,null!==(n=t.currentUser)&&void 0!==n&&n.isAnonymous)return new wt({user:t.currentUser,providerId:null,operationType:"signIn"});var n=await It(t,{returnSecureToken:!0}),n=await wt._fromIdTokenResponse(t,"signIn",n,!0);return await t._updateCurrentUser(n.user),n}(this._delegate))}signInWithCredential(e){return pi(this._delegate,Nt(this._delegate,e))}signInWithCustomToken(e){return pi(this._delegate,Dt(this._delegate,e))}signInWithEmailAndPassword(e,t){return pi(this._delegate,(n=this._delegate,e=e,t=t,Nt(E(n),ut.credential(e,t))));var n}signInWithEmailLink(e,t){return pi(this._delegate,async function(e,t,n){var r=E(e),i=ut.credentialWithLink(t,n||$());return B(i._tenantId===(r.tenantId||null),r,"tenant-id-mismatch"),Nt(r,i)}(this._delegate,e,t))}signInWithPhoneNumber(e,t){return fi(this._delegate,async function(e,t,n){const r=Ge(e);var i=await Mn(r,t,E(n));return new Dn(i,e=>Nt(r,e))}(this._delegate,e,t))}async signInWithPopup(e){return mi(ti(),this._delegate,"operation-not-supported-in-this-environment"),pi(this._delegate,async function(e,t,n){var r=Ge(e);q(e,t,dt);var i=Fn(r,n);const s=new zn(r,"signInViaPopup",t,i);return s.executeNotNull()}(this._delegate,e,li))}async signInWithRedirect(e){return mi(ti(),this._delegate,"operation-not-supported-in-this-environment"),await ai(this._delegate),Qn(this._delegate,e,li)}updateCurrentUser(e){return this._delegate.updateCurrentUser(e)}verifyPasswordResetCode(e){return async function(e,t){var n=(await jt(E(e),t))["data"];return n.email}(this._delegate,e)}unwrap(){return this._delegate}_delete(){return this._delegate._delete()}linkUnderlyingAuth(){this._delegate.wrapped=()=>this}}function yi(e,t,n){let r=e;"function"!=typeof e&&({next:r,error:t,complete:n}=e);const i=r;return{next:e=>i(e&&gi.getOrCreate(e)),error:t,complete:n}}_i.Persistence=ri;class Ii{constructor(){this.providerId="phone",this._delegate=new Un(ui(i.default.auth()))}static credential(e,t){return Un.credential(e,t)}verifyPhoneNumber(e,t){return this._delegate.verifyPhoneNumber(e,t)}unwrap(){return this._delegate}}Ii.PHONE_SIGN_IN_METHOD=Un.PHONE_SIGN_IN_METHOD,Ii.PROVIDER_ID=Un.PROVIDER_ID;const wi=B;class Ti{constructor(e,t,n=i.default.app()){var r;wi(null===(r=n.options)||void 0===r?void 0:r.apiKey,"invalid-api-key",{appName:n.name}),this._delegate=new Ln(e,t,n.auth()),this.type=this._delegate.type}clear(){this._delegate.clear()}render(){return this._delegate.render()}verify(){return this._delegate.verify()}}(Jr=i.default).INTERNAL.registerComponent(new N("auth-compat",e=>{var t=e.getProvider("app-compat").getImmediate(),n=e.getProvider("auth");return new _i(t,n)},"PUBLIC").setServiceProps({ActionCodeInfo:{Operation:{EMAIL_SIGNIN:L.EMAIL_SIGNIN,PASSWORD_RESET:L.PASSWORD_RESET,RECOVER_EMAIL:L.RECOVER_EMAIL,REVERT_SECOND_FACTOR_ADDITION:L.REVERT_SECOND_FACTOR_ADDITION,VERIFY_AND_CHANGE_EMAIL:L.VERIFY_AND_CHANGE_EMAIL,VERIFY_EMAIL:L.VERIFY_EMAIL}},EmailAuthProvider:ut,FacebookAuthProvider:ft,GithubAuthProvider:gt,GoogleAuthProvider:vt,OAuthProvider:pt,SAMLAuthProvider:_t,PhoneAuthProvider:Ii,PhoneMultiFactorGenerator:Pr,RecaptchaVerifier:Ti,TwitterAuthProvider:yt,Auth:_i,AuthCredential:Xe,Error:m}).setInstantiationMode("LAZY").setMultipleInstances(!1)),Jr.registerVersion("@firebase/auth-compat","0.4.1")}).apply(this,arguments)}catch(e){throw console.error(e),new Error("Cannot instantiate firebase-auth-compat.js - be sure to load firebase-app.js first.")}});
//# sourceMappingURL=firebase-auth-compat.js.map

!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(require("@firebase/app-compat"),require("@firebase/app")):"function"==typeof define&&define.amd?define(["@firebase/app-compat","@firebase/app"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).firebase,e.firebase.INTERNAL.modularAPIs)}(this,function(wo,Co){"use strict";try{!(function(){function e(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var n,t=e(wo);function r(t){const n=[];let r=0;for(let i=0;i<t.length;i++){let e=t.charCodeAt(i);e<128?n[r++]=e:(e<2048?n[r++]=e>>6|192:(55296==(64512&e)&&i+1<t.length&&56320==(64512&t.charCodeAt(i+1))?(e=65536+((1023&e)<<10)+(1023&t.charCodeAt(++i)),n[r++]=e>>18|240,n[r++]=e>>12&63|128):n[r++]=e>>12|224,n[r++]=e>>6&63|128),n[r++]=63&e|128)}return n}const i={NODE_CLIENT:!1,NODE_ADMIN:!1,SDK_VERSION:"${JSCORE_VERSION}"},p=function(e,t){if(!e)throw c(t)},c=function(e){return new Error("Firebase Database ("+i.SDK_VERSION+") INTERNAL ASSERT FAILED: "+e)},s={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray(n,e){if(!Array.isArray(n))throw Error("encodeByteArray takes an array as a parameter");this.init_();var r=e?this.byteToCharMapWebSafe_:this.byteToCharMap_;const i=[];for(let c=0;c<n.length;c+=3){var s=n[c],o=c+1<n.length,a=o?n[c+1]:0,l=c+2<n.length,h=l?n[c+2]:0;let e=(15&a)<<2|h>>6,t=63&h;l||(t=64,o||(e=64)),i.push(r[s>>2],r[(3&s)<<4|a>>4],r[e],r[t])}return i.join("")},encodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(e):this.encodeByteArray(r(e),t)},decodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(e):function(e){const t=[];let n=0,r=0;for(;n<e.length;){var i,s,o=e[n++];o<128?t[r++]=String.fromCharCode(o):191<o&&o<224?(i=e[n++],t[r++]=String.fromCharCode((31&o)<<6|63&i)):239<o&&o<365?(s=((7&o)<<18|(63&e[n++])<<12|(63&e[n++])<<6|63&e[n++])-65536,t[r++]=String.fromCharCode(55296+(s>>10)),t[r++]=String.fromCharCode(56320+(1023&s))):(i=e[n++],s=e[n++],t[r++]=String.fromCharCode((15&o)<<12|(63&i)<<6|63&s))}return t.join("")}(this.decodeStringToByteArray(e,t))},decodeStringToByteArray(e,t){this.init_();var n=t?this.charToByteMapWebSafe_:this.charToByteMap_;const r=[];for(let l=0;l<e.length;){var i=n[e.charAt(l++)],s=l<e.length?n[e.charAt(l)]:0;++l;var o=l<e.length?n[e.charAt(l)]:64;++l;var a=l<e.length?n[e.charAt(l)]:64;if(++l,null==i||null==s||null==o||null==a)throw new h;r.push(i<<2|s>>4),64!==o&&(r.push(s<<4&240|o>>2),64!==a&&r.push(o<<6&192|a))}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let e=0;e<this.ENCODED_VALS.length;e++)this.byteToCharMap_[e]=this.ENCODED_VALS.charAt(e),this.charToByteMap_[this.byteToCharMap_[e]]=e,this.byteToCharMapWebSafe_[e]=this.ENCODED_VALS_WEBSAFE.charAt(e),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[e]]=e,e>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(e)]=e,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(e)]=e)}}};class h extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}function o(e){var t=r(e);return s.encodeByteArray(t,!0)}const a=function(e){return o(e).replace(/\./g,"")},l=function(e){try{return s.decodeString(e,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};function u(e){return function e(t,n){if(!(n instanceof Object))return n;switch(n.constructor){case Date:const r=n;return new Date(r.getTime());case Object:void 0===t&&(t={});break;case Array:t=[];break;default:return n}for(const i in n)n.hasOwnProperty(i)&&d(i)&&(t[i]=e(t[i],n[i]));return t}(void 0,e)}function d(e){return"__proto__"!==e}class _{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(n){return(e,t)=>{e?this.reject(e):this.resolve(t),"function"==typeof n&&(this.promise.catch(()=>{}),1===n.length?n(e):n(e,t))}}}function f(){return"undefined"!=typeof window&&(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test("undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:"")}function g(){return!0===i.NODE_ADMIN}function m(e){return JSON.parse(e)}function v(e){return JSON.stringify(e)}function y(e){let t={},n={},r={},i="";try{var s=e.split(".");t=m(l(s[0])||""),n=m(l(s[1])||""),i=s[2],r=n.d||{},delete n.d}catch(e){}return{header:t,claims:n,data:r,signature:i}}function w(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function C(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]}function b(e){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}function I(e,t,n){const r={};for(const i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=t.call(n,e[i],i,e));return r}class T{constructor(){this.chain_=[],this.buf_=[],this.W_=[],this.pad_=[],this.inbuf_=0,this.total_=0,this.blockSize=64,this.pad_[0]=128;for(let e=1;e<this.blockSize;++e)this.pad_[e]=0;this.reset()}reset(){this.chain_[0]=1732584193,this.chain_[1]=4023233417,this.chain_[2]=2562383102,this.chain_[3]=271733878,this.chain_[4]=3285377520,this.inbuf_=0,this.total_=0}compress_(n,r){r=r||0;const i=this.W_;if("string"==typeof n)for(let e=0;e<16;e++)i[e]=n.charCodeAt(r)<<24|n.charCodeAt(r+1)<<16|n.charCodeAt(r+2)<<8|n.charCodeAt(r+3),r+=4;else for(let t=0;t<16;t++)i[t]=n[r]<<24|n[r+1]<<16|n[r+2]<<8|n[r+3],r+=4;for(let d=16;d<80;d++){var e=i[d-3]^i[d-8]^i[d-14]^i[d-16];i[d]=4294967295&(e<<1|e>>>31)}let t=this.chain_[0],s=this.chain_[1],o=this.chain_[2],a=this.chain_[3],l=this.chain_[4],h,c;for(let _=0;_<80;_++){c=_<40?_<20?(h=a^s&(o^a),1518500249):(h=s^o^a,1859775393):_<60?(h=s&o|a&(s|o),2400959708):(h=s^o^a,3395469782);var u=(t<<5|t>>>27)+h+l+c+i[_]&4294967295;l=a,a=o,o=4294967295&(s<<30|s>>>2),s=t,t=u}this.chain_[0]=this.chain_[0]+t&4294967295,this.chain_[1]=this.chain_[1]+s&4294967295,this.chain_[2]=this.chain_[2]+o&4294967295,this.chain_[3]=this.chain_[3]+a&4294967295,this.chain_[4]=this.chain_[4]+l&4294967295}update(n,r){if(null!=n){var i=(r=void 0===r?n.length:r)-this.blockSize;let e=0;const s=this.buf_;let t=this.inbuf_;for(;e<r;){if(0===t)for(;e<=i;)this.compress_(n,e),e+=this.blockSize;if("string"==typeof n){for(;e<r;)if(s[t]=n.charCodeAt(e),++t,++e,t===this.blockSize){this.compress_(s),t=0;break}}else for(;e<r;)if(s[t]=n[e],++t,++e,t===this.blockSize){this.compress_(s),t=0;break}}this.inbuf_=t,this.total_+=r}}digest(){const t=[];let e=8*this.total_;this.inbuf_<56?this.update(this.pad_,56-this.inbuf_):this.update(this.pad_,this.blockSize-(this.inbuf_-56));for(let r=this.blockSize-1;56<=r;r--)this.buf_[r]=255&e,e/=256;this.compress_(this.buf_);let n=0;for(let i=0;i<5;i++)for(let e=24;0<=e;e-=8)t[n]=this.chain_[i]>>e&255,++n;return t}}function E(e,t,n,r){let i;if(r<t?i="at least "+t:n<r&&(i=0===n?"none":"no more than "+n),i){var s=e+" failed: Was called with "+r+(1===r?" argument.":" arguments.")+" Expects "+i+".";throw new Error(s)}}function S(e,t){return`${e} failed: ${t} argument `}function k(e,t,n,r){if((!r||n)&&"function"!=typeof n)throw new Error(S(e,t)+"must be a valid function.")}function N(e,t,n,r){if((!r||n)&&("object"!=typeof n||null===n))throw new Error(S(e,t)+"must be a valid context object.")}const P=function(e){let t=0;for(let r=0;r<e.length;r++){var n=e.charCodeAt(r);n<128?t++:n<2048?t+=2:55296<=n&&n<=56319?(t+=4,r++):t+=3}return t};function R(e){return e&&e._delegate?e._delegate:e}class x{constructor(e,t,n){this.name=e,this.instanceFactory=t,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}const D="[DEFAULT]";class A{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){var t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const r=new _;if(this.instancesDeferred.set(t,r),this.isInitialized(t)||this.shouldAutoInitialize())try{var n=this.getOrInitializeService({instanceIdentifier:t});n&&r.resolve(n)}catch(e){}}return this.instancesDeferred.get(t).promise}getImmediate(e){var t=this.normalizeInstanceIdentifier(null==e?void 0:e.identifier),n=null!==(n=null==e?void 0:e.optional)&&void 0!==n&&n;if(!this.isInitialized(t)&&!this.shouldAutoInitialize()){if(n)return null;throw Error(`Service ${this.name} is not available`)}try{return this.getOrInitializeService({instanceIdentifier:t})}catch(e){if(n)return null;throw e}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,this.shouldAutoInitialize()){if("EAGER"===e.instantiationMode)try{this.getOrInitializeService({instanceIdentifier:D})}catch(e){}for(var[t,n]of this.instancesDeferred.entries()){t=this.normalizeInstanceIdentifier(t);try{var r=this.getOrInitializeService({instanceIdentifier:t});n.resolve(r)}catch(e){}}}}clearInstance(e=D){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(e=>"INTERNAL"in e).map(e=>e.INTERNAL.delete()),...e.filter(e=>"_delete"in e).map(e=>e._delete())])}isComponentSet(){return null!=this.component}isInitialized(e=D){return this.instances.has(e)}getOptions(e=D){return this.instancesOptions.get(e)||{}}initialize(e={}){var{options:t={}}=e,n=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(n))throw Error(`${this.name}(${n}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);var r,i,s=this.getOrInitializeService({instanceIdentifier:n,options:t});for([r,i]of this.instancesDeferred.entries())n===this.normalizeInstanceIdentifier(r)&&i.resolve(s);return s}onInit(e,t){var n=this.normalizeInstanceIdentifier(t);const r=null!==(i=this.onInitCallbacks.get(n))&&void 0!==i?i:new Set;r.add(e),this.onInitCallbacks.set(n,r);var i=this.instances.get(n);return i&&e(i,n),()=>{r.delete(e)}}invokeOnInitCallbacks(e,t){var n=this.onInitCallbacks.get(t);if(n)for(const r of n)try{r(e,t)}catch(e){}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let n=this.instances.get(e);if(!n&&this.component&&(n=this.component.instanceFactory(this.container,{instanceIdentifier:(r=e)===D?void 0:r,options:t}),this.instances.set(e,n),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(n,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,n)}catch(e){}var r;return n||null}normalizeInstanceIdentifier(e=D){return!this.component||this.component.multipleInstances?e:D}shouldAutoInitialize(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}class O{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){const t=this.getProvider(e.name);t.isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);var t=new A(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}($=n=n||{})[$.DEBUG=0]="DEBUG",$[$.VERBOSE=1]="VERBOSE",$[$.INFO=2]="INFO",$[$.WARN=3]="WARN",$[$.ERROR=4]="ERROR",$[$.SILENT=5]="SILENT";const L={debug:n.DEBUG,verbose:n.VERBOSE,info:n.INFO,warn:n.WARN,error:n.ERROR,silent:n.SILENT},M=n.INFO,F={[n.DEBUG]:"log",[n.VERBOSE]:"log",[n.INFO]:"info",[n.WARN]:"warn",[n.ERROR]:"error"},q=(e,t,...n)=>{if(!(t<e.logLevel)){var r=(new Date).toISOString(),i=F[t];if(!i)throw new Error(`Attempted to log a message with an invalid logType (value: ${t})`);console[i](`[${r}]  ${e.name}:`,...n)}};class W{constructor(e){this.name=e,this._logLevel=M,this._logHandler=q,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in n))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel="string"==typeof e?L[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if("function"!=typeof e)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,n.DEBUG,...e),this._logHandler(this,n.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,n.VERBOSE,...e),this._logHandler(this,n.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,n.INFO,...e),this._logHandler(this,n.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,n.WARN,...e),this._logHandler(this,n.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,n.ERROR,...e),this._logHandler(this,n.ERROR,...e)}}const U="@firebase/database";let B="";function j(e){B=e}class V{constructor(e){this.domStorage_=e,this.prefix_="firebase:"}set(e,t){null==t?this.domStorage_.removeItem(this.prefixedName_(e)):this.domStorage_.setItem(this.prefixedName_(e),v(t))}get(e){var t=this.domStorage_.getItem(this.prefixedName_(e));return null==t?null:m(t)}remove(e){this.domStorage_.removeItem(this.prefixedName_(e))}prefixedName_(e){return this.prefix_+e}toString(){return this.domStorage_.toString()}}class z{constructor(){this.cache_={},this.isInMemoryStorage=!0}set(e,t){null==t?delete this.cache_[e]:this.cache_[e]=t}get(e){return w(this.cache_,e)?this.cache_[e]:null}remove(e){delete this.cache_[e]}}function H(e){try{if("undefined"!=typeof window&&void 0!==window[e]){const t=window[e];return t.setItem("firebase:sentinel","cache"),t.removeItem("firebase:sentinel"),new V(t)}}catch(e){}return new z}var Q,Y,K,$,G,J,X;function Z(e){var t=function(t){const n=[];let r=0;for(let o=0;o<t.length;o++){let e=t.charCodeAt(o);var i,s;55296<=e&&e<=56319&&(i=e-55296,o++,p(o<t.length,"Surrogate pair missing trail surrogate."),s=t.charCodeAt(o)-56320,e=65536+(i<<10)+s),e<128?n[r++]=e:(e<2048?n[r++]=e>>6|192:(e<65536?n[r++]=e>>12|224:(n[r++]=e>>18|240,n[r++]=e>>12&63|128),n[r++]=e>>6&63|128),n[r++]=63&e|128)}return n}(e);const n=new T;return n.update(t),t=n.digest(),s.encodeByteArray(t)}const ee=H("localStorage"),te=H("sessionStorage"),ne=new W("@firebase/database"),re=function(){let e=1;return function(){return e++}}(),ie=function(...e){let t="";for(let r=0;r<e.length;r++){var n=e[r];Array.isArray(n)||n&&"object"==typeof n&&"number"==typeof n.length?t+=ie.apply(null,n):t+="object"==typeof n?v(n):n,t+=" "}return t};let se=null,oe=!0;function ae(t){return function(...e){pe(t,...e)}}function le(...e){var t="FIREBASE INTERNAL ERROR: "+ie(...e);ne.error(t)}function he(e,t){return e===t?0:e<t?-1:1}function ce(e,t){if(t&&e in t)return t[e];throw new Error("Missing required key ("+e+") in object: "+v(t))}function ue(e){if("object"!=typeof e||null===e)return v(e);const t=[];for(const r in e)t.push(r);t.sort();let n="{";for(let i=0;i<t.length;i++)0!==i&&(n+=","),n+=v(t[i]),n+=":",n+=ue(e[t[i]]);return n+="}",n}function de(e,t){var n=e.length;if(n<=t)return[e];const r=[];for(let i=0;i<n;i+=t)i+t>n?r.push(e.substring(i,n)):r.push(e.substring(i,i+t));return r}const _e=function(e,t){p(!t||!0===e||!1===e,"Can't turn on custom loggers persistently."),!0===e?(ne.logLevel=n.VERBOSE,se=ne.log.bind(ne),t&&te.set("logging_enabled",!0)):"function"==typeof e?se=e:(se=null,te.remove("logging_enabled"))},pe=function(...e){var t;!0===oe&&(oe=!1,null===se&&!0===te.get("logging_enabled")&&_e(!0)),se&&(t=ie.apply(null,e),se(t))},fe=function(...e){var t=`FIREBASE FATAL ERROR: ${ie(...e)}`;throw ne.error(t),new Error(t)},ge=function(...e){var t="FIREBASE WARNING: "+ie(...e);ne.warn(t)},me=function(){"undefined"!=typeof window&&window.location&&window.location.protocol&&-1!==window.location.protocol.indexOf("https:")&&ge("Insecure Firebase access from a secure page. Please use https in calls to new Firebase().")},ve=function(e){return"number"==typeof e&&(e!=e||e===Number.POSITIVE_INFINITY||e===Number.NEGATIVE_INFINITY)},ye="[MIN_NAME]",we="[MAX_NAME]",Ce=function(e,t){if(e===t)return 0;if(e===ye||t===we)return-1;if(t===ye||e===we)return 1;var n=Te(e),r=Te(t);return null!==n?null!==r?n-r==0?e.length-t.length:n-r:-1:null===r&&e<t?-1:1};function be(e,t){for(const n in e)e.hasOwnProperty(n)&&t(n,e[n])}function Ie(e){p(!ve(e),"Invalid JSON number");let t,n,r,i,s;0===e?(n=0,r=0,t=1/e==-1/0?1:0):(t=e<0,e=Math.abs(e),r=e>=Math.pow(2,-1022)?(i=Math.min(Math.floor(Math.log(e)/Math.LN2),1023),n=i+1023,Math.round(e*Math.pow(2,52-i)-Math.pow(2,52))):(n=0,Math.round(e/Math.pow(2,-1074))));const o=[];for(s=52;s;--s)o.push(r%2?1:0),r=Math.floor(r/2);for(s=11;s;--s)o.push(n%2?1:0),n=Math.floor(n/2);o.push(t?1:0),o.reverse();const a=o.join("");let l="";for(s=0;s<64;s+=8){let e=parseInt(a.substr(s,8),2).toString(16);1===e.length&&(e="0"+e),l+=e}return l.toLowerCase()}function Te(e){if(Se.test(e)){var t=Number(e);if(t>=ke&&t<=Ne)return t}return null}function Ee(e,t){const n=setTimeout(e,t);return"number"==typeof n&&"undefined"!=typeof Deno&&Deno.unrefTimer?Deno.unrefTimer(n):"object"==typeof n&&n.unref&&n.unref(),n}const Se=new RegExp("^-?(0*)\\d{1,10}$"),ke=-2147483648,Ne=2147483647,Pe=function(e){try{e()}catch(t){setTimeout(()=>{var e=t.stack||"";throw ge("Exception was thrown by user callback.",e),t},Math.floor(0))}};class Re{constructor(e,t){this.appName_=e,this.appCheckProvider=t,this.appCheck=null==t?void 0:t.getImmediate({optional:!0}),this.appCheck||null!=t&&t.get().then(e=>this.appCheck=e)}getToken(n){return this.appCheck?this.appCheck.getToken(n):new Promise((e,t)=>{setTimeout(()=>{this.appCheck?this.getToken(n).then(e,t):e(null)},0)})}addTokenChangeListener(t){var e;null!==(e=this.appCheckProvider)&&void 0!==e&&e.get().then(e=>e.addTokenListener(t))}notifyForInvalidToken(){ge(`Provided AppCheck credentials for the app named "${this.appName_}" `+"are invalid. This usually indicates your app was not initialized correctly.")}}class xe{constructor(e,t,n){this.appName_=e,this.firebaseOptions_=t,this.authProvider_=n,this.auth_=null,this.auth_=n.getImmediate({optional:!0}),this.auth_||n.onInit(e=>this.auth_=e)}getToken(n){return this.auth_?this.auth_.getToken(n).catch(e=>e&&"auth/token-not-initialized"===e.code?(pe("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(e)):new Promise((e,t)=>{setTimeout(()=>{this.auth_?this.getToken(n).then(e,t):e(null)},0)})}addTokenChangeListener(t){this.auth_?this.auth_.addAuthTokenListener(t):this.authProvider_.get().then(e=>e.addAuthTokenListener(t))}removeTokenChangeListener(t){this.authProvider_.get().then(e=>e.removeAuthTokenListener(t))}notifyForInvalidToken(){let e='Provided authentication credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.firebaseOptions_?e+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.firebaseOptions_?e+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':e+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',ge(e)}}class De{constructor(e){this.accessToken=e}getToken(e){return Promise.resolve({accessToken:this.accessToken})}addTokenChangeListener(e){e(this.accessToken)}removeTokenChangeListener(e){}notifyForInvalidToken(){}}De.OWNER="owner";const Ae=/(console\.firebase|firebase-console-\w+\.corp|firebase\.corp)\.google\.com/,Oe="websocket",Le="long_polling";class Me{constructor(e,t,n,r,i=!1,s="",o=!1,a=!1){this.secure=t,this.namespace=n,this.webSocketOnly=r,this.nodeAdmin=i,this.persistenceKey=s,this.includeNamespaceInQueryParams=o,this.isUsingEmulator=a,this._host=e.toLowerCase(),this._domain=this._host.substr(this._host.indexOf(".")+1),this.internalHost=ee.get("host:"+e)||this._host}isCacheableHost(){return"s-"===this.internalHost.substr(0,2)}isCustomHost(){return"firebaseio.com"!==this._domain&&"firebaseio-demo.com"!==this._domain}get host(){return this._host}set host(e){e!==this.internalHost&&(this.internalHost=e,this.isCacheableHost()&&ee.set("host:"+this._host,this.internalHost))}toString(){let e=this.toURLString();return this.persistenceKey&&(e+="<"+this.persistenceKey+">"),e}toURLString(){var e=this.secure?"https://":"http://",t=this.includeNamespaceInQueryParams?`?ns=${this.namespace}`:"";return`${e}${this.host}/${t}`}}function Fe(e,t,n){p("string"==typeof t,"typeof type must == string"),p("object"==typeof n,"typeof params must == object");let r;if(t===Oe)r=(e.secure?"wss://":"ws://")+e.internalHost+"/.ws?";else{if(t!==Le)throw new Error("Unknown connection type: "+t);r=(e.secure?"https://":"http://")+e.internalHost+"/.lp?"}((t=e).host!==t.internalHost||t.isCustomHost()||t.includeNamespaceInQueryParams)&&(n.ns=e.namespace);const i=[];return be(n,(e,t)=>{i.push(e+"="+t)}),r+i.join("&")}class qe{constructor(){this.counters_={}}incrementCounter(e,t=1){w(this.counters_,e)||(this.counters_[e]=0),this.counters_[e]+=t}get(){return u(this.counters_)}}const We={},Ue={};function Be(e){var t=e.toString();return We[t]||(We[t]=new qe),We[t]}class je{constructor(e){this.onMessage_=e,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}closeAfter(e,t){this.closeAfterResponse=e,this.onClose=t,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)}handleResponse(e,t){for(this.pendingResponses[e]=t;this.pendingResponses[this.currentResponseNum];){const n=this.pendingResponses[this.currentResponseNum];delete this.pendingResponses[this.currentResponseNum];for(let e=0;e<n.length;++e)n[e]&&Pe(()=>{this.onMessage_(n[e])});if(this.currentResponseNum===this.closeAfterResponse){this.onClose&&(this.onClose(),this.onClose=null);break}this.currentResponseNum++}}}class Ve{constructor(e,t,n,r,i,s,o){this.connId=e,this.repoInfo=t,this.applicationId=n,this.appCheckToken=r,this.authToken=i,this.transportSessionId=s,this.lastSessionId=o,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=ae(e),this.stats_=Be(t),this.urlFn=e=>(this.appCheckToken&&(e.ac=this.appCheckToken),Fe(t,Le,e))}open(e,t){this.curSegmentNum=0,this.onDisconnect_=t,this.myPacketOrderer=new je(e),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout(()=>{this.log_("Timed out trying to connect."),this.onClosed_(),this.connectTimeoutTimer_=null},Math.floor(3e4)),function(t){if("complete"===document.readyState)t();else{let e=!1;const n=function(){document.body?e||(e=!0,t()):setTimeout(n,Math.floor(10))};document.addEventListener?(document.addEventListener("DOMContentLoaded",n,!1),window.addEventListener("load",n,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",()=>{"complete"===document.readyState&&n()}),window.attachEvent("onload",n))}}(()=>{if(!this.isClosed_){this.scriptTagHolder=new ze((...e)=>{var[t,n,r]=e;if(this.incrementIncomingBytes_(e),this.scriptTagHolder)if(this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null),this.everConnected_=!0,"start"===t)this.id=n,this.password=r;else{if("close"!==t)throw new Error("Unrecognized command received: "+t);n?(this.scriptTagHolder.sendNewPolls=!1,this.myPacketOrderer.closeAfter(n,()=>{this.onClosed_()})):this.onClosed_()}},(...e)=>{var[t,n]=e;this.incrementIncomingBytes_(e),this.myPacketOrderer.handleResponse(t,n)},()=>{this.onClosed_()},this.urlFn);const t={start:"t"};t.ser=Math.floor(1e8*Math.random()),this.scriptTagHolder.uniqueCallbackIdentifier&&(t.cb=this.scriptTagHolder.uniqueCallbackIdentifier),t.v="5",this.transportSessionId&&(t.s=this.transportSessionId),this.lastSessionId&&(t.ls=this.lastSessionId),this.applicationId&&(t.p=this.applicationId),this.appCheckToken&&(t.ac=this.appCheckToken),"undefined"!=typeof location&&location.hostname&&Ae.test(location.hostname)&&(t.r="f");var e=this.urlFn(t);this.log_("Connecting via long-poll to "+e),this.scriptTagHolder.addTag(e,()=>{})}})}start(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)}static forceAllow(){Ve.forceAllow_=!0}static forceDisallow(){Ve.forceDisallow_=!0}static isAvailable(){return!!Ve.forceAllow_||!(Ve.forceDisallow_||"undefined"==typeof document||null==document.createElement||"object"==typeof window&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href)||"object"==typeof Windows&&"object"==typeof Windows.UI)}markConnectionHealthy(){}shutdown_(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)}onClosed_(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))}close(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())}send(e){var t=v(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);var t=o(t),n=de(t,1840);for(let r=0;r<n.length;r++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,n.length,n[r]),this.curSegmentNum++}addDisconnectPingFrame(e,t){this.myDisconnFrame=document.createElement("iframe");const n={dframe:"t"};n.id=e,n.pw=t,this.myDisconnFrame.src=this.urlFn(n),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}incrementIncomingBytes_(e){var t=v(e).length;this.bytesReceived+=t,this.stats_.incrementCounter("bytes_received",t)}}class ze{constructor(t,n,e,r){this.onDisconnect=e,this.urlFn=r,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(1e8*Math.random()),this.sendNewPolls=!0;{this.uniqueCallbackIdentifier=re(),window["pLPCommand"+this.uniqueCallbackIdentifier]=t,window["pRTLPCB"+this.uniqueCallbackIdentifier]=n,this.myIFrame=ze.createIFrame_();let e="";this.myIFrame.src&&"javascript:"===this.myIFrame.src.substr(0,"javascript:".length)&&(i=document.domain,e='<script>document.domain="'+i+'";<\/script>');var i="<html><body>"+e+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(i),this.myIFrame.doc.close()}catch(e){pe("frame writing exception"),e.stack&&pe(e.stack),pe(e)}}}static createIFrame_(){const t=document.createElement("iframe");if(t.style.display="none",!document.body)throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";document.body.appendChild(t);try{t.contentWindow.document||pe("No IE domain setting required")}catch(e){var n=document.domain;t.src="javascript:void((function(){document.open();document.domain='"+n+"';document.close();})())"}return t.contentDocument?t.doc=t.contentDocument:t.contentWindow?t.doc=t.contentWindow.document:t.document&&(t.doc=t.document),t}close(){this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.textContent="",setTimeout(()=>{null!==this.myIFrame&&(document.body.removeChild(this.myIFrame),this.myIFrame=null)},Math.floor(0)));const e=this.onDisconnect;e&&(this.onDisconnect=null,e())}startLongPoll(e,t){for(this.myID=e,this.myPW=t,this.alive=!0;this.newRequest_(););}newRequest_(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.size<(0<this.pendingSegs.length?2:1)){this.currentSerial++;const i={};i.id=this.myID,i.pw=this.myPW,i.ser=this.currentSerial;var n=this.urlFn(i);let e="",t=0;for(;0<this.pendingSegs.length;){if(!(this.pendingSegs[0].d.length+30+e.length<=1870))break;var r=this.pendingSegs.shift();e=e+"&seg"+t+"="+r.seg+"&ts"+t+"="+r.ts+"&d"+t+"="+r.d,t++}return n+=e,this.addLongPollTag_(n,this.currentSerial),!0}return!1}enqueueSegment(e,t,n){this.pendingSegs.push({seg:e,ts:t,d:n}),this.alive&&this.newRequest_()}addLongPollTag_(e,t){this.outstandingRequests.add(t);const n=()=>{this.outstandingRequests.delete(t),this.newRequest_()},r=setTimeout(n,Math.floor(25e3));this.addTag(e,()=>{clearTimeout(r),n()})}addTag(e,n){setTimeout(()=>{try{if(!this.sendNewPolls)return;const t=this.myIFrame.doc.createElement("script");t.type="text/javascript",t.async=!0,t.src=e,t.onload=t.onreadystatechange=function(){var e=t.readyState;e&&"loaded"!==e&&"complete"!==e||(t.onload=t.onreadystatechange=null,t.parentNode&&t.parentNode.removeChild(t),n())},t.onerror=()=>{pe("Long-poll script failed to load: "+e),this.sendNewPolls=!1,this.close()},this.myIFrame.doc.body.appendChild(t)}catch(e){}},Math.floor(1))}}let He=null;"undefined"!=typeof MozWebSocket?He=MozWebSocket:"undefined"!=typeof WebSocket&&(He=WebSocket);class Qe{constructor(e,t,n,r,i,s,o){this.connId=e,this.applicationId=n,this.appCheckToken=r,this.authToken=i,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=ae(this.connId),this.stats_=Be(t),this.connURL=Qe.connectionURL_(t,s,o,r,n),this.nodeAdmin=t.nodeAdmin}static connectionURL_(e,t,n,r,i){const s={v:"5"};return"undefined"!=typeof location&&location.hostname&&Ae.test(location.hostname)&&(s.r="f"),t&&(s.s=t),n&&(s.ls=n),r&&(s.ac=r),i&&(s.p=i),Fe(e,Oe,s)}open(e,t){this.onDisconnect=t,this.onMessage=e,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,ee.set("previous_websocket_failure",!0);try{g(),this.mySock=new He(this.connURL,[],void 0)}catch(e){this.log_("Error instantiating WebSocket.");var n=e.message||e.data;return n&&this.log_(n),void this.onClosed_()}this.mySock.onopen=()=>{this.log_("Websocket connected."),this.everConnected_=!0},this.mySock.onclose=()=>{this.log_("Websocket connection was disconnected."),this.mySock=null,this.onClosed_()},this.mySock.onmessage=e=>{this.handleIncomingFrame(e)},this.mySock.onerror=e=>{this.log_("WebSocket error.  Closing connection.");var t=e.message||e.data;t&&this.log_(t),this.onClosed_()}}start(){}static forceDisallow(){Qe.forceDisallow_=!0}static isAvailable(){let e=!1;var t;return"undefined"==typeof navigator||!navigator.userAgent||(t=navigator.userAgent.match(/Android ([0-9]{0,}\.[0-9]{0,})/))&&1<t.length&&parseFloat(t[1])<4.4&&(e=!0),!e&&null!==He&&!Qe.forceDisallow_}static previouslyFailed(){return ee.isInMemoryStorage||!0===ee.get("previous_websocket_failure")}markConnectionHealthy(){ee.remove("previous_websocket_failure")}appendFrame_(e){var t;this.frames.push(e),this.frames.length===this.totalFrames&&(t=this.frames.join(""),this.frames=null,t=m(t),this.onMessage(t))}handleNewFrameCount_(e){this.totalFrames=e,this.frames=[]}extractFrameCount_(e){if(p(null===this.frames,"We already have a frame buffer"),e.length<=6){var t=Number(e);if(!isNaN(t))return this.handleNewFrameCount_(t),null}return this.handleNewFrameCount_(1),e}handleIncomingFrame(e){var t;null!==this.mySock&&(t=e.data,this.bytesReceived+=t.length,this.stats_.incrementCounter("bytes_received",t.length),this.resetKeepAlive(),null!==this.frames?this.appendFrame_(t):null!==(t=this.extractFrameCount_(t))&&this.appendFrame_(t))}send(e){this.resetKeepAlive();var t=v(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);var n=de(t,16384);1<n.length&&this.sendString_(String(n.length));for(let r=0;r<n.length;r++)this.sendString_(n[r])}shutdown_(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)}onClosed_(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))}close(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())}resetKeepAlive(){clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval(()=>{this.mySock&&this.sendString_("0"),this.resetKeepAlive()},Math.floor(45e3))}sendString_(e){try{this.mySock.send(e)}catch(e){this.log_("Exception thrown from WebSocket.send():",e.message||e.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}}}Qe.responsesRequiredToBeHealthy=2,Qe.healthyTimeout=3e4;class Ye{constructor(e){this.initTransports_(e)}static get ALL_TRANSPORTS(){return[Ve,Qe]}static get IS_TRANSPORT_INITIALIZED(){return this.globalTransportInitialized_}initTransports_(e){var t=Qe&&Qe.isAvailable();let n=t&&!Qe.previouslyFailed();if(e.webSocketOnly&&(t||ge("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),n=!0),n)this.transports_=[Qe];else{const r=this.transports_=[];for(const i of Ye.ALL_TRANSPORTS)i&&i.isAvailable()&&r.push(i);Ye.globalTransportInitialized_=!0}}initialTransport(){if(0<this.transports_.length)return this.transports_[0];throw new Error("No transports available")}upgradeTransport(){return 1<this.transports_.length?this.transports_[1]:null}}Ye.globalTransportInitialized_=!1;class Ke{constructor(e,t,n,r,i,s,o,a,l,h){this.id=e,this.repoInfo_=t,this.applicationId_=n,this.appCheckToken_=r,this.authToken_=i,this.onMessage_=s,this.onReady_=o,this.onDisconnect_=a,this.onKill_=l,this.lastSessionId=h,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=ae("c:"+this.id+":"),this.transportManager_=new Ye(t),this.log_("Connection created"),this.start_()}start_(){const e=this.transportManager_.initialTransport();this.conn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,null,this.lastSessionId),this.primaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const t=this.connReceiver_(this.conn_),n=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout(()=>{this.conn_&&this.conn_.open(t,n)},Math.floor(0));var r=e.healthyTimeout||0;0<r&&(this.healthyTimeout_=Ee(()=>{this.healthyTimeout_=null,this.isHealthy_||(this.conn_&&102400<this.conn_.bytesReceived?(this.log_("Connection exceeded healthy timeout but has received "+this.conn_.bytesReceived+" bytes.  Marking connection healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()):this.conn_&&10240<this.conn_.bytesSent?this.log_("Connection exceeded healthy timeout but has sent "+this.conn_.bytesSent+" bytes.  Leaving connection alive."):(this.log_("Closing unhealthy connection after timeout."),this.close()))},Math.floor(r)))}nextTransportId_(){return"c:"+this.id+":"+this.connectionCount++}disconnReceiver_(t){return e=>{t===this.conn_?this.onConnectionLost_(e):t===this.secondaryConn_?(this.log_("Secondary connection lost."),this.onSecondaryConnectionLost_()):this.log_("closing an old connection")}}connReceiver_(t){return e=>{2!==this.state_&&(t===this.rx_?this.onPrimaryMessageReceived_(e):t===this.secondaryConn_?this.onSecondaryMessageReceived_(e):this.log_("message on old connection"))}}sendRequest(e){this.sendData_({t:"d",d:e})}tryCleanupConnection(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)}onSecondaryControl_(e){var t;"t"in e&&("a"===(t=e.t)?this.upgradeIfSecondaryHealthy_():"r"===t?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),this.tx_!==this.secondaryConn_&&this.rx_!==this.secondaryConn_||this.close()):"o"===t&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_()))}onSecondaryMessageReceived_(e){var t=ce("t",e),n=ce("d",e);if("c"===t)this.onSecondaryControl_(n);else{if("d"!==t)throw new Error("Unknown protocol layer: "+t);this.pendingDataMessages.push(n)}}upgradeIfSecondaryHealthy_(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:"p",d:{}}}))}proceedWithUpgrade_(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:"a",d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:"n",d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()}onPrimaryMessageReceived_(e){var t=ce("t",e),n=ce("d",e);"c"===t?this.onControl_(n):"d"===t&&this.onDataMessage_(n)}onDataMessage_(e){this.onPrimaryResponse_(),this.onMessage_(e)}onPrimaryResponse_(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))}onControl_(e){var t=ce("t",e);if("d"in e){var n=e.d;if("h"===t){const r=Object.assign({},n);this.repoInfo_.isUsingEmulator&&(r.h=this.repoInfo_.host),this.onHandshake_(r)}else if("n"===t){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(let e=0;e<this.pendingDataMessages.length;++e)this.onDataMessage_(this.pendingDataMessages[e]);this.pendingDataMessages=[],this.tryCleanupConnection()}else"s"===t?this.onConnectionShutdown_(n):"r"===t?this.onReset_(n):"e"===t?le("Server Error: "+n):"o"===t?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):le("Unknown control packet command: "+t)}}onHandshake_(e){var t=e.ts,n=e.v,r=e.h;this.sessionId=e.s,this.repoInfo_.host=r,0===this.state_&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,t),"5"!==n&&ge("Protocol version mismatch detected"),this.tryStartUpgrade_())}tryStartUpgrade_(){var e=this.transportManager_.upgradeTransport();e&&this.startUpgrade_(e)}startUpgrade_(e){this.secondaryConn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,this.sessionId),this.secondaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;var t=this.connReceiver_(this.secondaryConn_),n=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(t,n),Ee(()=>{this.secondaryConn_&&(this.log_("Timed out trying to upgrade."),this.secondaryConn_.close())},Math.floor(6e4))}onReset_(e){this.log_("Reset packet received.  New host: "+e),this.repoInfo_.host=e,1===this.state_?this.close():(this.closeConnections_(),this.start_())}onConnectionEstablished_(e,t){this.log_("Realtime connection established."),this.conn_=e,this.state_=1,this.onReady_&&(this.onReady_(t,this.sessionId),this.onReady_=null),0===this.primaryResponsesRequired_?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):Ee(()=>{this.sendPingOnPrimaryIfNecessary_()},Math.floor(5e3))}sendPingOnPrimaryIfNecessary_(){this.isHealthy_||1!==this.state_||(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:"p",d:{}}}))}onSecondaryConnectionLost_(){var e=this.secondaryConn_;this.secondaryConn_=null,this.tx_!==e&&this.rx_!==e||this.close()}onConnectionLost_(e){this.conn_=null,e||0!==this.state_?1===this.state_&&this.log_("Realtime connection lost."):(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(ee.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)),this.close()}onConnectionShutdown_(e){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(e),this.onKill_=null),this.onDisconnect_=null,this.close()}sendData_(e){if(1!==this.state_)throw"Connection is not connected";this.tx_.send(e)}close(){2!==this.state_&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))}closeConnections_(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)}}class $e{put(e,t,n,r){}merge(e,t,n,r){}refreshAuthToken(e){}refreshAppCheckToken(e){}onDisconnectPut(e,t,n){}onDisconnectMerge(e,t,n){}onDisconnectCancel(e,t){}reportStats(e){}}class Ge{constructor(e){this.allowedEvents_=e,this.listeners_={},p(Array.isArray(e)&&0<e.length,"Requires a non-empty array")}trigger(t,...n){if(Array.isArray(this.listeners_[t])){const r=[...this.listeners_[t]];for(let e=0;e<r.length;e++)r[e].callback.apply(r[e].context,n)}}on(e,t,n){this.validateEventType_(e),this.listeners_[e]=this.listeners_[e]||[],this.listeners_[e].push({callback:t,context:n});var r=this.getInitialEvent(e);r&&t.apply(n,r)}off(e,t,n){this.validateEventType_(e);const r=this.listeners_[e]||[];for(let i=0;i<r.length;i++)if(r[i].callback===t&&(!n||n===r[i].context))return void r.splice(i,1)}validateEventType_(t){p(this.allowedEvents_.find(e=>e===t),"Unknown event: "+t)}}class Je extends Ge{constructor(){super(["online"]),this.online_=!0,"undefined"==typeof window||void 0===window.addEventListener||f()||(window.addEventListener("online",()=>{this.online_||(this.online_=!0,this.trigger("online",!0))},!1),window.addEventListener("offline",()=>{this.online_&&(this.online_=!1,this.trigger("online",!1))},!1))}static getInstance(){return new Je}getInitialEvent(e){return p("online"===e,"Unknown event type: "+e),[this.online_]}currentlyOnline(){return this.online_}}class Xe{constructor(n,e){if(void 0===e){this.pieces_=n.split("/");let e=0;for(let t=0;t<this.pieces_.length;t++)0<this.pieces_[t].length&&(this.pieces_[e]=this.pieces_[t],e++);this.pieces_.length=e,this.pieceNum_=0}else this.pieces_=n,this.pieceNum_=e}toString(){let e="";for(let t=this.pieceNum_;t<this.pieces_.length;t++)""!==this.pieces_[t]&&(e+="/"+this.pieces_[t]);return e||"/"}}function Ze(){return new Xe("")}function et(e){return e.pieceNum_>=e.pieces_.length?null:e.pieces_[e.pieceNum_]}function tt(e){return e.pieces_.length-e.pieceNum_}function nt(e){let t=e.pieceNum_;return t<e.pieces_.length&&t++,new Xe(e.pieces_,t)}function rt(e){return e.pieceNum_<e.pieces_.length?e.pieces_[e.pieces_.length-1]:null}function it(e,t=0){return e.pieces_.slice(e.pieceNum_+t)}function st(e){if(e.pieceNum_>=e.pieces_.length)return null;const t=[];for(let n=e.pieceNum_;n<e.pieces_.length-1;n++)t.push(e.pieces_[n]);return new Xe(t,0)}function ot(e,t){const n=[];for(let i=e.pieceNum_;i<e.pieces_.length;i++)n.push(e.pieces_[i]);if(t instanceof Xe)for(let e=t.pieceNum_;e<t.pieces_.length;e++)n.push(t.pieces_[e]);else{var r=t.split("/");for(let e=0;e<r.length;e++)0<r[e].length&&n.push(r[e])}return new Xe(n,0)}function at(e){return e.pieceNum_>=e.pieces_.length}function lt(e,t){var n=et(e),r=et(t);if(null===n)return t;if(n===r)return lt(nt(e),nt(t));throw new Error("INTERNAL ERROR: innerPath ("+t+") is not within outerPath ("+e+")")}function ht(e,t){var n=it(e,0),r=it(t,0);for(let s=0;s<n.length&&s<r.length;s++){var i=Ce(n[s],r[s]);if(0!==i)return i}return n.length===r.length?0:n.length<r.length?-1:1}function ct(e,t){if(tt(e)!==tt(t))return!1;for(let n=e.pieceNum_,r=t.pieceNum_;n<=e.pieces_.length;n++,r++)if(e.pieces_[n]!==t.pieces_[r])return!1;return!0}function ut(e,t){let n=e.pieceNum_,r=t.pieceNum_;if(tt(e)>tt(t))return!1;for(;n<e.pieces_.length;){if(e.pieces_[n]!==t.pieces_[r])return!1;++n,++r}return!0}class dt{constructor(e,t){this.errorPrefix_=t,this.parts_=it(e,0),this.byteLength_=Math.max(1,this.parts_.length);for(let n=0;n<this.parts_.length;n++)this.byteLength_+=P(this.parts_[n]);_t(this)}}function _t(e){if(768<e.byteLength_)throw new Error(e.errorPrefix_+"has a key path longer than 768 bytes ("+e.byteLength_+").");if(32<e.parts_.length)throw new Error(e.errorPrefix_+"path specified exceeds the maximum depth that can be written (32) or object contains a cycle "+pt(e))}function pt(e){return 0===e.parts_.length?"":"in property '"+e.parts_.join(".")+"'"}class ft extends Ge{constructor(){super(["visible"]);let t,e;"undefined"!=typeof document&&void 0!==document.addEventListener&&(void 0!==document.hidden?(e="visibilitychange",t="hidden"):void 0!==document.mozHidden?(e="mozvisibilitychange",t="mozHidden"):void 0!==document.msHidden?(e="msvisibilitychange",t="msHidden"):void 0!==document.webkitHidden&&(e="webkitvisibilitychange",t="webkitHidden")),this.visible_=!0,e&&document.addEventListener(e,()=>{var e=!document[t];e!==this.visible_&&(this.visible_=e,this.trigger("visible",e))},!1)}static getInstance(){return new ft}getInitialEvent(e){return p("visible"===e,"Unknown event type: "+e),[this.visible_]}}class gt extends $e{constructor(e,t,n,r,i,s,o,a){if(super(),this.repoInfo_=e,this.applicationId_=t,this.onDataUpdate_=n,this.onConnectStatus_=r,this.onServerInfoUpdate_=i,this.authTokenProvider_=s,this.appCheckTokenProvider_=o,this.authOverride_=a,this.id=gt.nextPersistentConnectionId_++,this.log_=ae("p:"+this.id+":"),this.interruptReasons_={},this.listens=new Map,this.outstandingPuts_=[],this.outstandingGets_=[],this.outstandingPutCount_=0,this.outstandingGetCount_=0,this.onDisconnectRequestQueue_=[],this.connected_=!1,this.reconnectDelay_=1e3,this.maxReconnectDelay_=3e5,this.securityDebugCallback_=null,this.lastSessionId=null,this.establishConnectionTimer_=null,this.visible_=!1,this.requestCBHash_={},this.requestNumber_=0,this.realtime_=null,this.authToken_=null,this.appCheckToken_=null,this.forceTokenRefresh_=!1,this.invalidAuthTokenCount_=0,this.invalidAppCheckTokenCount_=0,this.firstConnection_=!0,this.lastConnectionAttemptTime_=null,this.lastConnectionEstablishedTime_=null,a&&!g())throw new Error("Auth override specified in options, but not supported on non Node.js platforms");ft.getInstance().on("visible",this.onVisible_,this),-1===e.host.indexOf("fblocal")&&Je.getInstance().on("online",this.onOnline_,this)}sendRequest(e,t,n){var r=++this.requestNumber_,i={r:r,a:e,b:t};this.log_(v(i)),p(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(i),n&&(this.requestCBHash_[r]=n)}get(e){this.initConnection_();const n=new _;var t={p:e._path.toString(),q:e._queryObject};this.outstandingGets_.push({action:"g",request:t,onComplete:e=>{var t=e.d;"ok"===e.s?n.resolve(t):n.reject(t)}}),this.outstandingGetCount_++;t=this.outstandingGets_.length-1;return this.connected_&&this.sendGet_(t),n.promise}listen(e,t,n,r){this.initConnection_();var i=e._queryIdentifier,s=e._path.toString();this.log_("Listen called for "+s+" "+i),this.listens.has(s)||this.listens.set(s,new Map),p(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"listen() called for non-default but complete query"),p(!this.listens.get(s).has(i),"listen() called twice for same path/queryId.");var o={onComplete:r,hashFn:t,query:e,tag:n};this.listens.get(s).set(i,o),this.connected_&&this.sendListen_(o)}sendGet_(t){const n=this.outstandingGets_[t];this.sendRequest("g",n.request,e=>{delete this.outstandingGets_[t],this.outstandingGetCount_--,0===this.outstandingGetCount_&&(this.outstandingGets_=[]),n.onComplete&&n.onComplete(e)})}sendListen_(r){const i=r.query,s=i._path.toString(),o=i._queryIdentifier;this.log_("Listen on "+s+" for "+o);const e={p:s};r.tag&&(e.q=i._queryObject,e.t=r.tag),e.h=r.hashFn(),this.sendRequest("q",e,e=>{var t=e.d,n=e.s;gt.warnOnListenWarnings_(t,i),(this.listens.get(s)&&this.listens.get(s).get(o))===r&&(this.log_("listen response",e),"ok"!==n&&this.removeListen_(s,o),r.onComplete&&r.onComplete(n,t))})}static warnOnListenWarnings_(e,t){if(e&&"object"==typeof e&&w(e,"w")){const i=C(e,"w");var n,r;Array.isArray(i)&&~i.indexOf("no_index")&&(n='".indexOn": "'+t._queryParams.getIndex().toString()+'"',r=t._path.toString(),ge("Using an unspecified index. Your data will be downloaded and "+`filtered on the client. Consider adding ${n} at `+`${r} to your security rules for better performance.`))}}refreshAuthToken(e){this.authToken_=e,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},()=>{}),this.reduceReconnectDelayIfAdminCredential_(e)}reduceReconnectDelayIfAdminCredential_(e){var t;(e&&40===e.length||(e=e,"object"==typeof(t=y(e).claims)&&!0===t.admin))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=3e4)}refreshAppCheckToken(e){this.appCheckToken_=e,this.log_("App check token refreshed"),this.appCheckToken_?this.tryAppCheck():this.connected_&&this.sendRequest("unappeck",{},()=>{})}tryAuth(){if(this.connected_&&this.authToken_){const r=this.authToken_;var e=function(e){const t=y(e),n=t.claims;return!!n&&"object"==typeof n&&n.hasOwnProperty("iat")}(r)?"auth":"gauth";const t={cred:r};null===this.authOverride_?t.noauth=!0:"object"==typeof this.authOverride_&&(t.authvar=this.authOverride_),this.sendRequest(e,t,e=>{var t=e.s,n=e.d||"error";this.authToken_===r&&("ok"===t?this.invalidAuthTokenCount_=0:this.onAuthRevoked_(t,n))})}}tryAppCheck(){this.connected_&&this.appCheckToken_&&this.sendRequest("appcheck",{token:this.appCheckToken_},e=>{var t=e.s,n=e.d||"error";"ok"===t?this.invalidAppCheckTokenCount_=0:this.onAppCheckRevoked_(t,n)})}unlisten(e,t){var n=e._path.toString(),r=e._queryIdentifier;this.log_("Unlisten called for "+n+" "+r),p(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"unlisten() called for non-default but complete query"),this.removeListen_(n,r)&&this.connected_&&this.sendUnlisten_(n,r,e._queryObject,t)}sendUnlisten_(e,t,n,r){this.log_("Unlisten on "+e+" for "+t);const i={p:e};r&&(i.q=n,i.t=r),this.sendRequest("n",i)}onDisconnectPut(e,t,n){this.initConnection_(),this.connected_?this.sendOnDisconnect_("o",e,t,n):this.onDisconnectRequestQueue_.push({pathString:e,action:"o",data:t,onComplete:n})}onDisconnectMerge(e,t,n){this.initConnection_(),this.connected_?this.sendOnDisconnect_("om",e,t,n):this.onDisconnectRequestQueue_.push({pathString:e,action:"om",data:t,onComplete:n})}onDisconnectCancel(e,t){this.initConnection_(),this.connected_?this.sendOnDisconnect_("oc",e,null,t):this.onDisconnectRequestQueue_.push({pathString:e,action:"oc",data:null,onComplete:t})}sendOnDisconnect_(e,t,n,r){var i={p:t,d:n};this.log_("onDisconnect "+e,i),this.sendRequest(e,i,e=>{r&&setTimeout(()=>{r(e.s,e.d)},Math.floor(0))})}put(e,t,n,r){this.putInternal("p",e,t,n,r)}merge(e,t,n,r){this.putInternal("m",e,t,n,r)}putInternal(e,t,n,r,i){this.initConnection_();const s={p:t,d:n};void 0!==i&&(s.h=i),this.outstandingPuts_.push({action:e,request:s,onComplete:r}),this.outstandingPutCount_++;var o=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(o):this.log_("Buffering put: "+t)}sendPut_(t){const n=this.outstandingPuts_[t].action;var e=this.outstandingPuts_[t].request;const r=this.outstandingPuts_[t].onComplete;this.outstandingPuts_[t].queued=this.connected_,this.sendRequest(n,e,e=>{this.log_(n+" response",e),delete this.outstandingPuts_[t],this.outstandingPutCount_--,0===this.outstandingPutCount_&&(this.outstandingPuts_=[]),r&&r(e.s,e.d)})}reportStats(e){var t;this.connected_&&(this.log_("reportStats",t={c:e}),this.sendRequest("s",t,e=>{var t;"ok"!==e.s&&(t=e.d,this.log_("reportStats","Error sending stats: "+t))}))}onDataMessage_(e){if("r"in e){this.log_("from server: "+v(e));var t=e.r;const n=this.requestCBHash_[t];n&&(delete this.requestCBHash_[t],n(e.b))}else{if("error"in e)throw"A server-side error has occurred: "+e.error;"a"in e&&this.onDataPush_(e.a,e.b)}}onDataPush_(e,t){this.log_("handleServerMessage",e,t),"d"===e?this.onDataUpdate_(t.p,t.d,!1,t.t):"m"===e?this.onDataUpdate_(t.p,t.d,!0,t.t):"c"===e?this.onListenRevoked_(t.p,t.q):"ac"===e?this.onAuthRevoked_(t.s,t.d):"apc"===e?this.onAppCheckRevoked_(t.s,t.d):"sd"===e?this.onSecurityDebugPacket_(t):le("Unrecognized action received from server: "+v(e)+"\nAre you using the latest client?")}onReady_(e,t){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=(new Date).getTime(),this.handleTimestamp_(e),this.lastSessionId=t,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)}scheduleConnect_(e){p(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout(()=>{this.establishConnectionTimer_=null,this.establishConnection_()},Math.floor(e))}initConnection_(){!this.realtime_&&this.firstConnection_&&this.scheduleConnect_(0)}onVisible_(e){e&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=1e3,this.realtime_||this.scheduleConnect_(0)),this.visible_=e}onOnline_(e){e?(this.log_("Browser went online."),this.reconnectDelay_=1e3,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())}onRealtimeDisconnect_(){var e;this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()&&(this.visible_?this.lastConnectionEstablishedTime_&&(3e4<(new Date).getTime()-this.lastConnectionEstablishedTime_&&(this.reconnectDelay_=1e3),this.lastConnectionEstablishedTime_=null):(this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=(new Date).getTime()),e=(new Date).getTime()-this.lastConnectionAttemptTime_,e=Math.max(0,this.reconnectDelay_-e),e=Math.random()*e,this.log_("Trying to reconnect in "+e+"ms"),this.scheduleConnect_(e),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,1.3*this.reconnectDelay_)),this.onConnectStatus_(!1)}async establishConnection_(){if(this.shouldReconnect_()){this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=(new Date).getTime(),this.lastConnectionEstablishedTime_=null;var e=this.onDataMessage_.bind(this),r=this.onReady_.bind(this);const c=this.onRealtimeDisconnect_.bind(this);var i=this.id+":"+gt.nextConnectionId_++,s=this.lastSessionId;let t=!1,n=null;var o=function(){n?n.close():(t=!0,c())};this.realtime_={close:o,sendRequest:function(e){p(n,"sendRequest call when we're not connected not allowed."),n.sendRequest(e)}};var a=this.forceTokenRefresh_;this.forceTokenRefresh_=!1;try{var[l,h]=await Promise.all([this.authTokenProvider_.getToken(a),this.appCheckTokenProvider_.getToken(a)]);t?pe("getToken() completed but was canceled"):(pe("getToken() completed. Creating connection."),this.authToken_=l&&l.accessToken,this.appCheckToken_=h&&h.token,n=new Ke(i,this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,e,r,c,e=>{ge(e+" ("+this.repoInfo_.toString()+")"),this.interrupt("server_kill")},s))}catch(e){this.log_("Failed to get token: "+e),t||(this.repoInfo_.nodeAdmin&&ge(e),o())}}}interrupt(e){pe("Interrupting connection for reason: "+e),this.interruptReasons_[e]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())}resume(e){pe("Resuming connection for reason: "+e),delete this.interruptReasons_[e],b(this.interruptReasons_)&&(this.reconnectDelay_=1e3,this.realtime_||this.scheduleConnect_(0))}handleTimestamp_(e){var t=e-(new Date).getTime();this.onServerInfoUpdate_({serverTimeOffset:t})}cancelSentTransactions_(){for(let e=0;e<this.outstandingPuts_.length;e++){const t=this.outstandingPuts_[e];t&&"h"in t.request&&t.queued&&(t.onComplete&&t.onComplete("disconnect"),delete this.outstandingPuts_[e],this.outstandingPutCount_--)}0===this.outstandingPutCount_&&(this.outstandingPuts_=[])}onListenRevoked_(e,t){let n;n=t?t.map(e=>ue(e)).join("$"):"default";const r=this.removeListen_(e,n);r&&r.onComplete&&r.onComplete("permission_denied")}removeListen_(e,t){var n=new Xe(e).toString();let r;if(this.listens.has(n)){const i=this.listens.get(n);r=i.get(t),i.delete(t),0===i.size&&this.listens.delete(n)}else r=void 0;return r}onAuthRevoked_(e,t){pe("Auth token revoked: "+e+"/"+t),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),"invalid_token"!==e&&"permission_denied"!==e||(this.invalidAuthTokenCount_++,3<=this.invalidAuthTokenCount_&&(this.reconnectDelay_=3e4,this.authTokenProvider_.notifyForInvalidToken()))}onAppCheckRevoked_(e,t){pe("App check token revoked: "+e+"/"+t),this.appCheckToken_=null,this.forceTokenRefresh_=!0,"invalid_token"!==e&&"permission_denied"!==e||(this.invalidAppCheckTokenCount_++,3<=this.invalidAppCheckTokenCount_&&this.appCheckTokenProvider_.notifyForInvalidToken())}onSecurityDebugPacket_(e){this.securityDebugCallback_?this.securityDebugCallback_(e):"msg"in e&&console.log("FIREBASE: "+e.msg.replace("\n","\nFIREBASE: "))}restoreState_(){this.tryAuth(),this.tryAppCheck();for(const t of this.listens.values())for(const n of t.values())this.sendListen_(n);for(let r=0;r<this.outstandingPuts_.length;r++)this.outstandingPuts_[r]&&this.sendPut_(r);for(;this.onDisconnectRequestQueue_.length;){var e=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(e.action,e.pathString,e.data,e.onComplete)}for(let i=0;i<this.outstandingGets_.length;i++)this.outstandingGets_[i]&&this.sendGet_(i)}sendConnectStats_(){const e={};e["sdk.js."+B.replace(/\./g,"-")]=1,f()?e["framework.cordova"]=1:"object"==typeof navigator&&"ReactNative"===navigator.product&&(e["framework.reactnative"]=1),this.reportStats(e)}shouldReconnect_(){var e=Je.getInstance().currentlyOnline();return b(this.interruptReasons_)&&e}}gt.nextPersistentConnectionId_=0,gt.nextConnectionId_=0;class mt{constructor(e,t){this.name=e,this.node=t}static Wrap(e,t){return new mt(e,t)}}class vt{getCompare(){return this.compare.bind(this)}indexedValueChanged(e,t){var n=new mt(ye,e),r=new mt(ye,t);return 0!==this.compare(n,r)}minPost(){return mt.MIN}}let yt;class wt extends vt{static get __EMPTY_NODE(){return yt}static set __EMPTY_NODE(e){yt=e}compare(e,t){return Ce(e.name,t.name)}isDefinedOn(e){throw c("KeyIndex.isDefinedOn not expected to be called.")}indexedValueChanged(e,t){return!1}minPost(){return mt.MIN}maxPost(){return new mt(we,yt)}makePost(e,t){return p("string"==typeof e,"KeyIndex indexValue must always be a string."),new mt(e,yt)}toString(){return".key"}}const Ct=new wt;class bt{constructor(e,t,n,r,i=null){this.isReverse_=r,this.resultGenerator_=i,this.nodeStack_=[];let s=1;for(;!e.isEmpty();)if(s=t?n(e.key,t):1,r&&(s*=-1),s<0)e=this.isReverse_?e.left:e.right;else{if(0===s){this.nodeStack_.push(e);break}this.nodeStack_.push(e),e=this.isReverse_?e.right:e.left}}getNext(){if(0===this.nodeStack_.length)return null;let e=this.nodeStack_.pop(),t;if(t=this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value},this.isReverse_)for(e=e.left;!e.isEmpty();)this.nodeStack_.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack_.push(e),e=e.left;return t}hasNext(){return 0<this.nodeStack_.length}peek(){if(0===this.nodeStack_.length)return null;var e=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value}}}class It{constructor(e,t,n,r,i){this.key=e,this.value=t,this.color=null!=n?n:It.RED,this.left=null!=r?r:Tt.EMPTY_NODE,this.right=null!=i?i:Tt.EMPTY_NODE}copy(e,t,n,r,i){return new It(null!=e?e:this.key,null!=t?t:this.value,null!=n?n:this.color,null!=r?r:this.left,null!=i?i:this.right)}count(){return this.left.count()+1+this.right.count()}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||!!e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min_(){return this.left.isEmpty()?this:this.left.min_()}minKey(){return this.min_().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,n){let r=this;var i=n(e,r.key);return r=i<0?r.copy(null,null,null,r.left.insert(e,t,n),null):0===i?r.copy(null,t,null,null,null):r.copy(null,null,null,null,r.right.insert(e,t,n)),r.fixUp_()}removeMin_(){if(this.left.isEmpty())return Tt.EMPTY_NODE;let e=this;return e.left.isRed_()||e.left.left.isRed_()||(e=e.moveRedLeft_()),e=e.copy(null,null,null,e.left.removeMin_(),null),e.fixUp_()}remove(e,t){let n,r;if(n=this,t(e,n.key)<0)n.left.isEmpty()||n.left.isRed_()||n.left.left.isRed_()||(n=n.moveRedLeft_()),n=n.copy(null,null,null,n.left.remove(e,t),null);else{if(n.left.isRed_()&&(n=n.rotateRight_()),n.right.isEmpty()||n.right.isRed_()||n.right.left.isRed_()||(n=n.moveRedRight_()),0===t(e,n.key)){if(n.right.isEmpty())return Tt.EMPTY_NODE;r=n.right.min_(),n=n.copy(r.key,r.value,null,null,n.right.removeMin_())}n=n.copy(null,null,null,null,n.right.remove(e,t))}return n.fixUp_()}isRed_(){return this.color}fixUp_(){let e=this;return e.right.isRed_()&&!e.left.isRed_()&&(e=e.rotateLeft_()),e.left.isRed_()&&e.left.left.isRed_()&&(e=e.rotateRight_()),e.left.isRed_()&&e.right.isRed_()&&(e=e.colorFlip_()),e}moveRedLeft_(){let e=this.colorFlip_();return e.right.left.isRed_()&&(e=e.copy(null,null,null,null,e.right.rotateRight_()),e=e.rotateLeft_(),e=e.colorFlip_()),e}moveRedRight_(){let e=this.colorFlip_();return e.left.left.isRed_()&&(e=e.rotateRight_(),e=e.colorFlip_()),e}rotateLeft_(){var e=this.copy(null,null,It.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight_(){var e=this.copy(null,null,It.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip_(){var e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth_(){var e=this.check_();return Math.pow(2,e)<=this.count()+1}check_(){if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");var e=this.left.check_();if(e!==this.right.check_())throw new Error("Black depths differ");return e+(this.isRed_()?0:1)}}It.RED=!0,It.BLACK=!1;class Tt{constructor(e,t=Tt.EMPTY_NODE){this.comparator_=e,this.root_=t}insert(e,t){return new Tt(this.comparator_,this.root_.insert(e,t,this.comparator_).copy(null,null,It.BLACK,null,null))}remove(e){return new Tt(this.comparator_,this.root_.remove(e,this.comparator_).copy(null,null,It.BLACK,null,null))}get(e){var t;let n=this.root_;for(;!n.isEmpty();){if(0===(t=this.comparator_(e,n.key)))return n.value;t<0?n=n.left:0<t&&(n=n.right)}return null}getPredecessorKey(e){let t,n=this.root_,r=null;for(;!n.isEmpty();){if(0===(t=this.comparator_(e,n.key))){if(n.left.isEmpty())return r?r.key:null;for(n=n.left;!n.right.isEmpty();)n=n.right;return n.key}t<0?n=n.left:0<t&&(r=n,n=n.right)}throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")}isEmpty(){return this.root_.isEmpty()}count(){return this.root_.count()}minKey(){return this.root_.minKey()}maxKey(){return this.root_.maxKey()}inorderTraversal(e){return this.root_.inorderTraversal(e)}reverseTraversal(e){return this.root_.reverseTraversal(e)}getIterator(e){return new bt(this.root_,null,this.comparator_,!1,e)}getIteratorFrom(e,t){return new bt(this.root_,e,this.comparator_,!1,t)}getReverseIteratorFrom(e,t){return new bt(this.root_,e,this.comparator_,!0,t)}getReverseIterator(e){return new bt(this.root_,null,this.comparator_,!0,e)}}function Et(e,t){return Ce(e.name,t.name)}function St(e,t){return Ce(e,t)}Tt.EMPTY_NODE=new class{copy(e,t,n,r,i){return this}insert(e,t,n){return new It(e,t,null)}remove(e,t){return this}count(){return 0}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}check_(){return 0}isRed_(){return!1}};let kt;function Nt(e){return"number"==typeof e?"number:"+Ie(e):"string:"+e}function Pt(e){var t;e.isLeafNode()?(t=e.val(),p("string"==typeof t||"number"==typeof t||"object"==typeof t&&w(t,".sv"),"Priority must be a string or number.")):p(e===kt||e.isEmpty(),"priority of unexpected type."),p(e===kt||e.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")}let Rt;class xt{constructor(e,t=xt.__childrenNodeConstructor.EMPTY_NODE){this.value_=e,this.priorityNode_=t,this.lazyHash_=null,p(void 0!==this.value_&&null!==this.value_,"LeafNode shouldn't be created with null/undefined value."),Pt(this.priorityNode_)}static set __childrenNodeConstructor(e){Rt=e}static get __childrenNodeConstructor(){return Rt}isLeafNode(){return!0}getPriority(){return this.priorityNode_}updatePriority(e){return new xt(this.value_,e)}getImmediateChild(e){return".priority"===e?this.priorityNode_:xt.__childrenNodeConstructor.EMPTY_NODE}getChild(e){return at(e)?this:".priority"===et(e)?this.priorityNode_:xt.__childrenNodeConstructor.EMPTY_NODE}hasChild(){return!1}getPredecessorChildName(e,t){return null}updateImmediateChild(e,t){return".priority"===e?this.updatePriority(t):t.isEmpty()&&".priority"!==e?this:xt.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(e,t).updatePriority(this.priorityNode_)}updateChild(e,t){var n=et(e);return null===n?t:t.isEmpty()&&".priority"!==n?this:(p(".priority"!==n||1===tt(e),".priority must be the last token in a path"),this.updateImmediateChild(n,xt.__childrenNodeConstructor.EMPTY_NODE.updateChild(nt(e),t)))}isEmpty(){return!1}numChildren(){return 0}forEachChild(e,t){return!1}val(e){return e&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()}hash(){if(null===this.lazyHash_){let e="";this.priorityNode_.isEmpty()||(e+="priority:"+Nt(this.priorityNode_.val())+":");var t=typeof this.value_;e+=t+":",e+="number"==t?Ie(this.value_):this.value_,this.lazyHash_=Z(e)}return this.lazyHash_}getValue(){return this.value_}compareTo(e){return e===xt.__childrenNodeConstructor.EMPTY_NODE?1:e instanceof xt.__childrenNodeConstructor?-1:(p(e.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(e))}compareToLeafNode_(e){var t=typeof e.value_,n=typeof this.value_,r=xt.VALUE_TYPE_ORDER.indexOf(t),i=xt.VALUE_TYPE_ORDER.indexOf(n);return p(0<=r,"Unknown leaf type: "+t),p(0<=i,"Unknown leaf type: "+n),r===i?"object"==n?0:this.value_<e.value_?-1:this.value_===e.value_?0:1:i-r}withIndex(){return this}isIndexed(){return!0}equals(e){return e===this||!!e.isLeafNode()&&(this.value_===e.value_&&this.priorityNode_.equals(e.priorityNode_))}}xt.VALUE_TYPE_ORDER=["object","boolean","number","string"];let Dt,At;const Ot=new class extends vt{compare(e,t){const n=e.node.getPriority();var r=t.node.getPriority(),r=n.compareTo(r);return 0===r?Ce(e.name,t.name):r}isDefinedOn(e){return!e.getPriority().isEmpty()}indexedValueChanged(e,t){return!e.getPriority().equals(t.getPriority())}minPost(){return mt.MIN}maxPost(){return new mt(we,new xt("[PRIORITY-POST]",At))}makePost(e,t){var n=Dt(e);return new mt(t,new xt("[PRIORITY-POST]",n))}toString(){return".priority"}},Lt=Math.log(2);class Mt{constructor(e){var t;this.count=(t=e+1,parseInt(Math.log(t)/Lt,10)),this.current_=this.count-1;var n,r=(n=this.count,parseInt(Array(n+1).join("1"),2));this.bits_=e+1&r}nextBitIsOne(){var e=!(this.bits_&1<<this.current_);return this.current_--,e}}function Ft(l,e,h,t){l.sort(e);const c=function(e,t){var n=t-e;let r,i;if(0==n)return null;if(1==n)return r=l[e],i=h?h(r):r,new It(i,r.node,It.BLACK,null,null);var s=parseInt(n/2,10)+e,o=c(e,s),n=c(s+1,t);return r=l[s],i=h?h(r):r,new It(i,r.node,It.BLACK,o,n)};var n=function(e){let s=null,o=null,a=l.length;function t(e,t){var n=a-e,r=a;a-=e;var i=c(1+n,r),r=l[n],n=h?h(r):r;!function(e){if(s){s.left=e;s=e}else{o=e;s=e}}(new It(n,r.node,t,null,i))}for(let i=0;i<e.count;++i){var n=e.nextBitIsOne(),r=Math.pow(2,e.count-(i+1));n?t(r,It.BLACK):(t(r,It.BLACK),t(r,It.RED))}return o}(new Mt(l.length));return new Tt(t||e,n)}let qt;const Wt={};class Ut{constructor(e,t){this.indexes_=e,this.indexSet_=t}static get Default(){return p((Wt,Ot),"ChildrenNode.ts has not been loaded"),qt=qt||new Ut({".priority":Wt},{".priority":Ot}),qt}get(e){var t=C(this.indexes_,e);if(!t)throw new Error("No index defined for "+e);return t instanceof Tt?t:null}hasIndex(e){return w(this.indexSet_,e.toString())}addIndex(e,t){p(e!==Ct,"KeyIndex always exists and isn't meant to be added to the IndexMap.");const n=[];let r=!1;const i=t.getIterator(mt.Wrap);let s=i.getNext();for(;s;)r=r||e.isDefinedOn(s.node),n.push(s),s=i.getNext();let o;o=r?Ft(n,e.getCompare()):Wt;var a=e.toString();const l=Object.assign({},this.indexSet_);l[a]=e;const h=Object.assign({},this.indexes_);return h[a]=o,new Ut(h,l)}addToIndexes(o,a){var e=I(this.indexes_,(t,e)=>{const n=C(this.indexSet_,e);if(p(n,"Missing index implementation for "+e),t===Wt){if(n.isDefinedOn(o.node)){const i=[],s=a.getIterator(mt.Wrap);let e=s.getNext();for(;e;)e.name!==o.name&&i.push(e),e=s.getNext();return i.push(o),Ft(i,n.getCompare())}return Wt}{var r=a.get(o.name);let e=t;return r&&(e=e.remove(new mt(o.name,r))),e.insert(o,o.node)}});return new Ut(e,this.indexSet_)}removeFromIndexes(n,r){var e=I(this.indexes_,e=>{if(e===Wt)return e;var t=r.get(n.name);return t?e.remove(new mt(n.name,t)):e});return new Ut(e,this.indexSet_)}}let Bt;class jt{constructor(e,t,n){this.children_=e,this.priorityNode_=t,this.indexMap_=n,this.lazyHash_=null,this.priorityNode_&&Pt(this.priorityNode_),this.children_.isEmpty()&&p(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}static get EMPTY_NODE(){return Bt=Bt||new jt(new Tt(St),null,Ut.Default)}isLeafNode(){return!1}getPriority(){return this.priorityNode_||Bt}updatePriority(e){return this.children_.isEmpty()?this:new jt(this.children_,e,this.indexMap_)}getImmediateChild(e){if(".priority"===e)return this.getPriority();var t=this.children_.get(e);return null===t?Bt:t}getChild(e){var t=et(e);return null===t?this:this.getImmediateChild(t).getChild(nt(e))}hasChild(e){return null!==this.children_.get(e)}updateImmediateChild(n,r){if(p(r,"We should always be passing snapshot nodes"),".priority"===n)return this.updatePriority(r);{var i=new mt(n,r);let e,t;t=r.isEmpty()?(e=this.children_.remove(n),this.indexMap_.removeFromIndexes(i,this.children_)):(e=this.children_.insert(n,r),this.indexMap_.addToIndexes(i,this.children_));i=e.isEmpty()?Bt:this.priorityNode_;return new jt(e,i,t)}}updateChild(e,t){var n=et(e);if(null===n)return t;p(".priority"!==et(e)||1===tt(e),".priority must be the last token in a path");var r=this.getImmediateChild(n).updateChild(nt(e),t);return this.updateImmediateChild(n,r)}isEmpty(){return this.children_.isEmpty()}numChildren(){return this.children_.count()}val(n){if(this.isEmpty())return null;const r={};let i=0,s=0,o=!0;if(this.forEachChild(Ot,(e,t)=>{r[e]=t.val(n),i++,o&&jt.INTEGER_REGEXP_.test(e)?s=Math.max(s,Number(e)):o=!1}),!n&&o&&s<2*i){const e=[];for(const t in r)e[t]=r[t];return e}return n&&!this.getPriority().isEmpty()&&(r[".priority"]=this.getPriority().val()),r}hash(){if(null===this.lazyHash_){let r="";this.getPriority().isEmpty()||(r+="priority:"+Nt(this.getPriority().val())+":"),this.forEachChild(Ot,(e,t)=>{var n=t.hash();""!==n&&(r+=":"+e+":"+n)}),this.lazyHash_=""===r?"":Z(r)}return this.lazyHash_}getPredecessorChildName(e,t,n){const r=this.resolveIndex_(n);if(r){var i=r.getPredecessorKey(new mt(e,t));return i?i.name:null}return this.children_.getPredecessorKey(e)}getFirstChildName(e){const t=this.resolveIndex_(e);if(t){var n=t.minKey();return n&&n.name}return this.children_.minKey()}getFirstChild(e){var t=this.getFirstChildName(e);return t?new mt(t,this.children_.get(t)):null}getLastChildName(e){const t=this.resolveIndex_(e);if(t){var n=t.maxKey();return n&&n.name}return this.children_.maxKey()}getLastChild(e){var t=this.getLastChildName(e);return t?new mt(t,this.children_.get(t)):null}forEachChild(e,t){const n=this.resolveIndex_(e);return n?n.inorderTraversal(e=>t(e.name,e.node)):this.children_.inorderTraversal(t)}getIterator(e){return this.getIteratorFrom(e.minPost(),e)}getIteratorFrom(t,n){const e=this.resolveIndex_(n);if(e)return e.getIteratorFrom(t,e=>e);{const r=this.children_.getIteratorFrom(t.name,mt.Wrap);let e=r.peek();for(;null!=e&&n.compare(e,t)<0;)r.getNext(),e=r.peek();return r}}getReverseIterator(e){return this.getReverseIteratorFrom(e.maxPost(),e)}getReverseIteratorFrom(t,n){const e=this.resolveIndex_(n);if(e)return e.getReverseIteratorFrom(t,e=>e);{const r=this.children_.getReverseIteratorFrom(t.name,mt.Wrap);let e=r.peek();for(;null!=e&&0<n.compare(e,t);)r.getNext(),e=r.peek();return r}}compareTo(e){return this.isEmpty()?e.isEmpty()?0:-1:e.isLeafNode()||e.isEmpty()?1:e===zt?-1:0}withIndex(e){if(e===Ct||this.indexMap_.hasIndex(e))return this;var t=this.indexMap_.addIndex(e,this.children_);return new jt(this.children_,this.priorityNode_,t)}isIndexed(e){return e===Ct||this.indexMap_.hasIndex(e)}equals(e){if(e===this)return!0;if(e.isLeafNode())return!1;{const n=e;if(this.getPriority().equals(n.getPriority())){if(this.children_.count()!==n.children_.count())return!1;{const r=this.getIterator(Ot),i=n.getIterator(Ot);let e=r.getNext(),t=i.getNext();for(;e&&t;){if(e.name!==t.name||!e.node.equals(t.node))return!1;e=r.getNext(),t=i.getNext()}return null===e&&null===t}}return!1}}resolveIndex_(e){return e===Ct?null:this.indexMap_.get(e.toString())}}jt.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/;class Vt extends jt{constructor(){super(new Tt(St),jt.EMPTY_NODE,Ut.Default)}compareTo(e){return e===this?0:1}equals(e){return e===this}getPriority(){return this}getImmediateChild(e){return jt.EMPTY_NODE}isEmpty(){return!1}}const zt=new Vt;Object.defineProperties(mt,{MIN:{value:new mt(ye,jt.EMPTY_NODE)},MAX:{value:new mt(we,zt)}}),wt.__EMPTY_NODE=jt.EMPTY_NODE,xt.__childrenNodeConstructor=jt,Q=zt,kt=Q,Y=zt,At=Y;const Ht=!0;function Qt(i,e=null){if(null===i)return jt.EMPTY_NODE;if("object"==typeof i&&".priority"in i&&(e=i[".priority"]),p(null===e||"string"==typeof e||"number"==typeof e||"object"==typeof e&&".sv"in e,"Invalid priority type found: "+typeof e),"object"!=typeof(i="object"==typeof i&&".value"in i&&null!==i[".value"]?i[".value"]:i)||".sv"in i){var t=i;return new xt(t,Qt(e))}if(i instanceof Array||!Ht){let r=jt.EMPTY_NODE;return be(i,(e,t)=>{if(w(i,e)&&"."!==e.substring(0,1)){const n=Qt(t);!n.isLeafNode()&&n.isEmpty()||(r=r.updateImmediateChild(e,n))}}),r.updatePriority(Qt(e))}{const s=[];let r=!1;if(be(i,(e,t)=>{if("."!==e.substring(0,1)){const n=Qt(t);n.isEmpty()||(r=r||!n.getPriority().isEmpty(),s.push(new mt(e,n)))}}),0===s.length)return jt.EMPTY_NODE;var n=Ft(s,Et,e=>e.name,St);if(r){t=Ft(s,Ot.getCompare());return new jt(n,Qt(e),new Ut({".priority":t},{".priority":Ot}))}return new jt(n,Qt(e),Ut.Default)}}Dt=Qt;class Yt extends vt{constructor(e){super(),this.indexPath_=e,p(!at(e)&&".priority"!==et(e),"Can't create PathIndex with empty path or .priority key")}extractChild(e){return e.getChild(this.indexPath_)}isDefinedOn(e){return!e.getChild(this.indexPath_).isEmpty()}compare(e,t){const n=this.extractChild(e.node);var r=this.extractChild(t.node),r=n.compareTo(r);return 0===r?Ce(e.name,t.name):r}makePost(e,t){var n=Qt(e),n=jt.EMPTY_NODE.updateChild(this.indexPath_,n);return new mt(t,n)}maxPost(){var e=jt.EMPTY_NODE.updateChild(this.indexPath_,zt);return new mt(we,e)}toString(){return it(this.indexPath_,0).join("/")}}const Kt=new class extends vt{compare(e,t){var n=e.node.compareTo(t.node);return 0===n?Ce(e.name,t.name):n}isDefinedOn(e){return!0}indexedValueChanged(e,t){return!e.equals(t)}minPost(){return mt.MIN}maxPost(){return mt.MAX}makePost(e,t){var n=Qt(e);return new mt(t,n)}toString(){return".value"}};function $t(e){return{type:"value",snapshotNode:e}}function Gt(e,t){return{type:"child_added",snapshotNode:t,childName:e}}function Jt(e,t){return{type:"child_removed",snapshotNode:t,childName:e}}function Xt(e,t,n){return{type:"child_changed",snapshotNode:t,childName:e,oldSnap:n}}class Zt{constructor(e){this.index_=e}updateChild(e,t,n,r,i,s){p(e.isIndexed(this.index_),"A node must be indexed if only a child is updated");const o=e.getImmediateChild(t);return o.getChild(r).equals(n.getChild(r))&&o.isEmpty()===n.isEmpty()?e:(null!=s&&(n.isEmpty()?e.hasChild(t)?s.trackChildChange(Jt(t,o)):p(e.isLeafNode(),"A child remove without an old child only makes sense on a leaf node"):o.isEmpty()?s.trackChildChange(Gt(t,n)):s.trackChildChange(Xt(t,n,o))),e.isLeafNode()&&n.isEmpty()?e:e.updateImmediateChild(t,n).withIndex(this.index_))}updateFullNode(r,n,i){return null!=i&&(r.isLeafNode()||r.forEachChild(Ot,(e,t)=>{n.hasChild(e)||i.trackChildChange(Jt(e,t))}),n.isLeafNode()||n.forEachChild(Ot,(e,t)=>{if(r.hasChild(e)){const n=r.getImmediateChild(e);n.equals(t)||i.trackChildChange(Xt(e,t,n))}else i.trackChildChange(Gt(e,t))})),n.withIndex(this.index_)}updatePriority(e,t){return e.isEmpty()?jt.EMPTY_NODE:e.updatePriority(t)}filtersNodes(){return!1}getIndexedFilter(){return this}getIndex(){return this.index_}}class en{constructor(e){this.indexedFilter_=new Zt(e.getIndex()),this.index_=e.getIndex(),this.startPost_=en.getStartPost_(e),this.endPost_=en.getEndPost_(e),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}getStartPost(){return this.startPost_}getEndPost(){return this.endPost_}matches(e){var t=this.startIsInclusive_?this.index_.compare(this.getStartPost(),e)<=0:this.index_.compare(this.getStartPost(),e)<0,n=this.endIsInclusive_?this.index_.compare(e,this.getEndPost())<=0:this.index_.compare(e,this.getEndPost())<0;return t&&n}updateChild(e,t,n,r,i,s){return this.matches(new mt(t,n))||(n=jt.EMPTY_NODE),this.indexedFilter_.updateChild(e,t,n,r,i,s)}updateFullNode(e,t,n){let r=(t=t.isLeafNode()?jt.EMPTY_NODE:t).withIndex(this.index_);r=r.updatePriority(jt.EMPTY_NODE);const i=this;return t.forEachChild(Ot,(e,t)=>{i.matches(new mt(e,t))||(r=r.updateImmediateChild(e,jt.EMPTY_NODE))}),this.indexedFilter_.updateFullNode(e,r,n)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.indexedFilter_}getIndex(){return this.index_}static getStartPost_(e){if(e.hasStart()){var t=e.getIndexStartName();return e.getIndex().makePost(e.getIndexStartValue(),t)}return e.getIndex().minPost()}static getEndPost_(e){if(e.hasEnd()){var t=e.getIndexEndName();return e.getIndex().makePost(e.getIndexEndValue(),t)}return e.getIndex().maxPost()}}class tn{constructor(e){this.withinDirectionalStart=e=>this.reverse_?this.withinEndPost(e):this.withinStartPost(e),this.withinDirectionalEnd=e=>this.reverse_?this.withinStartPost(e):this.withinEndPost(e),this.withinStartPost=e=>{var t=this.index_.compare(this.rangedFilter_.getStartPost(),e);return this.startIsInclusive_?t<=0:t<0},this.withinEndPost=e=>{var t=this.index_.compare(e,this.rangedFilter_.getEndPost());return this.endIsInclusive_?t<=0:t<0},this.rangedFilter_=new en(e),this.index_=e.getIndex(),this.limit_=e.getLimit(),this.reverse_=!e.isViewFromLeft(),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}updateChild(e,t,n,r,i,s){return this.rangedFilter_.matches(new mt(t,n))||(n=jt.EMPTY_NODE),e.getImmediateChild(t).equals(n)?e:e.numChildren()<this.limit_?this.rangedFilter_.getIndexedFilter().updateChild(e,t,n,r,i,s):this.fullLimitUpdateChild_(e,t,n,i,s)}updateFullNode(e,n,t){let r;if(n.isLeafNode()||n.isEmpty())r=jt.EMPTY_NODE.withIndex(this.index_);else if(2*this.limit_<n.numChildren()&&n.isIndexed(this.index_)){r=jt.EMPTY_NODE.withIndex(this.index_);let e;e=this.reverse_?n.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_):n.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_);let t=0;for(;e.hasNext()&&t<this.limit_;){var i=e.getNext();if(this.withinDirectionalStart(i)){if(!this.withinDirectionalEnd(i))break;r=r.updateImmediateChild(i.name,i.node),t++}}}else{r=n.withIndex(this.index_),r=r.updatePriority(jt.EMPTY_NODE);let e;e=this.reverse_?r.getReverseIterator(this.index_):r.getIterator(this.index_);let t=0;for(;e.hasNext();){var s=e.getNext();t<this.limit_&&this.withinDirectionalStart(s)&&this.withinDirectionalEnd(s)?t++:r=r.updateImmediateChild(s.name,jt.EMPTY_NODE)}}return this.rangedFilter_.getIndexedFilter().updateFullNode(e,r,t)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.rangedFilter_.getIndexedFilter()}getIndex(){return this.index_}fullLimitUpdateChild_(e,t,n,r,i){let s;if(this.reverse_){const d=this.index_.getCompare();s=(e,t)=>d(t,e)}else s=this.index_.getCompare();const o=e;p(o.numChildren()===this.limit_,"");var a=new mt(t,n),l=this.reverse_?o.getFirstChild(this.index_):o.getLastChild(this.index_),h=this.rangedFilter_.matches(a);if(o.hasChild(t)){var c=o.getImmediateChild(t);let e=r.getChildAfterChild(this.index_,l,this.reverse_);for(;null!=e&&(e.name===t||o.hasChild(e.name));)e=r.getChildAfterChild(this.index_,e,this.reverse_);var u=null==e?1:s(e,a);if(h&&!n.isEmpty()&&0<=u)return null!=i&&i.trackChildChange(Xt(t,n,c)),o.updateImmediateChild(t,n);{null!=i&&i.trackChildChange(Jt(t,c));const _=o.updateImmediateChild(t,jt.EMPTY_NODE);return null!=e&&this.rangedFilter_.matches(e)?(null!=i&&i.trackChildChange(Gt(e.name,e.node)),_.updateImmediateChild(e.name,e.node)):_}}return!n.isEmpty()&&h&&0<=s(l,a)?(null!=i&&(i.trackChildChange(Jt(l.name,l.node)),i.trackChildChange(Gt(t,n))),o.updateImmediateChild(t,n).updateImmediateChild(l.name,jt.EMPTY_NODE)):e}}class nn{constructor(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.startAfterSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.endBeforeSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=Ot}hasStart(){return this.startSet_}isViewFromLeft(){return""===this.viewFrom_?this.startSet_:"l"===this.viewFrom_}getIndexStartValue(){return p(this.startSet_,"Only valid if start has been set"),this.indexStartValue_}getIndexStartName(){return p(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:ye}hasEnd(){return this.endSet_}getIndexEndValue(){return p(this.endSet_,"Only valid if end has been set"),this.indexEndValue_}getIndexEndName(){return p(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:we}hasLimit(){return this.limitSet_}hasAnchoredLimit(){return this.limitSet_&&""!==this.viewFrom_}getLimit(){return p(this.limitSet_,"Only valid if limit has been set"),this.limit_}getIndex(){return this.index_}loadsAllData(){return!(this.startSet_||this.endSet_||this.limitSet_)}isDefault(){return this.loadsAllData()&&this.index_===Ot}copy(){const e=new nn;return e.limitSet_=this.limitSet_,e.limit_=this.limit_,e.startSet_=this.startSet_,e.startAfterSet_=this.startAfterSet_,e.indexStartValue_=this.indexStartValue_,e.startNameSet_=this.startNameSet_,e.indexStartName_=this.indexStartName_,e.endSet_=this.endSet_,e.endBeforeSet_=this.endBeforeSet_,e.indexEndValue_=this.indexEndValue_,e.endNameSet_=this.endNameSet_,e.indexEndName_=this.indexEndName_,e.index_=this.index_,e.viewFrom_=this.viewFrom_,e}}function rn(e,t,n){const r=e.copy();return r.startSet_=!0,void 0===t&&(t=null),r.indexStartValue_=t,null!=n?(r.startNameSet_=!0,r.indexStartName_=n):(r.startNameSet_=!1,r.indexStartName_=""),r}function sn(e,t,n){const r=e.copy();return r.endSet_=!0,void 0===t&&(t=null),r.indexEndValue_=t,void 0!==n?(r.endNameSet_=!0,r.indexEndName_=n):(r.endNameSet_=!1,r.indexEndName_=""),r}function on(e,t){const n=e.copy();return n.index_=t,n}function an(e){const t={};if(e.isDefault())return t;let n;var r;return n=e.index_===Ot?"$priority":e.index_===Kt?"$value":e.index_===Ct?"$key":(p(e.index_ instanceof Yt,"Unrecognized index type!"),e.index_.toString()),t.orderBy=v(n),e.startSet_&&(r=e.startAfterSet_?"startAfter":"startAt",t[r]=v(e.indexStartValue_),e.startNameSet_&&(t[r]+=","+v(e.indexStartName_))),e.endSet_&&(r=e.endBeforeSet_?"endBefore":"endAt",t[r]=v(e.indexEndValue_),e.endNameSet_&&(t[r]+=","+v(e.indexEndName_))),e.limitSet_&&(e.isViewFromLeft()?t.limitToFirst=e.limit_:t.limitToLast=e.limit_),t}function ln(t){const n={};if(t.startSet_&&(n.sp=t.indexStartValue_,t.startNameSet_&&(n.sn=t.indexStartName_),n.sin=!t.startAfterSet_),t.endSet_&&(n.ep=t.indexEndValue_,t.endNameSet_&&(n.en=t.indexEndName_),n.ein=!t.endBeforeSet_),t.limitSet_){n.l=t.limit_;let e=t.viewFrom_;""===e&&(e=t.isViewFromLeft()?"l":"r"),n.vf=e}return t.index_!==Ot&&(n.i=t.index_.toString()),n}class hn extends $e{constructor(e,t,n,r){super(),this.repoInfo_=e,this.onDataUpdate_=t,this.authTokenProvider_=n,this.appCheckTokenProvider_=r,this.log_=ae("p:rest:"),this.listens_={}}reportStats(e){throw new Error("Method not implemented.")}static getListenId_(e,t){return void 0!==t?"tag$"+t:(p(e._queryParams.isDefault(),"should have a tag if it's not a default query."),e._path.toString())}listen(e,t,r,i){const s=e._path.toString();this.log_("Listen called for "+s+" "+e._queryIdentifier);const o=hn.getListenId_(e,r),a={};this.listens_[o]=a;var n=an(e._queryParams);this.restRequest_(s+".json",n,(t,e)=>{let n=e;if(null===(t=404===t?n=null:t)&&this.onDataUpdate_(s,n,!1,r),C(this.listens_,o)===a){let e;e=t?401===t?"permission_denied":"rest_error:"+t:"ok",i(e,null)}})}unlisten(e,t){var n=hn.getListenId_(e,t);delete this.listens_[n]}get(e){var t=an(e._queryParams);const r=e._path.toString(),i=new _;return this.restRequest_(r+".json",t,(e,t)=>{let n=t;null===(e=404===e?n=null:e)?(this.onDataUpdate_(r,n,!1,null),i.resolve(n)):i.reject(new Error(n))}),i.promise}refreshAuthToken(e){}restRequest_(i,s={},o){return s.format="export",Promise.all([this.authTokenProvider_.getToken(!1),this.appCheckTokenProvider_.getToken(!1)]).then(([e,t])=>{e&&e.accessToken&&(s.auth=e.accessToken),t&&t.token&&(s.ac=t.token);const n=(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host+i+"?ns="+this.repoInfo_.namespace+function(e){const t=[];for(const[n,r]of Object.entries(e))Array.isArray(r)?r.forEach(e=>{t.push(encodeURIComponent(n)+"="+encodeURIComponent(e))}):t.push(encodeURIComponent(n)+"="+encodeURIComponent(r));return t.length?"&"+t.join("&"):""}(s);this.log_("Sending REST request for "+n);const r=new XMLHttpRequest;r.onreadystatechange=()=>{if(o&&4===r.readyState){this.log_("REST Response for "+n+" received. status:",r.status,"response:",r.responseText);let e=null;if(200<=r.status&&r.status<300){try{e=m(r.responseText)}catch(e){ge("Failed to parse JSON response for "+n+": "+r.responseText)}o(null,e)}else 401!==r.status&&404!==r.status&&ge("Got unsuccessful REST response for "+n+" Status: "+r.status),o(r.status);o=null}},r.open("GET",n,!0),r.send()})}}class cn{constructor(){this.rootNode_=jt.EMPTY_NODE}getNode(e){return this.rootNode_.getChild(e)}updateSnapshot(e,t){this.rootNode_=this.rootNode_.updateChild(e,t)}}function un(){return{value:null,children:new Map}}function dn(e,t,n){var r;at(t)?(e.value=n,e.children.clear()):null!==e.value?e.value=e.value.updateChild(t,n):(r=et(t),e.children.has(r)||e.children.set(r,un()),dn(e.children.get(r),t=nt(t),n))}function _n(e,n,r){var i;null!==e.value?r(n,e.value):(i=(e,t)=>{_n(t,new Xe(n.toString()+"/"+e),r)},e.children.forEach((e,t)=>{i(t,e)}))}class pn{constructor(e){this.collection_=e,this.last_=null}get(){var e=this.collection_.get();const n=Object.assign({},e);return this.last_&&be(this.last_,(e,t)=>{n[e]=n[e]-t}),this.last_=e,n}}class fn{constructor(e,t){this.server_=t,this.statsToReport_={},this.statsListener_=new pn(e);var n=1e4+2e4*Math.random();Ee(this.reportStats_.bind(this),Math.floor(n))}reportStats_(){var e=this.statsListener_.get();const n={};let r=!1;be(e,(e,t)=>{0<t&&w(this.statsToReport_,e)&&(n[e]=t,r=!0)}),r&&this.server_.reportStats(n),Ee(this.reportStats_.bind(this),Math.floor(2*Math.random()*3e5))}}function gn(){return{fromUser:!0,fromServer:!1,queryId:null,tagged:!1}}function mn(){return{fromUser:!1,fromServer:!0,queryId:null,tagged:!1}}function vn(e){return{fromUser:!1,fromServer:!0,queryId:e,tagged:!0}}($=K=K||{})[$.OVERWRITE=0]="OVERWRITE",$[$.MERGE=1]="MERGE",$[$.ACK_USER_WRITE=2]="ACK_USER_WRITE",$[$.LISTEN_COMPLETE=3]="LISTEN_COMPLETE";class yn{constructor(e,t,n){this.path=e,this.affectedTree=t,this.revert=n,this.type=K.ACK_USER_WRITE,this.source=gn()}operationForChild(e){if(at(this.path)){if(null!=this.affectedTree.value)return p(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;var t=this.affectedTree.subtree(new Xe(e));return new yn(Ze(),t,this.revert)}return p(et(this.path)===e,"operationForChild called for unrelated child."),new yn(nt(this.path),this.affectedTree,this.revert)}}class wn{constructor(e,t){this.source=e,this.path=t,this.type=K.LISTEN_COMPLETE}operationForChild(e){return at(this.path)?new wn(this.source,Ze()):new wn(this.source,nt(this.path))}}class Cn{constructor(e,t,n){this.source=e,this.path=t,this.snap=n,this.type=K.OVERWRITE}operationForChild(e){return at(this.path)?new Cn(this.source,Ze(),this.snap.getImmediateChild(e)):new Cn(this.source,nt(this.path),this.snap)}}class bn{constructor(e,t,n){this.source=e,this.path=t,this.children=n,this.type=K.MERGE}operationForChild(e){if(at(this.path)){const t=this.children.subtree(new Xe(e));return t.isEmpty()?null:t.value?new Cn(this.source,Ze(),t.value):new bn(this.source,Ze(),t)}return p(et(this.path)===e,"Can't get a merge for a child not on the path of the operation"),new bn(this.source,nt(this.path),this.children)}toString(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"}}class In{constructor(e,t,n){this.node_=e,this.fullyInitialized_=t,this.filtered_=n}isFullyInitialized(){return this.fullyInitialized_}isFiltered(){return this.filtered_}isCompleteForPath(e){if(at(e))return this.isFullyInitialized()&&!this.filtered_;var t=et(e);return this.isCompleteForChild(t)}isCompleteForChild(e){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(e)}getNode(){return this.node_}}class Tn{constructor(e){this.query_=e,this.index_=this.query_._queryParams.getIndex()}}function En(n,e,t,r){var i=[];const s=[];return e.forEach(e=>{var t;"child_changed"===e.type&&n.index_.indexedValueChanged(e.oldSnap,e.snapshotNode)&&s.push((t=e.childName,{type:"child_moved",snapshotNode:e.snapshotNode,childName:t}))}),Sn(n,i,"child_removed",e,r,t),Sn(n,i,"child_added",e,r,t),Sn(n,i,"child_moved",s,r,t),Sn(n,i,"child_changed",e,r,t),Sn(n,i,"value",e,r,t),i}function Sn(s,o,t,e,a,l){const n=e.filter(e=>e.type===t);n.sort((e,t)=>function(e,t,n){if(null==t.childName||null==n.childName)throw c("Should only compare child_ events.");var r=new mt(t.childName,t.snapshotNode),i=new mt(n.childName,n.snapshotNode);return e.index_.compare(r,i)}(s,e,t)),n.forEach(t=>{const n=(e=s,i=l,"value"===(r=t).type||"child_removed"===r.type||(r.prevName=i.getPredecessorChildName(r.childName,r.snapshotNode,e.index_)),r);var e,r,i;a.forEach(e=>{e.respondsTo(t.type)&&o.push(e.createEvent(n,s.query_))})})}function kn(e,t){return{eventCache:e,serverCache:t}}function Nn(e,t,n,r){return kn(new In(t,n,r),e.serverCache)}function Pn(e,t,n,r){return kn(e.eventCache,new In(t,n,r))}function Rn(e){return e.eventCache.isFullyInitialized()?e.eventCache.getNode():null}function xn(e){return e.serverCache.isFullyInitialized()?e.serverCache.getNode():null}let Dn;class An{constructor(e,t=(Dn=Dn||new Tt(he),Dn)){this.value=e,this.children=t}static fromObject(e){let n=new An(null);return be(e,(e,t)=>{n=n.set(new Xe(e),t)}),n}isEmpty(){return null===this.value&&this.children.isEmpty()}findRootMostMatchingPathAndValue(e,t){if(null!=this.value&&t(this.value))return{path:Ze(),value:this.value};if(at(e))return null;{var n=et(e);const i=this.children.get(n);if(null===i)return null;var r=i.findRootMostMatchingPathAndValue(nt(e),t);return null==r?null:{path:ot(new Xe(n),r.path),value:r.value}}}findRootMostValueAndPath(e){return this.findRootMostMatchingPathAndValue(e,()=>!0)}subtree(e){if(at(e))return this;{var t=et(e);const n=this.children.get(t);return null!==n?n.subtree(nt(e)):new An(null)}}set(e,t){if(at(e))return new An(t,this.children);{var n=et(e);const i=this.children.get(n)||new An(null);var r=i.set(nt(e),t),r=this.children.insert(n,r);return new An(this.value,r)}}remove(t){if(at(t))return this.children.isEmpty()?new An(null):new An(null,this.children);{var n=et(t);const r=this.children.get(n);if(r){const i=r.remove(nt(t));let e;return e=i.isEmpty()?this.children.remove(n):this.children.insert(n,i),null===this.value&&e.isEmpty()?new An(null):new An(this.value,e)}return this}}get(e){if(at(e))return this.value;{var t=et(e);const n=this.children.get(t);return n?n.get(nt(e)):null}}setTree(t,n){if(at(t))return n;{var r=et(t);const i=this.children.get(r)||new An(null),s=i.setTree(nt(t),n);let e;return e=s.isEmpty()?this.children.remove(r):this.children.insert(r,s),new An(this.value,e)}}fold(e){return this.fold_(Ze(),e)}fold_(n,r){const i={};return this.children.inorderTraversal((e,t)=>{i[e]=t.fold_(ot(n,e),r)}),r(n,this.value,i)}findOnPath(e,t){return this.findOnPath_(e,Ze(),t)}findOnPath_(e,t,n){var r=!!this.value&&n(t,this.value);if(r)return r;if(at(e))return null;{r=et(e);const i=this.children.get(r);return i?i.findOnPath_(nt(e),ot(t,r),n):null}}foreachOnPath(e,t){return this.foreachOnPath_(e,Ze(),t)}foreachOnPath_(e,t,n){if(at(e))return this;{this.value&&n(t,this.value);var r=et(e);const i=this.children.get(r);return i?i.foreachOnPath_(nt(e),ot(t,r),n):new An(null)}}foreach(e){this.foreach_(Ze(),e)}foreach_(n,r){this.children.inorderTraversal((e,t)=>{t.foreach_(ot(n,e),r)}),this.value&&r(n,this.value)}foreachChild(n){this.children.inorderTraversal((e,t)=>{t.value&&n(e,t.value)})}}class On{constructor(e){this.writeTree_=e}static empty(){return new On(new An(null))}}function Ln(t,n,r){if(at(n))return new On(new An(r));var i=t.writeTree_.findRootMostValueAndPath(n);if(null!=i){var s=i.path;let e=i.value;i=lt(s,n);return e=e.updateChild(i,r),new On(t.writeTree_.set(s,e))}s=new An(r),s=t.writeTree_.setTree(n,s);return new On(s)}function Mn(e,n,t){let r=e;return be(t,(e,t)=>{r=Ln(r,ot(n,e),t)}),r}function Fn(e,t){if(at(t))return On.empty();var n=e.writeTree_.setTree(t,new An(null));return new On(n)}function qn(e,t){return null!=Wn(e,t)}function Wn(e,t){var n=e.writeTree_.findRootMostValueAndPath(t);return null!=n?e.writeTree_.get(n.path).getChild(lt(n.path,t)):null}function Un(e){const n=[],t=e.writeTree_.value;return null!=t?t.isLeafNode()||t.forEachChild(Ot,(e,t)=>{n.push(new mt(e,t))}):e.writeTree_.children.inorderTraversal((e,t)=>{null!=t.value&&n.push(new mt(e,t.value))}),n}function Bn(e,t){if(at(t))return e;var n=Wn(e,t);return null!=n?new On(new An(n)):new On(e.writeTree_.subtree(t))}function jn(e){return e.writeTree_.isEmpty()}function Vn(e,t){return function r(i,e,s){{if(null!=e.value)return s.updateChild(i,e.value);{let n=null;return e.children.inorderTraversal((e,t)=>{".priority"===e?(p(null!==t.value,"Priority writes must always be leaf nodes"),n=t.value):s=r(ot(i,e),t,s)}),s=!s.getChild(i).isEmpty()&&null!==n?s.updateChild(ot(i,".priority"),n):s}}}(Ze(),e.writeTree_,t)}function zn(e,t){return nr(t,e)}function Hn(t,n){var e,r=t.allWrites.findIndex(e=>e.writeId===n);p(0<=r,"removeWrite called with nonexistent writeId.");const i=t.allWrites[r];t.allWrites.splice(r,1);let s=i.visible,o=!1,a=t.allWrites.length-1;for(;s&&0<=a;){var l=t.allWrites[a];l.visible&&(a>=r&&function(e,t){{if(e.snap)return ut(e.path,t);for(const n in e.children)if(e.children.hasOwnProperty(n)&&ut(ot(e.path,n),t))return!0;return!1}}(l,i.path)?s=!1:ut(i.path,l.path)&&(o=!0)),a--}return!!s&&(o?((e=t).visibleWrites=Yn(e.allWrites,Qn,Ze()),0<e.allWrites.length?e.lastWriteId=e.allWrites[e.allWrites.length-1].writeId:e.lastWriteId=-1):i.snap?t.visibleWrites=Fn(t.visibleWrites,i.path):be(i.children,e=>{t.visibleWrites=Fn(t.visibleWrites,ot(i.path,e))}),!0)}function Qn(e){return e.visible}function Yn(e,t,n){let r=On.empty();for(let s=0;s<e.length;++s){const o=e[s];if(t(o)){var i=o.path;let e;if(o.snap)ut(n,i)?(e=lt(n,i),r=Ln(r,e,o.snap)):ut(i,n)&&(e=lt(i,n),r=Ln(r,Ze(),o.snap.getChild(e)));else{if(!o.children)throw c("WriteRecord should have .snap or .children");if(ut(n,i))e=lt(n,i),r=Mn(r,e,o.children);else if(ut(i,n))if(e=lt(i,n),at(e))r=Mn(r,Ze(),o.children);else{const a=C(o.children,et(e));a&&(i=a.getChild(nt(e)),r=Ln(r,Ze(),i))}}}}return r}function Kn(e,t,n,r,i){if(r||i){var s=Bn(e.visibleWrites,t);if(!i&&jn(s))return n;if(i||null!=n||qn(s,Ze()))return Vn(Yn(e.allWrites,function(e){return(e.visible||i)&&(!r||!~r.indexOf(e.writeId))&&(ut(e.path,t)||ut(t,e.path))},t),n||jt.EMPTY_NODE);return null}s=Wn(e.visibleWrites,t);if(null!=s)return s;s=Bn(e.visibleWrites,t);return jn(s)?n:null!=n||qn(s,Ze())?Vn(s,n||jt.EMPTY_NODE):null}function $n(e,t,n,r){return Kn(e.writeTree,e.treePath,t,n,r)}function Gn(e,t){return function(e,t,n){let r=jt.EMPTY_NODE;const i=Wn(e.visibleWrites,t);if(i)return i.isLeafNode()||i.forEachChild(Ot,(e,t)=>{r=r.updateImmediateChild(e,t)}),r;if(n){const s=Bn(e.visibleWrites,t);return n.forEachChild(Ot,(e,t)=>{var n=Vn(Bn(s,new Xe(e)),t);r=r.updateImmediateChild(e,n)}),Un(s).forEach(e=>{r=r.updateImmediateChild(e.name,e.node)}),r}return Un(Bn(e.visibleWrites,t)).forEach(e=>{r=r.updateImmediateChild(e.name,e.node)}),r}(e.writeTree,e.treePath,t)}function Jn(e,t,n,r){return function(e,t,n,r,i){p(r||i,"Either existingEventSnap or existingServerSnap must exist");var s=ot(t,n);return qn(e.visibleWrites,s)?null:jn(s=Bn(e.visibleWrites,s))?i.getChild(n):Vn(s,i.getChild(n))}(e.writeTree,e.treePath,t,n,r)}function Xn(e,t){return n=e.writeTree,t=ot(e.treePath,t),Wn(n.visibleWrites,t);var n}function Zn(e,t,n,r,i,s){return function(e,t,n,r,i,s,o){let a;var l=Bn(e.visibleWrites,t),h=Wn(l,Ze());if(null!=h)a=h;else{if(null==n)return[];a=Vn(l,n)}if(a=a.withIndex(o),a.isEmpty()||a.isLeafNode())return[];{const c=[],u=o.getCompare(),d=s?a.getReverseIteratorFrom(r,o):a.getIteratorFrom(r,o);let e=d.getNext();for(;e&&c.length<i;)0!==u(e,r)&&c.push(e),e=d.getNext();return c}}(e.writeTree,e.treePath,t,n,r,i,s)}function er(e,t,n){return r=e.writeTree,e=e.treePath,n=n,i=ot(e,t=t),null!=(s=Wn(r.visibleWrites,i))?s:n.isCompleteForChild(t)?Vn(Bn(r.visibleWrites,i),n.getNode().getImmediateChild(t)):null;var r,i,s}function tr(e,t){return nr(ot(e.treePath,t),e.writeTree)}function nr(e,t){return{treePath:e,writeTree:t}}class rr{constructor(){this.changeMap=new Map}trackChildChange(e){var t=e.type,n=e.childName;p("child_added"===t||"child_changed"===t||"child_removed"===t,"Only child changes supported for tracking"),p(".priority"!==n,"Only non-priority child changes can be tracked.");var r=this.changeMap.get(n);if(r){var i=r.type;if("child_added"===t&&"child_removed"===i)this.changeMap.set(n,Xt(n,e.snapshotNode,r.snapshotNode));else if("child_removed"===t&&"child_added"===i)this.changeMap.delete(n);else if("child_removed"===t&&"child_changed"===i)this.changeMap.set(n,Jt(n,r.oldSnap));else if("child_changed"===t&&"child_added"===i)this.changeMap.set(n,Gt(n,e.snapshotNode));else{if("child_changed"!==t||"child_changed"!==i)throw c("Illegal combination of changes: "+e+" occurred after "+r);this.changeMap.set(n,Xt(n,e.snapshotNode,r.oldSnap))}}else this.changeMap.set(n,e)}getChanges(){return Array.from(this.changeMap.values())}}const ir=new class{getCompleteChild(e){return null}getChildAfterChild(e,t,n){return null}};class sr{constructor(e,t,n=null){this.writes_=e,this.viewCache_=t,this.optCompleteServerCache_=n}getCompleteChild(e){const t=this.viewCache_.eventCache;if(t.isCompleteForChild(e))return t.getNode().getImmediateChild(e);var n=null!=this.optCompleteServerCache_?new In(this.optCompleteServerCache_,!0,!1):this.viewCache_.serverCache;return er(this.writes_,e,n)}getChildAfterChild(e,t,n){var r=null!=this.optCompleteServerCache_?this.optCompleteServerCache_:xn(this.viewCache_),r=Zn(this.writes_,r,t,1,n,e);return 0===r.length?null:r[0]}}function or(e,t,n,r,i){const s=new rr;let o,a;if(n.type===K.OVERWRITE){var l=n;o=l.source.fromUser?hr(e,t,l.path,l.snap,r,i,s):(p(l.source.fromServer,"Unknown source."),a=l.source.tagged||t.serverCache.isFiltered()&&!at(l.path),lr(e,t,l.path,l.snap,r,i,a,s))}else if(n.type===K.MERGE){l=n;o=l.source.fromUser?function(r,i,s,e,o,a,l){let h=i;return e.foreach((e,t)=>{var n=ot(s,e);cr(i,et(n))&&(h=hr(r,h,n,t,o,a,l))}),e.foreach((e,t)=>{var n=ot(s,e);cr(i,et(n))||(h=hr(r,h,n,t,o,a,l))}),h}(e,t,l.path,l.children,r,i,s):(p(l.source.fromServer,"Unknown source."),a=l.source.tagged||t.serverCache.isFiltered(),dr(e,t,l.path,l.children,r,i,a,s))}else if(n.type===K.ACK_USER_WRITE){var h=n;o=h.revert?function(n,r,i,s,e,o){let a;{if(null!=Xn(s,i))return r;{var l=new sr(s,r,e);const c=r.eventCache.getNode();let t;if(at(i)||".priority"===et(i)){let e;e=r.serverCache.isFullyInitialized()?$n(s,xn(r)):(h=r.serverCache.getNode(),p(h instanceof jt,"serverChildren would be complete if leaf node"),Gn(s,h)),e=e,t=n.filter.updateFullNode(c,e,o)}else{var h=et(i);let e=er(s,h,r.serverCache);null==e&&r.serverCache.isCompleteForChild(h)&&(e=c.getImmediateChild(h)),t=null!=e?n.filter.updateChild(c,h,e,nt(i),l,o):r.eventCache.getNode().hasChild(h)?n.filter.updateChild(c,h,jt.EMPTY_NODE,nt(i),l,o):c,t.isEmpty()&&r.serverCache.isFullyInitialized()&&(a=$n(s,xn(r)),a.isLeafNode()&&(t=n.filter.updateFullNode(t,a,o)))}return a=r.serverCache.isFullyInitialized()||null!=Xn(s,Ze()),Nn(r,t,a,n.filter.filtersNodes())}}}(e,t,h.path,r,i,s):function(e,t,i,n,s,o,a){if(null!=Xn(s,i))return t;const l=t.serverCache.isFiltered(),h=t.serverCache;{if(null!=n.value){if(at(i)&&h.isFullyInitialized()||h.isCompleteForPath(i))return lr(e,t,i,h.getNode().getChild(i),s,o,l,a);if(at(i)){let n=new An(null);return h.getNode().forEachChild(Ct,(e,t)=>{n=n.set(new Xe(e),t)}),dr(e,t,i,n,s,o,l,a)}return t}{let r=new An(null);return n.foreach((e,t)=>{var n=ot(i,e);h.isCompleteForPath(n)&&(r=r.set(e,h.getNode().getChild(n)))}),dr(e,t,i,r,s,o,l,a)}}}(e,t,h.path,h.affectedTree,r,i,s)}else{if(n.type!==K.LISTEN_COMPLETE)throw c("Unknown operation type: "+n.type);o=function(e,t,n,r,i){const s=t.serverCache,o=Pn(t,s.getNode(),s.isFullyInitialized()||at(n),s.isFiltered());return ar(e,o,n,r,ir,i)}(e,t,n.path,r,s)}h=s.getChanges();return function(e,t,n){const r=t.eventCache;if(r.isFullyInitialized()){var i=r.getNode().isLeafNode()||r.getNode().isEmpty();const s=Rn(e);(0<n.length||!e.eventCache.isFullyInitialized()||i&&!r.getNode().equals(s)||!r.getNode().getPriority().equals(s.getPriority()))&&n.push($t(Rn(t)))}}(t,o,h),{viewCache:o,changes:h}}function ar(r,i,s,o,a,l){const h=i.eventCache;if(null!=Xn(o,s))return i;{let t,n;if(at(s)){var e;p(i.serverCache.isFullyInitialized(),"If change path is empty, we must have complete server data"),t=i.serverCache.isFiltered()?(e=Gn(o,(e=xn(i))instanceof jt?e:jt.EMPTY_NODE),r.filter.updateFullNode(i.eventCache.getNode(),e,l)):(c=$n(o,xn(i)),r.filter.updateFullNode(i.eventCache.getNode(),c,l))}else{var c=et(s);if(".priority"===c){p(1===tt(s),"Can't have a priority with additional path components");var u=h.getNode();n=i.serverCache.getNode();var d=Jn(o,s,u,n);t=null!=d?r.filter.updatePriority(u,d):h.getNode()}else{u=nt(s);let e;e=h.isCompleteForChild(c)?(n=i.serverCache.getNode(),null!=(d=Jn(o,s,h.getNode(),n))?h.getNode().getImmediateChild(c).updateChild(u,d):h.getNode().getImmediateChild(c)):er(o,c,i.serverCache),t=null!=e?r.filter.updateChild(h.getNode(),c,e,u,a,l):h.getNode()}}return Nn(i,t,h.isFullyInitialized()||at(s),r.filter.filtersNodes())}}function lr(e,t,n,r,i,s,o,a){const l=t.serverCache;let h;const c=o?e.filter:e.filter.getIndexedFilter();if(at(n))h=c.updateFullNode(l.getNode(),r,null);else if(c.filtersNodes()&&!l.isFiltered()){var u=l.getNode().updateChild(n,r);h=c.updateFullNode(l.getNode(),u,null)}else{var d=et(n);if(!l.isCompleteForPath(n)&&1<tt(n))return t;var _=nt(n);const p=l.getNode().getImmediateChild(d);u=p.updateChild(_,r);h=".priority"===d?c.updatePriority(l.getNode(),u):c.updateChild(l.getNode(),d,u,_,ir,null)}_=Pn(t,h,l.isFullyInitialized()||at(n),c.filtersNodes());return ar(e,_,n,i,new sr(i,_,s),a)}function hr(t,n,r,i,e,s,o){const a=n.eventCache;let l,h;const c=new sr(e,n,s);if(at(r))h=t.filter.updateFullNode(n.eventCache.getNode(),i,o),l=Nn(n,h,!0,t.filter.filtersNodes());else{var u=et(r);if(".priority"===u)h=t.filter.updatePriority(n.eventCache.getNode(),i),l=Nn(n,h,a.isFullyInitialized(),a.isFiltered());else{var d=nt(r);const _=a.getNode().getImmediateChild(u);let e;if(at(d))e=i;else{const p=c.getCompleteChild(u);e=null!=p?".priority"===rt(d)&&p.getChild(st(d)).isEmpty()?p:p.updateChild(d,i):jt.EMPTY_NODE}l=_.equals(e)?n:Nn(n,t.filter.updateChild(a.getNode(),u,e,d,c,o),a.isFullyInitialized(),t.filter.filtersNodes())}}return l}function cr(e,t){return e.eventCache.isCompleteForChild(t)}function ur(e,n,t){return t.foreach((e,t)=>{n=n.updateChild(e,t)}),n}function dr(r,i,e,t,s,o,a,l){if(i.serverCache.getNode().isEmpty()&&!i.serverCache.isFullyInitialized())return i;let h=i,n;n=at(e)?t:new An(null).setTree(e,t);const c=i.serverCache.getNode();return n.children.inorderTraversal((e,t)=>{var n;c.hasChild(e)&&(n=ur(0,i.serverCache.getNode().getImmediateChild(e),t),h=lr(r,h,new Xe(e),n,s,o,a,l))}),n.children.inorderTraversal((e,t)=>{var n=!i.serverCache.isCompleteForChild(e)&&null===t.value;c.hasChild(e)||n||(n=ur(0,i.serverCache.getNode().getImmediateChild(e),t),h=lr(r,h,new Xe(e),n,s,o,a,l))}),h}class _r{constructor(e,t){this.query_=e,this.eventRegistrations_=[];const n=this.query_._queryParams,r=new Zt(n.getIndex()),i=(e=n).loadsAllData()?new Zt(e.getIndex()):new(e.hasLimit()?tn:en)(e);this.processor_={filter:i};const s=t.serverCache,o=t.eventCache;var a=r.updateFullNode(jt.EMPTY_NODE,s.getNode(),null),l=i.updateFullNode(jt.EMPTY_NODE,o.getNode(),null),a=new In(a,s.isFullyInitialized(),r.filtersNodes()),l=new In(l,o.isFullyInitialized(),i.filtersNodes());this.viewCache_=kn(l,a),this.eventGenerator_=new Tn(this.query_)}get query(){return this.query_}}function pr(e){return 0===e.eventRegistrations_.length}function fr(n,r,i){const s=[];if(i){p(null==r,"A cancel should cancel all event registrations.");const o=n.query._path;n.eventRegistrations_.forEach(e=>{var t=e.createCancelEvent(i,o);t&&s.push(t)})}if(r){let e=[];for(let t=0;t<n.eventRegistrations_.length;++t){const a=n.eventRegistrations_[t];if(a.matches(r)){if(r.hasAnyCallback()){e=e.concat(n.eventRegistrations_.slice(t+1));break}}else e.push(a)}n.eventRegistrations_=e}else n.eventRegistrations_=[];return s}function gr(e,t,n,r){t.type===K.MERGE&&null!==t.source.queryId&&(p(xn(e.viewCache_),"We should always have a full cache before handling merges"),p(Rn(e.viewCache_),"Missing event cache, even though we have a server cache"));const i=e.viewCache_,s=or(e.processor_,i,t,n,r);return n=e.processor_,r=s.viewCache,p(r.eventCache.getNode().isIndexed(n.filter.getIndex()),"Event snap not indexed"),p(r.serverCache.getNode().isIndexed(n.filter.getIndex()),"Server snap not indexed"),p(s.viewCache.serverCache.isFullyInitialized()||!i.serverCache.isFullyInitialized(),"Once a server snap is complete, it should never go back"),e.viewCache_=s.viewCache,mr(e,s.changes,s.viewCache.eventCache.getNode(),null)}function mr(e,t,n,r){var i=r?[r]:e.eventRegistrations_;return En(e.eventGenerator_,t,n,i)}let vr;class yr{constructor(){this.views=new Map}}function wr(t,n,r,i){var e=n.source.queryId;if(null!==e){e=t.views.get(e);return p(null!=e,"SyncTree gave us an op for an invalid query."),gr(e,n,r,i)}{let e=[];for(const s of t.views.values())e=e.concat(gr(s,n,r,i));return e}}function Cr(e,n,r,i,s){var o=n._queryIdentifier,o=e.views.get(o);if(o)return o;{let e=$n(r,s?i:null),t=!1;t=!!e||(e=i instanceof jt?Gn(r,i):jt.EMPTY_NODE,!1);o=kn(new In(e,t,!1),new In(i,s,!1));return new _r(n,o)}}function br(e,t,n,r,i,s){var o=Cr(e,t,r,i,s);return e.views.has(t._queryIdentifier)||e.views.set(t._queryIdentifier,o),o.eventRegistrations_.push(n),function(e,t){const n=e.viewCache_.eventCache,r=[];if(!n.getNode().isLeafNode()){const i=n.getNode();i.forEachChild(Ot,(e,t)=>{r.push(Gt(e,t))})}return n.isFullyInitialized()&&r.push($t(n.getNode())),mr(e,r,n.getNode(),t)}(o,n)}function Ir(e,t,n,r){var i=t._queryIdentifier;const s=[];let o=[];var a=Nr(e);if("default"===i)for(var[l,h]of e.views.entries())o=o.concat(fr(h,n,r)),pr(h)&&(e.views.delete(l),h.query._queryParams.loadsAllData()||s.push(h.query));else{const c=e.views.get(i);c&&(o=o.concat(fr(c,n,r)),pr(c)&&(e.views.delete(i),c.query._queryParams.loadsAllData()||s.push(c.query)))}return a&&!Nr(e)&&s.push((p(vr,"Reference.ts has not been loaded"),new vr(t._repo,t._path))),{removed:s,events:o}}function Tr(e){const t=[];for(const n of e.views.values())n.query._queryParams.loadsAllData()||t.push(n);return t}function Er(e,t){let n=null;for(const r of e.views.values())n=n||function(e,t){const n=xn(e.viewCache_);return n&&(e.query._queryParams.loadsAllData()||!at(t)&&!n.getImmediateChild(et(t)).isEmpty())?n.getChild(t):null}(r,t);return n}function Sr(e,t){const n=t._queryParams;if(n.loadsAllData())return Pr(e);var r=t._queryIdentifier;return e.views.get(r)}function kr(e,t){return null!=Sr(e,t)}function Nr(e){return null!=Pr(e)}function Pr(e){for(const t of e.views.values())if(t.query._queryParams.loadsAllData())return t;return null}let Rr;let xr=1;class Dr{constructor(e){this.listenProvider_=e,this.syncPointTree_=new An(null),this.pendingWriteTree_={visibleWrites:On.empty(),allWrites:[],lastWriteId:-1},this.tagToQueryMap=new Map,this.queryToTagMap=new Map}}function Ar(e,t,n,r,i){var s,o,a,l;return s=e.pendingWriteTree_,o=t,a=n,l=r,r=i,p(l>s.lastWriteId,"Stacking an older write on top of newer ones"),s.allWrites.push({path:o,snap:a,writeId:l,visible:r=void 0===r?!0:r}),r&&(s.visibleWrites=Ln(s.visibleWrites,o,a)),s.lastWriteId=l,i?jr(e,new Cn(gn(),t,n)):[]}function Or(e,t,n,r){var i,s,o;i=e.pendingWriteTree_,s=t,o=n,r=r,p(r>i.lastWriteId,"Stacking an older merge on top of newer ones"),i.allWrites.push({path:s,children:o,writeId:r,visible:!0}),i.visibleWrites=Mn(i.visibleWrites,s,o),i.lastWriteId=r;var a=An.fromObject(n);return jr(e,new bn(gn(),t,a))}function Lr(e,t,n=!1){var r=function(e,t){for(let r=0;r<e.allWrites.length;r++){var n=e.allWrites[r];if(n.writeId===t)return n}return null}(e.pendingWriteTree_,t);if(Hn(e.pendingWriteTree_,t)){let t=new An(null);return null!=r.snap?t=t.set(Ze(),!0):be(r.children,e=>{t=t.set(new Xe(e),!0)}),jr(e,new yn(r.path,t,n))}return[]}function Mr(e,t,n){return jr(e,new Cn(mn(),t,n))}function Fr(n,e,t,r,i=!1){var s=e._path,o=n.syncPointTree_.get(s);let a=[];if(o&&("default"===e._queryIdentifier||kr(o,e))){var l=Ir(o,e,t,r);0===o.views.size&&(n.syncPointTree_=n.syncPointTree_.remove(s));const d=l.removed;if(a=l.events,!i){o=-1!==d.findIndex(e=>e._queryParams.loadsAllData()),l=n.syncPointTree_.findOnPath(s,(e,t)=>Nr(t));if(o&&!l){const _=n.syncPointTree_.subtree(s);if(!_.isEmpty()){var h=_.fold((e,t,r)=>{if(t&&Nr(t))return[Pr(t)];{let n=[];return t&&(n=Tr(t)),be(r,(e,t)=>{n=n.concat(t)}),n}});for(let e=0;e<h.length;++e){var c=h[e],u=c.query,c=zr(n,c);n.listenProvider_.startListening(Gr(u),Hr(n,u),c.hashFn,c.onComplete)}}}!l&&0<d.length&&!r&&(o?n.listenProvider_.stopListening(Gr(e),null):d.forEach(e=>{var t=n.queryToTagMap.get(Qr(e));n.listenProvider_.stopListening(Gr(e),t)}))}!function(e,t){for(let i=0;i<t.length;++i){const s=t[i];var n,r;s._queryParams.loadsAllData()||(n=Qr(s),r=e.queryToTagMap.get(n),e.queryToTagMap.delete(n),e.tagToQueryMap.delete(r))}}(n,d)}return a}function qr(e,t,n,r){var i=Yr(e,r);if(null==i)return[];var s=Kr(i),o=s.path,i=s.queryId,s=lt(o,t);return $r(e,o,new Cn(vn(i),s,n))}function Wr(e,t,n,r=!1){const i=t._path;let s=null,o=!1;e.syncPointTree_.foreachOnPath(i,(e,t)=>{var n=lt(e,i);s=s||Er(t,n),o=o||Nr(t)});let a=e.syncPointTree_.get(i);a?(o=o||Nr(a),s=s||Er(a,Ze())):(a=new yr,e.syncPointTree_=e.syncPointTree_.set(i,a));let l;if(null!=s)l=!0;else{l=!1,s=jt.EMPTY_NODE;const _=e.syncPointTree_.subtree(i);_.foreachChild((e,t)=>{var n=Er(t,Ze());n&&(s=s.updateImmediateChild(e,n))})}var h,c=kr(a,t);c||t._queryParams.loadsAllData()||(u=Qr(t),p(!e.queryToTagMap.has(u),"View does not exist, but we have a tag"),h=xr++,e.queryToTagMap.set(u,h),e.tagToQueryMap.set(h,u));var u=zn(e.pendingWriteTree_,i);let d=br(a,t,n,u,s,l);return c||o||r||(c=Sr(a,t),d=d.concat(function(t,e,n){const r=e._path,i=Hr(t,e),s=zr(t,n),o=t.listenProvider_.startListening(Gr(e),i,s.hashFn,s.onComplete),a=t.syncPointTree_.subtree(r);if(i)p(!Nr(a.value),"If we're adding a query, it shouldn't be shadowed");else{var l=a.fold((e,t,r)=>{if(!at(e)&&t&&Nr(t))return[Pr(t).query];{let n=[];return t&&(n=n.concat(Tr(t).map(e=>e.query))),be(r,(e,t)=>{n=n.concat(t)}),n}});for(let e=0;e<l.length;++e){var h=l[e];t.listenProvider_.stopListening(Gr(h),Hr(t,h))}}return o}(e,t,c))),d}function Ur(e,r,t){var n=e.pendingWriteTree_,i=e.syncPointTree_.findOnPath(r,(e,t)=>{var n=Er(t,lt(e,r));if(n)return n});return Kn(n,r,i,t,!0)}function Br(e,t){const r=t._path;let i=null;e.syncPointTree_.foreachOnPath(r,(e,t)=>{var n=lt(e,r);i=i||Er(t,n)});let n=e.syncPointTree_.get(r);n?i=i||Er(n,Ze()):(n=new yr,e.syncPointTree_=e.syncPointTree_.set(r,n));var s=null!=i;const o=s?new In(i,!0,!1):null;var a=zn(e.pendingWriteTree_,t._path);return Rn(Cr(n,t,a,s?o.getNode():jt.EMPTY_NODE,s).viewCache_)}function jr(e,t){return function t(n,r,i,s){{if(at(n.path))return Vr(n,r,i,s);{const o=r.get(Ze());null==i&&null!=o&&(i=Er(o,Ze()));let e=[];const a=et(n.path),l=n.operationForChild(a),h=r.children.get(a);if(h&&l){const c=i?i.getImmediateChild(a):null,u=tr(s,a);e=e.concat(t(l,h,c,u))}return o&&(e=e.concat(wr(o,n,s,i))),e}}}(t,e.syncPointTree_,null,zn(e.pendingWriteTree_,Ze()))}function Vr(s,e,o,a){var t=e.get(Ze());null==o&&null!=t&&(o=Er(t,Ze()));let l=[];return e.children.inorderTraversal((e,t)=>{var n=o?o.getImmediateChild(e):null,r=tr(a,e),i=s.operationForChild(e);i&&(l=l.concat(Vr(i,t,n,r)))}),t&&(l=l.concat(wr(t,s,a,o))),l}function zr(i,t){const s=t.query,o=Hr(i,s);return{hashFn:()=>{const e=t.viewCache_.serverCache.getNode()||jt.EMPTY_NODE;return e.hash()},onComplete:e=>{if("ok"===e)return o?function(e,t,n){if(s=Yr(e,n)){var r=Kr(s),i=r.path,s=r.queryId,r=lt(i,t);return $r(e,i,new wn(vn(s),r))}return[]}(i,s._path,o):(t=i,n=s._path,jr(t,new wn(mn(),n)));var t,n,r=function(e,t){let n="Unknown Error";"too_big"===e?n="The data requested exceeds the maximum size that can be accessed with a single request.":"permission_denied"===e?n="Client doesn't have permission to access the desired data.":"unavailable"===e&&(n="The service is unavailable");const r=new Error(e+" at "+t._path.toString()+": "+n);return r.code=e.toUpperCase(),r}(e,s);return Fr(i,s,null,r)}}}function Hr(e,t){var n=Qr(t);return e.queryToTagMap.get(n)}function Qr(e){return e._path.toString()+"$"+e._queryIdentifier}function Yr(e,t){return e.tagToQueryMap.get(t)}function Kr(e){var t=e.indexOf("$");return p(-1!==t&&t<e.length-1,"Bad queryKey."),{queryId:e.substr(t+1),path:new Xe(e.substr(0,t))}}function $r(e,t,n){var r=e.syncPointTree_.get(t);return p(r,"Missing sync point for query tag that we're tracking"),wr(r,n,zn(e.pendingWriteTree_,t),null)}function Gr(e){return e._queryParams.loadsAllData()&&!e._queryParams.isDefault()?(p(Rr,"Reference.ts has not been loaded"),new Rr(e._repo,e._path)):e}class Jr{constructor(e){this.node_=e}getImmediateChild(e){var t=this.node_.getImmediateChild(e);return new Jr(t)}node(){return this.node_}}class Xr{constructor(e,t){this.syncTree_=e,this.path_=t}getImmediateChild(e){var t=ot(this.path_,e);return new Xr(this.syncTree_,t)}node(){return Ur(this.syncTree_,this.path_)}}function Zr(e){return(e=e||{}).timestamp=e.timestamp||(new Date).getTime(),e}function ei(e,t,n){return e&&"object"==typeof e?(p(".sv"in e,"Unexpected leaf node or priority contents"),"string"==typeof e[".sv"]?ti(e[".sv"],t,n):"object"==typeof e[".sv"]?ni(e[".sv"],t):void p(!1,"Unexpected server value: "+JSON.stringify(e,null,2))):e}const ti=function(e,t,n){if("timestamp"===e)return n.timestamp;p(!1,"Unexpected server value: "+e)},ni=function(e,t,n){e.hasOwnProperty("increment")||p(!1,"Unexpected server value: "+JSON.stringify(e,null,2));var r=e.increment;"number"!=typeof r&&p(!1,"Unexpected increment value: "+r);const i=t.node();if(p(null!==i&&void 0!==i,"Expected ChildrenNode.EMPTY_NODE for nulls"),!i.isLeafNode())return r;const s=i;var o=s.getValue();return"number"!=typeof o?r:o+r},ri=function(e,t,n,r){return si(t,new Xr(n,e),r)},ii=function(e,t,n){return si(e,new Jr(t),n)};function si(e,r,i){var t=e.getPriority().val(),n=ei(t,r.getImmediateChild(".priority"),i);let s;if(e.isLeafNode()){const o=e;t=ei(o.getValue(),r,i);return t!==o.getValue()||n!==o.getPriority().val()?new xt(t,Qt(n)):e}{const a=e;return s=a,n!==a.getPriority().val()&&(s=s.updatePriority(new xt(n))),a.forEachChild(Ot,(e,t)=>{var n=si(t,r.getImmediateChild(e),i);n!==t&&(s=s.updateImmediateChild(e,n))}),s}}class oi{constructor(e="",t=null,n={children:{},childCount:0}){this.name=e,this.parent=t,this.node=n}}function ai(e,t){let n=t instanceof Xe?t:new Xe(t),r=e,i=et(n);for(;null!==i;){var s=C(r.node.children,i)||{children:{},childCount:0};r=new oi(i,r,s),n=nt(n),i=et(n)}return r}function li(e){return e.node.value}function hi(e,t){e.node.value=t,_i(e)}function ci(e){return 0<e.node.childCount}function ui(n,r){be(n.node.children,(e,t)=>{r(new oi(e,n,t))})}function di(e){return new Xe(null===e.parent?e.name:di(e.parent)+"/"+e.name)}function _i(e){var t,n,r,i;null!==e.parent&&(t=e.parent,n=e.name,r=function(e){return void 0===li(e)&&!ci(e)}(e=e),i=w(t.node.children,n),r&&i?(delete t.node.children[n],t.node.childCount--,_i(t)):r||i||(t.node.children[n]=e.node,t.node.childCount++,_i(t)))}function pi(e,t,n,r){r&&void 0===t||ki(S(e,"value"),t,n)}function fi(e,t,r,n){if(!n||void 0!==t){const i=S(e,"values");if(!t||"object"!=typeof t||Array.isArray(t))throw new Error(i+" must be an object containing the children to replace.");const s=[];be(t,(e,t)=>{const n=new Xe(e);if(ki(i,t,ot(r,n)),".priority"===rt(n)&&!Si(t))throw new Error(i+"contains an invalid value for '"+n.toString()+"', which must be a valid Firebase priority (a string, finite number, server value, or null).");s.push(n)}),function(t,n){let r,i;for(r=0;r<n.length;r++){i=n[r];var s=it(i);for(let e=0;e<s.length;e++)if((".priority"!==s[e]||e!==s.length-1)&&!Ii(s[e]))throw new Error(t+"contains an invalid key ("+s[e]+") in path "+i.toString()+'. Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"')}n.sort(ht);let e=null;for(r=0;r<n.length;r++){if(i=n[r],null!==e&&ut(e,i))throw new Error(t+"contains a path "+e.toString()+" that is ancestor of another path "+i.toString());e=i}}(i,s)}}function gi(e,t,n){if(!n||void 0!==t){if(ve(t))throw new Error(S(e,"priority")+"is "+t.toString()+", but must be a valid Firebase priority (a string, finite number, server value, or null).");if(!Si(t))throw new Error(S(e,"priority")+"must be a valid Firebase priority (a string, finite number, server value, or null).")}}function mi(e,t,n,r){if(!(r&&void 0===n||Ii(n)))throw new Error(S(e,t)+'was an invalid key = "'+n+'".  Firebase keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]").')}function vi(e,t,n,r){n=n&&n.replace(/^\/*\.info(\/|$)/,"/"),Ni(e,t,n,r)}function yi(e,t){if(".info"===et(t))throw new Error(e+" failed = Can't modify data under /.info/")}const wi=/[\[\].#$\/\u0000-\u001F\u007F]/,Ci=/[\[\].#$\u0000-\u001F\u007F]/,bi=10485760,Ii=function(e){return"string"==typeof e&&0!==e.length&&!wi.test(e)},Ti=function(e){return"string"==typeof e&&0!==e.length&&!Ci.test(e)},Ei=function(e){return e=e&&e.replace(/^\/*\.info(\/|$)/,"/"),Ti(e)},Si=function(e){return null===e||"string"==typeof e||"number"==typeof e&&!ve(e)||e&&"object"==typeof e&&w(e,".sv")},ki=function(o,e,t){const a=t instanceof Xe?new dt(t,o):t;if(void 0===e)throw new Error(o+"contains undefined "+pt(a));if("function"==typeof e)throw new Error(o+"contains a function "+pt(a)+" with contents = "+e.toString());if(ve(e))throw new Error(o+"contains "+e.toString()+" "+pt(a));if("string"==typeof e&&e.length>bi/3&&P(e)>bi)throw new Error(o+"contains a string greater than "+bi+" utf8 bytes "+pt(a)+" ('"+e.substring(0,50)+"...')");if(e&&"object"==typeof e){let i=!1,s=!1;if(be(e,(e,t)=>{if(".value"===e)i=!0;else if(".priority"!==e&&".sv"!==e&&(s=!0,!Ii(e)))throw new Error(o+" contains an invalid key ("+e+") "+pt(a)+'.  Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"');var n,r;n=a,e=e,0<n.parts_.length&&(n.byteLength_+=1),n.parts_.push(e),n.byteLength_+=P(e),_t(n),ki(o,t,a),t=a,r=t.parts_.pop(),t.byteLength_-=P(r),0<t.parts_.length&&--t.byteLength_}),i&&s)throw new Error(o+' contains ".value" child '+pt(a)+" in addition to actual children.")}},Ni=function(e,t,n,r){if(!(r&&void 0===n||Ti(n)))throw new Error(S(e,t)+'was an invalid path = "'+n+'". Paths must be non-empty strings and can\'t contain ".", "#", "$", "[", or "]"')},Pi=function(e,t){var n=t.path.toString();if("string"!=typeof t.repoInfo.host||0===t.repoInfo.host.length||!Ii(t.repoInfo.namespace)&&"localhost"!==t.repoInfo.host.split(":")[0]||0!==n.length&&!Ei(n))throw new Error(S(e,"url")+'must be a valid firebase URL and the path can\'t contain ".", "#", "$", "[", or "]".')};class Ri{constructor(){this.eventLists_=[],this.recursionDepth_=0}}function xi(e,t){let n=null;for(let i=0;i<t.length;i++){const s=t[i];var r=s.getPath();null===n||ct(r,n.path)||(e.eventLists_.push(n),n=null),null===n&&(n={events:[],path:r}),n.events.push(s)}n&&e.eventLists_.push(n)}function Di(e,t,n){xi(e,n),Oi(e,e=>ct(e,t))}function Ai(e,t,n){xi(e,n),Oi(e,e=>ut(e,t)||ut(t,e))}function Oi(e,t){e.recursionDepth_++;let n=!0;for(let i=0;i<e.eventLists_.length;i++){var r=e.eventLists_[i];r&&(t(r.path)?(function(e){for(let n=0;n<e.events.length;n++){const r=e.events[n];var t;null!==r&&(e.events[n]=null,t=r.getEventRunner(),se&&pe("event: "+r.toString()),Pe(t))}}(e.eventLists_[i]),e.eventLists_[i]=null):n=!1)}n&&(e.eventLists_=[]),e.recursionDepth_--}const Li="repo_interrupt",Mi=25;class Fi{constructor(e,t,n,r){this.repoInfo_=e,this.forceRestClient_=t,this.authTokenProvider_=n,this.appCheckProvider_=r,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new Ri,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=un(),this.transactionQueueTree_=new oi,this.persistentConnection_=null,this.key=this.repoInfo_.toURLString()}toString(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host}}function qi(o,e,t){if(o.stats_=Be(o.repoInfo_),o.forceRestClient_||function(){const e="object"==typeof window&&window.navigator&&window.navigator.userAgent||"";return 0<=e.search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)}())o.server_=new hn(o.repoInfo_,(e,t,n,r)=>{Bi(o,e,t,n,r)},o.authTokenProvider_,o.appCheckProvider_),setTimeout(()=>ji(o,!0),0);else{if(null!=t){if("object"!=typeof t)throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{v(t)}catch(e){throw new Error("Invalid authOverride provided: "+e)}}o.persistentConnection_=new gt(o.repoInfo_,e,(e,t,n,r)=>{Bi(o,e,t,n,r)},e=>{ji(o,e)},e=>{var n;n=o,be(e,(e,t)=>{Vi(n,e,t)})},o.authTokenProvider_,o.appCheckProvider_,t),o.server_=o.persistentConnection_}var n;o.authTokenProvider_.addTokenChangeListener(e=>{o.server_.refreshAuthToken(e)}),o.appCheckProvider_.addTokenChangeListener(e=>{o.server_.refreshAppCheckToken(e.token)}),o.statsReporter_=(e=o.repoInfo_,t=()=>new fn(o.stats_,o.server_),n=e.toString(),Ue[n]||(Ue[n]=t()),Ue[n]),o.infoData_=new cn,o.infoSyncTree_=new Dr({startListening:(e,t,n,r)=>{let i=[];const s=o.infoData_.getNode(e._path);return s.isEmpty()||(i=Mr(o.infoSyncTree_,e._path,s),setTimeout(()=>{r("ok")},0)),i},stopListening:()=>{}}),Vi(o,"connected",!1),o.serverSyncTree_=new Dr({startListening:(r,e,t,i)=>(o.server_.listen(r,t,e,(e,t)=>{var n=i(e,t);Ai(o.eventQueue_,r._path,n)}),[]),stopListening:(e,t)=>{o.server_.unlisten(e,t)}})}function Wi(e){const t=e.infoData_.getNode(new Xe(".info/serverTimeOffset"));var n=t.val()||0;return(new Date).getTime()+n}function Ui(e){return Zr({timestamp:Wi(e)})}function Bi(e,t,n,r,i){e.dataUpdateCount++;var s,o,a=new Xe(t);n=e.interceptServerDataCallback_?e.interceptServerDataCallback_(t,n):n;let l=[];l=i?r?(s=I(n,e=>Qt(e)),function(e,t,n,r){if(a=Yr(e,r)){var i=Kr(a),s=i.path,o=i.queryId,a=lt(s,t),i=An.fromObject(n);return $r(e,s,new bn(vn(o),a,i))}return[]}(e.serverSyncTree_,a,s,i)):(s=Qt(n),qr(e.serverSyncTree_,a,s,i)):r?(o=I(n,e=>Qt(e)),t=e.serverSyncTree_,i=a,r=o,o=An.fromObject(r),jr(t,new bn(mn(),i,o))):(o=Qt(n),Mr(e.serverSyncTree_,a,o));let h=a;0<l.length&&(h=es(e,a)),Ai(e.eventQueue_,h,l)}function ji(e,t){Vi(e,"connected",t),!1===t&&function(r){Gi(r,"onDisconnectEvents");const i=Ui(r),s=un();_n(r.onDisconnect_,Ze(),(e,t)=>{var n=ri(e,t,r.serverSyncTree_,i);dn(s,e,n)});let o=[];_n(s,Ze(),(e,t)=>{o=o.concat(Mr(r.serverSyncTree_,e,t));var n=is(r,e);es(r,n)}),r.onDisconnect_=un(),Ai(r.eventQueue_,Ze(),o)}(e)}function Vi(e,t,n){var r=new Xe("/.info/"+t),i=Qt(n);e.infoData_.updateSnapshot(r,i);i=Mr(e.infoSyncTree_,r,i);Ai(e.eventQueue_,r,i)}function zi(e){return e.nextWriteId_++}function Hi(r,i,e,t,s){Gi(r,"set",{path:i.toString(),value:e,priority:t});var n=Ui(r);const o=Qt(e,t);var a=Ur(r.serverSyncTree_,i),n=ii(o,a,n);const l=zi(r);n=Ar(r.serverSyncTree_,i,n,l,!0);xi(r.eventQueue_,n),r.server_.put(i.toString(),o.val(!0),(e,t)=>{var n="ok"===e;n||ge("set at "+i+" failed: "+e);n=Lr(r.serverSyncTree_,l,!n);Ai(r.eventQueue_,i,n),Ji(0,s,e,t)});n=is(r,i);es(r,n),Ai(r.eventQueue_,n,[])}function Qi(n,r,i){n.server_.onDisconnectCancel(r.toString(),(e,t)=>{"ok"===e&&!function e(n,t){if(at(t))return n.value=null,n.children.clear(),!0;if(null!==n.value){if(n.value.isLeafNode())return!1;{const i=n.value;return n.value=null,i.forEachChild(Ot,(e,t)=>{dn(n,new Xe(e),t)}),e(n,t)}}if(0<n.children.size){var r=et(t);return t=nt(t),n.children.has(r)&&e(n.children.get(r),t)&&n.children.delete(r),0===n.children.size}return!0}(n.onDisconnect_,r),Ji(0,i,e,t)})}function Yi(n,r,e,i){const s=Qt(e);n.server_.onDisconnectPut(r.toString(),s.val(!0),(e,t)=>{"ok"===e&&dn(n.onDisconnect_,r,s),Ji(0,i,e,t)})}function Ki(e,t,n){let r;r=".info"===et(t._path)?Fr(e.infoSyncTree_,t,n):Fr(e.serverSyncTree_,t,n),Di(e.eventQueue_,t._path,r)}function $i(e){e.persistentConnection_&&e.persistentConnection_.interrupt(Li)}function Gi(e,...t){let n="";e.persistentConnection_&&(n=e.persistentConnection_.id+":"),pe(n,...t)}function Ji(e,r,i,s){r&&Pe(()=>{if("ok"===i)r(null);else{var t=(i||"error").toUpperCase();let e=t;s&&(e+=": "+s);const n=new Error(e);n.code=t,r(n)}})}function Xi(e,t,n){return Ur(e.serverSyncTree_,t,n)||jt.EMPTY_NODE}function Zi(t,e=t.transactionQueueTree_){if(e||rs(t,e),li(e)){const n=ns(t,e);p(0<n.length,"Sending zero length transaction queue"),n.every(e=>0===e.status)&&function(i,s,o){const e=o.map(e=>e.currentWriteId),t=Xi(i,s,e);let n=t;var r=t.hash();for(let c=0;c<o.length;c++){const u=o[c];p(0===u.status,"tryToSendTransactionQueue_: items in queue should all be run."),u.status=1,u.retryCount++;var a=lt(s,u.path);n=n.updateChild(a,u.currentOutputSnapshotRaw)}const l=n.val(!0),h=s;i.server_.put(h.toString(),l,t=>{Gi(i,"transaction put response",{path:h.toString(),status:t});let n=[];if("ok"===t){const r=[];for(let e=0;e<o.length;e++)o[e].status=2,n=n.concat(Lr(i.serverSyncTree_,o[e].currentWriteId)),o[e].onComplete&&r.push(()=>o[e].onComplete(null,!0,o[e].currentOutputSnapshotResolved)),o[e].unwatcher();rs(i,ai(i.transactionQueueTree_,s)),Zi(i,i.transactionQueueTree_),Ai(i.eventQueue_,s,n);for(let t=0;t<r.length;t++)Pe(r[t])}else{if("datastale"===t)for(let e=0;e<o.length;e++)3===o[e].status?o[e].status=4:o[e].status=0;else{ge("transaction at "+h.toString()+" failed: "+t);for(let e=0;e<o.length;e++)o[e].status=4,o[e].abortReason=t}es(i,s)}},r)}(t,di(e),n)}else ci(e)&&ui(e,e=>{Zi(t,e)})}function es(e,t){var n=ts(e,t),r=di(n);return function(i,s,o){if(0!==s.length){const h=[];let n=[];const t=s.filter(e=>0===e.status),c=t.map(e=>e.currentWriteId);for(let r=0;r<s.length;r++){const u=s[r];var a=lt(o,u.path);let e=!1,t;if(p(null!==a,"rerunTransactionsUnderNode_: relativePath should not be null."),4===u.status)e=!0,t=u.abortReason,n=n.concat(Lr(i.serverSyncTree_,u.currentWriteId,!0));else if(0===u.status)if(u.retryCount>=Mi)e=!0,t="maxretry",n=n.concat(Lr(i.serverSyncTree_,u.currentWriteId,!0));else{const d=Xi(i,u.path,c);u.currentInputSnapshot=d;var l=s[r].update(d.val());if(void 0!==l){ki("transaction failed: Data returned ",l,u.path);let e=Qt(l);"object"==typeof l&&null!=l&&w(l,".priority")||(e=e.updatePriority(d.getPriority()));a=u.currentWriteId,l=Ui(i),l=ii(e,d,l);u.currentOutputSnapshotRaw=e,u.currentOutputSnapshotResolved=l,u.currentWriteId=zi(i),c.splice(c.indexOf(a),1),n=n.concat(Ar(i.serverSyncTree_,u.path,l,u.currentWriteId,u.applyLocally)),n=n.concat(Lr(i.serverSyncTree_,a,!0))}else e=!0,t="nodata",n=n.concat(Lr(i.serverSyncTree_,u.currentWriteId,!0))}Ai(i.eventQueue_,o,n),n=[],e&&(s[r].status=2,function(e){setTimeout(e,Math.floor(0))}(s[r].unwatcher),s[r].onComplete&&("nodata"===t?h.push(()=>s[r].onComplete(null,!1,s[r].currentInputSnapshot)):h.push(()=>s[r].onComplete(new Error(t),!1,null))))}rs(i,i.transactionQueueTree_);for(let e=0;e<h.length;e++)Pe(h[e]);Zi(i,i.transactionQueueTree_)}}(e,ns(e,n),r),r}function ts(e,t){let n,r=e.transactionQueueTree_;for(n=et(t);null!==n&&void 0===li(r);)r=ai(r,n),t=nt(t),n=et(t);return r}function ns(e,t){const n=[];return function t(n,e,r){const i=li(e);if(i)for(let e=0;e<i.length;e++)r.push(i[e]);ui(e,e=>{t(n,e,r)})}(e,t,n),n.sort((e,t)=>e.order-t.order),n}function rs(t,n){const r=li(n);if(r){let e=0;for(let t=0;t<r.length;t++)2!==r[t].status&&(r[e]=r[t],e++);r.length=e,hi(n,0<r.length?r:void 0)}ui(n,e=>{rs(t,e)})}function is(t,e){var n=di(ts(t,e)),r=ai(t.transactionQueueTree_,e);return function(e,t,n){let r=n?e:e.parent;for(;null!==r;){if(t(r))return;r=r.parent}}(r,e=>{ss(t,e)}),ss(t,r),function t(e,n,r,i){r&&!i&&n(e),ui(e,e=>{t(e,n,!0,i)}),r&&i&&n(e)}(r,e=>{ss(t,e)}),n}function ss(i,s){const o=li(s);if(o){const a=[];let e=[],t=-1;for(let n=0;n<o.length;n++)3===o[n].status||(1===o[n].status?(p(t===n-1,"All SENT items should be at beginning of queue."),t=n,o[n].status=3,o[n].abortReason="set"):(p(0===o[n].status,"Unexpected transaction status in abort"),o[n].unwatcher(),e=e.concat(Lr(i.serverSyncTree_,o[n].currentWriteId,!0)),o[n].onComplete&&a.push(o[n].onComplete.bind(null,new Error("set"),!1,null))));-1===t?hi(s,void 0):o.length=t+1,Ai(i.eventQueue_,di(s),e);for(let r=0;r<a.length;r++)Pe(a[r])}}const os=function(e,t){var n=as(e),r=n.namespace;"firebase.com"===n.domain&&fe(n.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),r&&"undefined"!==r||"localhost"===n.domain||fe("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),n.secure||me();var i="ws"===n.scheme||"wss"===n.scheme;return{repoInfo:new Me(n.host,n.secure,r,i,t,"",r!==n.subdomain),path:new Xe(n.pathString)}},as=function(r){let i="",s="",o="",a="",l="",h=!0,c="https",u=443;if("string"==typeof r){let e=r.indexOf("//");0<=e&&(c=r.substring(0,e-1),r=r.substring(e+2));let t=r.indexOf("/");-1===t&&(t=r.length);let n=r.indexOf("?");-1===n&&(n=r.length),i=r.substring(0,Math.min(t,n)),t<n&&(a=function(e){let t="";var n=e.split("/");for(let r=0;r<n.length;r++)if(0<n[r].length){let e=n[r];try{e=decodeURIComponent(e.replace(/\+/g," "))}catch(e){}t+="/"+e}return t}(r.substring(t,n)));var d,_=function(e){const t={};for(const r of(e="?"===e.charAt(0)?e.substring(1):e).split("&")){var n;0!==r.length&&(2===(n=r.split("=")).length?t[decodeURIComponent(n[0])]=decodeURIComponent(n[1]):ge(`Invalid query segment '${r}' in query '${e}'`))}return t}(r.substring(Math.min(r.length,n)));e=i.indexOf(":"),0<=e?(h="https"===c||"wss"===c,u=parseInt(i.substring(e+1),10)):e=i.length;const p=i.slice(0,e);"localhost"===p.toLowerCase()?s="localhost":p.split(".").length<=2?s=p:(d=i.indexOf("."),o=i.substring(0,d).toLowerCase(),s=i.substring(d+1),l=o),"ns"in _&&(l=_.ns)}return{host:i,port:u,domain:s,subdomain:o,secure:h,scheme:c,pathString:a,namespace:l}},ls="-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz",hs=function(){let s=0;const o=[];return function(e){var t=e===s;s=e;let n;const r=new Array(8);for(n=7;0<=n;n--)r[n]=ls.charAt(e%64),e=Math.floor(e/64);p(0===e,"Cannot push at time == 0");let i=r.join("");if(t){for(n=11;0<=n&&63===o[n];n--)o[n]=0;o[n]++}else for(n=0;n<12;n++)o[n]=Math.floor(64*Math.random());for(n=0;n<12;n++)i+=ls.charAt(o[n]);return p(20===i.length,"nextPushId: Length should be 20."),i}}();class cs{constructor(e,t,n,r){this.eventType=e,this.eventRegistration=t,this.snapshot=n,this.prevName=r}getPath(){var e=this.snapshot.ref;return("value"===this.eventType?e:e.parent)._path}getEventType(){return this.eventType}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.getPath().toString()+":"+this.eventType+":"+v(this.snapshot.exportVal())}}class us{constructor(e,t,n){this.eventRegistration=e,this.error=t,this.path=n}getPath(){return this.path}getEventType(){return"cancel"}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.path.toString()+":cancel"}}class ds{constructor(e,t){this.snapshotCallback=e,this.cancelCallback=t}onValue(e,t){this.snapshotCallback.call(null,e,t)}onCancel(e){return p(this.hasCancelCallback,"Raising a cancel event on a listener with no cancel callback"),this.cancelCallback.call(null,e)}get hasCancelCallback(){return!!this.cancelCallback}matches(e){return this.snapshotCallback===e.snapshotCallback||void 0!==this.snapshotCallback.userCallback&&this.snapshotCallback.userCallback===e.snapshotCallback.userCallback&&this.snapshotCallback.context===e.snapshotCallback.context}}class _s{constructor(e,t){this._repo=e,this._path=t}cancel(){const e=new _;return Qi(this._repo,this._path,e.wrapCallback(()=>{})),e.promise}remove(){yi("OnDisconnect.remove",this._path);const e=new _;return Yi(this._repo,this._path,null,e.wrapCallback(()=>{})),e.promise}set(e){yi("OnDisconnect.set",this._path),pi("OnDisconnect.set",e,this._path,!1);const t=new _;return Yi(this._repo,this._path,e,t.wrapCallback(()=>{})),t.promise}setWithPriority(e,t){yi("OnDisconnect.setWithPriority",this._path),pi("OnDisconnect.setWithPriority",e,this._path,!1),gi("OnDisconnect.setWithPriority",t,!1);const n=new _;return function(n,r,e,t,i){const s=Qt(e,t);n.server_.onDisconnectPut(r.toString(),s.val(!0),(e,t)=>{"ok"===e&&dn(n.onDisconnect_,r,s),Ji(0,i,e,t)})}(this._repo,this._path,e,t,n.wrapCallback(()=>{})),n.promise}update(e){yi("OnDisconnect.update",this._path),fi("OnDisconnect.update",e,this._path,!1);const t=new _;return function(r,i,n,s){if(b(n))return pe("onDisconnect().update() called with empty data.  Don't do anything."),Ji(0,s,"ok",void 0);r.server_.onDisconnectMerge(i.toString(),n,(e,t)=>{"ok"===e&&be(n,(e,t)=>{var n=Qt(t);dn(r.onDisconnect_,ot(i,e),n)}),Ji(0,s,e,t)})}(this._repo,this._path,e,t.wrapCallback(()=>{})),t.promise}}class ps{constructor(e,t,n,r){this._repo=e,this._path=t,this._queryParams=n,this._orderByCalled=r}get key(){return at(this._path)?null:rt(this._path)}get ref(){return new vs(this._repo,this._path)}get _queryIdentifier(){var e=ln(this._queryParams),e=ue(e);return"{}"===e?"default":e}get _queryObject(){return ln(this._queryParams)}isEqual(e){if(!((e=R(e))instanceof ps))return!1;var t=this._repo===e._repo,n=ct(this._path,e._path),r=this._queryIdentifier===e._queryIdentifier;return t&&n&&r}toJSON(){return this.toString()}toString(){return this._repo.toString()+function(e){let t="";for(let n=e.pieceNum_;n<e.pieces_.length;n++)""!==e.pieces_[n]&&(t+="/"+encodeURIComponent(String(e.pieces_[n])));return t||"/"}(this._path)}}function fs(e,t){if(!0===e._orderByCalled)throw new Error(t+": You can't combine multiple orderBy calls.")}function gs(e){let t=null,n=null;if(e.hasStart()&&(t=e.getIndexStartValue()),e.hasEnd()&&(n=e.getIndexEndValue()),e.getIndex()===Ct){var r="Query: When ordering by key, you may only pass one argument to startAt(), endAt(), or equalTo().",i="Query: When ordering by key, the argument passed to startAt(), startAfter(), endAt(), endBefore(), or equalTo() must be a string.";if(e.hasStart()){if(e.getIndexStartName()!==ye)throw new Error(r);if("string"!=typeof t)throw new Error(i)}if(e.hasEnd()){if(e.getIndexEndName()!==we)throw new Error(r);if("string"!=typeof n)throw new Error(i)}}else if(e.getIndex()===Ot){if(null!=t&&!Si(t)||null!=n&&!Si(n))throw new Error("Query: When ordering by priority, the first argument passed to startAt(), startAfter() endAt(), endBefore(), or equalTo() must be a valid priority value (null, a number, or a string).")}else if(p(e.getIndex()instanceof Yt||e.getIndex()===Kt,"unknown index type."),null!=t&&"object"==typeof t||null!=n&&"object"==typeof n)throw new Error("Query: First argument passed to startAt(), startAfter(), endAt(), endBefore(), or equalTo() cannot be an object.")}function ms(e){if(e.hasStart()&&e.hasEnd()&&e.hasLimit()&&!e.hasAnchoredLimit())throw new Error("Query: Can't combine startAt(), startAfter(), endAt(), endBefore(), and limit(). Use limitToFirst() or limitToLast() instead.")}class vs extends ps{constructor(e,t){super(e,t,new nn,!1)}get parent(){var e=st(this._path);return null===e?null:new vs(this._repo,e)}get root(){let e=this;for(;null!==e.parent;)e=e.parent;return e}}class ys{constructor(e,t,n){this._node=e,this.ref=t,this._index=n}get priority(){return this._node.getPriority().val()}get key(){return this.ref.key}get size(){return this._node.numChildren()}child(e){var t=new Xe(e),n=bs(this.ref,e);return new ys(this._node.getChild(t),n,Ot)}exists(){return!this._node.isEmpty()}exportVal(){return this._node.val(!0)}forEach(n){if(this._node.isLeafNode())return!1;const e=this._node;return!!e.forEachChild(this._index,(e,t)=>n(new ys(t,bs(this.ref,e),Ot)))}hasChild(e){var t=new Xe(e);return!this._node.getChild(t).isEmpty()}hasChildren(){return!this._node.isLeafNode()&&!this._node.isEmpty()}toJSON(){return this.exportVal()}val(){return this._node.val()}}function ws(e,t){return(e=R(e))._checkNotDeleted("ref"),void 0!==t?bs(e._root,t):e._root}function Cs(e,t){(e=R(e))._checkNotDeleted("refFromURL");const n=os(t,e._repo.repoInfo_.nodeAdmin);Pi("refFromURL",n);var r=n.repoInfo;return e._repo.repoInfo_.isCustomHost()||r.host===e._repo.repoInfo_.host||fe("refFromURL: Host name does not match the current database: (found "+r.host+" but expected "+e._repo.repoInfo_.host+")"),ws(e,n.path.toString())}function bs(e,t){return(null===et((e=R(e))._path)?vi:Ni)("child","path",t,!1),new vs(e._repo,ot(e._path,t))}function Is(e,t){e=R(e),yi("set",e._path),pi("set",t,e._path,!1);const n=new _;return Hi(e._repo,e._path,t,null,n.wrapCallback(()=>{})),n.promise}function Ts(e,t){fi("update",t,e._path,!1);const n=new _;return function(i,s,e,o){Gi(i,"update",{path:s.toString(),value:e});let n=!0;const r=Ui(i),a={};if(be(e,(e,t)=>{n=!1,a[e]=ri(ot(s,e),Qt(t),i.serverSyncTree_,r)}),n)pe("update() called with empty data.  Don't do anything."),Ji(0,o,"ok",void 0);else{const l=zi(i);var t=Or(i.serverSyncTree_,s,a,l);xi(i.eventQueue_,t),i.server_.merge(s.toString(),e,(e,t)=>{var n="ok"===e;n||ge("update at "+s+" failed: "+e);var r=Lr(i.serverSyncTree_,l,!n),n=0<r.length?es(i,s):s;Ai(i.eventQueue_,n,r),Ji(0,o,e,t)}),be(e,e=>{var t=is(i,ot(s,e));es(i,t)}),Ai(i.eventQueue_,s,[])}}(e._repo,e._path,t,n.wrapCallback(()=>{})),n.promise}function Es(t){t=R(t);var i,s,o,e=new ds(()=>{}),e=new Ss(e);return i=t._repo,s=t,o=e,(null!=(e=Br(i.serverSyncTree_,s))?Promise.resolve(e):i.server_.get(s).then(e=>{var t,n=Qt(e).withIndex(s._queryParams.getIndex());Wr(i.serverSyncTree_,s,o,!0);let r;return r=s._queryParams.loadsAllData()?Mr(i.serverSyncTree_,s._path,n):(t=Hr(i.serverSyncTree_,s),qr(i.serverSyncTree_,s._path,n,t)),Ai(i.eventQueue_,s._path,r),Fr(i.serverSyncTree_,s,o,null,!0),n},e=>(Gi(i,"get for query "+v(s)+" failed: "+e),Promise.reject(new Error(e))))).then(e=>new ys(e,new vs(t._repo,t._path),t._queryParams.getIndex()))}class Ss{constructor(e){this.callbackContext=e}respondsTo(e){return"value"===e}createEvent(e,t){var n=t._queryParams.getIndex();return new cs("value",this,new ys(e.snapshotNode,new vs(t._repo,t._path),n))}getEventRunner(e){return"cancel"===e.getEventType()?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,null)}createCancelEvent(e,t){return this.callbackContext.hasCancelCallback?new us(this,e,t):null}matches(e){return e instanceof Ss&&(!e.callbackContext||!this.callbackContext||e.callbackContext.matches(this.callbackContext))}hasAnyCallback(){return null!==this.callbackContext}}class ks{constructor(e,t){this.eventType=e,this.callbackContext=t}respondsTo(e){let t="children_added"===e?"child_added":e;return t="children_removed"===t?"child_removed":t,this.eventType===t}createCancelEvent(e,t){return this.callbackContext.hasCancelCallback?new us(this,e,t):null}createEvent(e,t){p(null!=e.childName,"Child events should have a childName.");var n=bs(new vs(t._repo,t._path),e.childName),r=t._queryParams.getIndex();return new cs(e.type,this,new ys(e.snapshotNode,n,r),e.prevName)}getEventRunner(e){return"cancel"===e.getEventType()?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,e.prevName)}matches(e){return e instanceof ks&&(this.eventType===e.eventType&&(!this.callbackContext||!e.callbackContext||this.callbackContext.matches(e.callbackContext)))}hasAnyCallback(){return!!this.callbackContext}}function Ns(n,e,t,r,i){let s;if("object"==typeof r&&(s=void 0,i=r),"function"==typeof r&&(s=r),i&&i.onlyOnce){const l=t;var o=(e,t)=>{Ki(n._repo,n,a),l(e,t)};o.userCallback=t.userCallback,o.context=t.context,t=o}o=new ds(t,s||void 0);const a="value"===e?new Ss(o):new ks(e,o);return function(e,t,n){let r;r=".info"===et(t._path)?Wr(e.infoSyncTree_,t,n):Wr(e.serverSyncTree_,t,n),Di(e.eventQueue_,t._path,r)}(n._repo,n,a),()=>Ki(n._repo,n,a)}function Ps(e,t,n,r){return Ns(e,"value",t,n,r)}function Rs(e,t,n,r){return Ns(e,"child_added",t,n,r)}function xs(e,t,n,r){return Ns(e,"child_changed",t,n,r)}function Ds(e,t,n,r){return Ns(e,"child_moved",t,n,r)}function As(e,t,n,r){return Ns(e,"child_removed",t,n,r)}function Os(e,t,n){let r=null;var i=n?new ds(n):null;"value"===t?r=new Ss(i):t&&(r=new ks(t,i)),Ki(e._repo,e,r)}class Ls{}class Ms extends Ls{constructor(e,t){super(),this._value=e,this._key=t}_apply(e){pi("endAt",this._value,e._path,!0);var t=sn(e._queryParams,this._value,this._key);if(ms(t),gs(t),e._queryParams.hasEnd())throw new Error("endAt: Starting point was already set (by another call to endAt, endBefore or equalTo).");return new ps(e._repo,e._path,t,e._orderByCalled)}}class Fs extends Ls{constructor(e,t){super(),this._value=e,this._key=t}_apply(e){pi("endBefore",this._value,e._path,!1);var t=function(e,t,n){let r;return r=e.index_===Ct||n?sn(e,t,n):sn(e,t,ye),r.endBeforeSet_=!0,r}(e._queryParams,this._value,this._key);if(ms(t),gs(t),e._queryParams.hasEnd())throw new Error("endBefore: Starting point was already set (by another call to endAt, endBefore or equalTo).");return new ps(e._repo,e._path,t,e._orderByCalled)}}class qs extends Ls{constructor(e,t){super(),this._value=e,this._key=t}_apply(e){pi("startAt",this._value,e._path,!0);var t=rn(e._queryParams,this._value,this._key);if(ms(t),gs(t),e._queryParams.hasStart())throw new Error("startAt: Starting point was already set (by another call to startAt, startBefore or equalTo).");return new ps(e._repo,e._path,t,e._orderByCalled)}}class Ws extends Ls{constructor(e,t){super(),this._value=e,this._key=t}_apply(e){pi("startAfter",this._value,e._path,!1);var t=function(e,t,n){let r;return r=e.index_===Ct||n?rn(e,t,n):rn(e,t,we),r.startAfterSet_=!0,r}(e._queryParams,this._value,this._key);if(ms(t),gs(t),e._queryParams.hasStart())throw new Error("startAfter: Starting point was already set (by another call to startAt, startAfter, or equalTo).");return new ps(e._repo,e._path,t,e._orderByCalled)}}class Us extends Ls{constructor(e){super(),this._limit=e}_apply(e){if(e._queryParams.hasLimit())throw new Error("limitToFirst: Limit was already set (by another call to limitToFirst or limitToLast).");return new ps(e._repo,e._path,function(e,t){const n=e.copy();return n.limitSet_=!0,n.limit_=t,n.viewFrom_="l",n}(e._queryParams,this._limit),e._orderByCalled)}}class Bs extends Ls{constructor(e){super(),this._limit=e}_apply(e){if(e._queryParams.hasLimit())throw new Error("limitToLast: Limit was already set (by another call to limitToFirst or limitToLast).");return new ps(e._repo,e._path,function(e,t){const n=e.copy();return n.limitSet_=!0,n.limit_=t,n.viewFrom_="r",n}(e._queryParams,this._limit),e._orderByCalled)}}class js extends Ls{constructor(e){super(),this._path=e}_apply(e){fs(e,"orderByChild");var t=new Xe(this._path);if(at(t))throw new Error("orderByChild: cannot pass in empty path. Use orderByValue() instead.");t=new Yt(t),t=on(e._queryParams,t);return gs(t),new ps(e._repo,e._path,t,!0)}}class Vs extends Ls{_apply(e){fs(e,"orderByKey");var t=on(e._queryParams,Ct);return gs(t),new ps(e._repo,e._path,t,!0)}}class zs extends Ls{_apply(e){fs(e,"orderByPriority");var t=on(e._queryParams,Ot);return gs(t),new ps(e._repo,e._path,t,!0)}}class Hs extends Ls{_apply(e){fs(e,"orderByValue");var t=on(e._queryParams,Kt);return gs(t),new ps(e._repo,e._path,t,!0)}}class Qs extends Ls{constructor(e,t){super(),this._value=e,this._key=t}_apply(e){if(pi("equalTo",this._value,e._path,!1),e._queryParams.hasStart())throw new Error("equalTo: Starting point was already set (by another call to startAt/startAfter or equalTo).");if(e._queryParams.hasEnd())throw new Error("equalTo: Ending point was already set (by another call to endAt/endBefore or equalTo).");return new Ms(this._value,this._key)._apply(new qs(this._value,this._key)._apply(e))}}function Ys(e,...t){let n=R(e);for(const r of t)n=r._apply(n);return n}G=vs,p(!vr,"__referenceConstructor has already been defined"),vr=G,J=vs,p(!Rr,"__referenceConstructor has already been defined"),Rr=J;const Ks="FIREBASE_DATABASE_EMULATOR_HOST",$s={};let Gs=!1;function Js(e,t,n,r,i){let s=r||e.options.databaseURL;void 0===s&&(e.options.projectId||fe("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),pe("Using default host for project ",e.options.projectId),s=`${e.options.projectId}-default-rtdb.firebaseio.com`);let o=os(s,i),a=o.repoInfo,l,h=void 0;"undefined"!=typeof process&&process.env&&(h=process.env[Ks]),h?(l=!0,s=`http://${h}?ns=${a.namespace}`,o=os(s,i),a=o.repoInfo):l=!o.repoInfo.secure;var c=i&&l?new De(De.OWNER):new xe(e.name,e.options,t);Pi("Invalid Firebase Database URL",o),at(o.path)||fe("Database URL must point to the root of a Firebase Database (not including a child path).");c=function(e,t,n,r){let i=$s[t.name];i||(i={},$s[t.name]=i);var s=i[e.toURLString()];s&&fe("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call.");return s=new Fi(e,Gs,n,r),i[e.toURLString()]=s}(a,e,c,new Re(e.name,n));return new Xs(c,e)}class Xs{constructor(e,t){this._repoInternal=e,this.app=t,this.type="database",this._instanceStarted=!1}get _repo(){return this._instanceStarted||(qi(this._repoInternal,this.app.options.appId,this.app.options.databaseAuthVariableOverride),this._instanceStarted=!0),this._repoInternal}get _root(){return this._rootInternal||(this._rootInternal=new vs(this._repo,Ze())),this._rootInternal}_delete(){return null!==this._rootInternal&&(function(e,t){const n=$s[t];n&&n[e.key]===e||fe(`Database ${t}(${e.repoInfo_}) has already been deleted.`),$i(e),delete n[e.key]}(this._repo,this.app.name),this._repoInternal=null,this._rootInternal=null),Promise.resolve()}_checkNotDeleted(e){null===this._rootInternal&&fe("Cannot call "+e+" on a deleted database.")}}function Zs(){Ye.IS_TRANSPORT_INITIALIZED&&ge("Transport has already been initialized. Please call this function before calling ref or setting up a listener")}function eo(){Zs(),Ve.forceDisallow()}function to(){Zs(),Qe.forceDisallow(),Ve.forceAllow()}function no(e,t,n,r={}){(e=R(e))._checkNotDeleted("useEmulator"),e._instanceStarted&&fe("Cannot call useEmulator() after instance has already been initialized.");var i,s=e._repoInternal;let o=void 0;s.repoInfo_.nodeAdmin?(r.mockUserToken&&fe('mockUserToken is not supported by the Admin SDK. For client access with mock users, please use the "firebase" package instead of "firebase-admin".'),o=new De(De.OWNER)):r.mockUserToken&&(i="string"==typeof r.mockUserToken?r.mockUserToken:function(e,t){if(e.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');var n=t||"demo-project",r=e.iat||0,i=e.sub||e.user_id;if(!i)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");return i=Object.assign({iss:`https://securetoken.google.com/${n}`,aud:n,iat:r,exp:r+3600,auth_time:r,sub:i,user_id:i,firebase:{sign_in_provider:"custom",identities:{}}},e),[a(JSON.stringify({alg:"none",type:"JWT"})),a(JSON.stringify(i)),""].join(".")}(r.mockUserToken,e.app.options.projectId),o=new De(i)),r=s,e=t,t=n,n=o,r.repoInfo_=new Me(`${e}:${t}`,!1,r.repoInfo_.namespace,r.repoInfo_.webSocketOnly,r.repoInfo_.nodeAdmin,r.repoInfo_.persistenceKey,r.repoInfo_.includeNamespaceInQueryParams,!0),n&&(r.authTokenProvider_=n)}function ro(e){(e=R(e))._checkNotDeleted("goOnline"),(e=e._repo).persistentConnection_&&e.persistentConnection_.resume(Li)}function io(e,t){_e(e,t)}const so={".sv":"timestamp"};class oo{constructor(e,t){this.committed=e,this.snapshot=t}toJSON(){return{committed:this.committed,snapshot:this.snapshot.toJSON()}}}function ao(i,e,t){if(i=R(i),yi("Reference.transaction",i._path),".length"===i.key||".keys"===i.key)throw"Reference.transaction failed: "+i.key+" is a read-only object.";var n=null===(r=null==t?void 0:t.applyLocally)||void 0===r||r;const s=new _;var r=Ps(i,()=>{});return function(t,n,e,r,i,s){Gi(t,"transaction on "+n);const o={path:n,update:e,onComplete:r,status:null,order:re(),applyLocally:s,retryCount:0,unwatcher:i,abortReason:null,currentWriteId:null,currentInputSnapshot:null,currentOutputSnapshotRaw:null,currentOutputSnapshotResolved:null},a=Xi(t,n,void 0);o.currentInputSnapshot=a;var l=o.update(a.val());if(void 0===l)o.unwatcher(),o.currentOutputSnapshotRaw=null,o.currentOutputSnapshotResolved=null,o.onComplete&&o.onComplete(null,!1,o.currentInputSnapshot);else{ki("transaction failed: Data returned ",l,o.path),o.status=0;var h=ai(t.transactionQueueTree_,n);const c=li(h)||[];c.push(o),hi(h,c);let e;if("object"==typeof l&&null!==l&&w(l,".priority"))e=C(l,".priority"),p(Si(e),"Invalid priority returned by transaction. Priority must be a valid string, finite number, server value, or null.");else{const u=Ur(t.serverSyncTree_,n)||jt.EMPTY_NODE;e=u.getPriority().val()}h=Ui(t),l=Qt(l,e),h=ii(l,a,h);o.currentOutputSnapshotRaw=l,o.currentOutputSnapshotResolved=h,o.currentWriteId=zi(t);h=Ar(t.serverSyncTree_,n,h,o.currentWriteId,o.applyLocally);Ai(t.eventQueue_,n,h),Zi(t,t.transactionQueueTree_)}}(i._repo,i._path,e,(e,t,n)=>{var r;e?s.reject(e):(r=new ys(n,new vs(i._repo,i._path),Ot),s.resolve(new oo(t,r)))},r,n),s.promise}gt.prototype.simpleListen=function(e,t){this.sendRequest("q",{p:e},t)},gt.prototype.echo=function(e,t){this.sendRequest("echo",{d:e},t)},j(Co.SDK_VERSION),Co._registerComponent(new x("database",(e,{instanceIdentifier:t})=>{return Js(e.getProvider("app").getImmediate(),e.getProvider("auth-internal"),e.getProvider("app-check-internal"),t)},"PUBLIC").setMultipleInstances(!0)),Co.registerVersion(U,"0.14.4",X),Co.registerVersion(U,"0.14.4","esm2017");function lo(e){var t="FIREBASE WARNING: "+e;ho.warn(t)}const ho=new W("@firebase/database-compat");class co{constructor(e){this._delegate=e}cancel(t){E("OnDisconnect.cancel",0,1,arguments.length),k("OnDisconnect.cancel","onComplete",t,!0);const e=this._delegate.cancel();return t&&e.then(()=>t(null),e=>t(e)),e}remove(t){E("OnDisconnect.remove",0,1,arguments.length),k("OnDisconnect.remove","onComplete",t,!0);const e=this._delegate.remove();return t&&e.then(()=>t(null),e=>t(e)),e}set(e,t){E("OnDisconnect.set",1,2,arguments.length),k("OnDisconnect.set","onComplete",t,!0);const n=this._delegate.set(e);return t&&n.then(()=>t(null),e=>t(e)),n}setWithPriority(e,t,n){E("OnDisconnect.setWithPriority",2,3,arguments.length),k("OnDisconnect.setWithPriority","onComplete",n,!0);const r=this._delegate.setWithPriority(e,t);return n&&r.then(()=>n(null),e=>n(e)),r}update(t,n){if(E("OnDisconnect.update",1,2,arguments.length),Array.isArray(t)){const r={};for(let e=0;e<t.length;++e)r[""+e]=t[e];t=r,lo("Passing an Array to firebase.database.onDisconnect().update() is deprecated. Use set() if you want to overwrite the existing data, or an Object with integer keys if you really do want to only update some of the children.")}k("OnDisconnect.update","onComplete",n,!0);const e=this._delegate.update(t);return n&&e.then(()=>n(null),e=>n(e)),e}}class uo{constructor(e,t){this.committed=e,this.snapshot=t}toJSON(){return E("TransactionResult.toJSON",0,1,arguments.length),{committed:this.committed,snapshot:this.snapshot.toJSON()}}}class _o{constructor(e,t){this._database=e,this._delegate=t}val(){return E("DataSnapshot.val",0,0,arguments.length),this._delegate.val()}exportVal(){return E("DataSnapshot.exportVal",0,0,arguments.length),this._delegate.exportVal()}toJSON(){return E("DataSnapshot.toJSON",0,1,arguments.length),this._delegate.toJSON()}exists(){return E("DataSnapshot.exists",0,0,arguments.length),this._delegate.exists()}child(e){return E("DataSnapshot.child",0,1,arguments.length),e=String(e),Ni("DataSnapshot.child","path",e,!1),new _o(this._database,this._delegate.child(e))}hasChild(e){return E("DataSnapshot.hasChild",1,1,arguments.length),Ni("DataSnapshot.hasChild","path",e,!1),this._delegate.hasChild(e)}getPriority(){return E("DataSnapshot.getPriority",0,0,arguments.length),this._delegate.priority}forEach(t){return E("DataSnapshot.forEach",1,1,arguments.length),k("DataSnapshot.forEach","action",t,!1),this._delegate.forEach(e=>t(new _o(this._database,e)))}hasChildren(){return E("DataSnapshot.hasChildren",0,0,arguments.length),this._delegate.hasChildren()}get key(){return this._delegate.key}numChildren(){return E("DataSnapshot.numChildren",0,0,arguments.length),this._delegate.size}getRef(){return E("DataSnapshot.ref",0,0,arguments.length),new fo(this._database,this._delegate.ref)}get ref(){return this.getRef()}}class po{constructor(e,t){this.database=e,this._delegate=t}on(e,n,t,r){var i;E("Query.on",2,4,arguments.length),k("Query.on","callback",n,!1);const s=po.getCancelAndContextArgs_("Query.on",t,r);var o=(e,t)=>{n.call(s.context,new _o(this.database,e),t)};o.userCallback=n,o.context=s.context;var a=null===(i=s.cancel)||void 0===i?void 0:i.bind(s.context);switch(e){case"value":return Ps(this._delegate,o,a),n;case"child_added":return Rs(this._delegate,o,a),n;case"child_removed":return As(this._delegate,o,a),n;case"child_changed":return xs(this._delegate,o,a),n;case"child_moved":return Ds(this._delegate,o,a),n;default:throw new Error(S("Query.on","eventType")+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}}off(e,t,n){var r;E("Query.off",0,3,arguments.length),function(e,t,n){if(!n||void 0!==t)switch(t){case"value":case"child_added":case"child_removed":case"child_changed":case"child_moved":break;default:throw new Error(S(e,"eventType")+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}}("Query.off",e,!0),k("Query.off","callback",t,!0),N("Query.off","context",n,!0),t?((r=()=>{}).userCallback=t,r.context=n,Os(this._delegate,e,r)):Os(this._delegate,e)}get(){return Es(this._delegate).then(e=>new _o(this.database,e))}once(e,r,t,n){E("Query.once",1,4,arguments.length),k("Query.once","callback",r,!0);const i=po.getCancelAndContextArgs_("Query.once",t,n),s=new _;var o=(e,t)=>{var n=new _o(this.database,e);r&&r.call(i.context,n,t),s.resolve(n)};o.userCallback=r,o.context=i.context;var a=e=>{i.cancel&&i.cancel.call(i.context,e),s.reject(e)};switch(e){case"value":Ps(this._delegate,o,a,{onlyOnce:!0});break;case"child_added":Rs(this._delegate,o,a,{onlyOnce:!0});break;case"child_removed":As(this._delegate,o,a,{onlyOnce:!0});break;case"child_changed":xs(this._delegate,o,a,{onlyOnce:!0});break;case"child_moved":Ds(this._delegate,o,a,{onlyOnce:!0});break;default:throw new Error(S("Query.once","eventType")+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}return s.promise}limitToFirst(e){return E("Query.limitToFirst",1,1,arguments.length),new po(this.database,Ys(this._delegate,function(e){if("number"!=typeof e||Math.floor(e)!==e||e<=0)throw new Error("limitToFirst: First argument must be a positive integer.");return new Us(e)}(e)))}limitToLast(e){return E("Query.limitToLast",1,1,arguments.length),new po(this.database,Ys(this._delegate,function(e){if("number"!=typeof e||Math.floor(e)!==e||e<=0)throw new Error("limitToLast: First argument must be a positive integer.");return new Bs(e)}(e)))}orderByChild(e){return E("Query.orderByChild",1,1,arguments.length),new po(this.database,Ys(this._delegate,function(e){if("$key"===e)throw new Error('orderByChild: "$key" is invalid.  Use orderByKey() instead.');if("$priority"===e)throw new Error('orderByChild: "$priority" is invalid.  Use orderByPriority() instead.');if("$value"===e)throw new Error('orderByChild: "$value" is invalid.  Use orderByValue() instead.');return Ni("orderByChild","path",e,!1),new js(e)}(e)))}orderByKey(){return E("Query.orderByKey",0,0,arguments.length),new po(this.database,Ys(this._delegate,new Vs))}orderByPriority(){return E("Query.orderByPriority",0,0,arguments.length),new po(this.database,Ys(this._delegate,new zs))}orderByValue(){return E("Query.orderByValue",0,0,arguments.length),new po(this.database,Ys(this._delegate,new Hs))}startAt(e=null,t){return E("Query.startAt",0,2,arguments.length),new po(this.database,Ys(this._delegate,([e=null,t]=[e,t],mi("startAt","key",t,!0),new qs(e,t))))}startAfter(e=null,t){return E("Query.startAfter",0,2,arguments.length),new po(this.database,Ys(this._delegate,(e=e,t=t,mi("startAfter","key",t,!0),new Ws(e,t))))}endAt(e=null,t){return E("Query.endAt",0,2,arguments.length),new po(this.database,Ys(this._delegate,(e=e,t=t,mi("endAt","key",t,!0),new Ms(e,t))))}endBefore(e=null,t){return E("Query.endBefore",0,2,arguments.length),new po(this.database,Ys(this._delegate,(e=e,t=t,mi("endBefore","key",t,!0),new Fs(e,t))))}equalTo(e,t){return E("Query.equalTo",1,2,arguments.length),new po(this.database,Ys(this._delegate,(e=e,t=t,mi("equalTo","key",t,!0),new Qs(e,t))))}toString(){return E("Query.toString",0,0,arguments.length),this._delegate.toString()}toJSON(){return E("Query.toJSON",0,1,arguments.length),this._delegate.toJSON()}isEqual(e){if(E("Query.isEqual",1,1,arguments.length),e instanceof po)return this._delegate.isEqual(e._delegate);throw new Error("Query.isEqual failed: First argument must be an instance of firebase.database.Query.")}static getCancelAndContextArgs_(e,t,n){const r={cancel:void 0,context:void 0};if(t&&n)r.cancel=t,k(e,"cancel",r.cancel,!0),r.context=n,N(e,"context",r.context,!0);else if(t)if("object"==typeof t&&null!==t)r.context=t;else{if("function"!=typeof t)throw new Error(S(e,"cancelOrContext")+" must either be a cancel callback or a context object.");r.cancel=t}return r}get ref(){return new fo(this.database,new vs(this._delegate._repo,this._delegate._path))}}class fo extends po{constructor(e,t){super(e,new ps(t._repo,t._path,new nn,!1)),this.database=e,this._delegate=t}getKey(){return E("Reference.key",0,0,arguments.length),this._delegate.key}child(e){return E("Reference.child",1,1,arguments.length),"number"==typeof e&&(e=String(e)),new fo(this.database,bs(this._delegate,e))}getParent(){E("Reference.parent",0,0,arguments.length);var e=this._delegate.parent;return e?new fo(this.database,e):null}getRoot(){return E("Reference.root",0,0,arguments.length),new fo(this.database,this._delegate.root)}set(e,t){E("Reference.set",1,2,arguments.length),k("Reference.set","onComplete",t,!0);const n=Is(this._delegate,e);return t&&n.then(()=>t(null),e=>t(e)),n}update(t,n){if(E("Reference.update",1,2,arguments.length),Array.isArray(t)){const r={};for(let e=0;e<t.length;++e)r[""+e]=t[e];t=r,lo("Passing an Array to Firebase.update() is deprecated. Use set() if you want to overwrite the existing data, or an Object with integer keys if you really do want to only update some of the children.")}yi("Reference.update",this._delegate._path),k("Reference.update","onComplete",n,!0);const e=Ts(this._delegate,t);return n&&e.then(()=>n(null),e=>n(e)),e}setWithPriority(e,t,n){E("Reference.setWithPriority",2,3,arguments.length),k("Reference.setWithPriority","onComplete",n,!0);const r=function(e,t,n){if(yi("setWithPriority",e._path),pi("setWithPriority",t,e._path,!1),gi("setWithPriority",n,!1),".length"===e.key||".keys"===e.key)throw"setWithPriority failed: "+e.key+" is a read-only object.";const r=new _;return Hi(e._repo,e._path,t,n,r.wrapCallback(()=>{})),r.promise}(this._delegate,e,t);return n&&r.then(()=>n(null),e=>n(e)),r}remove(t){E("Reference.remove",0,1,arguments.length),k("Reference.remove","onComplete",t,!0);const e=(n=this._delegate,yi("remove",n._path),Is(n,null));var n;return t&&e.then(()=>t(null),e=>t(e)),e}transaction(e,t,n){E("Reference.transaction",1,3,arguments.length),k("Reference.transaction","transactionUpdate",e,!1),k("Reference.transaction","onComplete",t,!0),function(e,t,n,r){if((!r||void 0!==n)&&"boolean"!=typeof n)throw new Error(S(e,t)+"must be a boolean.")}("Reference.transaction","applyLocally",n,!0);const r=ao(this._delegate,e,{applyLocally:n}).then(e=>new uo(e.committed,new _o(this.database,e.snapshot)));return t&&r.then(e=>t(null,e.committed,e.snapshot),e=>t(e,!1,null)),r}setPriority(e,t){E("Reference.setPriority",1,2,arguments.length),k("Reference.setPriority","onComplete",t,!0);const n=function(e,t){e=R(e),yi("setPriority",e._path),gi("setPriority",t,!1);const n=new _;return Hi(e._repo,ot(e._path,".priority"),t,null,n.wrapCallback(()=>{})),n.promise}(this._delegate,e);return t&&n.then(()=>t(null),e=>t(e)),n}push(e,t){E("Reference.push",0,2,arguments.length),k("Reference.push","onComplete",t,!0);const n=function(e,t){e=R(e),yi("push",e._path),pi("push",t,e._path,!0);var n=Wi(e._repo),n=hs(n);const r=bs(e,n),i=bs(e,n);let s;return s=null!=t?Is(i,t).then(()=>i):Promise.resolve(i),r.then=s.then.bind(s),r.catch=s.then.bind(s,void 0),r}(this._delegate,e),r=n.then(e=>new fo(this.database,e));t&&r.then(()=>t(null),e=>t(e));const i=new fo(this.database,n);return i.then=r.then.bind(r),i.catch=r.catch.bind(r,void 0),i}onDisconnect(){return yi("Reference.onDisconnect",this._delegate._path),new co(new _s(this._delegate._repo,this._delegate._path))}get key(){return this.getKey()}get parent(){return this.getParent()}get root(){return this.getRoot()}}class go{constructor(e,t){this._delegate=e,this.app=t,this.INTERNAL={delete:()=>this._delegate._delete(),forceWebSockets:eo,forceLongPolling:to}}useEmulator(e,t,n={}){no(this._delegate,e,t,n)}ref(e){if(E("database.ref",0,1,arguments.length),e instanceof fo){var t=Cs(this._delegate,e.toString());return new fo(this,t)}t=ws(this._delegate,e);return new fo(this,t)}refFromURL(e){E("database.refFromURL",1,1,arguments.length);var t=Cs(this._delegate,e);return new fo(this,t)}goOffline(){var e;E("database.goOffline",0,0,arguments.length),(e=R(e=this._delegate))._checkNotDeleted("goOffline"),$i(e._repo)}goOnline(){return E("database.goOnline",0,0,arguments.length),ro(this._delegate)}}go.ServerValue={TIMESTAMP:so,increment:e=>({".sv":{increment:e}})};var mo,vo=Object.freeze({__proto__:null,initStandalone:function({app:e,url:t,version:n,customAuthImpl:r,namespace:i,nodeAdmin:s=!1}){j(n);const o=new A("auth-internal",new O("database-standalone"));return o.setComponent(new x("auth-internal",()=>r,"PRIVATE")),{instance:new go(Js(e,o,void 0,t,s),e),namespace:i}}});const yo=go.ServerValue;(mo=t.default).INTERNAL.registerComponent(new x("database-compat",(e,{instanceIdentifier:t})=>{var n=e.getProvider("app-compat").getImmediate(),r=e.getProvider("database").getImmediate({identifier:t});return new go(r,n)},"PUBLIC").setServiceProps({Reference:fo,Query:po,Database:go,DataSnapshot:_o,enableLogging:io,INTERNAL:vo,ServerValue:yo}).setMultipleInstances(!0)),mo.registerVersion("@firebase/database-compat","0.3.4")}).apply(this,arguments)}catch(e){throw console.error(e),new Error("Cannot instantiate firebase-database-compat.js - be sure to load firebase-app.js first.")}});
//# sourceMappingURL=firebase-database-compat.js.map

!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(require("@firebase/app-compat"),require("@firebase/app")):"function"==typeof define&&define.amd?define(["@firebase/app-compat","@firebase/app"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).firebase,e.firebase.INTERNAL.modularAPIs)}(this,function(Yg,Jg){"use strict";try{!(function(){function e(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var l,t=e(Yg);function n(t){const n=[];let r=0;for(let i=0;i<t.length;i++){let e=t.charCodeAt(i);e<128?n[r++]=e:(e<2048?n[r++]=e>>6|192:(55296==(64512&e)&&i+1<t.length&&56320==(64512&t.charCodeAt(i+1))?(e=65536+((1023&e)<<10)+(1023&t.charCodeAt(++i)),n[r++]=e>>18|240,n[r++]=e>>12&63|128):n[r++]=e>>12|224,n[r++]=e>>6&63|128),n[r++]=63&e|128)}return n}const r={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray(n,e){if(!Array.isArray(n))throw Error("encodeByteArray takes an array as a parameter");this.init_();var r=e?this.byteToCharMapWebSafe_:this.byteToCharMap_;const i=[];for(let h=0;h<n.length;h+=3){var s=n[h],a=h+1<n.length,o=a?n[h+1]:0,u=h+2<n.length,c=u?n[h+2]:0;let e=(15&o)<<2|c>>6,t=63&c;u||(t=64,a||(e=64)),i.push(r[s>>2],r[(3&s)<<4|o>>4],r[e],r[t])}return i.join("")},encodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(e):this.encodeByteArray(n(e),t)},decodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(e):function(e){const t=[];let n=0,r=0;for(;n<e.length;){var i,s,a=e[n++];a<128?t[r++]=String.fromCharCode(a):191<a&&a<224?(i=e[n++],t[r++]=String.fromCharCode((31&a)<<6|63&i)):239<a&&a<365?(s=((7&a)<<18|(63&e[n++])<<12|(63&e[n++])<<6|63&e[n++])-65536,t[r++]=String.fromCharCode(55296+(s>>10)),t[r++]=String.fromCharCode(56320+(1023&s))):(i=e[n++],s=e[n++],t[r++]=String.fromCharCode((15&a)<<12|(63&i)<<6|63&s))}return t.join("")}(this.decodeStringToByteArray(e,t))},decodeStringToByteArray(e,t){this.init_();var n=t?this.charToByteMapWebSafe_:this.charToByteMap_;const r=[];for(let u=0;u<e.length;){var i=n[e.charAt(u++)],s=u<e.length?n[e.charAt(u)]:0;++u;var a=u<e.length?n[e.charAt(u)]:64;++u;var o=u<e.length?n[e.charAt(u)]:64;if(++u,null==i||null==s||null==a||null==o)throw new c;r.push(i<<2|s>>4),64!==a&&(r.push(s<<4&240|a>>2),64!==o&&r.push(a<<6&192|o))}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let e=0;e<this.ENCODED_VALS.length;e++)this.byteToCharMap_[e]=this.ENCODED_VALS.charAt(e),this.charToByteMap_[this.byteToCharMap_[e]]=e,this.byteToCharMapWebSafe_[e]=this.ENCODED_VALS_WEBSAFE.charAt(e),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[e]]=e,e>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(e)]=e,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(e)]=e)}}};class c extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const a=function(e){return e=e,t=n(e),r.encodeByteArray(t,!0).replace(/\./g,"");var t};const i=()=>function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if("undefined"!=typeof global)return global;throw new Error("Unable to locate global object.")}().__FIREBASE_DEFAULTS__,s=()=>{if("undefined"!=typeof document){let e;try{e=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch(e){return}var t=e&&function(e){try{return r.decodeString(e,!0)}catch(e){console.error("base64Decode failed: ",e)}return null}(e[1]);return t&&JSON.parse(t)}},o=()=>{try{return i()||(()=>{if("undefined"!=typeof process&&void 0!==process.env){var e=process.env.__FIREBASE_DEFAULTS__;return e?JSON.parse(e):void 0}})()||s()}catch(e){return void console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${e}`)}};function u(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}function h(){return!function(){var e=null===(e=o())||void 0===e?void 0:e.forceEnvironment;if("node"===e)return 1;if("browser"!==e)try{return"[object process]"===Object.prototype.toString.call(global.process)}catch(e){return}}()&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}class d extends Error{constructor(e,t,n){super(t),this.code=e,this.customData=n,this.name="FirebaseError",Object.setPrototypeOf(this,d.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,f.prototype.create)}}class f{constructor(e,t,n){this.service=e,this.serviceName=t,this.errors=n}create(e,...t){var r,n=t[0]||{},i=`${this.service}/${e}`,s=this.errors[e],s=s?(r=n,s.replace(g,(e,t)=>{var n=r[t];return null!=n?String(n):`<${t}?>`})):"Error",s=`${this.serviceName}: ${s} (${i}).`;return new d(i,s,n)}}const g=/\{\$([^}]+)}/g;function m(e){return e&&e._delegate?e._delegate:e}class p{constructor(e,t,n){this.name=e,this.instanceFactory=t,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}(Yd=l=l||{})[Yd.DEBUG=0]="DEBUG",Yd[Yd.VERBOSE=1]="VERBOSE",Yd[Yd.INFO=2]="INFO",Yd[Yd.WARN=3]="WARN",Yd[Yd.ERROR=4]="ERROR",Yd[Yd.SILENT=5]="SILENT";const y={debug:l.DEBUG,verbose:l.VERBOSE,info:l.INFO,warn:l.WARN,error:l.ERROR,silent:l.SILENT},v=l.INFO,w={[l.DEBUG]:"log",[l.VERBOSE]:"log",[l.INFO]:"info",[l.WARN]:"warn",[l.ERROR]:"error"},b=(e,t,...n)=>{if(!(t<e.logLevel)){var r=(new Date).toISOString(),i=w[t];if(!i)throw new Error(`Attempted to log a message with an invalid logType (value: ${t})`);console[i](`[${r}]  ${e.name}:`,...n)}};var I,E="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},T={},_=E||self;function S(){}function x(e){var t=typeof e;return"array"==(t="object"!=t?t:e?Array.isArray(e)?"array":t:"null")||"object"==t&&"number"==typeof e.length}function D(e){var t=typeof e;return"object"==t&&null!=e||"function"==t}var A="closure_uid_"+(1e9*Math.random()>>>0),C=0;function N(e,t,n){return e.call.apply(e.bind,arguments)}function k(t,n,e){if(!t)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var e=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(e,r),t.apply(n,e)}}return function(){return t.apply(n,arguments)}}function R(e,t,n){return(R=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?N:k).apply(null,arguments)}function M(t){var n=Array.prototype.slice.call(arguments,1);return function(){var e=n.slice();return e.push.apply(e,arguments),t.apply(this,e)}}function F(e,s){function t(){}t.prototype=s.prototype,e.$=s.prototype,e.prototype=new t,(e.prototype.constructor=e).ac=function(e,t,n){for(var r=Array(arguments.length-2),i=2;i<arguments.length;i++)r[i-2]=arguments[i];return s.prototype[t].apply(e,r)}}function L(){this.s=this.s,this.o=this.o}L.prototype.s=!1,L.prototype.ra=function(){var e;!this.s&&(this.s=!0,this.N(),0)&&(e=this,Object.prototype.hasOwnProperty.call(e,A)&&e[A]||(e[A]=++C))},L.prototype.N=function(){if(this.o)for(;this.o.length;)this.o.shift()()};const O=Array.prototype.indexOf?function(e,t){return Array.prototype.indexOf.call(e,t,void 0)}:function(e,t){if("string"==typeof e)return"string"!=typeof t||1!=t.length?-1:e.indexOf(t,0);for(let n=0;n<e.length;n++)if(n in e&&e[n]===t)return n;return-1};function P(t){var n=t.length;if(0<n){const r=Array(n);for(let e=0;e<n;e++)r[e]=t[e];return r}return[]}function V(t){for(let e=1;e<arguments.length;e++){var n=arguments[e];if(x(n)){var r=t.length||0,i=n.length||0;t.length=r+i;for(let e=0;e<i;e++)t[r+e]=n[e]}else t.push(n)}}function q(e,t){this.type=e,this.g=this.target=t,this.defaultPrevented=!1}q.prototype.h=function(){this.defaultPrevented=!0};var B=function(){if(!_.addEventListener||!Object.defineProperty)return!1;var e=!1,t=Object.defineProperty({},"passive",{get:function(){e=!0}});try{_.addEventListener("test",S,t),_.removeEventListener("test",S,t)}catch(e){}return e}();function U(e){return/^[\s\xa0]*$/.test(e)}var j=String.prototype.trim?function(e){return e.trim()}:function(e){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(e)[1]};function K(e,t){return e<t?-1:t<e?1:0}function G(){var e=_.navigator;return(e=e&&e.userAgent)?e:""}function z(e){return-1!=G().indexOf(e)}function $(e){return $[" "](e),e}function Q(e,t,n){return Object.prototype.hasOwnProperty.call(e,t)?e[t]:e[t]=n(t)}$[" "]=S;var H,W=z("Opera"),X=z("Trident")||z("MSIE"),Y=z("Edge"),J=Y||X,Z=z("Gecko")&&!(-1!=G().toLowerCase().indexOf("webkit")&&!z("Edge"))&&!(z("Trident")||z("MSIE"))&&!z("Edge"),ee=-1!=G().toLowerCase().indexOf("webkit")&&!z("Edge");function te(){var e=_.document;return e?e.documentMode:void 0}e:{var ne="",re=(re=G(),Z?/rv:([^\);]+)(\)|;)/.exec(re):Y?/Edge\/([\d\.]+)/.exec(re):X?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(re):ee?/WebKit\/(\S+)/.exec(re):W?/(?:Version)[ \/]?(\S+)/.exec(re):void 0);if(re&&(ne=re?re[1]:""),X){re=te();if(null!=re&&re>parseFloat(ne)){H=String(re);break e}}H=ne}var ie={};var se=_.document&&X&&(te()||parseInt(H,10))||void 0;function ae(e,t){if(q.call(this,e?e.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,e){var n=this.type=e.type,r=e.changedTouches&&e.changedTouches.length?e.changedTouches[0]:null;if(this.target=e.target||e.srcElement,this.g=t,t=e.relatedTarget){if(Z){e:{try{$(t.nodeName);var i=!0;break e}catch(e){}i=!1}i||(t=null)}}else"mouseover"==n?t=e.fromElement:"mouseout"==n&&(t=e.toElement);this.relatedTarget=t,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==e.clientX?e.clientX:e.pageX,this.clientY=void 0!==e.clientY?e.clientY:e.pageY,this.screenX=e.screenX||0,this.screenY=e.screenY||0),this.button=e.button,this.key=e.key||"",this.ctrlKey=e.ctrlKey,this.altKey=e.altKey,this.shiftKey=e.shiftKey,this.metaKey=e.metaKey,this.pointerId=e.pointerId||0,this.pointerType="string"==typeof e.pointerType?e.pointerType:oe[e.pointerType]||"",this.state=e.state,(this.i=e).defaultPrevented&&ae.$.h.call(this)}}F(ae,q);var oe={2:"touch",3:"pen",4:"mouse"};ae.prototype.h=function(){ae.$.h.call(this);var e=this.i;e.preventDefault?e.preventDefault():e.returnValue=!1};var ue="closure_listenable_"+(1e6*Math.random()|0),ce=0;function he(e,t,n,r,i){this.listener=e,this.proxy=null,this.src=t,this.type=n,this.capture=!!r,this.la=i,this.key=++ce,this.fa=this.ia=!1}function le(e){e.fa=!0,e.listener=null,e.proxy=null,e.src=null,e.la=null}function de(e,t,n){for(const r in e)t.call(n,e[r],r,e)}function fe(e){const t={};for(const n in e)t[n]=e[n];return t}const ge="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function me(t){let n,r;for(let i=1;i<arguments.length;i++){for(n in r=arguments[i])t[n]=r[n];for(let e=0;e<ge.length;e++)n=ge[e],Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}}function pe(e){this.src=e,this.g={},this.h=0}function ye(e,t){var n,r,i,s=t.type;s in e.g&&(n=e.g[s],(i=0<=(r=O(n,t)))&&Array.prototype.splice.call(n,r,1),i&&(le(t),0==e.g[s].length&&(delete e.g[s],e.h--)))}function ve(e,t,n,r){for(var i=0;i<e.length;++i){var s=e[i];if(!s.fa&&s.listener==t&&s.capture==!!n&&s.la==r)return i}return-1}pe.prototype.add=function(e,t,n,r,i){var s=e.toString();(e=this.g[s])||(e=this.g[s]=[],this.h++);var a=ve(e,t,r,i);return-1<a?(t=e[a],n||(t.ia=!1)):((t=new he(t,this.src,s,!!r,i)).ia=n,e.push(t)),t};var we="closure_lm_"+(1e6*Math.random()|0),be={};function Ie(e,t,n,r,i){if(r&&r.once)return function e(t,n,r,i,s){if(Array.isArray(n)){for(var a=0;a<n.length;a++)e(t,n[a],r,i,s);return null}r=Ae(r);return t&&t[ue]?t.P(n,r,D(i)?!!i.capture:!!i,s):Ee(t,n,r,!0,i,s)}(e,t,n,r,i);if(Array.isArray(t)){for(var s=0;s<t.length;s++)Ie(e,t[s],n,r,i);return null}return n=Ae(n),e&&e[ue]?e.O(t,n,D(r)?!!r.capture:!!r,i):Ee(e,t,n,!1,r,i)}function Ee(e,t,n,r,i,s){if(!t)throw Error("Invalid event type");var a=D(i)?!!i.capture:!!i,o=xe(e);if(o||(e[we]=o=new pe(e)),(n=o.add(t,n,r,a,s)).proxy)return n;if(r=function(){const n=Se;return function e(t){return n.call(e.src,e.listener,t)}}(),(n.proxy=r).src=e,r.listener=n,e.addEventListener)void 0===(i=!B?a:i)&&(i=!1),e.addEventListener(t.toString(),r,i);else if(e.attachEvent)e.attachEvent(_e(t.toString()),r);else{if(!e.addListener||!e.removeListener)throw Error("addEventListener and attachEvent are unavailable.");e.addListener(r)}return n}function Te(e){var t,n,r;"number"!=typeof e&&e&&!e.fa&&((t=e.src)&&t[ue]?ye(t.i,e):(n=e.type,r=e.proxy,t.removeEventListener?t.removeEventListener(n,r,e.capture):t.detachEvent?t.detachEvent(_e(n),r):t.addListener&&t.removeListener&&t.removeListener(r),(n=xe(t))?(ye(n,e),0==n.h&&(n.src=null,t[we]=null)):le(e)))}function _e(e){return e in be?be[e]:be[e]="on"+e}function Se(e,t){var n,r;return e=!!e.fa||(t=new ae(t,this),n=e.listener,r=e.la||e.src,e.ia&&Te(e),n.call(r,t))}function xe(e){return(e=e[we])instanceof pe?e:null}var De="__closure_events_fn_"+(1e9*Math.random()>>>0);function Ae(t){return"function"==typeof t?t:(t[De]||(t[De]=function(e){return t.handleEvent(e)}),t[De])}function Ce(){L.call(this),this.i=new pe(this),(this.S=this).J=null}function Ne(e,t){var n,r=e.J;if(r)for(n=[];r;r=r.J)n.push(r);if(e=e.S,r=t.type||t,"string"==typeof t?t=new q(t,e):t instanceof q?t.target=t.target||e:(a=t,me(t=new q(r,e),a)),a=!0,n)for(var i=n.length-1;0<=i;i--)var s=t.g=n[i],a=ke(s,r,!0,t)&&a;if(a=ke(s=t.g=e,r,!0,t)&&a,a=ke(s,r,!1,t)&&a,n)for(i=0;i<n.length;i++)a=ke(s=t.g=n[i],r,!1,t)&&a}function ke(e,t,n,r){if(!(t=e.i.g[String(t)]))return!0;t=t.concat();for(var i=!0,s=0;s<t.length;++s){var a,o,u=t[s];u&&!u.fa&&u.capture==n&&(a=u.listener,o=u.la||u.src,u.ia&&ye(e.i,u),i=!1!==a.call(o,r)&&i)}return i&&!r.defaultPrevented}F(Ce,L),Ce.prototype[ue]=!0,Ce.prototype.removeEventListener=function(e,t,n,r){!function e(t,n,r,i,s){if(Array.isArray(n))for(var a=0;a<n.length;a++)e(t,n[a],r,i,s);else i=D(i)?!!i.capture:!!i,r=Ae(r),t&&t[ue]?(t=t.i,(n=String(n).toString())in t.g&&-1<(r=ve(a=t.g[n],r,i,s))&&(le(a[r]),Array.prototype.splice.call(a,r,1),0==a.length&&(delete t.g[n],t.h--))):(t=t&&xe(t))&&(n=t.g[n.toString()],(r=(t=-1)<(t=n?ve(n,r,i,s):t)?n[t]:null)&&Te(r))}(this,e,t,n,r)},Ce.prototype.N=function(){if(Ce.$.N.call(this),this.i){var e,t=this.i;for(e in t.g){for(var n=t.g[e],r=0;r<n.length;r++)le(n[r]);delete t.g[e],t.h--}}this.J=null},Ce.prototype.O=function(e,t,n,r){return this.i.add(String(e),t,!1,n,r)},Ce.prototype.P=function(e,t,n,r){return this.i.add(String(e),t,!0,n,r)};var Re=_.JSON.stringify;var Me,Fe=new class{constructor(e,t){this.i=e,this.j=t,this.h=0,this.g=null}get(){let e;return 0<this.h?(this.h--,e=this.g,this.g=e.next,e.next=null):e=this.i(),e}}(()=>new Le,e=>e.reset());class Le{constructor(){this.next=this.g=this.h=null}set(e,t){this.h=e,this.g=t,this.next=null}reset(){this.next=this.g=this.h=null}}function Oe(e,t){var n;Me||(n=_.Promise.resolve(void 0),Me=function(){n.then(qe)}),Pe||(Me(),Pe=!0),Ve.add(e,t)}var Pe=!1,Ve=new class{constructor(){this.h=this.g=null}add(e,t){const n=Fe.get();n.set(e,t),this.h?this.h.next=n:this.g=n,this.h=n}};function qe(){for(var e;e=function(){var e=Ve;let t=null;return e.g&&(t=e.g,e.g=e.g.next,e.g||(e.h=null),t.next=null),t}();){try{e.h.call(e.g)}catch(e){!function(e){_.setTimeout(()=>{throw e},0)}(e)}var t=Fe;t.j(e),t.h<100&&(t.h++,e.next=t.g,t.g=e)}Pe=!1}function Be(e,t){Ce.call(this),this.h=e||1,this.g=t||_,this.j=R(this.qb,this),this.l=Date.now()}function Ue(e){e.ga=!1,e.T&&(e.g.clearTimeout(e.T),e.T=null)}function je(e,t,n){if("function"==typeof e)n&&(e=R(e,n));else{if(!e||"function"!=typeof e.handleEvent)throw Error("Invalid listener argument");e=R(e.handleEvent,e)}return 2147483647<Number(t)?-1:_.setTimeout(e,t||0)}F(Be,Ce),(I=Be.prototype).ga=!1,I.T=null,I.qb=function(){var e;this.ga&&(0<(e=Date.now()-this.l)&&e<.8*this.h?this.T=this.g.setTimeout(this.j,this.h-e):(this.T&&(this.g.clearTimeout(this.T),this.T=null),Ne(this,"tick"),this.ga&&(Ue(this),this.start())))},I.start=function(){this.ga=!0,this.T||(this.T=this.g.setTimeout(this.j,this.h),this.l=Date.now())},I.N=function(){Be.$.N.call(this),Ue(this),delete this.g};class Ke extends L{constructor(e,t){super(),this.m=e,this.j=t,this.h=null,this.i=!1,this.g=null}l(e){this.h=arguments,this.g?this.i=!0:function e(t){t.g=je(()=>{t.g=null,t.i&&(t.i=!1,e(t))},t.j);var n=t.h;t.h=null,t.m.apply(null,n)}(this)}N(){super.N(),this.g&&(_.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Ge(e){L.call(this),this.h=e,this.g={}}F(Ge,L);var ze=[];function $e(e,t,n,r){Array.isArray(n)||(n&&(ze[0]=n.toString()),n=ze);for(var i=0;i<n.length;i++){var s=Ie(t,n[i],r||e.handleEvent,!1,e.h||e);if(!s)break;e.g[s.key]=s}}function Qe(e){de(e.g,function(e,t){this.g.hasOwnProperty(t)&&Te(e)},e),e.g={}}function He(){this.g=!0}function We(e,t,n,r){e.info(function(){return"XMLHTTP TEXT ("+t+"): "+function(e,t){if(!e.g)return t;if(!t)return null;try{var n=JSON.parse(t);if(n)for(e=0;e<n.length;e++)if(Array.isArray(n[e])){var r=n[e];if(!(r.length<2)){var i=r[1];if(Array.isArray(i)&&!(i.length<1)){var s=i[0];if("noop"!=s&&"stop"!=s&&"close"!=s)for(var a=1;a<i.length;a++)i[a]=""}}}return Re(n)}catch(e){return t}}(e,n)+(r?" "+r:"")})}Ge.prototype.N=function(){Ge.$.N.call(this),Qe(this)},Ge.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},He.prototype.Ea=function(){this.g=!1},He.prototype.info=function(){};var Xe={},Ye=null;function Je(){return Ye=Ye||new Ce}function Ze(e){q.call(this,Xe.Ta,e)}function et(){var e=Je();Ne(e,new Ze(e))}function tt(e,t){q.call(this,Xe.STAT_EVENT,e),this.stat=t}function nt(e){var t=Je();Ne(t,new tt(t,e))}function rt(e,t){q.call(this,Xe.Ua,e),this.size=t}function it(e,t){if("function"!=typeof e)throw Error("Fn must not be null and must be a function");return _.setTimeout(function(){e()},t)}Xe.Ta="serverreachability",F(Ze,q),Xe.STAT_EVENT="statevent",F(tt,q),Xe.Ua="timingevent",F(rt,q);var st={NO_ERROR:0,rb:1,Eb:2,Db:3,yb:4,Cb:5,Fb:6,Qa:7,TIMEOUT:8,Ib:9},at={wb:"complete",Sb:"success",Ra:"error",Qa:"abort",Kb:"ready",Lb:"readystatechange",TIMEOUT:"timeout",Gb:"incrementaldata",Jb:"progress",zb:"downloadprogress",$b:"uploadprogress"};function ot(){}function ut(e){return e.h||(e.h=e.i())}function ct(){}ot.prototype.h=null;E={OPEN:"a",vb:"b",Ra:"c",Hb:"d"};function ht(){q.call(this,"d")}function lt(){q.call(this,"c")}function dt(){}function ft(e,t,n,r){this.l=e,this.j=t,this.m=n,this.W=r||1,this.U=new Ge(this),this.P=pt,this.V=new Be(e=J?125:void 0),this.I=null,this.i=!1,this.s=this.A=this.v=this.L=this.G=this.Y=this.B=null,this.F=[],this.g=null,this.C=0,this.o=this.u=null,this.aa=-1,this.J=!1,this.O=0,this.M=null,this.ca=this.K=this.ba=this.S=!1,this.h=new gt}function gt(){this.i=null,this.g="",this.h=!1}F(ht,q),F(lt,q),F(dt,ot),dt.prototype.g=function(){return new XMLHttpRequest},dt.prototype.i=function(){return{}};var mt=new dt,pt=45e3,yt={},vt={};function wt(e,t,n){e.L=1,e.v=Pt(Rt(t)),e.s=n,e.S=!0,bt(e,null)}function bt(e,t){e.G=Date.now(),Tt(e),e.A=Rt(e.v);var a,o,u,c,h,l,n=e.A,r=e.W;Array.isArray(r)||(r=[String(r)]),Xt(n.i,"t",r),e.C=0,n=e.l.I,e.h=new gt,e.g=Xn(e.l,n?t:null,!e.s),0<e.O&&(e.M=new Ke(R(e.Pa,e,e.g),e.O)),$e(e.U,e.g,"readystatechange",e.nb),t=e.I?fe(e.I):{},e.s?(e.u||(e.u="POST"),t["Content-Type"]="application/x-www-form-urlencoded",e.g.ha(e.A,e.u,e.s,t)):(e.u="GET",e.g.ha(e.A,e.u,null,t)),et(),a=e.j,o=e.u,u=e.A,c=e.m,h=e.W,l=e.s,a.info(function(){if(a.g)if(l)for(var e="",t=l.split("&"),n=0;n<t.length;n++){var r,i,s=t[n].split("=");1<s.length&&(r=s[0],s=s[1],e=2<=(i=r.split("_")).length&&"type"==i[1]?e+(r+"=")+s+"&":e+(r+"=redacted&"))}else e=null;else e=l;return"XMLHTTP REQ ("+c+") [attempt "+h+"]: "+o+"\n"+u+"\n"+e})}function It(e){return e.g&&("GET"==e.u&&2!=e.L&&e.l.Ha)}function Et(e,t,n){let r=!0,i;for(;!e.J&&e.C<n.length;){if(i=(a=n,u=o=void 0,o=(s=e).C,-1==(u=a.indexOf("\n",o))?vt:(o=Number(a.substring(o,u)),isNaN(o)?yt:(u+=1)+o>a.length?vt:(a=a.substr(u,o),s.C=u+o,a))),i==vt){4==t&&(e.o=4,nt(14),r=!1),We(e.j,e.m,null,"[Incomplete Response]");break}if(i==yt){e.o=4,nt(15),We(e.j,e.m,n,"[Invalid Chunk]"),r=!1;break}We(e.j,e.m,i,null),At(e,i)}var s,a,o,u;It(e)&&i!=vt&&i!=yt&&(e.h.g="",e.C=0),4!=t||0!=n.length||e.h.h||(e.o=1,nt(16),r=!1),e.i=e.i&&r,r?0<n.length&&!e.ca&&(e.ca=!0,(t=e.l).g==e&&t.ca&&!t.L&&(t.j.info("Great, no buffering proxy detected. Bytes received: "+n.length),jn(t),t.L=!0,nt(11))):(We(e.j,e.m,n,"[Invalid Chunked Response]"),Dt(e),xt(e))}function Tt(e){e.Y=Date.now()+e.P,_t(e,e.P)}function _t(e,t){if(null!=e.B)throw Error("WatchDog timer not null");e.B=it(R(e.lb,e),t)}function St(e){e.B&&(_.clearTimeout(e.B),e.B=null)}function xt(e){0==e.l.H||e.J||zn(e.l,e)}function Dt(e){St(e);var t=e.M;t&&"function"==typeof t.ra&&t.ra(),e.M=null,Ue(e.V),Qe(e.U),e.g&&(t=e.g,e.g=null,t.abort(),t.ra())}function At(e,t){try{var n=e.l;if(0!=n.H&&(n.g==e||rn(n.h,e)))if(!e.K&&rn(n.h,e)&&3==n.H){try{var r=n.Ja.g.parse(t)}catch(e){r=null}if(Array.isArray(r)&&3==r.length){var i=r;if(0==i[0]){e:if(!n.u){if(n.g){if(!(n.g.G+3e3<e.G))break e;Gn(n),Fn(n)}Un(n),nt(18)}}else n.Fa=i[1],0<n.Fa-n.V&&i[2]<37500&&n.M&&0==n.A&&!n.v&&(n.v=it(R(n.ib,n),6e3));if(nn(n.h)<=1&&n.na){try{n.na()}catch(e){}n.na=void 0}}else Qn(n,11)}else if(!e.K&&n.g!=e||Gn(n),!U(t))for(i=n.Ja.g.parse(t),t=0;t<i.length;t++){var s=i[t];if(n.V=s[0],s=s[1],2==n.H)if("c"==s[0]){n.J=s[1],n.oa=s[2];var a=s[3];null!=a&&(n.qa=a,n.j.info("VER="+n.qa));var o=s[4];null!=o&&(n.Ga=o,n.j.info("SVER="+n.Ga));var u,c,h=s[5];null!=h&&"number"==typeof h&&0<h&&(r=1.5*h,n.K=r,n.j.info("backChannelRequestTimeoutMs_="+r)),r=n;const g=e.g;if(g){const m=g.g?g.g.getResponseHeader("X-Client-Wire-Protocol"):null;m&&((u=r.h).g||-1==m.indexOf("spdy")&&-1==m.indexOf("quic")&&-1==m.indexOf("h2")||(u.j=u.l,u.g=new Set,u.h&&(sn(u,u.h),u.h=null))),!r.F||(c=g.g?g.g.getResponseHeader("X-HTTP-Session-Id"):null)&&(r.Da=c,Ot(r.G,r.F,c))}n.H=3,n.l&&n.l.Ba(),n.ca&&(n.S=Date.now()-e.G,n.j.info("Handshake RTT: "+n.S+"ms"));var l,d,f=e;(r=n).wa=Wn(r,r.I?r.oa:null,r.Y),f.K?(an(r.h,f),l=f,(d=r.K)&&l.setTimeout(d),l.B&&(St(l),Tt(l)),r.g=f):Bn(r),0<n.i.length&&On(n)}else"stop"!=s[0]&&"close"!=s[0]||Qn(n,7);else 3==n.H&&("stop"==s[0]||"close"==s[0]?"stop"==s[0]?Qn(n,7):Mn(n):"noop"!=s[0]&&n.l&&n.l.Aa(s),n.A=0)}et()}catch(e){}}function Ct(e,t){if(e.forEach&&"function"==typeof e.forEach)e.forEach(t,void 0);else if(x(e)||"string"==typeof e)Array.prototype.forEach.call(e,t,void 0);else for(var n=function(e){if(e.sa&&"function"==typeof e.sa)return e.sa();if(!e.Z||"function"!=typeof e.Z){if("undefined"!=typeof Map&&e instanceof Map)return Array.from(e.keys());if(!("undefined"!=typeof Set&&e instanceof Set)){if(x(e)||"string"==typeof e){var t=[];e=e.length;for(var n=0;n<e;n++)t.push(n);return t}t=[],n=0;for(const r in e)t[n++]=r;return t}}}(e),r=function(e){if(e.Z&&"function"==typeof e.Z)return e.Z();if("undefined"!=typeof Map&&e instanceof Map||"undefined"!=typeof Set&&e instanceof Set)return Array.from(e.values());if("string"==typeof e)return e.split("");if(x(e)){for(var t=[],n=e.length,r=0;r<n;r++)t.push(e[r]);return t}for(r in t=[],n=0,e)t[n++]=e[r];return t}(e),i=r.length,s=0;s<i;s++)t.call(void 0,r[s],n&&n[s],e)}(I=ft.prototype).setTimeout=function(e){this.P=e},I.nb=function(e){e=e.target;const t=this.M;t&&3==Dn(e)?t.l():this.Pa(e)},I.Pa=function(e){try{if(e==this.g)e:{var t=Dn(this.g),n=this.g.Ia();this.g.da();if(!(t<3)&&(3!=t||J||this.g&&(this.h.h||this.g.ja()||An(this.g)))){this.J||4!=t||7==n||et(),St(this);var r=this.g.da();this.aa=r;t:if(It(this)){var i=An(this.g);e="";var s=i.length,a=4==Dn(this.g);if(!this.h.i){if("undefined"==typeof TextDecoder){Dt(this),xt(this);var o="";break t}this.h.i=new _.TextDecoder}for(n=0;n<s;n++)this.h.h=!0,e+=this.h.i.decode(i[n],{stream:a&&n==s-1});i.splice(0,s),this.h.g+=e,this.C=0,o=this.h.g}else o=this.g.ja();if(this.i=200==r,l=this.j,d=this.u,f=this.A,g=this.m,m=this.W,p=t,y=r,l.info(function(){return"XMLHTTP RESP ("+g+") [ attempt "+m+"]: "+d+"\n"+f+"\n"+p+" "+y}),this.i){if(this.ba&&!this.K){t:{if(this.g){var u,c=this.g;if((u=c.g?c.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!U(u)){var h=u;break t}}h=null}if(!(r=h)){this.i=!1,this.o=3,nt(12),Dt(this),xt(this);break e}We(this.j,this.m,r,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,At(this,r)}this.S?(Et(this,t,o),J&&this.i&&3==t&&($e(this.U,this.V,"tick",this.mb),this.V.start())):(We(this.j,this.m,o,null),At(this,o)),4==t&&Dt(this),this.i&&!this.J&&(4==t?zn(this.l,this):(this.i=!1,Tt(this)))}else 400==r&&0<o.indexOf("Unknown SID")?(this.o=3,nt(12)):(this.o=0,nt(13)),Dt(this),xt(this)}}}catch(e){}var l,d,f,g,m,p,y},I.mb=function(){var e,t;this.g&&(e=Dn(this.g),t=this.g.ja(),this.C<t.length&&(St(this),Et(this,e,t),this.i&&4!=e&&Tt(this)))},I.cancel=function(){this.J=!0,Dt(this)},I.lb=function(){this.B=null;var e,t,n=Date.now();0<=n-this.Y?(e=this.j,t=this.A,e.info(function(){return"TIMEOUT: "+t}),2!=this.L&&(et(),nt(17)),Dt(this),this.o=2,xt(this)):_t(this,this.Y-n)};var Nt=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function kt(e,t){var n;this.g=this.s=this.j="",this.m=null,this.o=this.l="",this.h=!1,e instanceof kt?(this.h=void 0!==t?t:e.h,Mt(this,e.j),this.s=e.s,this.g=e.g,Ft(this,e.m),this.l=e.l,t=e.i,(n=new $t).i=t.i,t.g&&(n.g=new Map(t.g),n.h=t.h),Lt(this,n),this.o=e.o):e&&(n=String(e).match(Nt))?(this.h=!!t,Mt(this,n[1]||"",!0),this.s=Vt(n[2]||""),this.g=Vt(n[3]||"",!0),Ft(this,n[4]),this.l=Vt(n[5]||"",!0),Lt(this,n[6]||"",!0),this.o=Vt(n[7]||"")):(this.h=!!t,this.i=new $t(null,this.h))}function Rt(e){return new kt(e)}function Mt(e,t,n){e.j=n?Vt(t,!0):t,e.j&&(e.j=e.j.replace(/:$/,""))}function Ft(e,t){if(t){if(t=Number(t),isNaN(t)||t<0)throw Error("Bad port number "+t);e.m=t}else e.m=null}function Lt(e,t,n){var r,i;t instanceof $t?(e.i=t,r=e.i,(i=e.h)&&!r.j&&(Qt(r),r.i=null,r.g.forEach(function(e,t){var n=t.toLowerCase();t!=n&&(Ht(this,t),Xt(this,n,e))},r)),r.j=i):(n||(t=qt(t,Gt)),e.i=new $t(t,e.h))}function Ot(e,t,n){e.i.set(t,n)}function Pt(e){return Ot(e,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),e}function Vt(e,t){return e?t?decodeURI(e.replace(/%25/g,"%2525")):decodeURIComponent(e):""}function qt(e,t,n){return"string"==typeof e?(e=encodeURI(e).replace(t,Bt),e=n?e.replace(/%25([0-9a-fA-F]{2})/g,"%$1"):e):null}function Bt(e){return"%"+((e=e.charCodeAt(0))>>4&15).toString(16)+(15&e).toString(16)}kt.prototype.toString=function(){var e=[],t=this.j;t&&e.push(qt(t,Ut,!0),":");var n=this.g;return!n&&"file"!=t||(e.push("//"),(t=this.s)&&e.push(qt(t,Ut,!0),"@"),e.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.m)&&e.push(":",String(n))),(n=this.l)&&(this.g&&"/"!=n.charAt(0)&&e.push("/"),e.push(qt(n,"/"==n.charAt(0)?Kt:jt,!0))),(n=this.i.toString())&&e.push("?",n),(n=this.o)&&e.push("#",qt(n,zt)),e.join("")};var Ut=/[#\/\?@]/g,jt=/[#\?:]/g,Kt=/[#\?]/g,Gt=/[#\?@]/g,zt=/#/g;function $t(e,t){this.h=this.g=null,this.i=e||null,this.j=!!t}function Qt(n){n.g||(n.g=new Map,n.h=0,n.i&&function(e,t){if(e){e=e.split("&");for(var n=0;n<e.length;n++){var r,i=e[n].indexOf("="),s=null;0<=i?(r=e[n].substring(0,i),s=e[n].substring(i+1)):r=e[n],t(r,s?decodeURIComponent(s.replace(/\+/g," ")):"")}}}(n.i,function(e,t){n.add(decodeURIComponent(e.replace(/\+/g," ")),t)}))}function Ht(e,t){Qt(e),t=Yt(e,t),e.g.has(t)&&(e.i=null,e.h-=e.g.get(t).length,e.g.delete(t))}function Wt(e,t){return Qt(e),t=Yt(e,t),e.g.has(t)}function Xt(e,t,n){Ht(e,t),0<n.length&&(e.i=null,e.g.set(Yt(e,t),P(n)),e.h+=n.length)}function Yt(e,t){return t=String(t),t=e.j?t.toLowerCase():t}(I=$t.prototype).add=function(e,t){Qt(this),this.i=null,e=Yt(this,e);var n=this.g.get(e);return n||this.g.set(e,n=[]),n.push(t),this.h+=1,this},I.forEach=function(n,r){Qt(this),this.g.forEach(function(e,t){e.forEach(function(e){n.call(r,e,t,this)},this)},this)},I.sa=function(){Qt(this);const t=Array.from(this.g.values()),n=Array.from(this.g.keys()),r=[];for(let s=0;s<n.length;s++){var i=t[s];for(let e=0;e<i.length;e++)r.push(n[s])}return r},I.Z=function(t){Qt(this);let n=[];if("string"==typeof t)Wt(this,t)&&(n=n.concat(this.g.get(Yt(this,t))));else{t=Array.from(this.g.values());for(let e=0;e<t.length;e++)n=n.concat(t[e])}return n},I.set=function(e,t){return Qt(this),this.i=null,Wt(this,e=Yt(this,e))&&(this.h-=this.g.get(e).length),this.g.set(e,[t]),this.h+=1,this},I.get=function(e,t){return e&&0<(e=this.Z(e)).length?String(e[0]):t},I.toString=function(){if(this.i)return this.i;if(!this.g)return"";const e=[],t=Array.from(this.g.keys());for(var n=0;n<t.length;n++)for(var r=t[n],i=encodeURIComponent(String(r)),s=this.Z(r),r=0;r<s.length;r++){var a=i;""!==s[r]&&(a+="="+encodeURIComponent(String(s[r]))),e.push(a)}return this.i=e.join("&")};var Jt=class{constructor(e,t){this.h=e,this.g=t}};function Zt(e){this.l=e||10,e=_.PerformanceNavigationTiming?0<(e=_.performance.getEntriesByType("navigation")).length&&("hq"==e[0].nextHopProtocol||"h2"==e[0].nextHopProtocol):!!(_.g&&_.g.Ka&&_.g.Ka()&&_.g.Ka().ec),this.j=e?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}var en;function tn(e){return e.h||e.g&&e.g.size>=e.j}function nn(e){return e.h?1:e.g?e.g.size:0}function rn(e,t){return e.h?e.h==t:e.g&&e.g.has(t)}function sn(e,t){e.g?e.g.add(t):e.h=t}function an(e,t){e.h&&e.h==t?e.h=null:e.g&&e.g.has(t)&&e.g.delete(t)}function on(t){if(null!=t.h)return t.i.concat(t.h.F);if(null==t.g||0===t.g.size)return P(t.i);{let e=t.i;for(const n of t.g.values())e=e.concat(n.F);return e}}function un(){}function cn(){this.g=new un}function hn(e,t,n,r,i){try{t.onload=null,t.onerror=null,t.onabort=null,t.ontimeout=null,i(r)}catch(e){}}function ln(e){this.l=e.fc||null,this.j=e.ob||!1}function dn(e,t){Ce.call(this),this.F=e,this.u=t,this.m=void 0,this.readyState=fn,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C="GET",this.B="",this.g=!1,this.A=this.j=this.l=null}Zt.prototype.cancel=function(){if(this.i=on(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(const e of this.g.values())e.cancel();this.g.clear()}},un.prototype.stringify=function(e){return _.JSON.stringify(e,void 0)},un.prototype.parse=function(e){return _.JSON.parse(e,void 0)},F(ln,ot),ln.prototype.g=function(){return new dn(this.l,this.j)},ln.prototype.i=(en={},function(){return en}),F(dn,Ce);var fn=0;function gn(e){e.j.read().then(e.Xa.bind(e)).catch(e.ka.bind(e))}function mn(e){e.readyState=4,e.l=null,e.j=null,e.A=null,pn(e)}function pn(e){e.onreadystatechange&&e.onreadystatechange.call(e)}(I=dn.prototype).open=function(e,t){if(this.readyState!=fn)throw this.abort(),Error("Error reopening a connection");this.C=e,this.B=t,this.readyState=1,pn(this)},I.send=function(e){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;const t={headers:this.v,method:this.C,credentials:this.m,cache:void 0};e&&(t.body=e),(this.F||_).fetch(new Request(this.B,t)).then(this.$a.bind(this),this.ka.bind(this))},I.abort=function(){this.response=this.responseText="",this.v=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,mn(this)),this.readyState=fn},I.$a=function(e){if(this.g&&(this.l=e,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=e.headers,this.readyState=2,pn(this)),this.g&&(this.readyState=3,pn(this),this.g)))if("arraybuffer"===this.responseType)e.arrayBuffer().then(this.Ya.bind(this),this.ka.bind(this));else if(void 0!==_.ReadableStream&&"body"in e){if(this.j=e.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;gn(this)}else e.text().then(this.Za.bind(this),this.ka.bind(this))},I.Xa=function(e){var t;this.g&&(this.u&&e.value?this.response.push(e.value):this.u||(t=e.value||new Uint8Array(0),(t=this.A.decode(t,{stream:!e.done}))&&(this.response=this.responseText+=t)),(e.done?mn:pn)(this),3==this.readyState&&gn(this))},I.Za=function(e){this.g&&(this.response=this.responseText=e,mn(this))},I.Ya=function(e){this.g&&(this.response=e,mn(this))},I.ka=function(){this.g&&mn(this)},I.setRequestHeader=function(e,t){this.v.append(e,t)},I.getResponseHeader=function(e){return this.h&&this.h.get(e.toLowerCase())||""},I.getAllResponseHeaders=function(){if(!this.h)return"";const e=[],t=this.h.entries();for(var n=t.next();!n.done;)n=n.value,e.push(n[0]+": "+n[1]),n=t.next();return e.join("\r\n")},Object.defineProperty(dn.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(e){this.m=e?"include":"same-origin"}});var yn=_.JSON.parse;function vn(e){Ce.call(this),this.headers=new Map,this.u=e||null,this.h=!1,this.C=this.g=null,this.I="",this.m=0,this.j="",this.l=this.G=this.v=this.F=!1,this.B=0,this.A=null,this.K=wn,this.L=this.M=!1}F(vn,Ce);var wn="",bn=/^https?$/i,In=["POST","PUT"];function En(e,t){e.h=!1,e.g&&(e.l=!0,e.g.abort(),e.l=!1),e.j=t,e.m=5,Tn(e),Sn(e)}function Tn(e){e.F||(e.F=!0,Ne(e,"complete"),Ne(e,"error"))}function _n(e){if(e.h&&void 0!==T&&(!e.C[1]||4!=Dn(e)||2!=e.da()))if(e.v&&4==Dn(e))je(e.La,0,e);else if(Ne(e,"readystatechange"),4==Dn(e)){e.h=!1;try{var t,n,r,i,s=e.da();e:switch(s){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var a=!0;break e;default:a=!1}if((t=a)||((n=0===s)&&(!(i=String(e.I).match(Nt)[1]||null)&&_.self&&_.self.location&&(i=(r=_.self.location.protocol).substr(0,r.length-1)),n=!bn.test(i?i.toLowerCase():"")),t=n),t)Ne(e,"complete"),Ne(e,"success");else{e.m=6;try{var o=2<Dn(e)?e.g.statusText:""}catch(e){o=""}e.j=o+" ["+e.da()+"]",Tn(e)}}finally{Sn(e)}}}function Sn(e,t){if(e.g){xn(e);const n=e.g,r=e.C[0]?S:null;e.g=null,e.C=null,t||Ne(e,"ready");try{n.onreadystatechange=r}catch(e){}}}function xn(e){e.g&&e.L&&(e.g.ontimeout=null),e.A&&(_.clearTimeout(e.A),e.A=null)}function Dn(e){return e.g?e.g.readyState:0}function An(e){try{if(!e.g)return null;if("response"in e.g)return e.g.response;switch(e.K){case wn:case"text":return e.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in e.g)return e.g.mozResponseArrayBuffer}return null}catch(e){return null}}function Cn(e){let n="";return de(e,function(e,t){n+=t,n+=":",n+=e,n+="\r\n"}),n}function Nn(e,t,n){e:{for(r in n){var r=!1;break e}r=!0}r||(n=Cn(n),"string"==typeof e?null!=n&&encodeURIComponent(String(n)):Ot(e,t,n))}function kn(e,t,n){return n&&n.internalChannelParams&&n.internalChannelParams[e]||t}function Rn(e){this.Ga=0,this.i=[],this.j=new He,this.oa=this.wa=this.G=this.Y=this.g=this.Da=this.F=this.ma=this.o=this.U=this.s=null,this.fb=this.W=0,this.cb=kn("failFast",!1,e),this.M=this.v=this.u=this.m=this.l=null,this.aa=!0,this.ta=this.Fa=this.V=-1,this.ba=this.A=this.C=0,this.ab=kn("baseRetryDelayMs",5e3,e),this.hb=kn("retryDelaySeedMs",1e4,e),this.eb=kn("forwardChannelMaxRetries",2,e),this.xa=kn("forwardChannelRequestTimeoutMs",2e4,e),this.va=e&&e.xmlHttpFactory||void 0,this.Ha=e&&e.dc||!1,this.K=void 0,this.I=e&&e.supportsCrossDomainXhr||!1,this.J="",this.h=new Zt(e&&e.concurrentRequestLimit),this.Ja=new cn,this.P=e&&e.fastHandshake||!1,this.O=e&&e.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.bb=e&&e.bc||!1,e&&e.Ea&&this.j.Ea(),e&&e.forceLongPolling&&(this.aa=!1),this.ca=!this.P&&this.aa&&e&&e.detectBufferingProxy||!1,this.na=void 0,this.S=0,this.L=!1,this.pa=this.B=null}function Mn(e){var t,n;Ln(e),3==e.H&&(t=e.W++,Ot(n=Rt(e.G),"SID",e.J),Ot(n,"RID",t),Ot(n,"TYPE","terminate"),Vn(e,n),(t=new ft(e,e.j,t,void 0)).L=2,t.v=Pt(Rt(n)),n=!1,!(n=_.navigator&&_.navigator.sendBeacon?_.navigator.sendBeacon(t.v.toString(),""):n)&&_.Image&&((new Image).src=t.v,n=!0),n||(t.g=Xn(t.l,null),t.g.ha(t.v)),t.G=Date.now(),Tt(t)),Hn(e)}function Fn(e){e.g&&(jn(e),e.g.cancel(),e.g=null)}function Ln(e){Fn(e),e.u&&(_.clearTimeout(e.u),e.u=null),Gn(e),e.h.cancel(),e.m&&("number"==typeof e.m&&_.clearTimeout(e.m),e.m=null)}function On(e){tn(e.h)||e.m||(e.m=!0,Oe(e.Na,e),e.C=0)}function Pn(e,t){var n=t?t.m:e.W++,r=Rt(e.G);Ot(r,"SID",e.J),Ot(r,"RID",n),Ot(r,"AID",e.V),Vn(e,r),e.o&&e.s&&Nn(r,e.o,e.s),n=new ft(e,e.j,n,e.C+1),null===e.o&&(n.I=e.s),t&&(e.i=t.F.concat(e.i)),t=qn(e,n,1e3),n.setTimeout(Math.round(.5*e.xa)+Math.round(.5*e.xa*Math.random())),sn(e.h,n),wt(n,r,t)}function Vn(e,n){e.ma&&de(e.ma,function(e,t){Ot(n,t,e)}),e.l&&Ct({},function(e,t){Ot(n,t,e)})}function qn(e,t,r){r=Math.min(e.i.length,r);var i=e.l?R(e.l.Va,e.l,e):null;e:{var s=e.i;let n=-1;for(;;){const u=["count="+r];-1==n?0<r?(n=s[0].h,u.push("ofs="+n)):n=0:u.push("ofs="+n);let e=!0;for(let t=0;t<r;t++){var a=s[t].h,o=s[t].g;if((a-=n)<0)n=Math.max(0,s[t].h-100),e=!1;else try{!function(e,r,t){const i=t||"";try{Ct(e,function(e,t){let n=e;D(e)&&(n=Re(e)),r.push(i+t+"="+encodeURIComponent(n))})}catch(e){throw r.push(i+"type="+encodeURIComponent("_badmap")),e}}(o,u,"req"+a+"_")}catch(e){i&&i(o)}}if(e){i=u.join("&");break e}}}return e=e.i.splice(0,r),t.F=e,i}function Bn(e){e.g||e.u||(e.ba=1,Oe(e.Ma,e),e.A=0)}function Un(e){return!(e.g||e.u||3<=e.A)&&(e.ba++,e.u=it(R(e.Ma,e),$n(e,e.A)),e.A++,1)}function jn(e){null!=e.B&&(_.clearTimeout(e.B),e.B=null)}function Kn(e){e.g=new ft(e,e.j,"rpc",e.ba),null===e.o&&(e.g.I=e.s),e.g.O=0;var t=Rt(e.wa);Ot(t,"RID","rpc"),Ot(t,"SID",e.J),Ot(t,"CI",e.M?"0":"1"),Ot(t,"AID",e.V),Ot(t,"TYPE","xmlhttp"),Vn(e,t),e.o&&e.s&&Nn(t,e.o,e.s),e.K&&e.g.setTimeout(e.K);var n=e.g;e=e.oa,n.L=1,n.v=Pt(Rt(t)),n.s=null,n.S=!0,bt(n,e)}function Gn(e){null!=e.v&&(_.clearTimeout(e.v),e.v=null)}function zn(e,t){var n,r,i,s=null;if(e.g==t){Gn(e),jn(e),e.g=null;var a=2}else{if(!rn(e.h,t))return;s=t.F,an(e.h,t),a=1}if(0!=e.H)if(e.ta=t.aa,t.i)1==a?(s=t.s?t.s.length:0,t=Date.now()-t.G,n=e.C,Ne(a=Je(),new rt(a,s)),On(e)):Bn(e);else if(3==(n=t.o)||0==n&&0<e.ta||(1!=a||(i=t,nn((r=e).h)>=r.h.j-(r.m?1:0)||(r.m?(r.i=i.F.concat(r.i),0):1==r.H||2==r.H||r.C>=(r.cb?0:r.eb)||(r.m=it(R(r.Na,r,i),$n(r,r.C)),r.C++,0))))&&(2!=a||!Un(e)))switch(s&&0<s.length&&(t=e.h,t.i=t.i.concat(s)),n){case 1:Qn(e,5);break;case 4:Qn(e,10);break;case 3:Qn(e,6);break;default:Qn(e,2)}}function $n(e,t){let n=e.ab+Math.floor(Math.random()*e.hb);return e.l||(n*=2),n*t}function Qn(e,t){var n,r;e.j.info("Error code "+t),2==t?(n=null,e.l&&(n=null),r=R(e.pb,e),n||(n=new kt("//www.google.com/images/cleardot.gif"),_.location&&"http"==_.location.protocol||Mt(n,"https"),Pt(n)),function(e,t){var n=new He;if(_.Image){const r=new Image;r.onload=M(hn,n,r,"TestLoadImage: loaded",!0,t),r.onerror=M(hn,n,r,"TestLoadImage: error",!1,t),r.onabort=M(hn,n,r,"TestLoadImage: abort",!1,t),r.ontimeout=M(hn,n,r,"TestLoadImage: timeout",!1,t),_.setTimeout(function(){r.ontimeout&&r.ontimeout()},1e4),r.src=e}else t(!1)}(n.toString(),r)):nt(2),e.H=0,e.l&&e.l.za(t),Hn(e),Ln(e)}function Hn(e){var t;e.H=0,e.pa=[],e.l&&(0==(t=on(e.h)).length&&0==e.i.length||(V(e.pa,t),V(e.pa,e.i),e.h.i.length=0,P(e.i),e.i.length=0),e.l.ya())}function Wn(e,t,n){var r,i,s=n instanceof kt?Rt(n):new kt(n,void 0);return""!=s.g?(t&&(s.g=t+"."+s.g),Ft(s,s.m)):(s=(r=_.location).protocol,t=t?t+"."+r.hostname:r.hostname,r=+r.port,i=new kt(null,void 0),s&&Mt(i,s),t&&(i.g=t),r&&Ft(i,r),n&&(i.l=n),s=i),n=e.F,t=e.Da,n&&t&&Ot(s,n,t),Ot(s,"VER",e.qa),Vn(e,s),s}function Xn(e,t,n){if(t&&!e.I)throw Error("Can't create secondary domain capable XhrIo object.");return(t=n&&e.Ha&&!e.va?new vn(new ln({ob:!0})):new vn(e.va)).Oa(e.I),t}function Yn(){}function Jn(){if(X&&!(10<=Number(se)))throw Error("Environmental error: no available transport.")}function Zn(e,t){Ce.call(this),this.g=new Rn(t),this.l=e,this.h=t&&t.messageUrlParams||null,e=t&&t.messageHeaders||null,t&&t.clientProtocolHeaderRequired&&(e?e["X-Client-Protocol"]="webchannel":e={"X-Client-Protocol":"webchannel"}),this.g.s=e,e=t&&t.initMessageHeaders||null,t&&t.messageContentType&&(e?e["X-WebChannel-Content-Type"]=t.messageContentType:e={"X-WebChannel-Content-Type":t.messageContentType}),t&&t.Ca&&(e?e["X-WebChannel-Client-Profile"]=t.Ca:e={"X-WebChannel-Client-Profile":t.Ca}),this.g.U=e,(e=t&&t.cc)&&!U(e)&&(this.g.o=e),this.A=t&&t.supportsCrossDomainXhr||!1,this.v=t&&t.sendRawJson||!1,(t=t&&t.httpSessionIdParam)&&!U(t)&&(this.g.F=t,null!==(e=this.h)&&t in e&&(t in(e=this.h)&&delete e[t])),this.j=new nr(this)}function er(e){ht.call(this);var t=e.__sm__;if(t){e:{for(const n in t){e=n;break e}e=void 0}(this.i=e)&&(e=this.i,t=null!==t&&e in t?t[e]:void 0),this.data=t}else this.data=e}function tr(){lt.call(this),this.status=1}function nr(e){this.g=e}function rr(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.m=Array(this.blockSize),this.i=this.h=0,this.reset()}function ir(e,t,n){n=n||0;var r=Array(16);if("string"==typeof t)for(var i=0;i<16;++i)r[i]=t.charCodeAt(n++)|t.charCodeAt(n++)<<8|t.charCodeAt(n++)<<16|t.charCodeAt(n++)<<24;else for(i=0;i<16;++i)r[i]=t[n++]|t[n++]<<8|t[n++]<<16|t[n++]<<24;t=e.g[0],n=e.g[1];var i=e.g[2],s=e.g[3],a=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=n+((a=t+(s^n&(i^s))+r[0]+3614090360&4294967295)<<7&4294967295|a>>>25))+((a=s+(i^t&(n^i))+r[1]+3905402710&4294967295)<<12&4294967295|a>>>20))+((a=i+(n^s&(t^n))+r[2]+606105819&4294967295)<<17&4294967295|a>>>15))+((a=n+(t^i&(s^t))+r[3]+3250441966&4294967295)<<22&4294967295|a>>>10))+((a=t+(s^n&(i^s))+r[4]+4118548399&4294967295)<<7&4294967295|a>>>25))+((a=s+(i^t&(n^i))+r[5]+1200080426&4294967295)<<12&4294967295|a>>>20))+((a=i+(n^s&(t^n))+r[6]+2821735955&4294967295)<<17&4294967295|a>>>15))+((a=n+(t^i&(s^t))+r[7]+4249261313&4294967295)<<22&4294967295|a>>>10))+((a=t+(s^n&(i^s))+r[8]+1770035416&4294967295)<<7&4294967295|a>>>25))+((a=s+(i^t&(n^i))+r[9]+2336552879&4294967295)<<12&4294967295|a>>>20))+((a=i+(n^s&(t^n))+r[10]+4294925233&4294967295)<<17&4294967295|a>>>15))+((a=n+(t^i&(s^t))+r[11]+2304563134&4294967295)<<22&4294967295|a>>>10))+((a=t+(s^n&(i^s))+r[12]+1804603682&4294967295)<<7&4294967295|a>>>25))+((a=s+(i^t&(n^i))+r[13]+4254626195&4294967295)<<12&4294967295|a>>>20))+((a=i+(n^s&(t^n))+r[14]+2792965006&4294967295)<<17&4294967295|a>>>15))+((a=n+(t^i&(s^t))+r[15]+1236535329&4294967295)<<22&4294967295|a>>>10))+((a=t+(i^s&(n^i))+r[1]+4129170786&4294967295)<<5&4294967295|a>>>27))+((a=s+(n^i&(t^n))+r[6]+3225465664&4294967295)<<9&4294967295|a>>>23))+((a=i+(t^n&(s^t))+r[11]+643717713&4294967295)<<14&4294967295|a>>>18))+((a=n+(s^t&(i^s))+r[0]+3921069994&4294967295)<<20&4294967295|a>>>12))+((a=t+(i^s&(n^i))+r[5]+3593408605&4294967295)<<5&4294967295|a>>>27))+((a=s+(n^i&(t^n))+r[10]+38016083&4294967295)<<9&4294967295|a>>>23))+((a=i+(t^n&(s^t))+r[15]+3634488961&4294967295)<<14&4294967295|a>>>18))+((a=n+(s^t&(i^s))+r[4]+3889429448&4294967295)<<20&4294967295|a>>>12))+((a=t+(i^s&(n^i))+r[9]+568446438&4294967295)<<5&4294967295|a>>>27))+((a=s+(n^i&(t^n))+r[14]+3275163606&4294967295)<<9&4294967295|a>>>23))+((a=i+(t^n&(s^t))+r[3]+4107603335&4294967295)<<14&4294967295|a>>>18))+((a=n+(s^t&(i^s))+r[8]+1163531501&4294967295)<<20&4294967295|a>>>12))+((a=t+(i^s&(n^i))+r[13]+2850285829&4294967295)<<5&4294967295|a>>>27))+((a=s+(n^i&(t^n))+r[2]+4243563512&4294967295)<<9&4294967295|a>>>23))+((a=i+(t^n&(s^t))+r[7]+1735328473&4294967295)<<14&4294967295|a>>>18))+((a=n+(s^t&(i^s))+r[12]+2368359562&4294967295)<<20&4294967295|a>>>12))+((a=t+(n^i^s)+r[5]+4294588738&4294967295)<<4&4294967295|a>>>28))+((a=s+(t^n^i)+r[8]+2272392833&4294967295)<<11&4294967295|a>>>21))+((a=i+(s^t^n)+r[11]+1839030562&4294967295)<<16&4294967295|a>>>16))+((a=n+(i^s^t)+r[14]+4259657740&4294967295)<<23&4294967295|a>>>9))+((a=t+(n^i^s)+r[1]+2763975236&4294967295)<<4&4294967295|a>>>28))+((a=s+(t^n^i)+r[4]+1272893353&4294967295)<<11&4294967295|a>>>21))+((a=i+(s^t^n)+r[7]+4139469664&4294967295)<<16&4294967295|a>>>16))+((a=n+(i^s^t)+r[10]+3200236656&4294967295)<<23&4294967295|a>>>9))+((a=t+(n^i^s)+r[13]+681279174&4294967295)<<4&4294967295|a>>>28))+((a=s+(t^n^i)+r[0]+3936430074&4294967295)<<11&4294967295|a>>>21))+((a=i+(s^t^n)+r[3]+3572445317&4294967295)<<16&4294967295|a>>>16))+((a=n+(i^s^t)+r[6]+76029189&4294967295)<<23&4294967295|a>>>9))+((a=t+(n^i^s)+r[9]+3654602809&4294967295)<<4&4294967295|a>>>28))+((a=s+(t^n^i)+r[12]+3873151461&4294967295)<<11&4294967295|a>>>21))+((a=i+(s^t^n)+r[15]+530742520&4294967295)<<16&4294967295|a>>>16))+((a=n+(i^s^t)+r[2]+3299628645&4294967295)<<23&4294967295|a>>>9))+((a=t+(i^(n|~s))+r[0]+4096336452&4294967295)<<6&4294967295|a>>>26))+((a=s+(n^(t|~i))+r[7]+1126891415&4294967295)<<10&4294967295|a>>>22))+((a=i+(t^(s|~n))+r[14]+2878612391&4294967295)<<15&4294967295|a>>>17))+((a=n+(s^(i|~t))+r[5]+4237533241&4294967295)<<21&4294967295|a>>>11))+((a=t+(i^(n|~s))+r[12]+1700485571&4294967295)<<6&4294967295|a>>>26))+((a=s+(n^(t|~i))+r[3]+2399980690&4294967295)<<10&4294967295|a>>>22))+((a=i+(t^(s|~n))+r[10]+4293915773&4294967295)<<15&4294967295|a>>>17))+((a=n+(s^(i|~t))+r[1]+2240044497&4294967295)<<21&4294967295|a>>>11))+((a=t+(i^(n|~s))+r[8]+1873313359&4294967295)<<6&4294967295|a>>>26))+((a=s+(n^(t|~i))+r[15]+4264355552&4294967295)<<10&4294967295|a>>>22))+((a=i+(t^(s|~n))+r[6]+2734768916&4294967295)<<15&4294967295|a>>>17))+((a=n+(s^(i|~t))+r[13]+1309151649&4294967295)<<21&4294967295|a>>>11))+((s=(t=n+((a=t+(i^(n|~s))+r[4]+4149444226&4294967295)<<6&4294967295|a>>>26))+((a=s+(n^(t|~i))+r[11]+3174756917&4294967295)<<10&4294967295|a>>>22))^((i=s+((a=i+(t^(s|~n))+r[2]+718787259&4294967295)<<15&4294967295|a>>>17))|~t))+r[9]+3951481745&4294967295;e.g[0]=e.g[0]+t&4294967295,e.g[1]=e.g[1]+(i+(a<<21&4294967295|a>>>11))&4294967295,e.g[2]=e.g[2]+i&4294967295,e.g[3]=e.g[3]+s&4294967295}function sr(e,t){this.h=t;for(var n=[],r=!0,i=e.length-1;0<=i;i--){var s=0|e[i];r&&s==t||(n[i]=s,r=!1)}this.g=n}(I=vn.prototype).Oa=function(e){this.M=e},I.ha=function(e,t,n,r){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.I+"; newUri="+e);t=t?t.toUpperCase():"GET",this.I=e,this.j="",this.m=0,this.F=!1,this.h=!0,this.g=(this.u||mt).g(),this.C=this.u?ut(this.u):ut(mt),this.g.onreadystatechange=R(this.La,this);try{this.G=!0,this.g.open(t,String(e),!0),this.G=!1}catch(e){return void En(this,e)}if(e=n||"",n=new Map(this.headers),r)if(Object.getPrototypeOf(r)===Object.prototype)for(var i in r)n.set(i,r[i]);else{if("function"!=typeof r.keys||"function"!=typeof r.get)throw Error("Unknown input type for opt_headers: "+String(r));for(const u of r.keys())n.set(u,r.get(u))}r=Array.from(n.keys()).find(e=>"content-type"==e.toLowerCase()),i=_.FormData&&e instanceof _.FormData,0<=O(In,t)&&!r&&!i&&n.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(var[s,a]of n)this.g.setRequestHeader(s,a);this.K&&(this.g.responseType=this.K),"withCredentials"in this.g&&this.g.withCredentials!==this.M&&(this.g.withCredentials=this.M);try{xn(this),0<this.B&&((this.L=(o=this.g,X&&Q(ie,9,function(){let e=0;var t=j(String(H)).split("."),n=j("9").split("."),r=Math.max(t.length,n.length);for(let a=0;0==e&&a<r;a++)for(var i=t[a]||"",s=n[a]||"";i=/(\d*)(\D*)(.*)/.exec(i)||["","","",""],s=/(\d*)(\D*)(.*)/.exec(s)||["","","",""],(0!=i[0].length||0!=s[0].length)&&(e=K(0==i[1].length?0:parseInt(i[1],10),0==s[1].length?0:parseInt(s[1],10))||K(0==i[2].length,0==s[2].length)||K(i[2],s[2]),i=i[3],s=s[3],0==e););return 0<=e})&&"number"==typeof o.timeout&&void 0!==o.ontimeout))?(this.g.timeout=this.B,this.g.ontimeout=R(this.ua,this)):this.A=je(this.ua,this.B,this)),this.v=!0,this.g.send(e),this.v=!1}catch(e){En(this,e)}var o},I.ua=function(){void 0!==T&&this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,Ne(this,"timeout"),this.abort(8))},I.abort=function(e){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=e||7,Ne(this,"complete"),Ne(this,"abort"),Sn(this))},I.N=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),Sn(this,!0)),vn.$.N.call(this)},I.La=function(){this.s||(this.G||this.v||this.l?_n(this):this.kb())},I.kb=function(){_n(this)},I.da=function(){try{return 2<Dn(this)?this.g.status:-1}catch(e){return-1}},I.ja=function(){try{return this.g?this.g.responseText:""}catch(e){return""}},I.Wa=function(e){if(this.g){var t=this.g.responseText;return e&&0==t.indexOf(e)&&(t=t.substring(e.length)),yn(t)}},I.Ia=function(){return this.m},I.Sa=function(){return"string"==typeof this.j?this.j:String(this.j)},(I=Rn.prototype).qa=8,I.H=1,I.Na=function(t){if(this.m)if(this.m=null,1==this.H){if(!t){this.W=Math.floor(1e5*Math.random()),t=this.W++;const s=new ft(this,this.j,t,void 0);let e=this.s;if(this.U&&(e?(e=fe(e),me(e,this.U)):e=this.U),null!==this.o||this.O||(s.I=e,e=null),this.P)e:{for(var n=0,r=0;r<this.i.length;r++){var i=this.i[r];if("__data__"in i.g&&"string"==typeof(i=i.g.__data__)?i=i.length:i=void 0,void 0===i)break;if(4096<(n+=i)){n=r;break e}if(4096===n||r===this.i.length-1){n=r+1;break e}}n=1e3}else n=1e3;n=qn(this,s,n),Ot(r=Rt(this.G),"RID",t),Ot(r,"CVER",22),this.F&&Ot(r,"X-HTTP-Session-Id",this.F),Vn(this,r),e&&(this.O?n="headers="+encodeURIComponent(String(Cn(e)))+"&"+n:this.o&&Nn(r,this.o,e)),sn(this.h,s),this.bb&&Ot(r,"TYPE","init"),this.P?(Ot(r,"$req",n),Ot(r,"SID","null"),s.ba=!0,wt(s,r,null)):wt(s,r,n),this.H=2}}else 3==this.H&&(t?Pn(this,t):0==this.i.length||tn(this.h)||Pn(this))},I.Ma=function(){var e;this.u=null,Kn(this),this.ca&&!(this.L||null==this.g||this.S<=0)&&(e=2*this.S,this.j.info("BP detection timer enabled: "+e),this.B=it(R(this.jb,this),e))},I.jb=function(){this.B&&(this.B=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.M=!1,this.L=!0,nt(10),Fn(this),Kn(this))},I.ib=function(){null!=this.v&&(this.v=null,Fn(this),Un(this),nt(19))},I.pb=function(e){e?(this.j.info("Successfully pinged google.com"),nt(2)):(this.j.info("Failed to ping google.com"),nt(1))},(I=Yn.prototype).Ba=function(){},I.Aa=function(){},I.za=function(){},I.ya=function(){},I.Va=function(){},Jn.prototype.g=function(e,t){return new Zn(e,t)},F(Zn,Ce),Zn.prototype.m=function(){this.g.l=this.j,this.A&&(this.g.I=!0);var e=this.g,t=this.l,n=this.h||void 0;nt(0),e.Y=t,e.ma=n||{},e.M=e.aa,e.G=Wn(e,null,e.Y),On(e)},Zn.prototype.close=function(){Mn(this.g)},Zn.prototype.u=function(e){var t,n=this.g;"string"==typeof e?((t={}).__data__=e,e=t):this.v&&((t={}).__data__=Re(e),e=t),n.i.push(new Jt(n.fb++,e)),3==n.H&&On(n)},Zn.prototype.N=function(){this.g.l=null,delete this.j,Mn(this.g),delete this.g,Zn.$.N.call(this)},F(er,ht),F(tr,lt),F(nr,Yn),nr.prototype.Ba=function(){Ne(this.g,"a")},nr.prototype.Aa=function(e){Ne(this.g,new er(e))},nr.prototype.za=function(e){Ne(this.g,new tr)},nr.prototype.ya=function(){Ne(this.g,"b")},F(rr,function(){this.blockSize=-1}),rr.prototype.reset=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.i=this.h=0},rr.prototype.j=function(e,t){for(var n=(t=void 0===t?e.length:t)-this.blockSize,r=this.m,i=this.h,s=0;s<t;){if(0==i)for(;s<=n;)ir(this,e,s),s+=this.blockSize;if("string"==typeof e){for(;s<t;)if(r[i++]=e.charCodeAt(s++),i==this.blockSize){ir(this,r),i=0;break}}else for(;s<t;)if(r[i++]=e[s++],i==this.blockSize){ir(this,r),i=0;break}}this.h=i,this.i+=t},rr.prototype.l=function(){var e=Array((this.h<56?this.blockSize:2*this.blockSize)-this.h);e[0]=128;for(var t=1;t<e.length-8;++t)e[t]=0;for(var n=8*this.i,t=e.length-8;t<e.length;++t)e[t]=255&n,n/=256;for(this.j(e),e=Array(16),t=n=0;t<4;++t)for(var r=0;r<32;r+=8)e[n++]=this.g[t]>>>r&255;return e};var ar={};function or(e){return-128<=e&&e<128?Q(ar,e,function(e){return new sr([0|e],e<0?-1:0)}):new sr([0|e],e<0?-1:0)}function ur(e){if(isNaN(e)||!isFinite(e))return hr;if(e<0)return mr(ur(-e));for(var t=[],n=1,r=0;n<=e;r++)t[r]=e/n|0,n*=cr;return new sr(t,0)}var cr=4294967296,hr=or(0),lr=or(1),dr=or(16777216);function fr(e){if(0==e.h){for(var t=0;t<e.g.length;t++)if(0!=e.g[t])return;return 1}}function gr(e){return-1==e.h}function mr(e){for(var t=e.g.length,n=[],r=0;r<t;r++)n[r]=~e.g[r];return new sr(n,~e.h).add(lr)}function pr(e,t){return e.add(mr(t))}function yr(e,t){for(;(65535&e[t])!=e[t];)e[t+1]+=e[t]>>>16,e[t]&=65535,t++}function vr(e,t){this.g=e,this.h=t}function wr(e,t){if(fr(t))throw Error("division by zero");if(fr(e))return new vr(hr,hr);if(gr(e))return t=wr(mr(e),t),new vr(mr(t.g),mr(t.h));if(gr(t))return t=wr(e,mr(t)),new vr(mr(t.g),t.h);if(30<e.g.length){if(gr(e)||gr(t))throw Error("slowDivide_ only works with positive integers.");for(var n=lr,r=t;r.X(e)<=0;)n=br(n),r=br(r);for(var i=Ir(n,1),s=Ir(r,1),r=Ir(r,2),n=Ir(n,2);!fr(r);){var a=s.add(r);a.X(e)<=0&&(i=i.add(n),s=a),r=Ir(r,1),n=Ir(n,1)}return t=pr(e,i.R(t)),new vr(i,t)}for(i=hr;0<=e.X(t);){for(n=Math.max(1,Math.floor(e.ea()/t.ea())),r=(r=Math.ceil(Math.log(n)/Math.LN2))<=48?1:Math.pow(2,r-48),a=(s=ur(n)).R(t);gr(a)||0<a.X(e);)a=(s=ur(n-=r)).R(t);fr(s)&&(s=lr),i=i.add(s),e=pr(e,a)}return new vr(i,e)}function br(e){for(var t=e.g.length+1,n=[],r=0;r<t;r++)n[r]=e.D(r)<<1|e.D(r-1)>>>31;return new sr(n,e.h)}function Ir(e,t){var n=t>>5;t%=32;for(var r=e.g.length-n,i=[],s=0;s<r;s++)i[s]=0<t?e.D(s+n)>>>t|e.D(s+n+1)<<32-t:e.D(s+n);return new sr(i,e.h)}(I=sr.prototype).ea=function(){if(gr(this))return-mr(this).ea();for(var e=0,t=1,n=0;n<this.g.length;n++){var r=this.D(n);e+=(0<=r?r:cr+r)*t,t*=cr}return e},I.toString=function(e){if((e=e||10)<2||36<e)throw Error("radix out of range: "+e);if(fr(this))return"0";if(gr(this))return"-"+mr(this).toString(e);for(var t=ur(Math.pow(e,6)),n=this,r="";;){var i=wr(n,t).g,s=((0<(n=pr(n,i.R(t))).g.length?n.g[0]:n.h)>>>0).toString(e);if(fr(n=i))return s+r;for(;s.length<6;)s="0"+s;r=s+r}},I.D=function(e){return e<0?0:e<this.g.length?this.g[e]:this.h},I.X=function(e){return gr(e=pr(this,e))?-1:fr(e)?0:1},I.abs=function(){return gr(this)?mr(this):this},I.add=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],r=0,i=0;i<=t;i++){var s=r+(65535&this.D(i))+(65535&e.D(i)),a=(s>>>16)+(this.D(i)>>>16)+(e.D(i)>>>16),r=a>>>16;s&=65535,a&=65535,n[i]=a<<16|s}return new sr(n,-2147483648&n[n.length-1]?-1:0)},I.R=function(e){if(fr(this)||fr(e))return hr;if(gr(this))return gr(e)?mr(this).R(mr(e)):mr(mr(this).R(e));if(gr(e))return mr(this.R(mr(e)));if(this.X(dr)<0&&e.X(dr)<0)return ur(this.ea()*e.ea());for(var t=this.g.length+e.g.length,n=[],r=0;r<2*t;r++)n[r]=0;for(r=0;r<this.g.length;r++)for(var i=0;i<e.g.length;i++){var s=this.D(r)>>>16,a=65535&this.D(r),o=e.D(i)>>>16,u=65535&e.D(i);n[2*r+2*i]+=a*u,yr(n,2*r+2*i),n[2*r+2*i+1]+=s*u,yr(n,2*r+2*i+1),n[2*r+2*i+1]+=a*o,yr(n,2*r+2*i+1),n[2*r+2*i+2]+=s*o,yr(n,2*r+2*i+2)}for(r=0;r<t;r++)n[r]=n[2*r+1]<<16|n[2*r];for(r=t;r<2*t;r++)n[r]=0;return new sr(n,0)},I.gb=function(e){return wr(this,e).h},I.and=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],r=0;r<t;r++)n[r]=this.D(r)&e.D(r);return new sr(n,this.h&e.h)},I.or=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],r=0;r<t;r++)n[r]=this.D(r)|e.D(r);return new sr(n,this.h|e.h)},I.xor=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],r=0;r<t;r++)n[r]=this.D(r)^e.D(r);return new sr(n,this.h^e.h)},Jn.prototype.createWebChannel=Jn.prototype.g,Zn.prototype.send=Zn.prototype.u,Zn.prototype.open=Zn.prototype.m,st.NO_ERROR=0,st.TIMEOUT=8,st.HTTP_ERROR=6,at.COMPLETE="complete",(ct.EventType=E).OPEN="a",E.CLOSE="b",E.ERROR="c",E.MESSAGE="d",Ce.prototype.listen=Ce.prototype.O,vn.prototype.listenOnce=vn.prototype.P,vn.prototype.getLastError=vn.prototype.Sa,vn.prototype.getLastErrorCode=vn.prototype.Ia,vn.prototype.getStatus=vn.prototype.da,vn.prototype.getResponseJson=vn.prototype.Wa,vn.prototype.getResponseText=vn.prototype.ja,vn.prototype.send=vn.prototype.ha,vn.prototype.setWithCredentials=vn.prototype.Oa,rr.prototype.digest=rr.prototype.l,rr.prototype.update=rr.prototype.j,sr.prototype.multiply=sr.prototype.R,sr.prototype.modulo=sr.prototype.gb,sr.prototype.compare=sr.prototype.X,sr.prototype.toNumber=sr.prototype.ea,sr.prototype.getBits=sr.prototype.D,sr.fromNumber=ur,sr.fromString=function e(t,n){if(0==t.length)throw Error("number format error: empty string");if((n=n||10)<2||36<n)throw Error("radix out of range: "+n);if("-"==t.charAt(0))return mr(e(t.substring(1),n));if(0<=t.indexOf("-"))throw Error('number format error: interior "-" character');for(var r=ur(Math.pow(n,8)),i=hr,s=0;s<t.length;s+=8)var a=Math.min(8,t.length-s),o=parseInt(t.substring(s,s+a),n),i=a<8?(a=ur(Math.pow(n,a)),i.R(a).add(ur(o))):(i=i.R(r)).add(ur(o));return i};var Er,Tr=Je,_r=st,Sr=at,xr=Xe,Dr=10,Ar=11,Cr=ln,Nr=ct,kr=vn,Rr=rr,Mr=sr;const Fr="@firebase/firestore";class Lr{constructor(e){this.uid=e}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}Lr.UNAUTHENTICATED=new Lr(null),Lr.GOOGLE_CREDENTIALS=new Lr("google-credentials-uid"),Lr.FIRST_PARTY=new Lr("first-party-uid"),Lr.MOCK_USER=new Lr("mock-user");let Or="9.21.0";const Pr=new class{constructor(e){this.name=e,this._logLevel=v,this._logHandler=b,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in l))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel="string"==typeof e?y[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if("function"!=typeof e)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,l.DEBUG,...e),this._logHandler(this,l.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,l.VERBOSE,...e),this._logHandler(this,l.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,l.INFO,...e),this._logHandler(this,l.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,l.WARN,...e),this._logHandler(this,l.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,l.ERROR,...e),this._logHandler(this,l.ERROR,...e)}}("@firebase/firestore");function Vr(){return Pr.logLevel}function qr(e,...t){var n;Pr.logLevel<=l.DEBUG&&(n=t.map(jr),Pr.debug(`Firestore (${Or}): ${e}`,...n))}function Br(e,...t){var n;Pr.logLevel<=l.ERROR&&(n=t.map(jr),Pr.error(`Firestore (${Or}): ${e}`,...n))}function Ur(e,...t){var n;Pr.logLevel<=l.WARN&&(n=t.map(jr),Pr.warn(`Firestore (${Or}): ${e}`,...n))}function jr(t){if("string"==typeof t)return t;try{return JSON.stringify(t)}catch(e){return t}}function Kr(e="Unexpected state"){var t=`FIRESTORE (${Or}) INTERNAL ASSERTION FAILED: `+e;throw Br(t),new Error(t)}function Gr(e){e||Kr()}const zr={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class $r extends d{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class Qr{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}class Hr{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class Wr{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(Lr.UNAUTHENTICATED))}shutdown(){}}class Xr{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class Yr{constructor(e){this.t=e,this.currentUser=Lr.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(t,n){let r=this.i;const i=e=>this.i!==r?(r=this.i,n(e)):Promise.resolve();let s=new Qr;this.o=()=>{this.i++,this.currentUser=this.u(),s.resolve(),s=new Qr,t.enqueueRetryable(()=>i(this.currentUser))};const a=()=>{const e=s;t.enqueueRetryable(async()=>{await e.promise,await i(this.currentUser)})},o=e=>{qr("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=e,this.auth.addAuthTokenListener(this.o),a()};this.t.onInit(e=>o(e)),setTimeout(()=>{var e;this.auth||((e=this.t.getImmediate({optional:!0}))?o(e):(qr("FirebaseAuthCredentialsProvider","Auth not yet detected"),s.resolve(),s=new Qr))},0),a()}getToken(){const t=this.i,e=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(e).then(e=>this.i!==t?(qr("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):e?(Gr("string"==typeof e.accessToken),new Hr(e.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.o)}u(){var e=this.auth&&this.auth.getUid();return Gr(null===e||"string"==typeof e),new Lr(e)}}class Jr{constructor(e,t,n){this.h=e,this.l=t,this.m=n,this.type="FirstParty",this.user=Lr.FIRST_PARTY,this.g=new Map}p(){return this.m?this.m():null}get headers(){this.g.set("X-Goog-AuthUser",this.h);var e=this.p();return e&&this.g.set("Authorization",e),this.l&&this.g.set("X-Goog-Iam-Authorization-Token",this.l),this.g}}class Zr{constructor(e,t,n){this.h=e,this.l=t,this.m=n}getToken(){return Promise.resolve(new Jr(this.h,this.l,this.m))}start(e,t){e.enqueueRetryable(()=>t(Lr.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class ei{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&0<e.length&&this.headers.set("x-firebase-appcheck",this.value)}}class ti{constructor(e){this.I=e,this.forceRefresh=!1,this.appCheck=null,this.T=null}start(t,n){const r=e=>{null!=e.error&&qr("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${e.error.message}`);var t=e.token!==this.T;return this.T=e.token,qr("FirebaseAppCheckTokenProvider",`Received ${t?"new":"existing"} token.`),t?n(e.token):Promise.resolve()};this.o=e=>{t.enqueueRetryable(()=>r(e))};const i=e=>{qr("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=e,this.appCheck.addTokenListener(this.o)};this.I.onInit(e=>i(e)),setTimeout(()=>{var e;this.appCheck||((e=this.I.getImmediate({optional:!0}))?i(e):qr("FirebaseAppCheckTokenProvider","AppCheck not yet detected"))},0)}getToken(){var e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(e=>e?(Gr("string"==typeof e.token),this.T=e.token,new ei(e.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.appCheck.removeTokenListener(this.o)}}class ni{static A(){var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n=Math.floor(256/t.length)*t.length;let r="";for(;r.length<20;){var i=function(t){const n="undefined"!=typeof self&&(self.crypto||self.msCrypto),r=new Uint8Array(t);if(n&&"function"==typeof n.getRandomValues)n.getRandomValues(r);else for(let e=0;e<t;e++)r[e]=Math.floor(256*Math.random());return r}(40);for(let e=0;e<i.length;++e)r.length<20&&i[e]<n&&(r+=t.charAt(i[e]%t.length))}return r}}function ri(e,t){return e<t?-1:t<e?1:0}function ii(e,n,r){return e.length===n.length&&e.every((e,t)=>r(e,n[t]))}function si(e){return e+"\0"}class ai{constructor(e,t){if(this.seconds=e,(this.nanoseconds=t)<0)throw new $r(zr.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(1e9<=t)throw new $r(zr.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-62135596800)throw new $r(zr.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(253402300800<=e)throw new $r(zr.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return ai.fromMillis(Date.now())}static fromDate(e){return ai.fromMillis(e.getTime())}static fromMillis(e){var t=Math.floor(e/1e3),n=Math.floor(1e6*(e-1e3*t));return new ai(t,n)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?ri(this.nanoseconds,e.nanoseconds):ri(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){var e=this.seconds- -62135596800;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}class oi{constructor(e){this.timestamp=e}static fromTimestamp(e){return new oi(e)}static min(){return new oi(new ai(0,0))}static max(){return new oi(new ai(253402300799,999999999))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}class ui{constructor(e,t,n){void 0===t?t=0:t>e.length&&Kr(),void 0===n?n=e.length-t:n>e.length-t&&Kr(),this.segments=e,this.offset=t,this.len=n}get length(){return this.len}isEqual(e){return 0===ui.comparator(this,e)}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof ui?e.forEach(e=>{t.push(e)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return this.construct(this.segments,this.offset+(e=void 0===e?1:e),this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return 0===this.length}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,n=this.limit();t<n;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const n=Math.min(e.length,t.length);for(let r=0;r<n;r++){const n=e.get(r),i=t.get(r);if(n<i)return-1;if(n>i)return 1}return e.length<t.length?-1:e.length>t.length?1:0}}class ci extends ui{construct(e,t,n){return new ci(e,t,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}static fromString(...e){const t=[];for(const n of e){if(0<=n.indexOf("//"))throw new $r(zr.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);t.push(...n.split("/").filter(e=>0<e.length))}return new ci(t)}static emptyPath(){return new ci([])}}const hi=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class li extends ui{construct(e,t,n){return new li(e,t,n)}static isValidIdentifier(e){return hi.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),e=!li.isValidIdentifier(e)?"`"+e+"`":e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&"__name__"===this.get(0)}static keyField(){return new li(["__name__"])}static fromServerFormat(e){const t=[];let n="",r=0;var i=()=>{if(0===n.length)throw new $r(zr.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(n),n=""};let s=!1;for(;r<e.length;){const t=e[r];if("\\"===t){if(r+1===e.length)throw new $r(zr.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const t=e[r+1];if("\\"!==t&&"."!==t&&"`"!==t)throw new $r(zr.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);n+=t,r+=2}else"`"===t?s=!s:"."!==t||s?n+=t:i(),r++}if(i(),s)throw new $r(zr.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new li(t)}static emptyPath(){return new li([])}}class di{constructor(e){this.path=e}static fromPath(e){return new di(ci.fromString(e))}static fromName(e){return new di(ci.fromString(e).popFirst(5))}static empty(){return new di(ci.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return 2<=this.path.length&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return null!==e&&0===ci.comparator(this.path,e.path)}toString(){return this.path.toString()}static comparator(e,t){return ci.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new di(new ci(e.slice()))}}class fi{constructor(e,t,n,r){this.indexId=e,this.collectionGroup=t,this.fields=n,this.indexState=r}}function gi(e){return e.fields.find(e=>2===e.kind)}function mi(e){return e.fields.filter(e=>2!==e.kind)}fi.UNKNOWN_ID=-1;class pi{constructor(e,t){this.fieldPath=e,this.kind=t}}class yi{constructor(e,t){this.sequenceNumber=e,this.offset=t}static empty(){return new yi(0,bi.min())}}function vi(e,t){var n=e.toTimestamp().seconds,r=e.toTimestamp().nanoseconds+1,r=oi.fromTimestamp(1e9===r?new ai(n+1,0):new ai(n,r));return new bi(r,di.empty(),t)}function wi(e){return new bi(e.readTime,e.key,-1)}class bi{constructor(e,t,n){this.readTime=e,this.documentKey=t,this.largestBatchId=n}static min(){return new bi(oi.min(),di.empty(),-1)}static max(){return new bi(oi.max(),di.empty(),-1)}}function Ii(e,t){let n=e.readTime.compareTo(t.readTime);return 0!==n?n:(n=di.comparator(e.documentKey,t.documentKey),0!==n?n:ri(e.largestBatchId,t.largestBatchId))}const Ei="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class Ti{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}async function _i(e){if(e.code!==zr.FAILED_PRECONDITION||e.message!==Ei)throw e;qr("LocalStore","Unexpectedly lost primary lease")}class Si{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(e=>{this.isDone=!0,this.result=e,this.nextCallback&&this.nextCallback(e)},e=>{this.isDone=!0,this.error=e,this.catchCallback&&this.catchCallback(e)})}catch(e){return this.next(void 0,e)}next(r,i){return this.callbackAttached&&Kr(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(i,this.error):this.wrapSuccess(r,this.result):new Si((t,n)=>{this.nextCallback=e=>{this.wrapSuccess(r,e).next(t,n)},this.catchCallback=e=>{this.wrapFailure(i,e).next(t,n)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{var t=e();return t instanceof Si?t:Si.resolve(t)}catch(e){return Si.reject(e)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):Si.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):Si.reject(t)}static resolve(n){return new Si((e,t)=>{e(n)})}static reject(n){return new Si((e,t)=>{t(n)})}static waitFor(e){return new Si((t,n)=>{let r=0,i=0,s=!1;e.forEach(e=>{++r,e.next(()=>{++i,s&&i===r&&t()},e=>n(e))}),s=!0,i===r&&t()})}static or(e){let t=Si.resolve(!1);for(const n of e)t=t.next(e=>e?Si.resolve(e):n());return t}static forEach(e,n){const r=[];return e.forEach((e,t)=>{r.push(n.call(this,e,t))}),this.waitFor(r)}static mapArray(o,u){return new Si((t,n)=>{const r=o.length,i=new Array(r);let s=0;for(let e=0;e<r;e++){const a=e;u(o[a]).next(e=>{i[a]=e,++s,s===r&&t(i)},e=>n(e))}})}static doWhile(r,i){return new Si((e,t)=>{const n=()=>{!0===r()?i().next(()=>{n()},t):e()};n()})}}class xi{constructor(n,e){this.action=n,this.transaction=e,this.aborted=!1,this.R=new Qr,this.transaction.oncomplete=()=>{this.R.resolve()},this.transaction.onabort=()=>{e.error?this.R.reject(new Ci(n,e.error)):this.R.resolve()},this.transaction.onerror=e=>{var t=Fi(e.target.error);this.R.reject(new Ci(n,t))}}static open(e,t,n,r){try{return new xi(t,e.transaction(r,n))}catch(e){throw new Ci(t,e)}}get v(){return this.R.promise}abort(e){e&&this.R.reject(e),this.aborted||(qr("SimpleDb","Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}P(){const e=this.transaction;this.aborted||"function"!=typeof e.commit||e.commit()}store(e){var t=this.transaction.objectStore(e);return new ki(t)}}class Di{constructor(e,t,n){this.name=e,this.version=t,this.V=n,12.2===Di.S(u())&&Br("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}static delete(e){return qr("SimpleDb","Removing database:",e),Ri(window.indexedDB.deleteDatabase(e)).toPromise()}static D(){if(!function(){try{return"object"==typeof indexedDB}catch(e){return}}())return!1;if(Di.C())return!0;const e=u(),t=Di.S(e),n=0<t&&t<10,r=Di.N(e),i=0<r&&r<4.5;return!(0<e.indexOf("MSIE ")||0<e.indexOf("Trident/")||0<e.indexOf("Edge/")||n||i)}static C(){var e;return"undefined"!=typeof process&&"YES"===(null===(e=process.env)||void 0===e?void 0:e.k)}static M(e,t){return e.store(t)}static S(e){const t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),n=t?t[1].split("_").slice(0,2).join("."):"-1";return Number(n)}static N(e){const t=e.match(/Android ([\d.]+)/i),n=t?t[1].split(".").slice(0,2).join("."):"-1";return Number(n)}async O(s){return this.db||(qr("SimpleDb","Opening database:",this.name),this.db=await new Promise((n,r)=>{const i=indexedDB.open(this.name,this.version);i.onsuccess=e=>{var t=e.target.result;n(t)},i.onblocked=()=>{r(new Ci(s,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},i.onerror=e=>{var t=e.target.error;"VersionError"===t.name?r(new $r(zr.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):"InvalidStateError"===t.name?r(new $r(zr.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+t)):r(new Ci(s,t))},i.onupgradeneeded=e=>{qr("SimpleDb",'Database "'+this.name+'" requires upgrade from version:',e.oldVersion);var t=e.target.result;this.V.$(t,i.transaction,e.oldVersion,this.version).next(()=>{qr("SimpleDb","Database upgrade to version "+this.version+" complete")})}})),this.F&&(this.db.onversionchange=e=>this.F(e)),this.db}B(t){this.F=t,this.db&&(this.db.onversionchange=e=>t(e))}async runTransaction(e,t,n,r){var i="readonly"===t;let s=0;for(;;){++s;try{this.db=await this.O(e);const t=xi.open(this.db,e,i?"readonly":"readwrite",n),s=r(t).next(e=>(t.P(),e)).catch(e=>(t.abort(e),Si.reject(e))).toPromise();return s.catch(()=>{}),await t.v,s}catch(e){const t=e,n="FirebaseError"!==t.name&&s<3;if(qr("SimpleDb","Transaction failed with error:",t.message,"Retrying:",n),this.close(),!n)return Promise.reject(t)}}}close(){this.db&&this.db.close(),this.db=void 0}}class Ai{constructor(e){this.L=e,this.q=!1,this.U=null}get isDone(){return this.q}get K(){return this.U}set cursor(e){this.L=e}done(){this.q=!0}G(e){this.U=e}delete(){return Ri(this.L.delete())}}class Ci extends $r{constructor(e,t){super(zr.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}}function Ni(e){return"IndexedDbTransactionError"===e.name}class ki{constructor(e){this.store=e}put(e,t){let n;return n=void 0!==t?(qr("SimpleDb","PUT",this.store.name,e,t),this.store.put(t,e)):(qr("SimpleDb","PUT",this.store.name,"<auto-key>",e),this.store.put(e)),Ri(n)}add(e){return qr("SimpleDb","ADD",this.store.name,e,e),Ri(this.store.add(e))}get(t){return Ri(this.store.get(t)).next(e=>(qr("SimpleDb","GET",this.store.name,t,e=void 0===e?null:e),e))}delete(e){return qr("SimpleDb","DELETE",this.store.name,e),Ri(this.store.delete(e))}count(){return qr("SimpleDb","COUNT",this.store.name),Ri(this.store.count())}j(e,n){var t=this.options(e,n);if(t.index||"function"!=typeof this.store.getAll){const e=this.cursor(t),n=[];return this.W(e,(e,t)=>{n.push(t)}).next(()=>n)}{const e=this.store.getAll(t.range);return new Si((t,n)=>{e.onerror=e=>{n(e.target.error)},e.onsuccess=e=>{t(e.target.result)}})}}H(e,t){const r=this.store.getAll(e,null===t?void 0:t);return new Si((t,n)=>{r.onerror=e=>{n(e.target.error)},r.onsuccess=e=>{t(e.target.result)}})}J(e,t){qr("SimpleDb","DELETE ALL",this.store.name);const n=this.options(e,t);n.Y=!1;var r=this.cursor(n);return this.W(r,(e,t,n)=>n.delete())}X(e,t){let n;t?n=e:(n={},t=e);var r=this.cursor(n);return this.W(r,t)}Z(i){const e=this.cursor({});return new Si((n,r)=>{e.onerror=e=>{var t=Fi(e.target.error);r(t)},e.onsuccess=e=>{const t=e.target.result;t?i(t.primaryKey,t.value).next(e=>{e?t.continue():n()}):n()}})}W(e,s){const a=[];return new Si((i,t)=>{e.onerror=e=>{t(e.target.error)},e.onsuccess=e=>{const t=e.target.result;if(t){const n=new Ai(t),r=s(t.primaryKey,t.value,n);if(r instanceof Si){const e=r.catch(e=>(n.done(),Si.reject(e)));a.push(e)}n.isDone?i():null===n.K?t.continue():t.continue(n.K)}else i()}}).next(()=>Si.waitFor(a))}options(e,t){let n;return void 0!==e&&("string"==typeof e?n=e:t=e),{index:n,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),e.index){const n=this.store.index(e.index);return e.Y?n.openKeyCursor(e.range,t):n.openCursor(e.range,t)}return this.store.openCursor(e.range,t)}}function Ri(e){return new Si((n,r)=>{e.onsuccess=e=>{var t=e.target.result;n(t)},e.onerror=e=>{var t=Fi(e.target.error);r(t)}})}let Mi=!1;function Fi(e){const t=Di.S(u());if(12.2<=t&&t<13){const t="An internal error was encountered in the Indexed Database server";if(0<=e.message.indexOf(t)){const e=new $r("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return Mi||(Mi=!0,setTimeout(()=>{throw e},0)),e}}return e}class Li{constructor(e,t){this.asyncQueue=e,this.tt=t,this.task=null}start(){this.et(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return null!==this.task}et(e){qr("IndexBackiller",`Scheduled in ${e}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,async()=>{this.task=null;try{qr("IndexBackiller",`Documents written: ${await this.tt.nt()}`)}catch(e){Ni(e)?qr("IndexBackiller","Ignoring IndexedDB error during index backfill: ",e):await _i(e)}await this.et(6e4)})}}class Oi{constructor(e,t){this.localStore=e,this.persistence=t}async nt(t=50){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",e=>this.st(e,t))}st(e,t){const n=new Set;let r=t,i=!0;return Si.doWhile(()=>!0===i&&0<r,()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next(t=>null===t||n.has(t)?void(i=!1):(qr("IndexBackiller",`Processing collection: ${t}`),this.it(e,t,r).next(e=>{r-=e,n.add(t)})))).next(()=>t-r)}it(r,i,e){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(r,i).next(n=>this.localStore.localDocuments.getNextDocuments(r,i,n,e).next(e=>{const t=e.changes;return this.localStore.indexManager.updateIndexEntries(r,t).next(()=>this.rt(n,e)).next(e=>(qr("IndexBackiller",`Updating offset: ${e}`),this.localStore.indexManager.updateCollectionGroup(r,i,e))).next(()=>t.size)}))}rt(e,t){let r=e;return t.changes.forEach((e,t)=>{var n=wi(t);0<Ii(n,r)&&(r=n)}),new bi(r.readTime,r.documentKey,Math.max(t.batchId,e.largestBatchId))}}class Pi{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=e=>this.ot(e),this.ut=e=>t.writeSequenceNumber(e))}ot(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){var e=++this.previousValue;return this.ut&&this.ut(e),e}}function Vi(e){return null==e}function qi(e){return 0===e&&1/e==-1/0}function Bi(e){return"number"==typeof e&&Number.isInteger(e)&&!qi(e)&&e<=Number.MAX_SAFE_INTEGER&&e>=Number.MIN_SAFE_INTEGER}function Ui(e){let t="";for(let n=0;n<e.length;n++)0<t.length&&(t=ji(t)),t=function(e,t){let n=t;const r=e.length;for(let i=0;i<r;i++){const r=e.charAt(i);switch(r){case"\0":n+="";break;case"":n+="";break;default:n+=r}}return n}(e.get(n),t);return ji(t)}function ji(e){return e+""}function Ki(t){const n=t.length;if(Gr(2<=n),2===n)return Gr(""===t.charAt(0)&&""===t.charAt(1)),ci.emptyPath();const __PRIVATE_lastReasonableEscapeIndex=n-2,r=[];let i="";for(let a=0;a<n;){const n=t.indexOf("",a);switch((n<0||n>__PRIVATE_lastReasonableEscapeIndex)&&Kr(),t.charAt(n+1)){case"":var s=t.substring(a,n);let e;0===i.length?e=s:(i+=s,e=i,i=""),r.push(e);break;case"":i+=t.substring(a,n),i+="\0";break;case"":i+=t.substring(a,n+1);break;default:Kr()}a=n+2}return new ci(r)}Pi.ct=-1;const Gi=["userId","batchId"];function zi(e,t){return[e,Ui(t)]}function $i(e,t,n){return[e,Ui(t),n]}const Qi={},Hi=["prefixPath","collectionGroup","readTime","documentId"],Wi=["prefixPath","collectionGroup","documentId"],Xi=["collectionGroup","readTime","prefixPath","documentId"],Yi=["canonicalId","targetId"],Ji=["targetId","path"],Zi=["path","targetId"],es=["collectionId","parent"],ts=["indexId","uid"],ns=["uid","sequenceNumber"],rs=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],is=["indexId","uid","orderedDocumentKey"],ss=["userId","collectionPath","documentId"],as=["userId","collectionPath","largestBatchId"],os=["userId","collectionGroup","largestBatchId"],us=["mutationQueues","mutations","documentMutations","remoteDocuments","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries"],cs=[...us,"documentOverlays"],hs=["mutationQueues","mutations","documentMutations","remoteDocumentsV14","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries","documentOverlays"],ls=hs,ds=[...ls,"indexConfiguration","indexState","indexEntries"];class fs extends Ti{constructor(e,t){super(),this.at=e,this.currentSequenceNumber=t}}function gs(e,t){var n=e;return Di.M(n.at,t)}function ms(e){let t=0;for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&t++;return t}function ps(e,t){for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&t(n,e[n])}function ys(e){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}class vs{constructor(e,t){this.comparator=e,this.root=t||bs.EMPTY}insert(e,t){return new vs(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,bs.BLACK,null,null))}remove(e){return new vs(this.comparator,this.root.remove(e,this.comparator).copy(null,null,bs.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){var n=this.comparator(e,t.key);if(0===n)return t.value;n<0?t=t.left:0<n&&(t=t.right)}return null}indexOf(e){let t=0,n=this.root;for(;!n.isEmpty();){var r=this.comparator(e,n.key);if(0===r)return t+n.left.size;n=r<0?n.left:(t+=n.left.size+1,n.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(n){this.inorderTraversal((e,t)=>(n(e,t),!1))}toString(){const n=[];return this.inorderTraversal((e,t)=>(n.push(`${e}:${t}`),!1)),`{${n.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new ws(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new ws(this.root,e,this.comparator,!1)}getReverseIterator(){return new ws(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new ws(this.root,e,this.comparator,!0)}}class ws{constructor(e,t,n,r){this.isReverse=r,this.nodeStack=[];let i=1;for(;!e.isEmpty();)if(i=t?n(e.key,t):1,t&&r&&(i*=-1),i<0)e=this.isReverse?e.left:e.right;else{if(0===i){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();var t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return 0<this.nodeStack.length}peek(){if(0===this.nodeStack.length)return null;var e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class bs{constructor(e,t,n,r,i){this.key=e,this.value=t,this.color=null!=n?n:bs.RED,this.left=null!=r?r:bs.EMPTY,this.right=null!=i?i:bs.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,n,r,i){return new bs(null!=e?e:this.key,null!=t?t:this.value,null!=n?n:this.color,null!=r?r:this.left,null!=i?i:this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,n){let r=this;var i=n(e,r.key);return r=i<0?r.copy(null,null,null,r.left.insert(e,t,n),null):0===i?r.copy(null,t,null,null,null):r.copy(null,null,null,null,r.right.insert(e,t,n)),r.fixUp()}removeMin(){if(this.left.isEmpty())return bs.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let n,r=this;if(t(e,r.key)<0)r.left.isEmpty()||r.left.isRed()||r.left.left.isRed()||(r=r.moveRedLeft()),r=r.copy(null,null,null,r.left.remove(e,t),null);else{if(r.left.isRed()&&(r=r.rotateRight()),r.right.isEmpty()||r.right.isRed()||r.right.left.isRed()||(r=r.moveRedRight()),0===t(e,r.key)){if(r.right.isEmpty())return bs.EMPTY;n=r.right.min(),r=r.copy(n.key,n.value,null,null,r.right.removeMin())}r=r.copy(null,null,null,null,r.right.remove(e,t))}return r.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){var e=this.copy(null,null,bs.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){var e=this.copy(null,null,bs.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){var e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){var e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw Kr();if(this.right.isRed())throw Kr();var e=this.left.check();if(e!==this.right.check())throw Kr();return e+(this.isRed()?0:1)}}bs.EMPTY=null,bs.RED=!0,bs.BLACK=!1,bs.EMPTY=new class{constructor(){this.size=0}get key(){throw Kr()}get value(){throw Kr()}get color(){throw Kr()}get left(){throw Kr()}get right(){throw Kr()}copy(e,t,n,r,i){return this}insert(e,t,n){return new bs(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class Is{constructor(e){this.comparator=e,this.data=new vs(this.comparator)}has(e){return null!==this.data.get(e)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(n){this.data.inorderTraversal((e,t)=>(n(e),!1))}forEachInRange(e,t){const n=this.data.getIteratorFrom(e[0]);for(;n.hasNext();){var r=n.getNext();if(0<=this.comparator(r.key,e[1]))return;t(r.key)}}forEachWhile(e,t){let n;for(n=void 0!==t?this.data.getIteratorFrom(t):this.data.getIterator();n.hasNext();)if(!e(n.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new Es(this.data.getIterator())}getIteratorFrom(e){return new Es(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(e=>{t=t.add(e)}),t}isEqual(e){if(!(e instanceof Is))return!1;if(this.size!==e.size)return!1;const t=this.data.getIterator(),n=e.data.getIterator();for(;t.hasNext();){const e=t.getNext().key,r=n.getNext().key;if(0!==this.comparator(e,r))return!1}return!0}toArray(){const t=[];return this.forEach(e=>{t.push(e)}),t}toString(){const t=[];return this.forEach(e=>t.push(e)),"SortedSet("+t.toString()+")"}copy(e){const t=new Is(this.comparator);return t.data=e,t}}class Es{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}function Ts(e){return e.hasNext()?e.getNext():void 0}class _s{constructor(e){(this.fields=e).sort(li.comparator)}static empty(){return new _s([])}unionWith(e){let t=new Is(li.comparator);for(const e of this.fields)t=t.add(e);for(const n of e)t=t.add(n);return new _s(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return ii(this.fields,e.fields,(e,t)=>e.isEqual(t))}}class Ss extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}class xs{constructor(e){this.binaryString=e}static fromBase64String(e){var t=function(e){try{return atob(e)}catch(e){throw"undefined"!=typeof DOMException&&e instanceof DOMException?new Ss("Invalid base64 string: "+e):e}}(e);return new xs(t)}static fromUint8Array(e){var t=function(e){let t="";for(let n=0;n<e.length;++n)t+=String.fromCharCode(e[n]);return t}(e);return new xs(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return e=this.binaryString,btoa(e);var e}toUint8Array(){return function(e){const t=new Uint8Array(e.length);for(let n=0;n<e.length;n++)t[n]=e.charCodeAt(n);return t}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return ri(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}xs.EMPTY_BYTE_STRING=new xs("");const Ds=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function As(t){if(Gr(!!t),"string"!=typeof t)return{seconds:Cs(t.seconds),nanos:Cs(t.nanos)};{let e=0;var n=Ds.exec(t);Gr(!!n),n[1]&&(n=((n=n[1])+"000000000").substr(0,9),e=Number(n));const r=new Date(t);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}}function Cs(e){return"number"==typeof e?e:"string"==typeof e?Number(e):0}function Ns(e){return"string"==typeof e?xs.fromBase64String(e):xs.fromUint8Array(e)}function ks(e){var t;return"server_timestamp"===(null===(t=((null===(t=null==e?void 0:e.mapValue)||void 0===t?void 0:t.fields)||{}).__type__)||void 0===t?void 0:t.stringValue)}function Rs(e){var t=e.mapValue.fields.__previous_value__;return ks(t)?Rs(t):t}function Ms(e){var t=As(e.mapValue.fields.__local_write_time__.timestampValue);return new ai(t.seconds,t.nanos)}class Fs{constructor(e,t,n,r,i,s,a,o){this.databaseId=e,this.appId=t,this.persistenceKey=n,this.host=r,this.ssl=i,this.forceLongPolling=s,this.autoDetectLongPolling=a,this.useFetchStreams=o}}class Ls{constructor(e,t){this.projectId=e,this.database=t||"(default)"}static empty(){return new Ls("","")}get isDefaultDatabase(){return"(default)"===this.database}isEqual(e){return e instanceof Ls&&e.projectId===this.projectId&&e.database===this.database}}const Os={mapValue:{fields:{__type__:{stringValue:"__max__"}}}},Ps={nullValue:"NULL_VALUE"};function Vs(e){return"nullValue"in e?0:"booleanValue"in e?1:"integerValue"in e||"doubleValue"in e?2:"timestampValue"in e?3:"stringValue"in e?5:"bytesValue"in e?6:"referenceValue"in e?7:"geoPointValue"in e?8:"arrayValue"in e?9:"mapValue"in e?ks(e)?4:Ys(e)?9007199254740991:10:Kr()}function qs(r,i){if(r===i)return!0;var e,t,n=Vs(r);if(n!==Vs(i))return!1;switch(n){case 0:case 9007199254740991:return!0;case 1:return r.booleanValue===i.booleanValue;case 4:return Ms(r).isEqual(Ms(i));case 3:return function(e){if("string"==typeof r.timestampValue&&"string"==typeof e.timestampValue&&r.timestampValue.length===e.timestampValue.length)return r.timestampValue===e.timestampValue;var t=As(r.timestampValue),n=As(e.timestampValue);return t.seconds===n.seconds&&t.nanos===n.nanos}(i);case 5:return r.stringValue===i.stringValue;case 6:return t=i,Ns(r.bytesValue).isEqual(Ns(t.bytesValue));case 7:return r.referenceValue===i.referenceValue;case 8:return e=i,Cs((t=r).geoPointValue.latitude)===Cs(e.geoPointValue.latitude)&&Cs(t.geoPointValue.longitude)===Cs(e.geoPointValue.longitude);case 2:return function(e,t){if("integerValue"in e&&"integerValue"in t)return Cs(e.integerValue)===Cs(t.integerValue);if("doubleValue"in e&&"doubleValue"in t){var n=Cs(e.doubleValue),r=Cs(t.doubleValue);return n===r?qi(n)===qi(r):isNaN(n)&&isNaN(r)}return!1}(r,i);case 9:return ii(r.arrayValue.values||[],i.arrayValue.values||[],qs);case 10:return function(e){const t=e.mapValue.fields||{},n=i.mapValue.fields||{};if(ms(t)!==ms(n))return!1;for(const e in t)if(t.hasOwnProperty(e)&&(void 0===n[e]||!qs(t[e],n[e])))return!1;return!0}(r);default:return Kr()}}function Bs(e,t){return void 0!==(e.values||[]).find(e=>qs(e,t))}function Us(e,t){if(e===t)return 0;var n,r,i,s,a=Vs(e),o=Vs(t);if(a!==o)return ri(a,o);switch(a){case 0:case 9007199254740991:return 0;case 1:return ri(e.booleanValue,t.booleanValue);case 2:return r=t,i=Cs(e.integerValue||e.doubleValue),s=Cs(r.integerValue||r.doubleValue),i<s?-1:s<i?1:i===s?0:isNaN(i)?isNaN(s)?0:-1:1;case 3:return js(e.timestampValue,t.timestampValue);case 4:return js(Ms(e),Ms(t));case 5:return ri(e.stringValue,t.stringValue);case 6:return function(e,t){const n=Ns(e),r=Ns(t);return n.compareTo(r)}(e.bytesValue,t.bytesValue);case 7:return function(e,t){var n=e.split("/"),r=t.split("/");for(let i=0;i<n.length&&i<r.length;i++){const t=ri(n[i],r[i]);if(0!==t)return t}return ri(n.length,r.length)}(e.referenceValue,t.referenceValue);case 8:return n=e.geoPointValue,r=t.geoPointValue,0!==(s=ri(Cs(n.latitude),Cs(r.latitude)))?s:ri(Cs(n.longitude),Cs(r.longitude));case 9:return function(e,t){var n=e.values||[],r=t.values||[];for(let i=0;i<n.length&&i<r.length;++i){const t=Us(n[i],r[i]);if(t)return t}return ri(n.length,r.length)}(e.arrayValue,t.arrayValue);case 10:return function(e,t){if(e===Os.mapValue&&t===Os.mapValue)return 0;if(e===Os.mapValue)return 1;if(t===Os.mapValue)return-1;const n=e.fields||{},r=Object.keys(n),i=t.fields||{},s=Object.keys(i);r.sort(),s.sort();for(let o=0;o<r.length&&o<s.length;++o){const t=ri(r[o],s[o]);if(0!==t)return t;var a=Us(n[r[o]],i[s[o]]);if(0!==a)return a}return ri(r.length,s.length)}(e.mapValue,t.mapValue);default:throw Kr()}}function js(e,t){if("string"==typeof e&&"string"==typeof t&&e.length===t.length)return ri(e,t);var n=As(e),r=As(t),i=ri(n.seconds,r.seconds);return 0!==i?i:ri(n.nanos,r.nanos)}function Ks(e){return function s(e){return"nullValue"in e?"null":"booleanValue"in e?""+e.booleanValue:"integerValue"in e?""+e.integerValue:"doubleValue"in e?""+e.doubleValue:"timestampValue"in e?function(e){const t=As(e);return`time(${t.seconds},${t.nanos})`}(e.timestampValue):"stringValue"in e?e.stringValue:"bytesValue"in e?Ns(e.bytesValue).toBase64():"referenceValue"in e?(t=e.referenceValue,di.fromName(t).toString()):"geoPointValue"in e?`geo(${(t=e.geoPointValue).latitude},${t.longitude})`:"arrayValue"in e?function(e){let t="[",n=!0;for(const r of e.values||[])n?n=!1:t+=",",t+=s(r);return t+"]"}(e.arrayValue):"mapValue"in e?function(e){const t=Object.keys(e.fields||{}).sort();let n="{",r=!0;for(const i of t)r?r=!1:n+=",",n+=`${i}:${s(e.fields[i])}`;return n+"}"}(e.mapValue):Kr();var t}(e)}function Gs(e,t){return{referenceValue:`projects/${e.projectId}/databases/${e.database}/documents/${t.path.canonicalString()}`}}function zs(e){return e&&"integerValue"in e}function $s(e){return!!e&&"arrayValue"in e}function Qs(e){return e&&"nullValue"in e}function Hs(e){return e&&"doubleValue"in e&&isNaN(Number(e.doubleValue))}function Ws(e){return e&&"mapValue"in e}function Xs(t){if(t.geoPointValue)return{geoPointValue:Object.assign({},t.geoPointValue)};if(t.timestampValue&&"object"==typeof t.timestampValue)return{timestampValue:Object.assign({},t.timestampValue)};if(t.mapValue){const n={mapValue:{fields:{}}};return ps(t.mapValue.fields,(e,t)=>n.mapValue.fields[e]=Xs(t)),n}if(t.arrayValue){const r={arrayValue:{values:[]}};for(let e=0;e<(t.arrayValue.values||[]).length;++e)r.arrayValue.values[e]=Xs(t.arrayValue.values[e]);return r}return Object.assign({},t)}function Ys(e){return"__max__"===(((e.mapValue||{}).fields||{}).__type__||{}).stringValue}function Js(e,t){var n=Us(e.value,t.value);return 0!==n?n:e.inclusive&&!t.inclusive?-1:!e.inclusive&&t.inclusive?1:0}function Zs(e,t){var n=Us(e.value,t.value);return 0!==n?n:e.inclusive&&!t.inclusive?1:!e.inclusive&&t.inclusive?-1:0}class ea{constructor(e){this.value=e}static empty(){return new ea({mapValue:{}})}field(n){if(n.isEmpty())return this.value;{let e=this.value;for(let t=0;t<n.length-1;++t)if(e=(e.mapValue.fields||{})[n.get(t)],!Ws(e))return null;return e=(e.mapValue.fields||{})[n.lastSegment()],e||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=Xs(t)}setAll(e){let n=li.emptyPath(),r={},i=[];e.forEach((e,t)=>{if(!n.isImmediateParentOf(t)){const e=this.getFieldsMap(n);this.applyChanges(e,r,i),r={},i=[],n=t.popLast()}e?r[t.lastSegment()]=Xs(e):i.push(t.lastSegment())});var t=this.getFieldsMap(n);this.applyChanges(t,r,i)}delete(e){const t=this.field(e.popLast());Ws(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return qs(this.value,e.value)}getFieldsMap(t){let n=this.value;n.mapValue.fields||(n.mapValue={fields:{}});for(let r=0;r<t.length;++r){let e=n.mapValue.fields[t.get(r)];Ws(e)&&e.mapValue.fields||(e={mapValue:{fields:{}}},n.mapValue.fields[t.get(r)]=e),n=e}return n.mapValue.fields}applyChanges(n,e,t){ps(e,(e,t)=>n[e]=t);for(const e of t)delete n[e]}clone(){return new ea(Xs(this.value))}}class ta{constructor(e,t,n,r,i,s,a){this.key=e,this.documentType=t,this.version=n,this.readTime=r,this.createTime=i,this.data=s,this.documentState=a}static newInvalidDocument(e){return new ta(e,0,oi.min(),oi.min(),oi.min(),ea.empty(),0)}static newFoundDocument(e,t,n,r){return new ta(e,1,t,oi.min(),n,r,0)}static newNoDocument(e,t){return new ta(e,2,t,oi.min(),oi.min(),ea.empty(),0)}static newUnknownDocument(e,t){return new ta(e,3,t,oi.min(),oi.min(),ea.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(oi.min())||2!==this.documentType&&0!==this.documentType||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=ea.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=ea.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=oi.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(e){return e instanceof ta&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new ta(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class na{constructor(e,t){this.position=e,this.inclusive=t}}function ra(e,t,n){let r=0;for(let i=0;i<e.position.length;i++){const s=t[i],a=e.position[i];if(r=s.field.isKeyField()?di.comparator(di.fromName(a.referenceValue),n.key):Us(a,n.data.field(s.field)),"desc"===s.dir&&(r*=-1),0!==r)break}return r}function ia(e,t){if(null===e)return null===t;if(null===t)return!1;if(e.inclusive!==t.inclusive||e.position.length!==t.position.length)return!1;for(let n=0;n<e.position.length;n++)if(!qs(e.position[n],t.position[n]))return!1;return!0}class sa{constructor(e,t="asc"){this.field=e,this.dir=t}}class aa{}class oa extends aa{constructor(e,t,n){super(),this.field=e,this.op=t,this.value=n}static create(e,t,n){return e.isKeyField()?"in"===t||"not-in"===t?this.createKeyFieldInFilter(e,t,n):new ma(e,t,n):"array-contains"===t?new wa(e,n):"in"===t?new ba(e,n):"not-in"===t?new Ia(e,n):"array-contains-any"===t?new Ea(e,n):new oa(e,t,n)}static createKeyFieldInFilter(e,t,n){return new("in"===t?pa:ya)(e,n)}matches(e){var t=e.data.field(this.field);return"!="===this.op?null!==t&&this.matchesComparison(Us(t,this.value)):null!==t&&Vs(this.value)===Vs(t)&&this.matchesComparison(Us(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return 0===e;case"!=":return 0!==e;case">":return 0<e;case">=":return 0<=e;default:return Kr()}}isInequality(){return 0<=["<","<=",">",">=","!=","not-in"].indexOf(this.op)}getFlattenedFilters(){return[this]}getFilters(){return[this]}getFirstInequalityField(){return this.isInequality()?this.field:null}}class ua extends aa{constructor(e,t){super(),this.filters=e,this.op=t,this.ht=null}static create(e,t){return new ua(e,t)}matches(t){return ca(this)?void 0===this.filters.find(e=>!e.matches(t)):void 0!==this.filters.find(e=>e.matches(t))}getFlattenedFilters(){return null!==this.ht||(this.ht=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.ht}getFilters(){return Object.assign([],this.filters)}getFirstInequalityField(){var e=this.lt(e=>e.isInequality());return null!==e?e.field:null}lt(e){for(const t of this.getFlattenedFilters())if(e(t))return t;return null}}function ca(e){return"and"===e.op}function ha(e){return"or"===e.op}function la(e){return da(e)&&ca(e)}function da(e){for(const t of e.filters)if(t instanceof ua)return!1;return!0}function fa(e,t){var n=e.filters.concat(t);return ua.create(n,e.op)}function ga(e){return e instanceof oa?`${(t=e).field.canonicalString()} ${t.op} ${Ks(t.value)}`:e instanceof ua?(e=e).op.toString()+" {"+e.getFilters().map(ga).join(" ,")+"}":"Filter";var t}class ma extends oa{constructor(e,t,n){super(e,t,n),this.key=di.fromName(n.referenceValue)}matches(e){var t=di.comparator(e.key,this.key);return this.matchesComparison(t)}}class pa extends oa{constructor(e,t){super(e,"in",t),this.keys=va(0,t)}matches(t){return this.keys.some(e=>e.isEqual(t.key))}}class ya extends oa{constructor(e,t){super(e,"not-in",t),this.keys=va(0,t)}matches(t){return!this.keys.some(e=>e.isEqual(t.key))}}function va(e,t){var n;return((null===(n=t.arrayValue)||void 0===n?void 0:n.values)||[]).map(e=>di.fromName(e.referenceValue))}class wa extends oa{constructor(e,t){super(e,"array-contains",t)}matches(e){var t=e.data.field(this.field);return $s(t)&&Bs(t.arrayValue,this.value)}}class ba extends oa{constructor(e,t){super(e,"in",t)}matches(e){var t=e.data.field(this.field);return null!==t&&Bs(this.value.arrayValue,t)}}class Ia extends oa{constructor(e,t){super(e,"not-in",t)}matches(e){if(Bs(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;var t=e.data.field(this.field);return null!==t&&!Bs(this.value.arrayValue,t)}}class Ea extends oa{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!$s(t)||!t.arrayValue.values)&&t.arrayValue.values.some(e=>Bs(this.value.arrayValue,e))}}class Ta{constructor(e,t=null,n=[],r=[],i=null,s=null,a=null){this.path=e,this.collectionGroup=t,this.orderBy=n,this.filters=r,this.limit=i,this.startAt=s,this.endAt=a,this.ft=null}}function _a(e,t=null,n=[],r=[],i=null,s=null,a=null){return new Ta(e,t,n,r,i,s,a)}function Sa(e){const t=e;if(null===t.ft){let e=t.path.canonicalString();null!==t.collectionGroup&&(e+="|cg:"+t.collectionGroup),e+="|f:",e+=t.filters.map(e=>function t(e){if(e instanceof oa)return e.field.canonicalString()+e.op.toString()+Ks(e.value);if(la(e))return e.filters.map(e=>t(e)).join(",");var n=e.filters.map(e=>t(e)).join(",");return`${e.op}(${n})`}(e)).join(","),e+="|ob:",e+=t.orderBy.map(e=>function(e){return e.field.canonicalString()+e.dir}(e)).join(","),Vi(t.limit)||(e+="|l:",e+=t.limit),t.startAt&&(e+="|lb:",e+=t.startAt.inclusive?"b:":"a:",e+=t.startAt.position.map(e=>Ks(e)).join(",")),t.endAt&&(e+="|ub:",e+=t.endAt.inclusive?"a:":"b:",e+=t.endAt.position.map(e=>Ks(e)).join(",")),t.ft=e}return t.ft}function xa(e,t){if(e.limit!==t.limit)return!1;if(e.orderBy.length!==t.orderBy.length)return!1;for(let i=0;i<e.orderBy.length;i++)if(n=e.orderBy[i],r=t.orderBy[i],n.dir!==r.dir||!n.field.isEqual(r.field))return!1;var n,r;if(e.filters.length!==t.filters.length)return!1;for(let s=0;s<e.filters.length;s++)if(!function r(e,t){return e instanceof oa?(n=e,(s=t)instanceof oa&&n.op===s.op&&n.field.isEqual(s.field)&&qs(n.value,s.value)):e instanceof ua?(i=t)instanceof ua&&e.op===i.op&&e.filters.length===i.filters.length&&e.filters.reduce((e,t,n)=>e&&r(t,i.filters[n]),!0):void Kr();var i,n,s}(e.filters[s],t.filters[s]))return!1;return e.collectionGroup===t.collectionGroup&&!!e.path.isEqual(t.path)&&!!ia(e.startAt,t.startAt)&&ia(e.endAt,t.endAt)}function Da(e){return di.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}function Aa(e,t){return e.filters.filter(e=>e instanceof oa&&e.field.isEqual(t))}function Ca(t,n,r){let i=Ps,s=!0;for(const r of Aa(t,n)){let e=Ps,t=!0;switch(r.op){case"<":case"<=":e="nullValue"in(a=r.value)?Ps:"booleanValue"in a?{booleanValue:!1}:"integerValue"in a||"doubleValue"in a?{doubleValue:NaN}:"timestampValue"in a?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in a?{stringValue:""}:"bytesValue"in a?{bytesValue:""}:"referenceValue"in a?Gs(Ls.empty(),di.empty()):"geoPointValue"in a?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in a?{arrayValue:{}}:"mapValue"in a?{mapValue:{}}:Kr();break;case"==":case"in":case">=":e=r.value;break;case">":e=r.value,t=!1;break;case"!=":case"not-in":e=Ps}Js({value:i,inclusive:s},{value:e,inclusive:t})<0&&(i=e,s=t)}var a;if(null!==r)for(let e=0;e<t.orderBy.length;++e)if(t.orderBy[e].field.isEqual(n)){const t=r.position[e];Js({value:i,inclusive:s},{value:t,inclusive:r.inclusive})<0&&(i=t,s=r.inclusive);break}return{value:i,inclusive:s}}function Na(t,n,r){let i=Os,s=!0;for(const r of Aa(t,n)){let e=Os,t=!0;switch(r.op){case">=":case">":e="nullValue"in(a=r.value)?{booleanValue:!1}:"booleanValue"in a?{doubleValue:NaN}:"integerValue"in a||"doubleValue"in a?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in a?{stringValue:""}:"stringValue"in a?{bytesValue:""}:"bytesValue"in a?Gs(Ls.empty(),di.empty()):"referenceValue"in a?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in a?{arrayValue:{}}:"arrayValue"in a?{mapValue:{}}:"mapValue"in a?Os:Kr(),t=!1;break;case"==":case"in":case"<=":e=r.value;break;case"<":e=r.value,t=!1;break;case"!=":case"not-in":e=Os}0<Zs({value:i,inclusive:s},{value:e,inclusive:t})&&(i=e,s=t)}var a;if(null!==r)for(let e=0;e<t.orderBy.length;++e)if(t.orderBy[e].field.isEqual(n)){const t=r.position[e];0<Zs({value:i,inclusive:s},{value:t,inclusive:r.inclusive})&&(i=t,s=r.inclusive);break}return{value:i,inclusive:s}}class ka{constructor(e,t=null,n=[],r=[],i=null,s="F",a=null,o=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=n,this.filters=r,this.limit=i,this.limitType=s,this.startAt=a,this.endAt=o,this.dt=null,this._t=null,this.startAt,this.endAt}}function Ra(e,t,n,r,i,s,a,o){return new ka(e,t,n,r,i,s,a,o)}function Ma(e){return new ka(e)}function Fa(e){return 0===e.filters.length&&null===e.limit&&null==e.startAt&&null==e.endAt&&(0===e.explicitOrderBy.length||1===e.explicitOrderBy.length&&e.explicitOrderBy[0].field.isKeyField())}function La(e){return 0<e.explicitOrderBy.length?e.explicitOrderBy[0].field:null}function Oa(e){for(const t of e.filters){const e=t.getFirstInequalityField();if(null!==e)return e}return null}function Pa(e){return null!==e.collectionGroup}function Va(t){const n=t;if(null===n.dt){n.dt=[];const t=Oa(n),e=La(n);if(null!==t&&null===e)t.isKeyField()||n.dt.push(new sa(t)),n.dt.push(new sa(li.keyField(),"asc"));else{let e=!1;for(const r of n.explicitOrderBy)n.dt.push(r),r.field.isKeyField()&&(e=!0);if(!e){const t=0<n.explicitOrderBy.length?n.explicitOrderBy[n.explicitOrderBy.length-1].dir:"asc";n.dt.push(new sa(li.keyField(),t))}}}return n.dt}function qa(e){const t=e;if(!t._t)if("F"===t.limitType)t._t=_a(t.path,t.collectionGroup,Va(t),t.filters,t.limit,t.startAt,t.endAt);else{const e=[];for(const i of Va(t)){const t="desc"===i.dir?"asc":"desc";e.push(new sa(i.field,t))}var n=t.endAt?new na(t.endAt.position,t.endAt.inclusive):null,r=t.startAt?new na(t.startAt.position,t.startAt.inclusive):null;t._t=_a(t.path,t.collectionGroup,e,t.filters,t.limit,n,r)}return t._t}function Ba(e,t){t.getFirstInequalityField(),Oa(e);var n=e.filters.concat([t]);return new ka(e.path,e.collectionGroup,e.explicitOrderBy.slice(),n,e.limit,e.limitType,e.startAt,e.endAt)}function Ua(e,t,n){return new ka(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),t,n,e.startAt,e.endAt)}function ja(e,t){return xa(qa(e),qa(t))&&e.limitType===t.limitType}function Ka(e){return`${Sa(qa(e))}|lt:${e.limitType}`}function Ga(e){return`Query(target=${function(e){let t=e.path.canonicalString();return null!==e.collectionGroup&&(t+=" collectionGroup="+e.collectionGroup),0<e.filters.length&&(t+=`, filters: [${e.filters.map(e=>ga(e)).join(", ")}]`),Vi(e.limit)||(t+=", limit: "+e.limit),0<e.orderBy.length&&(t+=`, orderBy: [${e.orderBy.map(e=>function(e){return`${e.field.canonicalString()} (${e.dir})`}(e)).join(", ")}]`),e.startAt&&(t+=", startAt: ",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(e=>Ks(e)).join(",")),e.endAt&&(t+=", endAt: ",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(e=>Ks(e)).join(",")),`Target(${t})`}(qa(e))}; limitType=${e.limitType})`}function za(n,e){return e.isFoundDocument()&&(i=n,a=(s=e).key.path,null!==i.collectionGroup?s.key.hasCollectionId(i.collectionGroup)&&i.path.isPrefixOf(a):di.isDocumentKey(i.path)?i.path.isEqual(a):i.path.isImmediateParentOf(a))&&function(e){for(const t of Va(n))if(!t.field.isKeyField()&&null===e.data.field(t.field))return;return 1}(e)&&function(e){for(const t of n.filters)if(!t.matches(e))return;return 1}(e)&&(i=e,(!(e=n).startAt||(t=e.startAt,r=ra(t,Va(e),i),t.inclusive?r<=0:r<0))&&(!e.endAt||(t=e.endAt,r=ra(t,Va(e),i),t.inclusive?0<=r:0<r)));var t,r,i,s,a}function $a(e){return e.collectionGroup||(e.path.length%2==1?e.path.lastSegment():e.path.get(e.path.length-2))}function Qa(i){return(e,t)=>{let n=!1;for(const r of Va(i)){const i=function(e,i,t){var n=e.field.isKeyField()?di.comparator(i.key,t.key):function(e,t){var n=i.data.field(e),r=t.data.field(e);return null!==n&&null!==r?Us(n,r):Kr()}(e.field,t);switch(e.dir){case"asc":return n;case"desc":return-1*n;default:return Kr()}}(r,e,t);if(0!==i)return i;n=n||r.field.isKeyField()}return 0}}class Ha{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),n=this.inner[t];if(void 0!==n)for(const[t,r]of n)if(this.equalsFn(t,e))return r}has(e){return void 0!==this.get(e)}set(e,t){const n=this.mapKeyFn(e),r=this.inner[n];if(void 0===r)return this.inner[n]=[[e,t]],void this.innerSize++;for(let i=0;i<r.length;i++)if(this.equalsFn(r[i][0],e))return void(r[i]=[e,t]);r.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),n=this.inner[t];if(void 0===n)return!1;for(let r=0;r<n.length;r++)if(this.equalsFn(n[r][0],e))return 1===n.length?delete this.inner[t]:n.splice(r,1),this.innerSize--,!0;return!1}forEach(r){ps(this.inner,(e,t)=>{for(const[e,n]of t)r(e,n)})}isEmpty(){return ys(this.inner)}size(){return this.innerSize}}const Wa=new vs(di.comparator);const Xa=new vs(di.comparator);function Ya(...e){let t=Xa;for(const n of e)t=t.insert(n.key,n);return t}function Ja(e){let n=Xa;return e.forEach((e,t)=>n=n.insert(e,t.overlayedDocument)),n}function Za(){return new Ha(e=>e.toString(),(e,t)=>e.isEqual(t))}const eo=new vs(di.comparator),to=new Is(di.comparator);function no(...e){let t=to;for(const n of e)t=t.add(n);return t}const ro=new Is(ri);function io(e,t){if(e.useProto3Json){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:qi(t)?"-0":t}}function so(e){return{integerValue:""+e}}function ao(e,t){return Bi(t)?so(t):io(e,t)}class oo{constructor(){this._=void 0}}function uo(e,t){return e instanceof mo?zs(n=t)||n&&"doubleValue"in n?t:{integerValue:0}:null;var n}class co extends oo{}class ho extends oo{constructor(e){super(),this.elements=e}}function lo(e,t){const n=yo(t);for(const t of e.elements)n.some(e=>qs(e,t))||n.push(t);return{arrayValue:{values:n}}}class fo extends oo{constructor(e){super(),this.elements=e}}function go(e,t){let n=yo(t);for(const t of e.elements)n=n.filter(e=>!qs(e,t));return{arrayValue:{values:n}}}class mo extends oo{constructor(e,t){super(),this.serializer=e,this.wt=t}}function po(e){return Cs(e.integerValue||e.doubleValue)}function yo(e){return $s(e)&&e.arrayValue.values?e.arrayValue.values.slice():[]}class vo{constructor(e,t){this.field=e,this.transform=t}}class wo{constructor(e,t){this.version=e,this.transformResults=t}}class bo{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new bo}static exists(e){return new bo(void 0,e)}static updateTime(e){return new bo(e)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function Io(e,t){return void 0!==e.updateTime?t.isFoundDocument()&&t.version.isEqual(e.updateTime):void 0===e.exists||e.exists===t.isFoundDocument()}class Eo{}function To(e,n){if(!e.hasLocalMutations||n&&0===n.fields.length)return null;if(null===n)return e.isNoDocument()?new Ro(e.key,bo.none()):new Do(e.key,e.data,bo.none());{const i=e.data,s=ea.empty();let t=new Is(li.comparator);for(var r of n.fields)if(!t.has(r)){let e=i.field(r);null===e&&1<r.length&&(r=r.popLast(),e=i.field(r)),null===e?s.delete(r):s.set(r,e),t=t.add(r)}return new Ao(e.key,s,new _s(t.toArray()),bo.none())}}function _o(e,t,n){e instanceof Do?function(e,t,n){const r=e.value.clone(),i=No(e.fieldTransforms,t,n.transformResults);r.setAll(i),t.convertToFoundDocument(n.version,r).setHasCommittedMutations()}(e,t,n):e instanceof Ao?function(e,t,n){if(!Io(e.precondition,t))return t.convertToUnknownDocument(n.version);const r=No(e.fieldTransforms,t,n.transformResults),i=t.data;i.setAll(Co(e)),i.setAll(r),t.convertToFoundDocument(n.version,i).setHasCommittedMutations()}(e,t,n):t.convertToNoDocument(n.version).setHasCommittedMutations()}function So(e,t,n,r){return e instanceof Do?function(e,t,n,r){if(!Io(e.precondition,t))return n;const i=e.value.clone(),s=ko(e.fieldTransforms,r,t);return i.setAll(s),t.convertToFoundDocument(t.version,i).setHasLocalMutations(),null}(e,t,n,r):e instanceof Ao?function(e,t,n,r){if(!Io(e.precondition,t))return n;const i=ko(e.fieldTransforms,r,t),s=t.data;return s.setAll(Co(e)),s.setAll(i),t.convertToFoundDocument(t.version,s).setHasLocalMutations(),null===n?null:n.unionWith(e.fieldMask.fields).unionWith(e.fieldTransforms.map(e=>e.field))}(e,t,n,r):(t=t,n=n,Io(e.precondition,t)?(t.convertToNoDocument(t.version).setHasLocalMutations(),null):n)}function xo(e,t){return e.type===t.type&&!!e.key.isEqual(t.key)&&!!e.precondition.isEqual(t.precondition)&&(n=e.fieldTransforms,r=t.fieldTransforms,!!(void 0===n&&void 0===r||n&&r&&ii(n,r,(e,t)=>function(e,t){return e.field.isEqual(t.field)&&(e=e.transform,t=t.transform,e instanceof ho&&t instanceof ho||e instanceof fo&&t instanceof fo?ii(e.elements,t.elements,qs):e instanceof mo&&t instanceof mo?qs(e.wt,t.wt):e instanceof co&&t instanceof co)}(e,t)))&&(0===e.type?e.value.isEqual(t.value):1!==e.type||e.data.isEqual(t.data)&&e.fieldMask.isEqual(t.fieldMask)));var n,r}class Do extends Eo{constructor(e,t,n,r=[]){super(),this.key=e,this.value=t,this.precondition=n,this.fieldTransforms=r,this.type=0}getFieldMask(){return null}}class Ao extends Eo{constructor(e,t,n,r,i=[]){super(),this.key=e,this.data=t,this.fieldMask=n,this.precondition=r,this.fieldTransforms=i,this.type=1}getFieldMask(){return this.fieldMask}}function Co(n){const r=new Map;return n.fieldMask.fields.forEach(e=>{var t;e.isEmpty()||(t=n.data.field(e),r.set(e,t))}),r}function No(e,t,n){const r=new Map;Gr(e.length===n.length);for(let h=0;h<n.length;h++){var i=e[h],s=i.transform,a=t.data.field(i.field);r.set(i.field,(o=s,u=a,c=n[h],o instanceof ho?lo(o,u):o instanceof fo?go(o,u):c))}var o,u,c;return r}function ko(e,t,n){const r=new Map;for(const c of e){const e=c.transform,h=n.data.field(c.field);r.set(c.field,(i=e,s=h,a=t,u=o=void 0,i instanceof co?function(e){const t={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:a.seconds,nanos:a.nanoseconds}}}};return(e=e&&ks(e)?Rs(e):e)&&(t.fields.__previous_value__=e),{mapValue:t}}(s):i instanceof ho?lo(i,s):i instanceof fo?go(i,s):(o=uo(i=i,s),u=po(o)+po(i.wt),zs(o)&&zs(i.wt)?so(u):io(i.serializer,u))))}var i,s,a,o,u;return r}class Ro extends Eo{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class Mo extends Eo{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class Fo{constructor(e,t,n,r){this.batchId=e,this.localWriteTime=t,this.baseMutations=n,this.mutations=r}applyToRemoteDocument(e,t){var n=t.mutationResults;for(let r=0;r<this.mutations.length;r++){const i=this.mutations[r];i.key.isEqual(e.key)&&_o(i,e,n[r])}}applyToLocalView(e,t){for(const n of this.baseMutations)n.key.isEqual(e.key)&&(t=So(n,e,t,this.localWriteTime));for(const r of this.mutations)r.key.isEqual(e.key)&&(t=So(r,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(s,a){const o=Za();return this.mutations.forEach(e=>{const t=s.get(e.key),n=t.overlayedDocument;let r=this.applyToLocalView(n,t.mutatedFields);r=a.has(e.key)?null:r;var i=To(n,r);null!==i&&o.set(e.key,i),n.isValidDocument()||n.convertToNoDocument(oi.min())}),o}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),no())}isEqual(e){return this.batchId===e.batchId&&ii(this.mutations,e.mutations,(e,t)=>xo(e,t))&&ii(this.baseMutations,e.baseMutations,(e,t)=>xo(e,t))}}class Lo{constructor(e,t,n,r){this.batch=e,this.commitVersion=t,this.mutationResults=n,this.docVersions=r}static from(e,t,n){Gr(e.mutations.length===n.length);let r=eo;var i=e.mutations;for(let s=0;s<i.length;s++)r=r.insert(i[s].key,n[s].version);return new Lo(e,t,n,r)}}class Oo{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return null!==e&&this.mutation===e.mutation}toString(){return`Overlay{\n      largestBatchId: ${this.largestBatchId},\n      mutation: ${this.mutation.toString()}\n    }`}}class Po{constructor(e,t){this.count=e,this.unchangedNames=t}}function Vo(e){switch(e){default:return Kr(),0;case zr.CANCELLED:case zr.UNKNOWN:case zr.DEADLINE_EXCEEDED:case zr.RESOURCE_EXHAUSTED:case zr.INTERNAL:case zr.UNAVAILABLE:case zr.UNAUTHENTICATED:return;case zr.INVALID_ARGUMENT:case zr.NOT_FOUND:case zr.ALREADY_EXISTS:case zr.PERMISSION_DENIED:case zr.FAILED_PRECONDITION:case zr.ABORTED:case zr.OUT_OF_RANGE:case zr.UNIMPLEMENTED:case zr.DATA_LOSS:return 1}}function qo(e){if(void 0===e)return Br("GRPC error has no .code"),zr.UNKNOWN;switch(e){case Er.OK:return zr.OK;case Er.CANCELLED:return zr.CANCELLED;case Er.UNKNOWN:return zr.UNKNOWN;case Er.DEADLINE_EXCEEDED:return zr.DEADLINE_EXCEEDED;case Er.RESOURCE_EXHAUSTED:return zr.RESOURCE_EXHAUSTED;case Er.INTERNAL:return zr.INTERNAL;case Er.UNAVAILABLE:return zr.UNAVAILABLE;case Er.UNAUTHENTICATED:return zr.UNAUTHENTICATED;case Er.INVALID_ARGUMENT:return zr.INVALID_ARGUMENT;case Er.NOT_FOUND:return zr.NOT_FOUND;case Er.ALREADY_EXISTS:return zr.ALREADY_EXISTS;case Er.PERMISSION_DENIED:return zr.PERMISSION_DENIED;case Er.FAILED_PRECONDITION:return zr.FAILED_PRECONDITION;case Er.ABORTED:return zr.ABORTED;case Er.OUT_OF_RANGE:return zr.OUT_OF_RANGE;case Er.UNIMPLEMENTED:return zr.UNIMPLEMENTED;case Er.DATA_LOSS:return zr.DATA_LOSS;default:return Kr()}}(at=Er=Er||{})[at.OK=0]="OK",at[at.CANCELLED=1]="CANCELLED",at[at.UNKNOWN=2]="UNKNOWN",at[at.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",at[at.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",at[at.NOT_FOUND=5]="NOT_FOUND",at[at.ALREADY_EXISTS=6]="ALREADY_EXISTS",at[at.PERMISSION_DENIED=7]="PERMISSION_DENIED",at[at.UNAUTHENTICATED=16]="UNAUTHENTICATED",at[at.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",at[at.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",at[at.ABORTED=10]="ABORTED",at[at.OUT_OF_RANGE=11]="OUT_OF_RANGE",at[at.UNIMPLEMENTED=12]="UNIMPLEMENTED",at[at.INTERNAL=13]="INTERNAL",at[at.UNAVAILABLE=14]="UNAVAILABLE",at[at.DATA_LOSS=15]="DATA_LOSS";class Bo{constructor(){this.onExistenceFilterMismatchCallbacks=new Map}static get instance(){return Uo}static getOrCreateInstance(){return null===Uo&&(Uo=new Bo),Uo}onExistenceFilterMismatch(e){const t=Symbol();return this.onExistenceFilterMismatchCallbacks.set(t,e),()=>this.onExistenceFilterMismatchCallbacks.delete(t)}notifyOnExistenceFilterMismatch(t){this.onExistenceFilterMismatchCallbacks.forEach(e=>e(t))}}let Uo=null;function jo(){return new TextEncoder}const Ko=new Mr([4294967295,4294967295],0);function Go(e){const t=jo().encode(e),n=new Rr;return n.update(t),new Uint8Array(n.digest())}function zo(e){const t=new DataView(e.buffer),n=t.getUint32(0,!0),r=t.getUint32(4,!0),i=t.getUint32(8,!0),s=t.getUint32(12,!0);return[new Mr([n,r],0),new Mr([i,s],0)]}class $o{constructor(e,t,n){if(this.bitmap=e,this.padding=t,this.hashCount=n,t<0||8<=t)throw new Qo(`Invalid padding: ${t}`);if(n<0)throw new Qo(`Invalid hash count: ${n}`);if(0<e.length&&0===this.hashCount)throw new Qo(`Invalid hash count: ${n}`);if(0===e.length&&0!==t)throw new Qo(`Invalid padding when bitmap length is 0: ${t}`);this.yt=8*e.length-t,this.It=Mr.fromNumber(this.yt)}Tt(e,t,n){let r=e.add(t.multiply(Mr.fromNumber(n)));return 1===r.compare(Ko)&&(r=new Mr([r.getBits(0),r.getBits(1)],0)),r.modulo(this.It).toNumber()}Et(e){return 0!=(this.bitmap[Math.floor(e/8)]&1<<e%8)}At(e){if(0===this.yt)return!1;const t=Go(e),[n,r]=zo(t);for(let i=0;i<this.hashCount;i++){const t=this.Tt(n,r,i);if(!this.Et(t))return!1}return!0}static create(e,t,n){const r=e%8==0?0:8-e%8,i=new Uint8Array(Math.ceil(e/8)),s=new $o(i,r,t);return n.forEach(e=>s.insert(e)),s}insert(t){if(0!==this.yt){const n=Go(t),[r,i]=zo(n);for(let e=0;e<this.hashCount;e++){const n=this.Tt(r,i,e);this.Rt(n)}}}Rt(e){var t=Math.floor(e/8);this.bitmap[t]|=1<<e%8}}class Qo extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class Ho{constructor(e,t,n,r,i){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=n,this.documentUpdates=r,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(e,t,n){const r=new Map;return r.set(e,Wo.createSynthesizedTargetChangeForCurrentChange(e,t,n)),new Ho(oi.min(),r,new vs(ri),Wa,no())}}class Wo{constructor(e,t,n,r,i){this.resumeToken=e,this.current=t,this.addedDocuments=n,this.modifiedDocuments=r,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(e,t,n){return new Wo(n,t,no(),no(),no())}}class Xo{constructor(e,t,n,r){this.vt=e,this.removedTargetIds=t,this.key=n,this.Pt=r}}class Yo{constructor(e,t){this.targetId=e,this.bt=t}}class Jo{constructor(e,t,n=xs.EMPTY_BYTE_STRING,r=null){this.state=e,this.targetIds=t,this.resumeToken=n,this.cause=r}}class Zo{constructor(){this.Vt=0,this.St=nu(),this.Dt=xs.EMPTY_BYTE_STRING,this.Ct=!1,this.xt=!0}get current(){return this.Ct}get resumeToken(){return this.Dt}get Nt(){return 0!==this.Vt}get kt(){return this.xt}Mt(e){0<e.approximateByteSize()&&(this.xt=!0,this.Dt=e)}Ot(){let n=no(),r=no(),i=no();return this.St.forEach((e,t)=>{switch(t){case 0:n=n.add(e);break;case 2:r=r.add(e);break;case 1:i=i.add(e);break;default:Kr()}}),new Wo(this.Dt,this.Ct,n,r,i)}$t(){this.xt=!1,this.St=nu()}Ft(e,t){this.xt=!0,this.St=this.St.insert(e,t)}Bt(e){this.xt=!0,this.St=this.St.remove(e)}Lt(){this.Vt+=1}qt(){--this.Vt}Ut(){this.xt=!0,this.Ct=!0}}class eu{constructor(e){this.Kt=e,this.Gt=new Map,this.Qt=Wa,this.jt=tu(),this.zt=new vs(ri)}Wt(e){for(const t of e.vt)e.Pt&&e.Pt.isFoundDocument()?this.Ht(t,e.Pt):this.Jt(t,e.key,e.Pt);for(const n of e.removedTargetIds)this.Jt(n,e.key,e.Pt)}Yt(n){this.forEachTarget(n,e=>{const t=this.Xt(e);switch(n.state){case 0:this.Zt(e)&&t.Mt(n.resumeToken);break;case 1:t.qt(),t.Nt||t.$t(),t.Mt(n.resumeToken);break;case 2:t.qt(),t.Nt||this.removeTarget(e);break;case 3:this.Zt(e)&&(t.Ut(),t.Mt(n.resumeToken));break;case 4:this.Zt(e)&&(this.te(e),t.Mt(n.resumeToken));break;default:Kr()}})}forEachTarget(e,n){0<e.targetIds.length?e.targetIds.forEach(n):this.Gt.forEach((e,t)=>{this.Zt(t)&&n(t)})}ee(e){const t=e.targetId,n=e.bt.count,r=this.ne(t);if(r){var i=r.target;if(Da(i))if(0===n){const e=new di(i.path);this.Jt(t,e,ta.newNoDocument(e,oi.min()))}else Gr(1===n);else{const r=this.se(t);if(r!==n){const n=this.ie(e,r);if(0!==n){this.te(t);const e=2===n?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.zt=this.zt.insert(t,e)}null===(i=Bo.instance)||void 0===i||i.notifyOnExistenceFilterMismatch(function(e,t,n){var r;const i={localCacheCount:t,existenceFilterCount:n.count},s=n.unchangedNames;return s&&(i.bloomFilter={applied:0===e,hashCount:null!==(r=null==s?void 0:s.hashCount)&&void 0!==r?r:0,bitmapLength:null!==(r=null===(r=null===(r=null==s?void 0:s.bits)||void 0===r?void 0:r.bitmap)||void 0===r?void 0:r.length)&&void 0!==r?r:0,padding:null!==(r=null===(r=null==s?void 0:s.bits)||void 0===r?void 0:r.padding)&&void 0!==r?r:0}),i}(n,r,e.bt))}}}}ie(e,t){var{unchangedNames:n,count:r}=e.bt;if(!n||!n.bits)return 1;var{bits:{bitmap:i="",padding:s=0},hashCount:n=0}=n;let a,o;try{a=Ns(i).toUint8Array()}catch(e){if(e instanceof Ss)return Ur("Decoding the base64 bloom filter in existence filter failed ("+e.message+"); ignoring the bloom filter and falling back to full re-query."),1;throw e}try{o=new $o(a,s,n)}catch(e){return Ur(e instanceof Qo?"BloomFilter error: ":"Applying bloom filter failed: ",e),1}return 0===o.yt?1:r!==t-this.re(e.targetId,o)?2:0}re(n,r){const e=this.Kt.getRemoteKeysForTarget(n);let i=0;return e.forEach(e=>{var t=this.Kt.oe(),t=`projects/${t.projectId}/databases/${t.database}/documents/${e.path.canonicalString()}`;r.At(t)||(this.Jt(n,e,null),i++)}),i}ue(r){const i=new Map;this.Gt.forEach((e,t)=>{var n=this.ne(t);if(n){if(e.current&&Da(n.target)){const i=new di(n.target.path);null!==this.Qt.get(i)||this.ce(t,i)||this.Jt(t,i,ta.newNoDocument(i,r))}e.kt&&(i.set(t,e.Ot()),e.$t())}});let s=no();this.jt.forEach((e,t)=>{let n=!0;t.forEachWhile(e=>{var t=this.ne(e);return!t||"TargetPurposeLimboResolution"===t.purpose||(n=!1)}),n&&(s=s.add(e))}),this.Qt.forEach((e,t)=>t.setReadTime(r));var e=new Ho(r,i,this.zt,this.Qt,s);return this.Qt=Wa,this.jt=tu(),this.zt=new vs(ri),e}Ht(e,t){var n;this.Zt(e)&&(n=this.ce(e,t.key)?2:0,this.Xt(e).Ft(t.key,n),this.Qt=this.Qt.insert(t.key,t),this.jt=this.jt.insert(t.key,this.ae(t.key).add(e)))}Jt(e,t,n){if(this.Zt(e)){const r=this.Xt(e);this.ce(e,t)?r.Ft(t,1):r.Bt(t),this.jt=this.jt.insert(t,this.ae(t).delete(e)),n&&(this.Qt=this.Qt.insert(t,n))}}removeTarget(e){this.Gt.delete(e)}se(e){var t=this.Xt(e).Ot();return this.Kt.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}Lt(e){this.Xt(e).Lt()}Xt(e){let t=this.Gt.get(e);return t||(t=new Zo,this.Gt.set(e,t)),t}ae(e){let t=this.jt.get(e);return t||(t=new Is(ri),this.jt=this.jt.insert(e,t)),t}Zt(e){var t=null!==this.ne(e);return t||qr("WatchChangeAggregator","Detected inactive target",e),t}ne(e){var t=this.Gt.get(e);return t&&t.Nt?null:this.Kt.he(e)}te(t){this.Gt.set(t,new Zo),this.Kt.getRemoteKeysForTarget(t).forEach(e=>{this.Jt(t,e,null)})}ce(e,t){return this.Kt.getRemoteKeysForTarget(e).has(t)}}function tu(){return new vs(di.comparator)}function nu(){return new vs(di.comparator)}const ru={asc:"ASCENDING",desc:"DESCENDING"},iu={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},su={and:"AND",or:"OR"};class au{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function ou(e,t){return e.useProto3Json||Vi(t)?t:{value:t}}function uu(e,t){return e.useProto3Json?`${new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+t.nanoseconds).slice(-9)}Z`:{seconds:""+t.seconds,nanos:t.nanoseconds}}function cu(e,t){return e.useProto3Json?t.toBase64():t.toUint8Array()}function hu(e){return Gr(!!e),oi.fromTimestamp((t=As(e),new ai(t.seconds,t.nanos)));var t}function lu(e,t){return e=e,new ci(["projects",e.projectId,"databases",e.database]).child("documents").child(t).canonicalString()}function du(e){var t=ci.fromString(e);return Gr(Nu(t)),t}function fu(e,t){return lu(e.databaseId,t.path)}function gu(e,t){const n=du(t);if(n.get(1)!==e.databaseId.projectId)throw new $r(zr.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+e.databaseId.projectId);if(n.get(3)!==e.databaseId.database)throw new $r(zr.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+e.databaseId.database);return new di(vu(n))}function mu(e,t){return lu(e.databaseId,t)}function pu(e){var t=du(e);return 4===t.length?ci.emptyPath():vu(t)}function yu(e){return new ci(["projects",e.databaseId.projectId,"databases",e.databaseId.database]).canonicalString()}function vu(e){return Gr(4<e.length&&"documents"===e.get(4)),e.popFirst(5)}function wu(e,t,n){return{name:fu(e,t),fields:n.value.mapValue.fields}}function bu(e,t,n){const r=gu(e,t.name),i=hu(t.updateTime),s=t.createTime?hu(t.createTime):oi.min(),a=new ea({mapValue:{fields:t.fields}}),o=ta.newFoundDocument(r,i,s,a);return n&&o.setHasCommittedMutations(),n?o.setHasCommittedMutations():o}function Iu(e,t){let n;if(t instanceof Do)n={update:wu(e,t.key,t.value)};else if(t instanceof Ro)n={delete:fu(e,t.key)};else if(t instanceof Ao)n={update:wu(e,t.key,t.data),updateMask:function(e){const t=[];return e.fields.forEach(e=>t.push(e.canonicalString())),{fieldPaths:t}}(t.fieldMask)};else{if(!(t instanceof Mo))return Kr();n={verify:fu(e,t.key)}}return 0<t.fieldTransforms.length&&(n.updateTransforms=t.fieldTransforms.map(e=>function(e){var t=e.transform;if(t instanceof co)return{fieldPath:e.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(t instanceof ho)return{fieldPath:e.field.canonicalString(),appendMissingElements:{values:t.elements}};if(t instanceof fo)return{fieldPath:e.field.canonicalString(),removeAllFromArray:{values:t.elements}};if(t instanceof mo)return{fieldPath:e.field.canonicalString(),increment:t.wt};throw Kr()}(e))),t.precondition.isNone||(n.currentDocument=void 0!==(r=t.precondition).updateTime?{updateTime:(t=r.updateTime,uu(e,t.toTimestamp()))}:void 0!==r.exists?{exists:r.exists}:Kr()),n;var r}function Eu(t,n){const e=n.currentDocument?void 0!==(i=n.currentDocument).updateTime?bo.updateTime(hu(i.updateTime)):void 0!==i.exists?bo.exists(i.exists):bo.none():bo.none(),r=n.updateTransforms?n.updateTransforms.map(e=>function(e,t){let n=null;if("setToServerValue"in t)Gr("REQUEST_TIME"===t.setToServerValue),n=new co;else if("appendMissingElements"in t){const e=t.appendMissingElements.values||[];n=new ho(e)}else if("removeAllFromArray"in t){const e=t.removeAllFromArray.values||[];n=new fo(e)}else"increment"in t?n=new mo(e,t.increment):Kr();var r=li.fromServerFormat(t.fieldPath);return new vo(r,n)}(t,e)):[];var i;if(n.update){n.update.name;var s=gu(t,n.update.name),a=new ea({mapValue:{fields:n.update.fields}});if(n.updateMask){const t=function(){const e=n.updateMask.fieldPaths||[];return new _s(e.map(e=>li.fromServerFormat(e)))}();return new Ao(s,a,t,e,r)}return new Do(s,a,e,r)}if(n.delete){const r=gu(t,n.delete);return new Ro(r,e)}if(n.verify){const r=gu(t,n.verify);return new Mo(r,e)}return Kr()}function Tu(e,t){return{documents:[mu(e,t.path)]}}function _u(e,t){const n={structuredQuery:{}},r=t.path;null!==t.collectionGroup?(n.parent=mu(e,r),n.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(n.parent=mu(e,r.popLast()),n.structuredQuery.from=[{collectionId:r.lastSegment()}]);var i=function(e){if(0!==e.length)return function n(e){return e instanceof oa?function(e){if("=="===e.op){if(Hs(e.value))return{unaryFilter:{field:Au(e.field),op:"IS_NAN"}};if(Qs(e.value))return{unaryFilter:{field:Au(e.field),op:"IS_NULL"}}}else if("!="===e.op){if(Hs(e.value))return{unaryFilter:{field:Au(e.field),op:"IS_NOT_NAN"}};if(Qs(e.value))return{unaryFilter:{field:Au(e.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Au(e.field),op:xu(e.op),value:e.value}}}(e):e instanceof ua?function(e){const t=e.getFilters().map(e=>n(e));return 1===t.length?t[0]:{compositeFilter:{op:Du(e.op),filters:t}}}(e):Kr()}(ua.create(e,"and"))}(t.filters);i&&(n.structuredQuery.where=i);i=function(e){if(0!==e.length)return e.map(e=>function(e){return{field:Au(e.field),direction:(e=e.dir,ru[e])}}(e))}(t.orderBy);i&&(n.structuredQuery.orderBy=i);i=ou(e,t.limit);return null!==i&&(n.structuredQuery.limit=i),t.startAt&&(n.structuredQuery.startAt={before:(i=t.startAt).inclusive,values:i.position}),t.endAt&&(n.structuredQuery.endAt={before:!(t=t.endAt).inclusive,values:t.position}),n}function Su(e){let t=pu(e.parent);const n=e.structuredQuery,r=n.from?n.from.length:0;let i=null;if(0<r){Gr(1===r);const g=n.from[0];g.allDescendants?i=g.collectionId:t=t.child(g.collectionId)}let s=[];n.where&&(s=function(){const e=function t(e){return void 0!==e.unaryFilter?function(e){switch(e.unaryFilter.op){case"IS_NAN":const t=Cu(e.unaryFilter.field);return oa.create(t,"==",{doubleValue:NaN});case"IS_NULL":const n=Cu(e.unaryFilter.field);return oa.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const r=Cu(e.unaryFilter.field);return oa.create(r,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const i=Cu(e.unaryFilter.field);return oa.create(i,"!=",{nullValue:"NULL_VALUE"});default:return Kr()}}(e):void 0!==e.fieldFilter?function(e){return oa.create(Cu(e.fieldFilter.field),function(e){switch(e){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return Kr()}}(e.fieldFilter.op),e.fieldFilter.value)}(e):void 0!==e.compositeFilter?function(e){return ua.create(e.compositeFilter.filters.map(e=>t(e)),function(e){switch(e){case"AND":return"and";case"OR":return"or";default:return Kr()}}(e.compositeFilter.op))}(e):Kr()}(n.where);return e instanceof ua&&la(e)?e.getFilters():[e]}());let a=[];n.orderBy&&(a=n.orderBy.map(e=>function(e){return new sa(Cu(e.field),function(){switch(e.direction){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}())}(e)));let o=null;var u,c,h,l;n.limit&&(o=(e=n.limit,Vi(u="object"==typeof e?e.value:e)?null:u));let d=null;n.startAt&&(d=(c=n.startAt,l=!!c.before,h=c.values||[],new na(h,l)));let f=null;return n.endAt&&(f=(c=n.endAt,h=!c.before,l=c.values||[],new na(l,h))),Ra(t,i,a,s,o,"F",d,f)}function xu(e){return iu[e]}function Du(e){return su[e]}function Au(e){return{fieldPath:e.canonicalString()}}function Cu(e){return li.fromServerFormat(e.fieldPath)}function Nu(e){return 4<=e.length&&"projects"===e.get(0)&&"databases"===e.get(2)}class ku{constructor(e,t,n,r,i=oi.min(),s=oi.min(),a=xs.EMPTY_BYTE_STRING,o=null){this.target=e,this.targetId=t,this.purpose=n,this.sequenceNumber=r,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=s,this.resumeToken=a,this.expectedCount=o}withSequenceNumber(e){return new ku(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new ku(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new ku(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new ku(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}class Ru{constructor(e){this.le=e}}function Mu(e,t){const n=t.key,r={prefixPath:n.getCollectionPath().popLast().toArray(),collectionGroup:n.collectionGroup,documentId:n.path.lastSegment(),readTime:Fu(t.readTime),hasCommittedMutations:t.hasCommittedMutations};if(t.isFoundDocument())r.document={name:fu(i=e.le,(e=t).key),fields:e.data.value.mapValue.fields,updateTime:uu(i,e.version.toTimestamp()),createTime:uu(i,e.createTime.toTimestamp())};else if(t.isNoDocument())r.noDocument={path:n.path.toArray(),readTime:Lu(t.version)};else{if(!t.isUnknownDocument())return Kr();r.unknownDocument={path:n.path.toArray(),version:Lu(t.version)}}var i;return r}function Fu(e){var t=e.toTimestamp();return[t.seconds,t.nanoseconds]}function Lu(e){var t=e.toTimestamp();return{seconds:t.seconds,nanoseconds:t.nanoseconds}}function Ou(e){var t=new ai(e.seconds,e.nanoseconds);return oi.fromTimestamp(t)}function Pu(t,e){const n=(e.baseMutations||[]).map(e=>Eu(t.le,e));for(let s=0;s<e.mutations.length-1;++s){const n=e.mutations[s];if(s+1<e.mutations.length&&void 0!==e.mutations[s+1].transform){const r=e.mutations[s+1];n.updateTransforms=r.transform.fieldTransforms,e.mutations.splice(s+1,1),++s}}const r=e.mutations.map(e=>Eu(t.le,e)),i=ai.fromMillis(e.localWriteTimeMs);return new Fo(e.batchId,i,n,r)}function Vu(e){var t,n=Ou(e.readTime),r=void 0!==e.lastLimboFreeSnapshotVersion?Ou(e.lastLimboFreeSnapshotVersion):oi.min();let i;return i=void 0!==e.query.documents?(Gr(1===(t=e.query).documents.length),qa(Ma(pu(t.documents[0])))):qa(Su(e.query)),new ku(i,e.targetId,"TargetPurposeListen",e.lastListenSequenceNumber,n,r,xs.fromBase64String(e.resumeToken))}function qu(e,t){var n=Lu(t.snapshotVersion),r=Lu(t.lastLimboFreeSnapshotVersion),i=(Da(t.target)?Tu:_u)(e.le,t.target),s=t.resumeToken.toBase64();return{targetId:t.targetId,canonicalId:Sa(t.target),readTime:n,resumeToken:s,lastListenSequenceNumber:t.sequenceNumber,lastLimboFreeSnapshotVersion:r,query:i}}function Bu(e){var t=Su({parent:e.parent,structuredQuery:e.structuredQuery});return"LAST"===e.limitType?Ua(t,t.limit,"L"):t}function Uu(e,t){return new Oo(t.largestBatchId,Eu(e.le,t.overlayMutation))}function ju(e,t){var n=t.path.lastSegment();return[e,Ui(t.path.popLast()),n]}function Ku(e,t,n,r){return{indexId:e,uid:t.uid||"",sequenceNumber:n,readTime:Lu(r.readTime),documentKey:Ui(r.documentKey.path),largestBatchId:r.largestBatchId}}class Gu{getBundleMetadata(e,t){return zu(e).get(t).next(e=>{if(e)return{id:(t=e).bundleId,createTime:Ou(t.createTime),version:t.version};var t})}saveBundleMetadata(e,t){return zu(e).put({bundleId:(n=t).id,createTime:Lu(hu(n.createTime)),version:n.version});var n}getNamedQuery(e,t){return $u(e).get(t).next(e=>{if(e)return{name:(t=e).name,query:Bu(t.bundledQuery),readTime:Ou(t.readTime)};var t})}saveNamedQuery(e,t){return $u(e).put({name:(t=t).name,readTime:Lu(hu(t.readTime)),bundledQuery:t.bundledQuery})}}function zu(e){return gs(e,"bundles")}function $u(e){return gs(e,"namedQueries")}class Qu{constructor(e,t){this.serializer=e,this.userId=t}static fe(e,t){var n=t.uid||"";return new Qu(e,n)}getOverlay(e,t){return Hu(e).get(ju(this.userId,t)).next(e=>e?Uu(this.serializer,e):null)}getOverlays(e,t){const n=Za();return Si.forEach(t,t=>this.getOverlay(e,t).next(e=>{null!==e&&n.set(t,e)})).next(()=>n)}saveOverlays(r,i,e){const s=[];return e.forEach((e,t)=>{var n=new Oo(i,t);s.push(this.de(r,n))}),Si.waitFor(s)}removeOverlaysForBatchId(n,e,r){const t=new Set;e.forEach(e=>t.add(Ui(e.getCollectionPath())));const i=[];return t.forEach(e=>{var t=IDBKeyRange.bound([this.userId,e,r],[this.userId,e,r+1],!1,!0);i.push(Hu(n).J("collectionPathOverlayIndex",t))}),Si.waitFor(i)}getOverlaysForCollection(e,t,n){const r=Za(),i=Ui(t),s=IDBKeyRange.bound([this.userId,i,n],[this.userId,i,Number.POSITIVE_INFINITY],!0);return Hu(e).j("collectionPathOverlayIndex",s).next(e=>{for(const t of e){const e=Uu(this.serializer,t);r.set(e.getKey(),e)}return r})}getOverlaysForCollectionGroup(e,t,n,i){const s=Za();let a;var r=IDBKeyRange.bound([this.userId,t,n],[this.userId,t,Number.POSITIVE_INFINITY],!0);return Hu(e).X({index:"collectionGroupOverlayIndex",range:r},(e,t,n)=>{const r=Uu(this.serializer,t);s.size()<i||r.largestBatchId===a?(s.set(r.getKey(),r),a=r.largestBatchId):n.done()}).next(()=>s)}de(e,t){return Hu(e).put(function(e,t,n){var[,r,i]=ju(t,n.mutation.key);return{userId:t,collectionPath:r,documentId:i,collectionGroup:n.mutation.key.getCollectionGroup(),largestBatchId:n.largestBatchId,overlayMutation:Iu(e.le,n.mutation)}}(this.serializer,this.userId,t))}}function Hu(e){return gs(e,"documentOverlays")}class Wu{constructor(){}_e(e,t){this.we(e,t),t.me()}we(e,t){var n,r;"nullValue"in e?this.ge(t,5):"booleanValue"in e?(this.ge(t,10),t.ye(e.booleanValue?1:0)):"integerValue"in e?(this.ge(t,15),t.ye(Cs(e.integerValue))):"doubleValue"in e?(n=Cs(e.doubleValue),isNaN(n)?this.ge(t,13):(this.ge(t,15),qi(n)?t.ye(0):t.ye(n))):"timestampValue"in e?(r=e.timestampValue,this.ge(t,20),"string"==typeof r?t.pe(r):(t.pe(`${r.seconds||""}`),t.ye(r.nanos||0))):"stringValue"in e?(this.Ie(e.stringValue,t),this.Te(t)):"bytesValue"in e?(this.ge(t,30),t.Ee(Ns(e.bytesValue)),this.Te(t)):"referenceValue"in e?this.Ae(e.referenceValue,t):"geoPointValue"in e?(r=e.geoPointValue,this.ge(t,45),t.ye(r.latitude||0),t.ye(r.longitude||0)):"mapValue"in e?Ys(e)?this.ge(t,Number.MAX_SAFE_INTEGER):(this.Re(e.mapValue,t),this.Te(t)):"arrayValue"in e?(this.ve(e.arrayValue,t),this.Te(t)):Kr()}Ie(e,t){this.ge(t,25),this.Pe(e,t)}Pe(e,t){t.pe(e)}Re(e,t){var n=e.fields||{};this.ge(t,55);for(const e of Object.keys(n))this.Ie(e,t),this.we(n[e],t)}ve(e,t){var n=e.values||[];this.ge(t,50);for(const e of n)this.we(e,t)}Ae(e,t){this.ge(t,37),di.fromName(e).path.forEach(e=>{this.ge(t,60),this.Pe(e,t)})}ge(e,t){e.ye(t)}Te(e){e.ye(2)}}function Xu(e){var t=64-function(e){let t=0;for(let r=0;r<8;++r){var n=function(e){if(0===e)return 8;let t=0;return e>>4==0&&(t+=4,e<<=4),e>>6==0&&(t+=2,e<<=2),e>>7==0&&(t+=1),t}(255&e[r]);if(t+=n,8!==n)break}return t}(e);return Math.ceil(t/8)}Wu.be=new Wu;class Yu{constructor(){this.buffer=new Uint8Array(1024),this.position=0}Ve(e){const t=e[Symbol.iterator]();let n=t.next();for(;!n.done;)this.Se(n.value),n=t.next();this.De()}Ce(e){const t=e[Symbol.iterator]();let n=t.next();for(;!n.done;)this.xe(n.value),n=t.next();this.Ne()}ke(e){for(const t of e){const e=t.charCodeAt(0);if(e<128)this.Se(e);else if(e<2048)this.Se(960|e>>>6),this.Se(128|63&e);else if(t<"\ud800"||"\udbff"<t)this.Se(480|e>>>12),this.Se(128|63&e>>>6),this.Se(128|63&e);else{const e=t.codePointAt(0);this.Se(240|e>>>18),this.Se(128|63&e>>>12),this.Se(128|63&e>>>6),this.Se(128|63&e)}}this.De()}Me(e){for(const t of e){const e=t.charCodeAt(0);if(e<128)this.xe(e);else if(e<2048)this.xe(960|e>>>6),this.xe(128|63&e);else if(t<"\ud800"||"\udbff"<t)this.xe(480|e>>>12),this.xe(128|63&e>>>6),this.xe(128|63&e);else{const e=t.codePointAt(0);this.xe(240|e>>>18),this.xe(128|63&e>>>12),this.xe(128|63&e>>>6),this.xe(128|63&e)}}this.Ne()}Oe(e){var t=this.$e(e),n=Xu(t);this.Fe(1+n),this.buffer[this.position++]=255&n;for(let r=t.length-n;r<t.length;++r)this.buffer[this.position++]=255&t[r]}Be(e){var t=this.$e(e),n=Xu(t);this.Fe(1+n),this.buffer[this.position++]=~(255&n);for(let r=t.length-n;r<t.length;++r)this.buffer[this.position++]=~(255&t[r])}Le(){this.qe(255),this.qe(255)}Ue(){this.Ke(255),this.Ke(255)}reset(){this.position=0}seed(e){this.Fe(e.length),this.buffer.set(e,this.position),this.position+=e.length}Ge(){return this.buffer.slice(0,this.position)}$e(e){const t=function(e){const t=new DataView(new ArrayBuffer(8));return t.setFloat64(0,e,!1),new Uint8Array(t.buffer)}(e),n=0!=(128&t[0]);t[0]^=n?255:128;for(let r=1;r<t.length;++r)t[r]^=n?255:0;return t}Se(e){var t=255&e;0==t?(this.qe(0),this.qe(255)):255==t?(this.qe(255),this.qe(0)):this.qe(t)}xe(e){var t=255&e;0==t?(this.Ke(0),this.Ke(255)):255==t?(this.Ke(255),this.Ke(0)):this.Ke(e)}De(){this.qe(0),this.qe(1)}Ne(){this.Ke(0),this.Ke(1)}qe(e){this.Fe(1),this.buffer[this.position++]=e}Ke(e){this.Fe(1),this.buffer[this.position++]=~e}Fe(e){var t=e+this.position;if(!(t<=this.buffer.length)){let e=2*this.buffer.length;e<t&&(e=t);const n=new Uint8Array(e);n.set(this.buffer),this.buffer=n}}}class Ju{constructor(e){this.Qe=e}Ee(e){this.Qe.Ve(e)}pe(e){this.Qe.ke(e)}ye(e){this.Qe.Oe(e)}me(){this.Qe.Le()}}class Zu{constructor(e){this.Qe=e}Ee(e){this.Qe.Ce(e)}pe(e){this.Qe.Me(e)}ye(e){this.Qe.Be(e)}me(){this.Qe.Ue()}}class ec{constructor(){this.Qe=new Yu,this.je=new Ju(this.Qe),this.ze=new Zu(this.Qe)}seed(e){this.Qe.seed(e)}We(e){return 0===e?this.je:this.ze}Ge(){return this.Qe.Ge()}reset(){this.Qe.reset()}}class tc{constructor(e,t,n,r){this.indexId=e,this.documentKey=t,this.arrayValue=n,this.directionalValue=r}He(){const e=this.directionalValue.length,t=0===e||255===this.directionalValue[e-1]?e+1:e,n=new Uint8Array(t);return n.set(this.directionalValue,0),t!==e?n.set([0],this.directionalValue.length):++n[n.length-1],new tc(this.indexId,this.documentKey,this.arrayValue,n)}}function nc(e,t){let n=e.indexId-t.indexId;return 0!==n?n:(n=rc(e.arrayValue,t.arrayValue),0!==n?n:(n=rc(e.directionalValue,t.directionalValue),0!==n?n:di.comparator(e.documentKey,t.documentKey)))}function rc(e,t){for(let r=0;r<e.length&&r<t.length;++r){var n=e[r]-t[r];if(0!=n)return n}return e.length-t.length}class ic{constructor(e){this.collectionId=null!=e.collectionGroup?e.collectionGroup:e.path.lastSegment(),this.Je=e.orderBy,this.Ye=[];for(const t of e.filters){const e=t;e.isInequality()?this.Xe=e:this.Ye.push(e)}}Ze(e){Gr(e.collectionGroup===this.collectionId);var t=gi(e);if(void 0!==t&&!this.tn(t))return!1;var n=mi(e);let r=0,i=0;for(;r<n.length&&this.tn(n[r]);++r);if(r===n.length)return!0;if(void 0!==this.Xe){const e=n[r];if(!this.en(this.Xe,e)||!this.nn(this.Je[i++],e))return!1;++r}for(;r<n.length;++r){const e=n[r];if(i>=this.Je.length||!this.nn(this.Je[i++],e))return!1}return!0}tn(e){for(const t of this.Ye)if(this.en(t,e))return!0;return!1}en(e,t){if(void 0===e||!e.field.isEqual(t.fieldPath))return!1;var n="array-contains"===e.op||"array-contains-any"===e.op;return 2===t.kind==n}nn(e,t){return!!e.field.isEqual(t.fieldPath)&&(0===t.kind&&"asc"===e.dir||1===t.kind&&"desc"===e.dir)}}function sc(e){if(0===e.getFilters().length)return[];const t=function t(e){if(Gr(e instanceof oa||e instanceof ua),e instanceof oa)return e;if(1===e.filters.length)return t(e.filters[0]);const n=e.filters.map(e=>t(e));let r=ua.create(n,e.op);return r=lc(r),uc(r)?r:(Gr(r instanceof ua),Gr(ca(r)),Gr(1<r.filters.length),r.filters.reduce((e,t)=>cc(e,t)))}(function t(n){var e;if(Gr(n instanceof oa||n instanceof ua),n instanceof oa){if(n instanceof ba){const r=(null===(e=null===(e=n.value.arrayValue)||void 0===e?void 0:e.values)||void 0===e?void 0:e.map(e=>oa.create(n.field,"==",e)))||[];return ua.create(r,"or")}return n}const r=n.filters.map(e=>t(e));return ua.create(r,n.op)}(e));return Gr(uc(t)),ac(t)||oc(t)?[t]:t.getFilters()}function ac(e){return e instanceof oa}function oc(e){return e instanceof ua&&la(e)}function uc(e){return ac(e)||oc(e)||function(e){if(e instanceof ua&&ha(e)){for(const t of e.getFilters())if(!ac(t)&&!oc(t))return!1;return!0}return!1}(e)}function cc(e,t){var n,r;return Gr(e instanceof oa||e instanceof ua),Gr(t instanceof oa||t instanceof ua),lc(e instanceof oa?t instanceof oa?(n=e,r=t,ua.create([n,r],"and")):hc(e,t):t instanceof oa?hc(t,e):function(e,t){if(Gr(0<e.filters.length&&0<t.filters.length),ca(e)&&ca(t))return fa(e,t.getFilters());const n=ha(e)?e:t,r=ha(e)?t:e,i=n.filters.map(e=>cc(e,r));return ua.create(i,"or")}(e,t))}function hc(t,e){if(ca(e))return fa(e,t.getFilters());var n=e.filters.map(e=>cc(t,e));return ua.create(n,"or")}function lc(t){if(Gr(t instanceof oa||t instanceof ua),t instanceof oa)return t;const e=t.getFilters();if(1===e.length)return lc(e[0]);if(da(t))return t;const n=e.map(e=>lc(e)),r=[];return n.forEach(e=>{e instanceof oa?r.push(e):e instanceof ua&&(e.op===t.op?r.push(...e.filters):r.push(e))}),1===r.length?r[0]:ua.create(r,t.op)}class dc{constructor(){this.sn=new fc}addToCollectionParentIndex(e,t){return this.sn.add(t),Si.resolve()}getCollectionParents(e,t){return Si.resolve(this.sn.getEntries(t))}addFieldIndex(e,t){return Si.resolve()}deleteFieldIndex(e,t){return Si.resolve()}getDocumentsMatchingTarget(e,t){return Si.resolve(null)}getIndexType(e,t){return Si.resolve(0)}getFieldIndexes(e,t){return Si.resolve([])}getNextCollectionGroupToUpdate(e){return Si.resolve(null)}getMinOffset(e,t){return Si.resolve(bi.min())}getMinOffsetFromCollectionGroup(e,t){return Si.resolve(bi.min())}updateCollectionGroup(e,t,n){return Si.resolve()}updateIndexEntries(e,t){return Si.resolve()}}class fc{constructor(){this.index={}}add(e){const t=e.lastSegment(),n=e.popLast(),r=this.index[t]||new Is(ci.comparator),i=!r.has(n);return this.index[t]=r.add(n),i}has(e){const t=e.lastSegment(),n=e.popLast(),r=this.index[t];return r&&r.has(n)}getEntries(e){return(this.index[e]||new Is(ci.comparator)).toArray()}}const gc=new Uint8Array(0);class mc{constructor(e,t){this.user=e,this.databaseId=t,this.rn=new fc,this.on=new Ha(e=>Sa(e),(e,t)=>xa(e,t)),this.uid=e.uid||""}addToCollectionParentIndex(e,t){if(this.rn.has(t))return Si.resolve();var n=t.lastSegment(),r=t.popLast();e.addOnCommittedListener(()=>{this.rn.add(t)});r={collectionId:n,parent:Ui(r)};return pc(e).put(r)}getCollectionParents(e,n){const r=[],t=IDBKeyRange.bound([n,""],[si(n),""],!1,!0);return pc(e).j(t).next(e=>{for(const t of e){if(t.collectionId!==n)break;r.push(Ki(t.parent))}return r})}addFieldIndex(e,t){const n=vc(e),r={indexId:t.indexId,collectionGroup:t.collectionGroup,fields:t.fields.map(e=>[e.fieldPath.canonicalString(),e.kind])};delete r.indexId;const i=n.add(r);if(t.indexState){const n=wc(e);return i.next(e=>{n.put(Ku(e,this.user,t.indexState.sequenceNumber,t.indexState.offset))})}return i.next()}deleteFieldIndex(e,t){const n=vc(e),r=wc(e),i=yc(e);return n.delete(t.indexId).next(()=>r.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))).next(()=>i.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0)))}getDocumentsMatchingTarget(e,c){const h=yc(e);let l=!0;const n=new Map;return Si.forEach(this.un(c),t=>this.cn(e,t).next(e=>{l=l&&!!e,n.set(t,e)})).next(()=>{if(l){let u=no();const l=[];return Si.forEach(n,(e,t)=>{qr("IndexedDbIndexManager",`Using index ${o=e,`id=${o.indexId}|cg=${o.collectionGroup}|f=${o.fields.map(e=>`${e.fieldPath}:${e.kind}`).join(",")}`} to execute ${Sa(c)}`);var n=function(e,t){var n=gi(t);if(void 0===n)return null;for(const t of Aa(e,n.fieldPath))switch(t.op){case"array-contains-any":return t.value.arrayValue.values||[];case"array-contains":return[t.value]}return null}(t,e),r=function(e,t){const n=new Map;for(const r of mi(t))for(const t of Aa(e,r.fieldPath))switch(t.op){case"==":case"in":n.set(r.fieldPath.canonicalString(),t.value);break;case"not-in":case"!=":return n.set(r.fieldPath.canonicalString(),t.value),Array.from(n.values())}return null}(t,e),i=function(e,t){const n=[];let r=!0;for(const i of mi(t)){const t=(0===i.kind?Ca:Na)(e,i.fieldPath,e.startAt);n.push(t.value),r=r&&t.inclusive}return new na(n,r)}(t,e),s=function(e,t){const n=[];let r=!0;for(const i of mi(t)){const t=(0===i.kind?Na:Ca)(e,i.fieldPath,e.endAt);n.push(t.value),r=r&&t.inclusive}return new na(n,r)}(t,e),a=this.an(e,t,i),o=this.an(e,t,s),r=this.hn(e,t,r),r=this.ln(e.indexId,n,a,i.inclusive,o,s.inclusive,r);return Si.forEach(r,e=>h.H(e,c.limit).next(e=>{e.forEach(e=>{var t=di.fromSegments(e.documentKey);u.has(t)||(u=u.add(t),l.push(t))})}))}).next(()=>l)}return Si.resolve(null)})}un(t){let e=this.on.get(t);return e||(e=0===t.filters.length?[t]:sc(ua.create(t.filters,"and")).map(e=>_a(t.path,t.collectionGroup,t.orderBy,e.getFilters(),t.limit,t.startAt,t.endAt)),this.on.set(t,e),e)}ln(t,e,n,r,i,s,a){const o=(null!=e?e.length:1)*Math.max(n.length,i.length),u=o/(null!=e?e.length:1),c=[];for(let h=0;h<o;++h){const o=e?this.fn(e[h/u]):gc,l=this.dn(t,o,n[h%u],r),d=this._n(t,o,i[h%u],s),f=a.map(e=>this.dn(t,o,e,!0));c.push(...this.createRange(l,d,f))}return c}dn(e,t,n,r){const i=new tc(e,di.empty(),t,n);return r?i:i.He()}_n(e,t,n,r){const i=new tc(e,di.empty(),t,n);return r?i.He():i}cn(e,t){const r=new ic(t),n=null!=t.collectionGroup?t.collectionGroup:t.path.lastSegment();return this.getFieldIndexes(e,n).next(e=>{let t=null;for(const n of e)r.Ze(n)&&(!t||n.fields.length>t.fields.length)&&(t=n);return t})}getIndexType(e,t){let n=2;const r=this.un(t);return Si.forEach(r,t=>this.cn(e,t).next(e=>{e?0!==n&&e.fields.length<function(e){let t=new Is(li.comparator),n=!1;for(const r of e.filters)for(const e of r.getFlattenedFilters())e.field.isKeyField()||("array-contains"===e.op||"array-contains-any"===e.op?n=!0:t=t.add(e.field));for(const n of e.orderBy)n.field.isKeyField()||(t=t.add(n.field));return t.size+(n?1:0)}(t)&&(n=1):n=0})).next(()=>null!==t.limit&&1<r.length&&2===n?1:n)}wn(e,t){const n=new ec;for(const i of mi(e)){const e=t.data.field(i.fieldPath);if(null==e)return null;var r=n.We(i.kind);Wu.be._e(e,r)}return n.Ge()}fn(e){const t=new ec;return Wu.be._e(e,t.We(0)),t.Ge()}mn(e,t){const n=new ec;return Wu.be._e(Gs(this.databaseId,t),n.We(0===(r=mi(e)).length?0:r[r.length-1].kind)),n.Ge();var r}hn(e,t,n){if(null===n)return[];let r=[];r.push(new ec);let i=0;for(const s of mi(e)){const e=n[i++];for(const n of r)if(this.gn(t,s.fieldPath)&&$s(e))r=this.yn(r,s,e);else{const t=n.We(s.kind);Wu.be._e(e,t)}}return this.pn(r)}an(e,t,n){return this.hn(e,t,n.position)}pn(e){const t=[];for(let n=0;n<e.length;++n)t[n]=e[n].Ge();return t}yn(e,t,n){const r=[...e],i=[];for(const e of n.arrayValue.values||[])for(const n of r){const r=new ec;r.seed(n.Ge()),Wu.be._e(e,r.We(t.kind)),i.push(r)}return i}gn(e,t){return!!e.filters.find(e=>e instanceof oa&&e.field.isEqual(t)&&("in"===e.op||"not-in"===e.op))}getFieldIndexes(e,t){const n=vc(e),r=wc(e);return(t?n.j("collectionGroupIndex",IDBKeyRange.bound(t,t)):n.j()).next(e=>{const s=[];return Si.forEach(e,i=>r.get([i.indexId,this.uid]).next(e=>{var t,n,r;s.push((t=i,n=(e=e)?new yi(e.sequenceNumber,new bi(Ou(e.readTime),new di(Ki(e.documentKey)),e.largestBatchId)):yi.empty(),r=t.fields.map(([e,t])=>new pi(li.fromServerFormat(e),t)),new fi(t.indexId,t.collectionGroup,r,n)))})).next(()=>s)})}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next(e=>0===e.length?null:(e.sort((e,t)=>{var n=e.indexState.sequenceNumber-t.indexState.sequenceNumber;return 0!=n?n:ri(e.collectionGroup,t.collectionGroup)}),e[0].collectionGroup))}updateCollectionGroup(e,n,r){const i=vc(e),s=wc(e);return this.In(e).next(t=>i.j("collectionGroupIndex",IDBKeyRange.bound(n,n)).next(e=>Si.forEach(e,e=>s.put(Ku(e.indexId,this.user,t,r)))))}updateIndexEntries(i,e){const n=new Map;return Si.forEach(e,(t,r)=>{var e=n.get(t.collectionGroup);return(e?Si.resolve(e):this.getFieldIndexes(i,t.collectionGroup)).next(e=>(n.set(t.collectionGroup,e),Si.forEach(e,n=>this.Tn(i,t,n).next(e=>{var t=this.En(r,n);return e.isEqual(t)?Si.resolve():this.An(i,r,n,e,t)}))))})}Rn(e,t,n,r){return yc(e).put({indexId:r.indexId,uid:this.uid,arrayValue:r.arrayValue,directionalValue:r.directionalValue,orderedDocumentKey:this.mn(n,t.key),documentKey:t.key.path.toArray()})}vn(e,t,n,r){return yc(e).delete([r.indexId,this.uid,r.arrayValue,r.directionalValue,this.mn(n,t.key),t.key.path.toArray()])}Tn(e,n,r){const t=yc(e);let i=new Is(nc);return t.X({index:"documentKeyIndex",range:IDBKeyRange.only([r.indexId,this.uid,this.mn(r,n)])},(e,t)=>{i=i.add(new tc(r.indexId,n,t.arrayValue,t.directionalValue))}).next(()=>i)}En(e,t){let n=new Is(nc);var r=this.wn(t,e);if(null==r)return n;const i=gi(t);if(null!=i){var s=e.data.field(i.fieldPath);if($s(s))for(const i of s.arrayValue.values||[])n=n.add(new tc(t.indexId,e.key,this.fn(i),r))}else n=n.add(new tc(t.indexId,e.key,gc,r));return n}An(t,n,r,c,e){qr("IndexedDbIndexManager","Updating index entries for document '%s'",n.key);const i=[];return function(e,n,r,i){var s=c.getIterator(),a=e.getIterator();let o=Ts(s),u=Ts(a);for(;o||u;){let e=!1,t=!1;if(o&&u){const r=n(o,u);r<0?t=!0:0<r&&(e=!0)}else null!=o?t=!0:e=!0;e?(r(u),u=Ts(a)):t?(i(o),o=Ts(s)):(o=Ts(s),u=Ts(a))}}(e,nc,e=>{i.push(this.Rn(t,n,r,e))},e=>{i.push(this.vn(t,n,r,e))}),Si.waitFor(i)}In(e){let r=1;return wc(e).X({index:"sequenceNumberIndex",reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(e,t,n)=>{n.done(),r=t.sequenceNumber+1}).next(()=>r)}createRange(e,t,n){n=n.sort((e,t)=>nc(e,t)).filter((e,t,n)=>!t||0!==nc(e,n[t-1]));const r=[];r.push(e);for(const i of n){const n=nc(i,e),s=nc(i,t);if(0===n)r[0]=e.He();else if(0<n&&s<0)r.push(i),r.push(i.He());else if(0<s)break}r.push(t);const i=[];for(let a=0;a<r.length;a+=2){if(this.Pn(r[a],r[a+1]))return[];const t=[r[a].indexId,this.uid,r[a].arrayValue,r[a].directionalValue,gc,[]],n=[r[a+1].indexId,this.uid,r[a+1].arrayValue,r[a+1].directionalValue,gc,[]];i.push(IDBKeyRange.bound(t,n))}return i}Pn(e,t){return 0<nc(e,t)}getMinOffsetFromCollectionGroup(e,t){return this.getFieldIndexes(e,t).next(bc)}getMinOffset(t,e){return Si.mapArray(this.un(e),e=>this.cn(t,e).next(e=>e||Kr())).next(bc)}}function pc(e){return gs(e,"collectionParents")}function yc(e){return gs(e,"indexEntries")}function vc(e){return gs(e,"indexConfiguration")}function wc(e){return gs(e,"indexState")}function bc(e){Gr(0!==e.length);let t=e[0].indexState.offset,n=t.largestBatchId;for(let i=1;i<e.length;i++){var r=e[i].indexState.offset;Ii(r,t)<0&&(t=r),n<r.largestBatchId&&(n=r.largestBatchId)}return new bi(t.readTime,t.documentKey,n)}const Ic={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0};class Ec{constructor(e,t,n){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=n}static withCacheSize(e){return new Ec(e,Ec.DEFAULT_COLLECTION_PERCENTILE,Ec.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}function Tc(e,t,n){const r=e.store("mutations"),i=e.store("documentMutations"),s=[],a=IDBKeyRange.only(n.batchId);let o=0;const u=r.X({range:a},(e,t,n)=>(o++,n.delete()));s.push(u.next(()=>{Gr(1===o)}));const c=[];for(const e of n.mutations){const r=$i(t,e.key.path,n.batchId);s.push(i.delete(r)),c.push(e.key)}return Si.waitFor(s).next(()=>c)}function _c(e){if(!e)return 0;let t;if(e.document)t=e.document;else if(e.unknownDocument)t=e.unknownDocument;else{if(!e.noDocument)throw Kr();t=e.noDocument}return JSON.stringify(t).length}Ec.DEFAULT_COLLECTION_PERCENTILE=10,Ec.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Ec.DEFAULT=new Ec(41943040,Ec.DEFAULT_COLLECTION_PERCENTILE,Ec.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Ec.DISABLED=new Ec(-1,0,0);class Sc{constructor(e,t,n,r){this.userId=e,this.serializer=t,this.indexManager=n,this.referenceDelegate=r,this.bn={}}static fe(e,t,n,r){Gr(""!==e.uid);var i=e.isAuthenticated()?e.uid:"";return new Sc(i,t,n,r)}checkEmpty(e){let r=!0;var t=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return Dc(e).X({index:"userMutationsIndex",range:t},(e,t,n)=>{r=!1,n.done()}).next(()=>r)}addMutationBatch(h,l,d,f){const g=Ac(h),m=Dc(h);return m.add({}).next(e=>{Gr("number"==typeof e);const t=new Fo(e,l,d,f),n=(i=this.serializer,s=this.userId,a=t,o=a.baseMutations.map(e=>Iu(i.le,e)),u=a.mutations.map(e=>Iu(i.le,e)),{userId:s,batchId:a.batchId,localWriteTimeMs:a.localWriteTime.toMillis(),baseMutations:o,mutations:u}),r=[];var i,s,a,o,u;let c=new Is((e,t)=>ri(e.canonicalString(),t.canonicalString()));for(const h of f){const l=$i(this.userId,h.key.path,e);c=c.add(h.key.path.popLast()),r.push(m.put(n)),r.push(g.put(l,Qi))}return c.forEach(e=>{r.push(this.indexManager.addToCollectionParentIndex(h,e))}),h.addOnCommittedListener(()=>{this.bn[e]=t.keys()}),Si.waitFor(r).next(()=>t)})}lookupMutationBatch(e,t){return Dc(e).get(t).next(e=>e?(Gr(e.userId===this.userId),Pu(this.serializer,e)):null)}Vn(e,n){return this.bn[n]?Si.resolve(this.bn[n]):this.lookupMutationBatch(e,n).next(e=>{if(e){var t=e.keys();return this.bn[n]=t}return null})}getNextMutationBatchAfterBatchId(e,t){const r=t+1,n=IDBKeyRange.lowerBound([this.userId,r]);let i=null;return Dc(e).X({index:"userMutationsIndex",range:n},(e,t,n)=>{t.userId===this.userId&&(Gr(t.batchId>=r),i=Pu(this.serializer,t)),n.done()}).next(()=>i)}getHighestUnacknowledgedBatchId(e){var t=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]);let r=-1;return Dc(e).X({index:"userMutationsIndex",range:t,reverse:!0},(e,t,n)=>{r=t.batchId,n.done()}).next(()=>r)}getAllMutationBatches(e){var t=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return Dc(e).j("userMutationsIndex",t).next(e=>e.map(e=>Pu(this.serializer,e)))}getAllMutationBatchesAffectingDocumentKey(a,o){const e=zi(this.userId,o.path),t=IDBKeyRange.lowerBound(e),u=[];return Ac(a).X({range:t},(e,t,n)=>{var[r,i,s]=e,i=Ki(i);if(r===this.userId&&o.path.isEqual(i))return Dc(a).get(s).next(e=>{if(!e)throw Kr();Gr(e.userId===this.userId),u.push(Pu(this.serializer,e))});n.done()}).next(()=>u)}getAllMutationBatchesAffectingDocumentKeys(t,e){let o=new Is(ri);const n=[];return e.forEach(a=>{var e=zi(this.userId,a.path),e=IDBKeyRange.lowerBound(e),e=Ac(t).X({range:e},(e,t,n)=>{var[r,i,s]=e,i=Ki(i);r===this.userId&&a.path.isEqual(i)?o=o.add(s):n.done()});n.push(e)}),Si.waitFor(n).next(()=>this.Sn(t,o))}getAllMutationBatchesAffectingQuery(e,t){const a=t.path,o=a.length+1,n=zi(this.userId,a),r=IDBKeyRange.lowerBound(n);let u=new Is(ri);return Ac(e).X({range:r},(e,t,n)=>{var[r,i,s]=e,i=Ki(i);r===this.userId&&a.isPrefixOf(i)?i.length===o&&(u=u.add(s)):n.done()}).next(()=>this.Sn(e,u))}Sn(t,e){const n=[],r=[];return e.forEach(e=>{r.push(Dc(t).get(e).next(e=>{if(null===e)throw Kr();Gr(e.userId===this.userId),n.push(Pu(this.serializer,e))}))}),Si.waitFor(r).next(()=>n)}removeMutationBatch(t,n){return Tc(t.at,this.userId,n).next(e=>(t.addOnCommittedListener(()=>{this.Dn(n.batchId)}),Si.forEach(e,e=>this.referenceDelegate.markPotentiallyOrphaned(t,e))))}Dn(e){delete this.bn[e]}performConsistencyCheck(n){return this.checkEmpty(n).next(e=>{if(!e)return Si.resolve();var t=IDBKeyRange.lowerBound([this.userId]);const r=[];return Ac(n).X({range:t},(e,t,n)=>{if(e[0]===this.userId){const t=Ki(e[1]);r.push(t)}else n.done()}).next(()=>{Gr(0===r.length)})})}containsKey(e,t){return xc(e,this.userId,t)}Cn(e){return Cc(e).get(this.userId).next(e=>e||{userId:this.userId,lastAcknowledgedBatchId:-1,lastStreamToken:""})}}function xc(e,s,t){const n=zi(s,t.path),a=n[1],r=IDBKeyRange.lowerBound(n);let o=!1;return Ac(e).X({range:r,Y:!0},(e,t,n)=>{var[r,i]=e;r===s&&i===a&&(o=!0),n.done()}).next(()=>o)}function Dc(e){return gs(e,"mutations")}function Ac(e){return gs(e,"documentMutations")}function Cc(e){return gs(e,"mutationQueues")}class Nc{constructor(e){this.xn=e}next(){return this.xn+=2,this.xn}static Nn(){return new Nc(0)}static kn(){return new Nc(-1)}}class kc{constructor(e,t){this.referenceDelegate=e,this.serializer=t}allocateTargetId(n){return this.Mn(n).next(e=>{const t=new Nc(e.highestTargetId);return e.highestTargetId=t.next(),this.On(n,e).next(()=>e.highestTargetId)})}getLastRemoteSnapshotVersion(e){return this.Mn(e).next(e=>oi.fromTimestamp(new ai(e.lastRemoteSnapshotVersion.seconds,e.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(e){return this.Mn(e).next(e=>e.highestListenSequenceNumber)}setTargetsMetadata(t,n,r){return this.Mn(t).next(e=>(e.highestListenSequenceNumber=n,r&&(e.lastRemoteSnapshotVersion=r.toTimestamp()),n>e.highestListenSequenceNumber&&(e.highestListenSequenceNumber=n),this.On(t,e)))}addTargetData(t,n){return this.$n(t,n).next(()=>this.Mn(t).next(e=>(e.targetCount+=1,this.Fn(n,e),this.On(t,e))))}updateTargetData(e,t){return this.$n(e,t)}removeTargetData(t,e){return this.removeMatchingKeysForTargetId(t,e.targetId).next(()=>Rc(t).delete(e.targetId)).next(()=>this.Mn(t)).next(e=>(Gr(0<e.targetCount),--e.targetCount,this.On(t,e)))}removeTargets(r,i,s){let a=0;const o=[];return Rc(r).X((e,t)=>{var n=Vu(t);n.sequenceNumber<=i&&null===s.get(n.targetId)&&(a++,o.push(this.removeTargetData(r,n)))}).next(()=>Si.waitFor(o)).next(()=>a)}forEachTarget(e,r){return Rc(e).X((e,t)=>{var n=Vu(t);r(n)})}Mn(e){return Mc(e).get("targetGlobalKey").next(e=>(Gr(null!==e),e))}On(e,t){return Mc(e).put("targetGlobalKey",t)}$n(e,t){return Rc(e).put(qu(this.serializer,t))}Fn(e,t){let n=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,n=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,n=!0),n}getTargetCount(e){return this.Mn(e).next(e=>e.targetCount)}getTargetData(e,i){var t=Sa(i),t=IDBKeyRange.bound([t,Number.NEGATIVE_INFINITY],[t,Number.POSITIVE_INFINITY]);let s=null;return Rc(e).X({range:t,index:"queryTargetsIndex"},(e,t,n)=>{var r=Vu(t);xa(i,r.target)&&(s=r,n.done())}).next(()=>s)}addMatchingKeys(n,e,r){const i=[],s=Fc(n);return e.forEach(e=>{var t=Ui(e.path);i.push(s.put({targetId:r,path:t})),i.push(this.referenceDelegate.addReference(n,r,e))}),Si.waitFor(i)}removeMatchingKeys(n,e,r){const i=Fc(n);return Si.forEach(e,e=>{var t=Ui(e.path);return Si.waitFor([i.delete([r,t]),this.referenceDelegate.removeReference(n,r,e)])})}removeMatchingKeysForTargetId(e,t){const n=Fc(e),r=IDBKeyRange.bound([t],[t+1],!1,!0);return n.delete(r)}getMatchingKeysForTargetId(e,t){const n=IDBKeyRange.bound([t],[t+1],!1,!0),r=Fc(e);let i=no();return r.X({range:n,Y:!0},(e,t,n)=>{var r=Ki(e[1]),r=new di(r);i=i.add(r)}).next(()=>i)}containsKey(e,t){var n=Ui(t.path),n=IDBKeyRange.bound([n],[si(n)],!1,!0);let r=0;return Fc(e).X({index:"documentTargetsIndex",Y:!0,range:n},([e],t,n)=>{0!==e&&(r++,n.done())}).next(()=>0<r)}he(e,t){return Rc(e).get(t).next(e=>e?Vu(e):null)}}function Rc(e){return gs(e,"targets")}function Mc(e){return gs(e,"targetGlobal")}function Fc(e){return gs(e,"targetDocuments")}function Lc([e,t],[n,r]){var i=ri(e,n);return 0===i?ri(t,r):i}class Oc{constructor(e){this.Bn=e,this.buffer=new Is(Lc),this.Ln=0}qn(){return++this.Ln}Un(e){var t=[e,this.qn()];if(this.buffer.size<this.Bn)this.buffer=this.buffer.add(t);else{const e=this.buffer.last();Lc(t,e)<0&&(this.buffer=this.buffer.delete(e).add(t))}}get maxValue(){return this.buffer.last()[0]}}class Pc{constructor(e,t,n){this.garbageCollector=e,this.asyncQueue=t,this.localStore=n,this.Kn=null}start(){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this.Gn(6e4)}stop(){this.Kn&&(this.Kn.cancel(),this.Kn=null)}get started(){return null!==this.Kn}Gn(e){qr("LruGarbageCollector",`Garbage collection scheduled in ${e}ms`),this.Kn=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,async()=>{this.Kn=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(e){Ni(e)?qr("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",e):await _i(e)}await this.Gn(3e5)})}}class Vc{constructor(e,t){this.Qn=e,this.params=t}calculateTargetCount(e,t){return this.Qn.jn(e).next(e=>Math.floor(t/100*e))}nthSequenceNumber(e,t){if(0===t)return Si.resolve(Pi.ct);const n=new Oc(t);return this.Qn.forEachTarget(e,e=>n.Un(e.sequenceNumber)).next(()=>this.Qn.zn(e,e=>n.Un(e))).next(()=>n.maxValue)}removeTargets(e,t,n){return this.Qn.removeTargets(e,t,n)}removeOrphanedDocuments(e,t){return this.Qn.removeOrphanedDocuments(e,t)}collect(t,n){return-1===this.params.cacheSizeCollectionThreshold?(qr("LruGarbageCollector","Garbage collection skipped; disabled"),Si.resolve(Ic)):this.getCacheSize(t).next(e=>e<this.params.cacheSizeCollectionThreshold?(qr("LruGarbageCollector",`Garbage collection skipped; Cache size ${e} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),Ic):this.Wn(t,n))}getCacheSize(e){return this.Qn.getCacheSize(e)}Wn(t,n){let r,i,s,a,o,u,c;const h=Date.now();return this.calculateTargetCount(t,this.params.percentileToCollect).next(e=>(i=e>this.params.maximumSequenceNumbersToCollect?(qr("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${e}`),this.params.maximumSequenceNumbersToCollect):e,a=Date.now(),this.nthSequenceNumber(t,i))).next(e=>(r=e,o=Date.now(),this.removeTargets(t,r,n))).next(e=>(s=e,u=Date.now(),this.removeOrphanedDocuments(t,r))).next(e=>(c=Date.now(),Vr()<=l.DEBUG&&qr("LruGarbageCollector",`LRU Garbage Collection\n\tCounted targets in ${a-h}ms\n\tDetermined least recently used ${i} in `+(o-a)+"ms\n"+`\tRemoved ${s} targets in `+(u-o)+"ms\n"+`\tRemoved ${e} documents in `+(c-u)+"ms\n"+`Total Duration: ${c-h}ms`),Si.resolve({didRun:!0,sequenceNumbersCollected:i,targetsRemoved:s,documentsRemoved:e})))}}class qc{constructor(e,t){this.db=e,this.garbageCollector=(e=this,t=t,new Vc(e,t))}jn(e){const n=this.Hn(e);return this.db.getTargetCache().getTargetCount(e).next(t=>n.next(e=>t+e))}Hn(e){let t=0;return this.zn(e,e=>{t++}).next(()=>t)}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}zn(e,n){return this.Jn(e,(e,t)=>n(t))}addReference(e,t,n){return Bc(e,n)}removeReference(e,t,n){return Bc(e,n)}removeTargets(e,t,n){return this.db.getTargetCache().removeTargets(e,t,n)}markPotentiallyOrphaned(e,t){return Bc(e,t)}Yn(t,n){let r=!1;return Cc(t).Z(e=>xc(t,e,n).next(e=>(e&&(r=!0),Si.resolve(!e)))).next(()=>r)}removeOrphanedDocuments(n,r){const i=this.db.getRemoteDocumentCache().newChangeBuffer(),s=[];let a=0;return this.Jn(n,(t,e)=>{if(e<=r){const r=this.Yn(n,t).next(e=>{if(!e)return a++,i.getEntry(n,t).next(()=>(i.removeEntry(t,oi.min()),Fc(n).delete([0,Ui(t.path)])))});s.push(r)}}).next(()=>Si.waitFor(s)).next(()=>i.apply(n)).next(()=>a)}removeTarget(e,t){var n=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,n)}updateLimboDocument(e,t){return Bc(e,t)}Jn(e,r){const t=Fc(e);let i,s=Pi.ct;return t.X({index:"documentTargetsIndex"},([e],{path:t,sequenceNumber:n})=>{0===e?(s!==Pi.ct&&r(new di(Ki(i)),s),s=n,i=t):s=Pi.ct}).next(()=>{s!==Pi.ct&&r(new di(Ki(i)),s)})}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}}function Bc(e,t){return Fc(e).put((e=e.currentSequenceNumber,{targetId:0,path:Ui(t.path),sequenceNumber:e}))}class Uc{constructor(){this.changes=new Ha(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,ta.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();var n=this.changes.get(t);return void 0!==n?Si.resolve(n):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class jc{constructor(e){this.serializer=e}setIndexManager(e){this.indexManager=e}addEntry(e,t,n){return $c(e).put(n)}removeEntry(e,n,t){return $c(e).delete(function(e){const t=n.path.toArray();return[t.slice(0,t.length-2),t[t.length-2],Fu(e),t[t.length-1]]}(t))}updateMetadata(t,n){return this.getMetadata(t).next(e=>(e.byteSize+=n,this.Xn(t,e)))}getEntry(e,n){let r=ta.newInvalidDocument(n);return $c(e).X({index:"documentKeyIndex",range:IDBKeyRange.only(Qc(n))},(e,t)=>{r=this.Zn(n,t)}).next(()=>r)}ts(e,n){let r={size:0,document:ta.newInvalidDocument(n)};return $c(e).X({index:"documentKeyIndex",range:IDBKeyRange.only(Qc(n))},(e,t)=>{r={document:this.Zn(n,t),size:_c(t)}}).next(()=>r)}getEntries(e,t){let r=Wa;return this.es(e,t,(e,t)=>{var n=this.Zn(e,t);r=r.insert(e,n)}).next(()=>r)}ns(e,t){let r=Wa,i=new vs(di.comparator);return this.es(e,t,(e,t)=>{var n=this.Zn(e,t);r=r.insert(e,n),i=i.insert(e,_c(t))}).next(()=>({documents:r,ss:i}))}es(e,t,i){if(t.isEmpty())return Si.resolve();let n=new Is(Wc);t.forEach(e=>n=n.add(e));const r=IDBKeyRange.bound(Qc(n.first()),Qc(n.last())),s=n.getIterator();let a=s.getNext();return $c(e).X({index:"documentKeyIndex",range:r},(e,t,n)=>{for(var r=di.fromSegments([...t.prefixPath,t.collectionGroup,t.documentId]);a&&Wc(a,r)<0;)i(a,null),a=s.getNext();a&&a.isEqual(r)&&(i(a,t),a=s.hasNext()?s.getNext():null),a?n.G(Qc(a)):n.done()}).next(()=>{for(;a;)i(a,null),a=s.hasNext()?s.getNext():null})}getDocumentsMatchingQuery(e,r,t,i){const n=r.path,s=[n.popLast().toArray(),n.lastSegment(),Fu(t.readTime),t.documentKey.path.isEmpty()?"":t.documentKey.path.lastSegment()],a=[n.popLast().toArray(),n.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return $c(e).j(IDBKeyRange.bound(s,a,!0)).next(e=>{let t=Wa;for(const n of e){const e=this.Zn(di.fromSegments(n.prefixPath.concat(n.collectionGroup,n.documentId)),n);e.isFoundDocument()&&(za(r,e)||i.has(e.key))&&(t=t.insert(e.key,e))}return t})}getAllFromCollectionGroup(e,t,n,i){let s=Wa;var r=Hc(t,n),a=Hc(t,bi.max());return $c(e).X({index:"collectionGroupIndex",range:IDBKeyRange.bound(r,a,!0)},(e,t,n)=>{var r=this.Zn(di.fromSegments(t.prefixPath.concat(t.collectionGroup,t.documentId)),t);s=s.insert(r.key,r),s.size===i&&n.done()}).next(()=>s)}newChangeBuffer(e){return new Gc(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next(e=>e.byteSize)}getMetadata(e){return zc(e).get("remoteDocumentGlobalKey").next(e=>(Gr(!!e),e))}Xn(e,t){return zc(e).put("remoteDocumentGlobalKey",t)}Zn(e,t){if(t){const e=function(e,t){let n;if(t.document)n=bu(e.le,t.document,!!t.hasCommittedMutations);else if(t.noDocument){const e=di.fromSegments(t.noDocument.path),i=Ou(t.noDocument.readTime);n=ta.newNoDocument(e,i),t.hasCommittedMutations&&n.setHasCommittedMutations()}else{if(!t.unknownDocument)return Kr();{const e=di.fromSegments(t.unknownDocument.path),s=Ou(t.unknownDocument.version);n=ta.newUnknownDocument(e,s)}}return t.readTime&&n.setReadTime((t=t.readTime,r=new ai(t[0],t[1]),oi.fromTimestamp(r))),n;var r}(this.serializer,t);if(!e.isNoDocument()||!e.version.isEqual(oi.min()))return e}return ta.newInvalidDocument(e)}}function Kc(e){return new jc(e)}class Gc extends Uc{constructor(e,t){super(),this.rs=e,this.trackRemovals=t,this.os=new Ha(e=>e.toString(),(e,t)=>e.isEqual(t))}applyChanges(s){const a=[];let o=0,u=new Is((e,t)=>ri(e.canonicalString(),t.canonicalString()));return this.changes.forEach((e,t)=>{var n=this.os.get(e);if(a.push(this.rs.removeEntry(s,e,n.readTime)),t.isValidDocument()){var r=Mu(this.rs.serializer,t);u=u.add(e.path.popLast());var i=_c(r);o+=i-n.size,a.push(this.rs.addEntry(s,e,r))}else if(o-=n.size,this.trackRemovals){const o=Mu(this.rs.serializer,t.convertToNoDocument(oi.min()));a.push(this.rs.addEntry(s,e,o))}}),u.forEach(e=>{a.push(this.rs.indexManager.addToCollectionParentIndex(s,e))}),a.push(this.rs.updateMetadata(s,o)),Si.waitFor(a)}getFromCache(e,t){return this.rs.ts(e,t).next(e=>(this.os.set(t,{size:e.size,readTime:e.document.readTime}),e.document))}getAllFromCache(e,t){return this.rs.ns(e,t).next(({documents:n,ss:e})=>(e.forEach((e,t)=>{this.os.set(e,{size:t,readTime:n.get(e).readTime})}),n))}}function zc(e){return gs(e,"remoteDocumentGlobal")}function $c(e){return gs(e,"remoteDocumentsV14")}function Qc(e){const t=e.path.toArray();return[t.slice(0,t.length-2),t[t.length-2],t[t.length-1]]}function Hc(e,t){const n=t.documentKey.path.toArray();return[e,Fu(t.readTime),n.slice(0,n.length-2),0<n.length?n[n.length-1]:""]}function Wc(e,t){var n=e.path.toArray(),r=t.path.toArray();let i=0;for(let s=0;s<n.length-2&&s<r.length-2;++s)if(i=ri(n[s],r[s]),i)return i;return i=ri(n.length,r.length),i||(i=ri(n[n.length-2],r[r.length-2]),i||ri(n[n.length-1],r[r.length-1]))}class Xc{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}class Yc{constructor(e,t,n,r){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=n,this.indexManager=r}getDocument(t,n){let r=null;return this.documentOverlayCache.getOverlay(t,n).next(e=>(r=e,this.remoteDocumentCache.getEntry(t,n))).next(e=>(null!==r&&So(r.mutation,e,_s.empty(),ai.now()),e))}getDocuments(t,e){return this.remoteDocumentCache.getEntries(t,e).next(e=>this.getLocalViewOfDocuments(t,e,no()).next(()=>e))}getLocalViewOfDocuments(e,t,n=no()){const r=Za();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,n).next(e=>{let n=Ya();return e.forEach((e,t)=>{n=n.insert(e,t.overlayedDocument)}),n}))}getOverlayedDocuments(e,t){const n=Za();return this.populateOverlays(e,n,t).next(()=>this.computeViews(e,t,n,no()))}populateOverlays(e,n,t){const r=[];return t.forEach(e=>{n.has(e)||r.push(e)}),this.documentOverlayCache.getOverlays(e,r).next(e=>{e.forEach((e,t)=>{n.set(e,t)})})}computeViews(e,t,r,i){let s=Wa;const a=Za(),o=Za();return t.forEach((e,t)=>{const n=r.get(t.key);i.has(t.key)&&(void 0===n||n.mutation instanceof Ao)?s=s.insert(t.key,t):void 0!==n?(a.set(t.key,n.mutation.getFieldMask()),So(n.mutation,t,n.mutation.getFieldMask(),ai.now())):a.set(t.key,_s.empty())}),this.recalculateAndSaveOverlays(e,s).next(e=>(e.forEach((e,t)=>a.set(e,t)),t.forEach((e,t)=>{var n;return o.set(e,new Xc(t,null!==(n=a.get(e))&&void 0!==n?n:null))}),o))}recalculateAndSaveOverlays(s,a){const o=Za();let u=new vs((e,t)=>e-t),c=no();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(s,a).next(e=>{for(const r of e)r.keys().forEach(e=>{var t,n=a.get(e);null!==n&&(t=o.get(e)||_s.empty(),t=r.applyToLocalView(n,t),o.set(e,t),t=(u.get(r.batchId)||no()).add(e),u=u.insert(r.batchId,t))})}).next(()=>{const e=[],t=u.getReverseIterator();for(;t.hasNext();){const u=t.getNext(),n=u.key,r=u.value,i=Za();r.forEach(e=>{var t;c.has(e)||(null!==(t=To(a.get(e),o.get(e)))&&i.set(e,t),c=c.add(e))}),e.push(this.documentOverlayCache.saveOverlays(s,n,i))}return Si.waitFor(e)}).next(()=>o)}recalculateAndSaveOverlaysForDocumentKeys(t,e){return this.remoteDocumentCache.getEntries(t,e).next(e=>this.recalculateAndSaveOverlays(t,e))}getDocumentsMatchingQuery(e,t,n){return r=t,di.isDocumentKey(r.path)&&null===r.collectionGroup&&0===r.filters.length?this.getDocumentsMatchingDocumentQuery(e,t.path):Pa(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,n):this.getDocumentsMatchingCollectionQuery(e,t,n);var r}getNextDocuments(s,t,a,o){return this.remoteDocumentCache.getAllFromCollectionGroup(s,t,a,o).next(n=>{const e=0<o-n.size?this.documentOverlayCache.getOverlaysForCollectionGroup(s,t,a.largestBatchId,o-n.size):Si.resolve(Za());let r=-1,i=n;return e.next(e=>Si.forEach(e,(t,e)=>(r<e.largestBatchId&&(r=e.largestBatchId),n.get(t)?Si.resolve():this.remoteDocumentCache.getEntry(s,t).next(e=>{i=i.insert(t,e)}))).next(()=>this.populateOverlays(s,e,n)).next(()=>this.computeViews(s,i,e,no())).next(e=>({batchId:r,changes:Ja(e)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new di(t)).next(e=>{let t=Ya();return e.isFoundDocument()&&(t=t.insert(e.key,e)),t})}getDocumentsMatchingCollectionGroupQuery(r,i,s){const a=i.collectionGroup;let o=Ya();return this.indexManager.getCollectionParents(r,a).next(e=>Si.forEach(e,e=>{var t,n=(t=i,e=e.child(a),new ka(e,null,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt));return this.getDocumentsMatchingCollectionQuery(r,n,s).next(e=>{e.forEach((e,t)=>{o=o.insert(e,t)})})}).next(()=>o))}getDocumentsMatchingCollectionQuery(t,s,n){let a;return this.documentOverlayCache.getOverlaysForCollection(t,s.path,n.largestBatchId).next(e=>(a=e,this.remoteDocumentCache.getDocumentsMatchingQuery(t,s,n,a))).next(r=>{a.forEach((e,t)=>{var n=t.getKey();null===r.get(n)&&(r=r.insert(n,ta.newInvalidDocument(n)))});let i=Ya();return r.forEach((e,t)=>{var n=a.get(e);void 0!==n&&So(n.mutation,t,_s.empty(),ai.now()),za(s,t)&&(i=i.insert(e,t))}),i})}}class Jc{constructor(e){this.serializer=e,this.us=new Map,this.cs=new Map}getBundleMetadata(e,t){return Si.resolve(this.us.get(t))}saveBundleMetadata(e,t){return this.us.set(t.id,{id:t.id,version:t.version,createTime:hu(t.createTime)}),Si.resolve()}getNamedQuery(e,t){return Si.resolve(this.cs.get(t))}saveNamedQuery(e,t){return this.cs.set(t.name,{name:(t=t).name,query:Bu(t.bundledQuery),readTime:hu(t.readTime)}),Si.resolve()}}class Zc{constructor(){this.overlays=new vs(di.comparator),this.hs=new Map}getOverlay(e,t){return Si.resolve(this.overlays.get(t))}getOverlays(e,t){const n=Za();return Si.forEach(t,t=>this.getOverlay(e,t).next(e=>{null!==e&&n.set(t,e)})).next(()=>n)}saveOverlays(n,r,e){return e.forEach((e,t)=>{this.de(n,r,t)}),Si.resolve()}removeOverlaysForBatchId(e,t,n){const r=this.hs.get(n);return void 0!==r&&(r.forEach(e=>this.overlays=this.overlays.remove(e)),this.hs.delete(n)),Si.resolve()}getOverlaysForCollection(e,t,n){const r=Za(),i=t.length+1,s=new di(t.child("")),a=this.overlays.getIteratorFrom(s);for(;a.hasNext();){const e=a.getNext().value,s=e.getKey();if(!t.isPrefixOf(s.path))break;s.path.length===i&&e.largestBatchId>n&&r.set(e.getKey(),e)}return Si.resolve(r)}getOverlaysForCollectionGroup(t,e,n,r){let i=new vs((e,t)=>e-t);const s=this.overlays.getIterator();for(;s.hasNext();){const t=s.getNext().value;if(t.getKey().getCollectionGroup()===e&&t.largestBatchId>n){let e=i.get(t.largestBatchId);null===e&&(e=Za(),i=i.insert(t.largestBatchId,e)),e.set(t.getKey(),t)}}const a=Za(),o=i.getIterator();for(;o.hasNext()&&(o.getNext().value.forEach((e,t)=>a.set(e,t)),!(a.size()>=r)););return Si.resolve(a)}de(e,t,n){var r=this.overlays.get(n.key);if(null!==r){const e=this.hs.get(r.largestBatchId).delete(n.key);this.hs.set(r.largestBatchId,e)}this.overlays=this.overlays.insert(n.key,new Oo(t,n));let i=this.hs.get(t);void 0===i&&(i=no(),this.hs.set(t,i)),this.hs.set(t,i.add(n.key))}}class eh{constructor(){this.ls=new Is(th.fs),this.ds=new Is(th._s)}isEmpty(){return this.ls.isEmpty()}addReference(e,t){var n=new th(e,t);this.ls=this.ls.add(n),this.ds=this.ds.add(n)}ws(e,t){e.forEach(e=>this.addReference(e,t))}removeReference(e,t){this.gs(new th(e,t))}ys(e,t){e.forEach(e=>this.removeReference(e,t))}ps(e){const t=new di(new ci([])),n=new th(t,e),r=new th(t,e+1),i=[];return this.ds.forEachInRange([n,r],e=>{this.gs(e),i.push(e.key)}),i}Is(){this.ls.forEach(e=>this.gs(e))}gs(e){this.ls=this.ls.delete(e),this.ds=this.ds.delete(e)}Ts(e){var t=new di(new ci([])),n=new th(t,e),t=new th(t,e+1);let r=no();return this.ds.forEachInRange([n,t],e=>{r=r.add(e.key)}),r}containsKey(e){var t=new th(e,0),t=this.ls.firstAfterOrEqual(t);return null!==t&&e.isEqual(t.key)}}class th{constructor(e,t){this.key=e,this.Es=t}static fs(e,t){return di.comparator(e.key,t.key)||ri(e.Es,t.Es)}static _s(e,t){return ri(e.Es,t.Es)||di.comparator(e.key,t.key)}}class nh{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.As=1,this.Rs=new Is(th.fs)}checkEmpty(e){return Si.resolve(0===this.mutationQueue.length)}addMutationBatch(e,t,n,r){var i=this.As;this.As++,0<this.mutationQueue.length&&this.mutationQueue[this.mutationQueue.length-1];var s=new Fo(i,t,n,r);this.mutationQueue.push(s);for(const t of r)this.Rs=this.Rs.add(new th(t.key,i)),this.indexManager.addToCollectionParentIndex(e,t.key.path.popLast());return Si.resolve(s)}lookupMutationBatch(e,t){return Si.resolve(this.vs(t))}getNextMutationBatchAfterBatchId(e,t){var n=this.Ps(t+1),n=n<0?0:n;return Si.resolve(this.mutationQueue.length>n?this.mutationQueue[n]:null)}getHighestUnacknowledgedBatchId(){return Si.resolve(0===this.mutationQueue.length?-1:this.As-1)}getAllMutationBatches(e){return Si.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const n=new th(t,0),r=new th(t,Number.POSITIVE_INFINITY),i=[];return this.Rs.forEachInRange([n,r],e=>{var t=this.vs(e.Es);i.push(t)}),Si.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new Is(ri);return t.forEach(e=>{var t=new th(e,0),n=new th(e,Number.POSITIVE_INFINITY);this.Rs.forEachInRange([t,n],e=>{r=r.add(e.Es)})}),Si.resolve(this.bs(r))}getAllMutationBatchesAffectingQuery(e,t){const n=t.path,r=n.length+1;let i=n;di.isDocumentKey(i)||(i=i.child(""));var s=new th(new di(i),0);let a=new Is(ri);return this.Rs.forEachWhile(e=>{var t=e.key.path;return!!n.isPrefixOf(t)&&(t.length===r&&(a=a.add(e.Es)),!0)},s),Si.resolve(this.bs(a))}bs(e){const n=[];return e.forEach(e=>{var t=this.vs(e);null!==t&&n.push(t)}),n}removeMutationBatch(n,r){Gr(0===this.Vs(r.batchId,"removed")),this.mutationQueue.shift();let i=this.Rs;return Si.forEach(r.mutations,e=>{var t=new th(e.key,r.batchId);return i=i.delete(t),this.referenceDelegate.markPotentiallyOrphaned(n,e.key)}).next(()=>{this.Rs=i})}Dn(e){}containsKey(e,t){var n=new th(t,0),n=this.Rs.firstAfterOrEqual(n);return Si.resolve(t.isEqual(n&&n.key))}performConsistencyCheck(e){return this.mutationQueue.length,Si.resolve()}Vs(e,t){return this.Ps(e)}Ps(e){return 0===this.mutationQueue.length?0:e-this.mutationQueue[0].batchId}vs(e){var t=this.Ps(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}class rh{constructor(e){this.Ss=e,this.docs=new vs(di.comparator),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const n=t.key,r=this.docs.get(n),i=r?r.size:0,s=this.Ss(t);return this.docs=this.docs.insert(n,{document:t.mutableCopy(),size:s}),this.size+=s-i,this.indexManager.addToCollectionParentIndex(e,n.path.popLast())}removeEntry(e){var t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const n=this.docs.get(t);return Si.resolve(n?n.document.mutableCopy():ta.newInvalidDocument(t))}getEntries(e,t){let n=Wa;return t.forEach(e=>{const t=this.docs.get(e);n=n.insert(e,t?t.document.mutableCopy():ta.newInvalidDocument(e))}),Si.resolve(n)}getDocumentsMatchingQuery(e,t,n,r){let i=Wa;const s=t.path,a=new di(s.child("")),o=this.docs.getIteratorFrom(a);for(;o.hasNext();){const{key:e,value:{document:a}}=o.getNext();if(!s.isPrefixOf(e.path))break;e.path.length>s.length+1||Ii(wi(a),n)<=0||(r.has(a.key)||za(t,a))&&(i=i.insert(a.key,a.mutableCopy()))}return Si.resolve(i)}getAllFromCollectionGroup(e,t,n,r){Kr()}Ds(e,t){return Si.forEach(this.docs,e=>t(e))}newChangeBuffer(e){return new ih(this)}getSize(e){return Si.resolve(this.size)}}class ih extends Uc{constructor(e){super(),this.rs=e}applyChanges(n){const r=[];return this.changes.forEach((e,t)=>{t.isValidDocument()?r.push(this.rs.addEntry(n,t)):this.rs.removeEntry(e)}),Si.waitFor(r)}getFromCache(e,t){return this.rs.getEntry(e,t)}getAllFromCache(e,t){return this.rs.getEntries(e,t)}}class sh{constructor(e){this.persistence=e,this.Cs=new Ha(e=>Sa(e),xa),this.lastRemoteSnapshotVersion=oi.min(),this.highestTargetId=0,this.xs=0,this.Ns=new eh,this.targetCount=0,this.ks=Nc.Nn()}forEachTarget(e,n){return this.Cs.forEach((e,t)=>n(t)),Si.resolve()}getLastRemoteSnapshotVersion(e){return Si.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return Si.resolve(this.xs)}allocateTargetId(e){return this.highestTargetId=this.ks.next(),Si.resolve(this.highestTargetId)}setTargetsMetadata(e,t,n){return n&&(this.lastRemoteSnapshotVersion=n),t>this.xs&&(this.xs=t),Si.resolve()}$n(e){this.Cs.set(e.target,e);var t=e.targetId;t>this.highestTargetId&&(this.ks=new Nc(t),this.highestTargetId=t),e.sequenceNumber>this.xs&&(this.xs=e.sequenceNumber)}addTargetData(e,t){return this.$n(t),this.targetCount+=1,Si.resolve()}updateTargetData(e,t){return this.$n(t),Si.resolve()}removeTargetData(e,t){return this.Cs.delete(t.target),this.Ns.ps(t.targetId),--this.targetCount,Si.resolve()}removeTargets(n,r,i){let s=0;const a=[];return this.Cs.forEach((e,t)=>{t.sequenceNumber<=r&&null===i.get(t.targetId)&&(this.Cs.delete(e),a.push(this.removeMatchingKeysForTargetId(n,t.targetId)),s++)}),Si.waitFor(a).next(()=>s)}getTargetCount(e){return Si.resolve(this.targetCount)}getTargetData(e,t){var n=this.Cs.get(t)||null;return Si.resolve(n)}addMatchingKeys(e,t,n){return this.Ns.ws(t,n),Si.resolve()}removeMatchingKeys(t,e,n){this.Ns.ys(e,n);const r=this.persistence.referenceDelegate,i=[];return r&&e.forEach(e=>{i.push(r.markPotentiallyOrphaned(t,e))}),Si.waitFor(i)}removeMatchingKeysForTargetId(e,t){return this.Ns.ps(t),Si.resolve()}getMatchingKeysForTargetId(e,t){var n=this.Ns.Ts(t);return Si.resolve(n)}containsKey(e,t){return Si.resolve(this.Ns.containsKey(t))}}class ah{constructor(e,t){this.Ms={},this.overlays={},this.Os=new Pi(0),this.$s=!1,this.$s=!0,this.referenceDelegate=e(this),this.Fs=new sh(this),this.indexManager=new dc,this.remoteDocumentCache=(e=e=>this.referenceDelegate.Bs(e),new rh(e)),this.serializer=new Ru(t),this.Ls=new Jc(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.$s=!1,Promise.resolve()}get started(){return this.$s}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new Zc,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let n=this.Ms[e.toKey()];return n||(n=new nh(t,this.referenceDelegate),this.Ms[e.toKey()]=n),n}getTargetCache(){return this.Fs}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ls}runTransaction(e,t,n){qr("MemoryPersistence","Starting transaction:",e);const r=new oh(this.Os.next());return this.referenceDelegate.qs(),n(r).next(e=>this.referenceDelegate.Us(r).next(()=>e)).toPromise().then(e=>(r.raiseOnCommittedEvent(),e))}Ks(t,n){return Si.or(Object.values(this.Ms).map(e=>()=>e.containsKey(t,n)))}}class oh extends Ti{constructor(e){super(),this.currentSequenceNumber=e}}class uh{constructor(e){this.persistence=e,this.Gs=new eh,this.Qs=null}static js(e){return new uh(e)}get zs(){if(this.Qs)return this.Qs;throw Kr()}addReference(e,t,n){return this.Gs.addReference(n,t),this.zs.delete(n.toString()),Si.resolve()}removeReference(e,t,n){return this.Gs.removeReference(n,t),this.zs.add(n.toString()),Si.resolve()}markPotentiallyOrphaned(e,t){return this.zs.add(t.toString()),Si.resolve()}removeTarget(e,t){this.Gs.ps(t.targetId).forEach(e=>this.zs.add(e.toString()));const n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(e,t.targetId).next(e=>{e.forEach(e=>this.zs.add(e.toString()))}).next(()=>n.removeTargetData(e,t))}qs(){this.Qs=new Set}Us(n){const r=this.persistence.getRemoteDocumentCache().newChangeBuffer();return Si.forEach(this.zs,e=>{const t=di.fromPath(e);return this.Ws(n,t).next(e=>{e||r.removeEntry(t,oi.min())})}).next(()=>(this.Qs=null,r.apply(n)))}updateLimboDocument(e,t){return this.Ws(e,t).next(e=>{e?this.zs.delete(t.toString()):this.zs.add(t.toString())})}Bs(e){return 0}Ws(e,t){return Si.or([()=>Si.resolve(this.Gs.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Ks(e,t)])}}class ch{constructor(e){this.serializer=e}$(t,e,n,r){const i=new xi("createOrUpgrade",e);var s;n<1&&1<=r&&(t.createObjectStore("owner"),(s=t).createObjectStore("mutationQueues",{keyPath:"userId"}),s.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",Gi,{unique:!0}),s.createObjectStore("documentMutations"),hh(t),t.createObjectStore("remoteDocuments"));let a=Si.resolve();return n<3&&3<=r&&(0!==n&&((s=t).deleteObjectStore("targetDocuments"),s.deleteObjectStore("targets"),s.deleteObjectStore("targetGlobal"),hh(t)),a=a.next(()=>function(){const e=i.store("targetGlobal"),t={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:oi.min().toTimestamp(),targetCount:0};return e.put("targetGlobalKey",t)}())),n<4&&4<=r&&(0!==n&&(a=a.next(()=>function(r,i){return i.store("mutations").j().next(e=>{r.deleteObjectStore("mutations"),r.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",Gi,{unique:!0});const t=i.store("mutations"),n=e.map(e=>t.put(e));return Si.waitFor(n)})}(t,i))),a=a.next(()=>{t.createObjectStore("clientMetadata",{keyPath:"clientId"})})),n<5&&5<=r&&(a=a.next(()=>this.Js(i))),n<6&&6<=r&&(a=a.next(()=>(t.createObjectStore("remoteDocumentGlobal"),this.Ys(i)))),n<7&&7<=r&&(a=a.next(()=>this.Xs(i))),n<8&&8<=r&&(a=a.next(()=>this.Zs(t,i))),n<9&&9<=r&&(a=a.next(()=>{var e;(e=t).objectStoreNames.contains("remoteDocumentChanges")&&e.deleteObjectStore("remoteDocumentChanges")})),n<10&&10<=r&&(a=a.next(()=>this.ti(i))),n<11&&11<=r&&(a=a.next(()=>{t.createObjectStore("bundles",{keyPath:"bundleId"}),t.createObjectStore("namedQueries",{keyPath:"name"})})),n<12&&12<=r&&(a=a.next(()=>{!function(){const e=t.createObjectStore("documentOverlays",{keyPath:ss});e.createIndex("collectionPathOverlayIndex",as,{unique:!1}),e.createIndex("collectionGroupOverlayIndex",os,{unique:!1})}()})),n<13&&13<=r&&(a=a.next(()=>function(){const e=t.createObjectStore("remoteDocumentsV14",{keyPath:Hi});e.createIndex("documentKeyIndex",Wi),e.createIndex("collectionGroupIndex",Xi)}()).next(()=>this.ei(t,i)).next(()=>t.deleteObjectStore("remoteDocuments"))),n<14&&14<=r&&(a=a.next(()=>this.ni(t,i))),n<15&&15<=r&&(a=a.next(()=>function(e){e.createObjectStore("indexConfiguration",{keyPath:"indexId",autoIncrement:!0}).createIndex("collectionGroupIndex","collectionGroup",{unique:!1}),e.createObjectStore("indexState",{keyPath:ts}).createIndex("sequenceNumberIndex",ns,{unique:!1}),e.createObjectStore("indexEntries",{keyPath:rs}).createIndex("documentKeyIndex",is,{unique:!1})}(t))),a}Ys(t){let n=0;return t.store("remoteDocuments").X((e,t)=>{n+=_c(t)}).next(()=>{var e={byteSize:n};return t.store("remoteDocumentGlobal").put("remoteDocumentGlobalKey",e)})}Js(r){const e=r.store("mutationQueues"),t=r.store("mutations");return e.j().next(e=>Si.forEach(e,n=>{var e=IDBKeyRange.bound([n.userId,-1],[n.userId,n.lastAcknowledgedBatchId]);return t.j("userMutationsIndex",e).next(e=>Si.forEach(e,e=>{Gr(e.userId===n.userId);var t=Pu(this.serializer,e);return Tc(r,n.userId,t).next(()=>{})}))}))}Xs(e){const a=e.store("targetDocuments"),t=e.store("remoteDocuments");return e.store("targetGlobal").get("targetGlobalKey").next(i=>{const s=[];return t.X((e,t)=>{const n=new ci(e),r=[0,Ui(n)];s.push(a.get(r).next(e=>e?Si.resolve():(e=>a.put({targetId:0,path:Ui(e),sequenceNumber:i.highestListenSequenceNumber}))(n)))}).next(()=>Si.waitFor(s))})}Zs(e,t){e.createObjectStore("collectionParents",{keyPath:es});const n=t.store("collectionParents"),r=new fc,i=e=>{if(r.add(e)){const t=e.lastSegment(),r=e.popLast();return n.put({collectionId:t,parent:Ui(r)})}};return t.store("remoteDocuments").X({Y:!0},(e,t)=>{const n=new ci(e);return i(n.popLast())}).next(()=>t.store("documentMutations").X({Y:!0},([,e],t)=>{const n=Ki(e);return i(n.popLast())}))}ti(e){const r=e.store("targets");return r.X((e,t)=>{var n=Vu(t),n=qu(this.serializer,n);return r.put(n)})}ei(e,s){const t=s.store("remoteDocuments"),a=[];return t.X((e,t)=>{const n=s.store("remoteDocumentsV14"),r=((i=t).document?new di(ci.fromString(i.document.name).popFirst(5)):i.noDocument?di.fromSegments(i.noDocument.path):i.unknownDocument?di.fromSegments(i.unknownDocument.path):Kr()).path.toArray();var i={prefixPath:r.slice(0,r.length-2),collectionGroup:r[r.length-2],documentId:r[r.length-1],readTime:t.readTime||[0,0],unknownDocument:t.unknownDocument,noDocument:t.noDocument,document:t.document,hasCommittedMutations:!!t.hasCommittedMutations};a.push(n.put(i))}).next(()=>Si.waitFor(a))}ni(e,s){const t=s.store("mutations"),a=Kc(this.serializer),o=new ah(uh.js,this.serializer.le);return t.j().next(e=>{const r=new Map;return e.forEach(e=>{var t;let n=null!==(t=r.get(e.userId))&&void 0!==t?t:no();Pu(this.serializer,e).keys().forEach(e=>n=n.add(e)),r.set(e.userId,n)}),Si.forEach(r,(e,t)=>{var n=new Lr(t),r=Qu.fe(this.serializer,n),i=o.getIndexManager(n),n=Sc.fe(n,this.serializer,i,o.referenceDelegate);return new Yc(a,n,r,i).recalculateAndSaveOverlaysForDocumentKeys(new fs(s,Pi.ct),e).next()})})}}function hh(e){e.createObjectStore("targetDocuments",{keyPath:Ji}).createIndex("documentTargetsIndex",Zi,{unique:!0}),e.createObjectStore("targets",{keyPath:"targetId"}).createIndex("queryTargetsIndex",Yi,{unique:!0}),e.createObjectStore("targetGlobal")}const lh="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.";class dh{constructor(e,t,n,r,i,s,a,o,u,c,h=15){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=n,this.si=i,this.window=s,this.document=a,this.ii=u,this.ri=c,this.oi=h,this.Os=null,this.$s=!1,this.isPrimary=!1,this.networkEnabled=!0,this.ui=null,this.inForeground=!1,this.ci=null,this.ai=null,this.hi=Number.NEGATIVE_INFINITY,this.li=e=>Promise.resolve(),!dh.D())throw new $r(zr.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new qc(this,r),this.fi=t+"main",this.serializer=new Ru(o),this.di=new Di(this.fi,this.oi,new ch(this.serializer)),this.Fs=new kc(this.referenceDelegate,this.serializer),this.remoteDocumentCache=Kc(this.serializer),this.Ls=new Gu,this.window&&this.window.localStorage?this._i=this.window.localStorage:(this._i=null,!1===c&&Br("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.wi().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new $r(zr.FAILED_PRECONDITION,lh);return this.mi(),this.gi(),this.yi(),this.runTransaction("getHighestListenSequenceNumber","readonly",e=>this.Fs.getHighestSequenceNumber(e))}).then(e=>{this.Os=new Pi(e,this.ii)}).then(()=>{this.$s=!0}).catch(e=>(this.di&&this.di.close(),Promise.reject(e)))}pi(t){return this.li=async e=>{if(this.started)return t(e)},t(this.isPrimary)}setDatabaseDeletedListener(t){this.di.B(async e=>{null===e.newVersion&&await t()})}setNetworkEnabled(e){this.networkEnabled!==e&&(this.networkEnabled=e,this.si.enqueueAndForget(async()=>{this.started&&await this.wi()}))}wi(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",t=>gh(t).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next(()=>{if(this.isPrimary)return this.Ii(t).next(e=>{e||(this.isPrimary=!1,this.si.enqueueRetryable(()=>this.li(!1)))})}).next(()=>this.Ti(t)).next(e=>this.isPrimary&&!e?this.Ei(t).next(()=>!1):!!e&&this.Ai(t).next(()=>!0))).catch(e=>{if(Ni(e))return qr("IndexedDbPersistence","Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return qr("IndexedDbPersistence","Releasing owner lease after error during lease refresh",e),!1}).then(e=>{this.isPrimary!==e&&this.si.enqueueRetryable(()=>this.li(e)),this.isPrimary=e})}Ii(e){return fh(e).get("owner").next(e=>Si.resolve(this.Ri(e)))}vi(e){return gh(e).delete(this.clientId)}async Pi(){if(this.isPrimary&&!this.bi(this.hi,18e5)){this.hi=Date.now();var e=await this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",e=>{const r=gs(e,"clientMetadata");return r.j().next(e=>{const t=this.Vi(e,18e5),n=e.filter(e=>-1===t.indexOf(e));return Si.forEach(n,e=>r.delete(e.clientId)).next(()=>n)})}).catch(()=>[]);if(this._i)for(const t of e)this._i.removeItem(this.Si(t.clientId))}}yi(){this.ai=this.si.enqueueAfterDelay("client_metadata_refresh",4e3,()=>this.wi().then(()=>this.Pi()).then(()=>this.yi()))}Ri(e){return!!e&&e.ownerId===this.clientId}Ti(t){return this.ri?Si.resolve(!0):fh(t).get("owner").next(e=>{if(null!==e&&this.bi(e.leaseTimestampMs,5e3)&&!this.Di(e.ownerId)){if(this.Ri(e)&&this.networkEnabled)return!0;if(!this.Ri(e)){if(!e.allowTabSynchronization)throw new $r(zr.FAILED_PRECONDITION,lh);return!1}}return!(!this.networkEnabled||!this.inForeground)||gh(t).j().next(e=>void 0===this.Vi(e,5e3).find(e=>{if(this.clientId!==e.clientId){var t=!this.networkEnabled&&e.networkEnabled,n=!this.inForeground&&e.inForeground,r=this.networkEnabled===e.networkEnabled;if(t||n&&r)return!0}return!1}))}).next(e=>(this.isPrimary!==e&&qr("IndexedDbPersistence",`Client ${e?"is":"is not"} eligible for a primary lease.`),e))}async shutdown(){this.$s=!1,this.Ci(),this.ai&&(this.ai.cancel(),this.ai=null),this.xi(),this.Ni(),await this.di.runTransaction("shutdown","readwrite",["owner","clientMetadata"],e=>{const t=new fs(e,Pi.ct);return this.Ei(t).next(()=>this.vi(t))}),this.di.close(),this.ki()}Vi(e,t){return e.filter(e=>this.bi(e.updateTimeMs,t)&&!this.Di(e.clientId))}Mi(){return this.runTransaction("getActiveClients","readonly",e=>gh(e).j().next(e=>this.Vi(e,18e5).map(e=>e.clientId)))}get started(){return this.$s}getMutationQueue(e,t){return Sc.fe(e,this.serializer,t,this.referenceDelegate)}getTargetCache(){return this.Fs}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new mc(e,this.serializer.le.databaseId)}getDocumentOverlayCache(e){return Qu.fe(this.serializer,e)}getBundleCache(){return this.Ls}runTransaction(t,n,r){qr("IndexedDbPersistence","Starting transaction:",t);var e,i="readonly"===n?"readonly":"readwrite",e=15===(e=this.oi)?ds:14===e?ls:13===e?hs:12===e?cs:11===e?us:void Kr();let s;return this.di.runTransaction(t,i,e,e=>(s=new fs(e,this.Os?this.Os.next():Pi.ct),"readwrite-primary"===n?this.Ii(s).next(e=>!!e||this.Ti(s)).next(e=>{if(!e)throw Br(`Failed to obtain primary lease for action '${t}'.`),this.isPrimary=!1,this.si.enqueueRetryable(()=>this.li(!1)),new $r(zr.FAILED_PRECONDITION,Ei);return r(s)}).next(e=>this.Ai(s).next(()=>e)):this.Oi(s).next(()=>r(s)))).then(e=>(s.raiseOnCommittedEvent(),e))}Oi(e){return fh(e).get("owner").next(e=>{if(null!==e&&this.bi(e.leaseTimestampMs,5e3)&&!this.Di(e.ownerId)&&!this.Ri(e)&&!(this.ri||this.allowTabSynchronization&&e.allowTabSynchronization))throw new $r(zr.FAILED_PRECONDITION,lh)})}Ai(e){var t={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return fh(e).put("owner",t)}static D(){return Di.D()}Ei(e){const t=fh(e);return t.get("owner").next(e=>this.Ri(e)?(qr("IndexedDbPersistence","Releasing primary lease."),t.delete("owner")):Si.resolve())}bi(e,t){var n=Date.now();return!(e<n-t||n<e&&(Br(`Detected an update time that is in the future: ${e} > ${n}`),1))}mi(){null!==this.document&&"function"==typeof this.document.addEventListener&&(this.ci=()=>{this.si.enqueueAndForget(()=>(this.inForeground="visible"===this.document.visibilityState,this.wi()))},this.document.addEventListener("visibilitychange",this.ci),this.inForeground="visible"===this.document.visibilityState)}xi(){this.ci&&(this.document.removeEventListener("visibilitychange",this.ci),this.ci=null)}gi(){var e;"function"==typeof(null===(e=this.window)||void 0===e?void 0:e.addEventListener)&&(this.ui=()=>{this.Ci();var e=/(?:Version|Mobile)\/1[456]/;h()&&(navigator.appVersion.match(e)||navigator.userAgent.match(e))&&this.si.enterRestrictedMode(!0),this.si.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.ui))}Ni(){this.ui&&(this.window.removeEventListener("pagehide",this.ui),this.ui=null)}Di(e){var t;try{var n=null!==(null===(t=this._i)||void 0===t?void 0:t.getItem(this.Si(e)));return qr("IndexedDbPersistence",`Client '${e}' ${n?"is":"is not"} zombied in LocalStorage`),n}catch(e){return Br("IndexedDbPersistence","Failed to get zombied client id.",e),!1}}Ci(){if(this._i)try{this._i.setItem(this.Si(this.clientId),String(Date.now()))}catch(e){Br("Failed to set zombie client id.",e)}}ki(){if(this._i)try{this._i.removeItem(this.Si(this.clientId))}catch(e){}}Si(e){return`firestore_zombie_${this.persistenceKey}_${e}`}}function fh(e){return gs(e,"owner")}function gh(e){return gs(e,"clientMetadata")}function mh(e,t){let n=e.projectId;return e.isDefaultDatabase||(n+="."+e.database),"firestore/"+t+"/"+n+"/"}class ph{constructor(e,t,n,r){this.targetId=e,this.fromCache=t,this.$i=n,this.Fi=r}static Bi(e,t){let n=no(),r=no();for(const e of t.docChanges)switch(e.type){case 0:n=n.add(e.doc.key);break;case 1:r=r.add(e.doc.key)}return new ph(e,t.fromCache,n,r)}}class yh{constructor(){this.Li=!1}initialize(e,t){this.qi=e,this.indexManager=t,this.Li=!0}getDocumentsMatchingQuery(t,n,r,i){return this.Ui(t,n).next(e=>e||this.Ki(t,n,i,r)).next(e=>e||this.Gi(t,n))}Ui(i,s){if(Fa(s))return Si.resolve(null);let t=qa(s);return this.indexManager.getIndexType(i,t).next(e=>0===e?null:(null!==s.limit&&1===e&&(s=Ua(s,null,"F"),t=qa(s)),this.indexManager.getDocumentsMatchingTarget(i,t).next(e=>{const r=no(...e);return this.qi.getDocuments(i,r).next(n=>this.indexManager.getMinOffset(i,t).next(e=>{var t=this.Qi(s,n);return this.ji(s,t,r,e.readTime)?this.Ui(i,Ua(s,null,"F")):this.zi(i,t,s,e)}))})))}Ki(n,r,i,s){return Fa(r)||s.isEqual(oi.min())?this.Gi(n,r):this.qi.getDocuments(n,i).next(e=>{var t=this.Qi(r,e);return this.ji(r,t,i,s)?this.Gi(n,r):(Vr()<=l.DEBUG&&qr("QueryEngine","Re-using previous result from %s to execute query: %s",s.toString(),Ga(r)),this.zi(n,t,r,vi(s,-1)))})}Qi(n,e){let r=new Is(Qa(n));return e.forEach((e,t)=>{za(n,t)&&(r=r.add(t))}),r}ji(e,t,n,r){if(null===e.limit)return!1;if(n.size!==t.size)return!0;const i="F"===e.limitType?t.last():t.first();return!!i&&(i.hasPendingWrites||0<i.version.compareTo(r))}Gi(e,t){return Vr()<=l.DEBUG&&qr("QueryEngine","Using full collection scan to execute query:",Ga(t)),this.qi.getDocumentsMatchingQuery(e,t,bi.min())}zi(e,n,t,r){return this.qi.getDocumentsMatchingQuery(e,t,r).next(t=>(n.forEach(e=>{t=t.insert(e.key,e)}),t))}}class vh{constructor(e,t,n,r){this.persistence=e,this.Wi=t,this.serializer=r,this.Hi=new vs(ri),this.Ji=new Ha(e=>Sa(e),xa),this.Yi=new Map,this.Xi=e.getRemoteDocumentCache(),this.Fs=e.getTargetCache(),this.Ls=e.getBundleCache(),this.Zi(n)}Zi(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new Yc(this.Xi,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Xi.setIndexManager(this.indexManager),this.Wi.initialize(this.localDocuments,this.indexManager)}collectGarbage(t){return this.persistence.runTransaction("Collect garbage","readwrite-primary",e=>t.collect(e,this.Hi))}}function wh(e,t,n,r){return new vh(e,t,n,r)}async function bh(e,t){const a=e;return a.persistence.runTransaction("Handle user change","readonly",i=>{let s;return a.mutationQueue.getAllMutationBatches(i).next(e=>(s=e,a.Zi(t),a.mutationQueue.getAllMutationBatches(i))).next(e=>{const t=[],n=[];let r=no();for(const i of s){t.push(i.batchId);for(const e of i.mutations)r=r.add(e.key)}for(const i of e){n.push(i.batchId);for(const e of i.mutations)r=r.add(e.key)}return a.localDocuments.getDocuments(i,r).next(e=>({tr:e,removedBatchIds:t,addedBatchIds:n}))})})}function Ih(e){const t=e;return t.persistence.runTransaction("Get last remote snapshot version","readonly",e=>t.Fs.getLastRemoteSnapshotVersion(e))}function Eh(e,c){const h=e,l=c.snapshotVersion;let d=h.Hi;return h.persistence.runTransaction("Apply remote event","readwrite-primary",o=>{const e=h.Xi.newChangeBuffer({trackRemovals:!0});d=h.Hi;const u=[];c.targetChanges.forEach((t,n)=>{const r=d.get(n);if(r){u.push(h.Fs.removeMatchingKeys(o,t.removedDocuments,n).next(()=>h.Fs.addMatchingKeys(o,t.addedDocuments,n)));let e=r.withSequenceNumber(o.currentSequenceNumber);var i,s,a;null!==c.targetMismatches.get(n)?e=e.withResumeToken(xs.EMPTY_BYTE_STRING,oi.min()).withLastLimboFreeSnapshotVersion(oi.min()):0<t.resumeToken.approximateByteSize()&&(e=e.withResumeToken(t.resumeToken,l)),d=d.insert(n,e),i=r,s=e,a=t,0!==i.resumeToken.approximateByteSize()&&!(3e8<=s.snapshotVersion.toMicroseconds()-i.snapshotVersion.toMicroseconds()||0<a.addedDocuments.size+a.modifiedDocuments.size+a.removedDocuments.size)||u.push(h.Fs.updateTargetData(o,e))}});let t=Wa,n=no();if(c.documentUpdates.forEach(e=>{c.resolvedLimboDocuments.has(e)&&u.push(h.persistence.referenceDelegate.updateLimboDocument(o,e))}),u.push(Th(o,e,c.documentUpdates).next(e=>{t=e.er,n=e.nr})),!l.isEqual(oi.min())){const c=h.Fs.getLastRemoteSnapshotVersion(o).next(e=>h.Fs.setTargetsMetadata(o,o.currentSequenceNumber,l));u.push(c)}return Si.waitFor(u).next(()=>e.apply(o)).next(()=>h.localDocuments.getLocalViewOfDocuments(o,t,n)).next(()=>t)}).then(e=>(h.Hi=d,e))}function Th(e,s,t){let n=no(),a=no();return t.forEach(e=>n=n.add(e)),s.getEntries(e,n).next(r=>{let i=Wa;return t.forEach((e,t)=>{const n=r.get(e);t.isFoundDocument()!==n.isFoundDocument()&&(a=a.add(e)),t.isNoDocument()&&t.version.isEqual(oi.min())?(s.removeEntry(e,t.readTime),i=i.insert(e,t)):!n.isValidDocument()||0<t.version.compareTo(n.version)||0===t.version.compareTo(n.version)&&n.hasPendingWrites?(s.addEntry(t),i=i.insert(e,t)):qr("LocalStore","Ignoring outdated watch update for ",e,". Current version:",n.version," Watch version:",t.version)}),{er:i,nr:a}})}function _h(e,r){const i=e;return i.persistence.runTransaction("Allocate target","readwrite",t=>{let n;return i.Fs.getTargetData(t,r).next(e=>e?(n=e,Si.resolve(n)):i.Fs.allocateTargetId(t).next(e=>(n=new ku(r,e,"TargetPurposeListen",t.currentSequenceNumber),i.Fs.addTargetData(t,n).next(()=>n))))}).then(e=>{var t=i.Hi.get(e.targetId);return(null===t||0<e.snapshotVersion.compareTo(t.snapshotVersion))&&(i.Hi=i.Hi.insert(e.targetId,e),i.Ji.set(r,e.targetId)),e})}async function Sh(e,t,n){const r=e,i=r.Hi.get(t),s=n?"readwrite":"readwrite-primary";try{n||await r.persistence.runTransaction("Release target",s,e=>r.persistence.referenceDelegate.removeTarget(e,i))}catch(e){if(!Ni(e))throw e;qr("LocalStore",`Failed to update sequence numbers for target ${t}: ${e}`)}r.Hi=r.Hi.remove(t),r.Ji.delete(i.target)}function xh(e,n,r){const i=e;let s=oi.min(),a=no();return i.persistence.runTransaction("Execute query","readonly",t=>function(e,t,n){const r=e,i=r.Ji.get(n);return void 0!==i?Si.resolve(r.Hi.get(i)):r.Fs.getTargetData(t,n)}(i,t,qa(n)).next(e=>{if(e)return s=e.lastLimboFreeSnapshotVersion,i.Fs.getMatchingKeysForTargetId(t,e.targetId).next(e=>{a=e})}).next(()=>i.Wi.getDocumentsMatchingQuery(t,n,r?s:oi.min(),r?a:no())).next(e=>(Ch(i,$a(n),e),{documents:e,sr:a})))}function Dh(e,t){const n=e,r=n.Fs,i=n.Hi.get(t);return i?Promise.resolve(i.target):n.persistence.runTransaction("Get target data","readonly",e=>r.he(e,t).next(e=>e?e.target:null))}function Ah(e,t){const n=e,r=n.Yi.get(t)||oi.min();return n.persistence.runTransaction("Get new document changes","readonly",e=>n.Xi.getAllFromCollectionGroup(e,t,vi(r,-1),Number.MAX_SAFE_INTEGER)).then(e=>(Ch(n,t,e),e))}function Ch(e,t,n){let r=e.Yi.get(t)||oi.min();n.forEach((e,t)=>{0<t.readTime.compareTo(r)&&(r=t.readTime)}),e.Yi.set(t,r)}function Nh(e,t){return`firestore_clients_${e}_${t}`}function kh(e,t,n){let r=`firestore_mutations_${e}_${n}`;return t.isAuthenticated()&&(r+=`_${t.uid}`),r}function Rh(e,t){return`firestore_targets_${e}_${t}`}class Mh{constructor(e,t,n,r){this.user=e,this.batchId=t,this.state=n,this.error=r}static cr(e,t,n){var r=JSON.parse(n);let i,s="object"==typeof r&&-1!==["pending","acknowledged","rejected"].indexOf(r.state)&&(void 0===r.error||"object"==typeof r.error);return s&&r.error&&(s="string"==typeof r.error.message&&"string"==typeof r.error.code,s&&(i=new $r(r.error.code,r.error.message))),s?new Mh(e,t,r.state,i):(Br("SharedClientState",`Failed to parse mutation state for ID '${t}': ${n}`),null)}ar(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class Fh{constructor(e,t,n){this.targetId=e,this.state=t,this.error=n}static cr(e,t){var n=JSON.parse(t);let r,i="object"==typeof n&&-1!==["not-current","current","rejected"].indexOf(n.state)&&(void 0===n.error||"object"==typeof n.error);return i&&n.error&&(i="string"==typeof n.error.message&&"string"==typeof n.error.code,i&&(r=new $r(n.error.code,n.error.message))),i?new Fh(e,n.state,r):(Br("SharedClientState",`Failed to parse target state for ID '${e}': ${t}`),null)}ar(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class Lh{constructor(e,t){this.clientId=e,this.activeTargetIds=t}static cr(e,t){var n=JSON.parse(t);let r="object"==typeof n&&n.activeTargetIds instanceof Array,i=ro;for(let s=0;r&&s<n.activeTargetIds.length;++s)r=Bi(n.activeTargetIds[s]),i=i.add(n.activeTargetIds[s]);return r?new Lh(e,i):(Br("SharedClientState",`Failed to parse client data for instance '${e}': ${t}`),null)}}class Oh{constructor(e,t){this.clientId=e,this.onlineState=t}static cr(e){var t=JSON.parse(e);return"object"==typeof t&&-1!==["Unknown","Online","Offline"].indexOf(t.onlineState)&&"string"==typeof t.clientId?new Oh(t.clientId,t.onlineState):(Br("SharedClientState",`Failed to parse online state: ${e}`),null)}}class Ph{constructor(){this.activeTargetIds=ro}hr(e){this.activeTargetIds=this.activeTargetIds.add(e)}lr(e){this.activeTargetIds=this.activeTargetIds.delete(e)}ar(){var e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class Vh{constructor(e,t,n,r,i){this.window=e,this.si=t,this.persistenceKey=n,this.dr=r,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this._r=this.wr.bind(this),this.mr=new vs(ri),this.started=!1,this.gr=[];var s=n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=i,this.yr=Nh(this.persistenceKey,this.dr),this.pr=`firestore_sequence_number_${this.persistenceKey}`,this.mr=this.mr.insert(this.dr,new Ph),this.Ir=new RegExp(`^firestore_clients_${s}_([^_]*)$`),this.Tr=new RegExp(`^firestore_mutations_${s}_(\\d+)(?:_(.*))?$`),this.Er=new RegExp(`^firestore_targets_${s}_(\\d+)$`),this.Ar=`firestore_online_state_${this.persistenceKey}`,this.Rr=`firestore_bundle_loaded_v2_${this.persistenceKey}`,this.window.addEventListener("storage",this._r)}static D(e){return!(!e||!e.localStorage)}async start(){const e=await this.syncEngine.Mi();for(const n of e)if(n!==this.dr){const e=this.getItem(Nh(this.persistenceKey,n));var t;!e||(t=Lh.cr(n,e))&&(this.mr=this.mr.insert(t.clientId,t))}this.vr();const n=this.storage.getItem(this.Ar);if(n){const e=this.Pr(n);e&&this.br(e)}for(const e of this.gr)this.wr(e);this.gr=[],this.window.addEventListener("pagehide",()=>this.shutdown()),this.started=!0}writeSequenceNumber(e){this.setItem(this.pr,JSON.stringify(e))}getAllActiveQueryTargets(){return this.Vr(this.mr)}isActiveQueryTarget(n){let r=!1;return this.mr.forEach((e,t)=>{t.activeTargetIds.has(n)&&(r=!0)}),r}addPendingMutation(e){this.Sr(e,"pending")}updateMutationState(e,t,n){this.Sr(e,t,n),this.Dr(e)}addLocalQueryTarget(e){let t="not-current";var n;return this.isActiveQueryTarget(e)&&(!(n=this.storage.getItem(Rh(this.persistenceKey,e)))||(n=Fh.cr(e,n))&&(t=n.state)),this.Cr.hr(e),this.vr(),t}removeLocalQueryTarget(e){this.Cr.lr(e),this.vr()}isLocalQueryTarget(e){return this.Cr.activeTargetIds.has(e)}clearQueryState(e){this.removeItem(Rh(this.persistenceKey,e))}updateQueryState(e,t,n){this.Nr(e,t,n)}handleUserChange(e,t,n){t.forEach(e=>{this.Dr(e)}),this.currentUser=e,n.forEach(e=>{this.addPendingMutation(e)})}setOnlineState(e){this.kr(e)}notifyBundleLoaded(e){this.Mr(e)}shutdown(){this.started&&(this.window.removeEventListener("storage",this._r),this.removeItem(this.yr),this.started=!1)}getItem(e){var t=this.storage.getItem(e);return qr("SharedClientState","READ",e,t),t}setItem(e,t){qr("SharedClientState","SET",e,t),this.storage.setItem(e,t)}removeItem(e){qr("SharedClientState","REMOVE",e),this.storage.removeItem(e)}wr(e){const i=e;i.storageArea===this.storage&&(qr("SharedClientState","EVENT",i.key,i.newValue),i.key!==this.yr?this.si.enqueueRetryable(async()=>{if(this.started){if(null!==i.key)if(this.Ir.test(i.key)){if(null==i.newValue){var e=this.Or(i.key);return this.$r(e,null)}e=this.Fr(i.key,i.newValue);if(e)return this.$r(e.clientId,e)}else if(this.Tr.test(i.key)){if(null!==i.newValue){var t=this.Br(i.key,i.newValue);if(t)return this.Lr(t)}}else if(this.Er.test(i.key)){if(null!==i.newValue){t=this.qr(i.key,i.newValue);if(t)return this.Ur(t)}}else if(i.key===this.Ar){if(null!==i.newValue){var n=this.Pr(i.newValue);if(n)return this.br(n)}}else if(i.key===this.pr){n=function(e){let t=Pi.ct;if(null!=e)try{var n=JSON.parse(e);Gr("number"==typeof n),t=n}catch(e){Br("SharedClientState","Failed to read sequence number from WebStorage",e)}return t}(i.newValue);n!==Pi.ct&&this.sequenceNumberHandler(n)}else if(i.key===this.Rr){const r=this.Kr(i.newValue);await Promise.all(r.map(e=>this.syncEngine.Gr(e)))}}else this.gr.push(i)}):Br("Received WebStorage notification for local change. Another client might have garbage-collected our state"))}get Cr(){return this.mr.get(this.dr)}vr(){this.setItem(this.yr,this.Cr.ar())}Sr(e,t,n){const r=new Mh(this.currentUser,e,t,n),i=kh(this.persistenceKey,this.currentUser,e);this.setItem(i,r.ar())}Dr(e){var t=kh(this.persistenceKey,this.currentUser,e);this.removeItem(t)}kr(e){var t={clientId:this.dr,onlineState:e};this.storage.setItem(this.Ar,JSON.stringify(t))}Nr(e,t,n){const r=Rh(this.persistenceKey,e),i=new Fh(e,t,n);this.setItem(r,i.ar())}Mr(e){var t=JSON.stringify(Array.from(e));this.setItem(this.Rr,t)}Or(e){var t=this.Ir.exec(e);return t?t[1]:null}Fr(e,t){var n=this.Or(e);return Lh.cr(n,t)}Br(e,t){var n=this.Tr.exec(e),r=Number(n[1]),n=void 0!==n[2]?n[2]:null;return Mh.cr(new Lr(n),r,t)}qr(e,t){var n=this.Er.exec(e),n=Number(n[1]);return Fh.cr(n,t)}Pr(e){return Oh.cr(e)}Kr(e){return JSON.parse(e)}async Lr(e){if(e.user.uid===this.currentUser.uid)return this.syncEngine.Qr(e.batchId,e.state,e.error);qr("SharedClientState",`Ignoring mutation for non-active user ${e.user.uid}`)}Ur(e){return this.syncEngine.jr(e.targetId,e.state,e.error)}$r(e,t){const n=t?this.mr.insert(e,t):this.mr.remove(e),r=this.Vr(this.mr),i=this.Vr(n),s=[],a=[];return i.forEach(e=>{r.has(e)||s.push(e)}),r.forEach(e=>{i.has(e)||a.push(e)}),this.syncEngine.zr(s,a).then(()=>{this.mr=n})}br(e){this.mr.get(e.clientId)&&this.onlineStateHandler(e.onlineState)}Vr(e){let n=ro;return e.forEach((e,t)=>{n=n.unionWith(t.activeTargetIds)}),n}}class qh{constructor(){this.Wr=new Ph,this.Hr={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,n){}addLocalQueryTarget(e){return this.Wr.hr(e),this.Hr[e]||"not-current"}updateQueryState(e,t,n){this.Hr[e]=t}removeLocalQueryTarget(e){this.Wr.lr(e)}isLocalQueryTarget(e){return this.Wr.activeTargetIds.has(e)}clearQueryState(e){delete this.Hr[e]}getAllActiveQueryTargets(){return this.Wr.activeTargetIds}isActiveQueryTarget(e){return this.Wr.activeTargetIds.has(e)}start(){return this.Wr=new Ph,Promise.resolve()}handleUserChange(e,t,n){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}class Bh{Jr(e){}shutdown(){}}class Uh{constructor(){this.Yr=()=>this.Xr(),this.Zr=()=>this.eo(),this.no=[],this.so()}Jr(e){this.no.push(e)}shutdown(){window.removeEventListener("online",this.Yr),window.removeEventListener("offline",this.Zr)}so(){window.addEventListener("online",this.Yr),window.addEventListener("offline",this.Zr)}Xr(){qr("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const e of this.no)e(0)}eo(){qr("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const e of this.no)e(1)}static D(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}let jh=null;function Kh(){return null===jh?jh=268435456+Math.round(2147483648*Math.random()):jh++,"0x"+jh.toString(16)}const Gh={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class zh{constructor(e){this.io=e.io,this.ro=e.ro}oo(e){this.uo=e}co(e){this.ao=e}onMessage(e){this.ho=e}close(){this.ro()}send(e){this.io(e)}lo(){this.uo()}fo(e){this.ao(e)}_o(e){this.ho(e)}}const $h="WebChannelConnection";class Qh extends class{constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;var t=e.ssl?"https":"http";this.wo=t+"://"+e.host,this.mo="projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database+"/documents"}get yo(){return!1}po(t,e,n,r,i){const s=Kh(),a=this.Io(t,e);qr("RestConnection",`Sending RPC '${t}' ${s}:`,a,n);var o={};return this.To(o,r,i),this.Eo(t,a,o,n).then(e=>(qr("RestConnection",`Received RPC '${t}' ${s}: `,e),e),e=>{throw Ur("RestConnection",`RPC '${t}' ${s} failed with error: `,e,"url: ",a,"request:",n),e})}Ao(e,t,n,r,i,s){return this.po(e,t,n,r,i)}To(n,e,t){n["X-Goog-Api-Client"]="gl-js/ fire/"+Or,n["Content-Type"]="text/plain",this.databaseInfo.appId&&(n["X-Firebase-GMPID"]=this.databaseInfo.appId),e&&e.headers.forEach((e,t)=>n[t]=e),t&&t.headers.forEach((e,t)=>n[t]=e)}Io(e,t){var n=Gh[e];return`${this.wo}/v1/${t}:${n}`}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams}Eo(o,t,n,r){const u=Kh();return new Promise((i,s)=>{const a=new kr;a.setWithCredentials(!0),a.listenOnce(Sr.COMPLETE,()=>{try{switch(a.getLastErrorCode()){case _r.NO_ERROR:var e=a.getResponseJson();qr($h,`XHR for RPC '${o}' ${u} received:`,JSON.stringify(e)),i(e);break;case _r.TIMEOUT:qr($h,`RPC '${o}' ${u} timed out`),s(new $r(zr.DEADLINE_EXCEEDED,"Request time out"));break;case _r.HTTP_ERROR:var t=a.getStatus();if(qr($h,`RPC '${o}' ${u} failed with status:`,t,"response text:",a.getResponseText()),0<t){let e=a.getResponseJson();Array.isArray(e)&&(e=e[0]);var n=null==e?void 0:e.error;if(n&&n.status&&n.message){const o=(r=n.status.toLowerCase().replace(/_/g,"-"),0<=Object.values(zr).indexOf(r)?r:zr.UNKNOWN);s(new $r(o,n.message))}else s(new $r(zr.UNKNOWN,"Server responded with status "+a.getStatus()))}else s(new $r(zr.UNAVAILABLE,"Connection failed."));break;default:Kr()}}finally{qr($h,`RPC '${o}' ${u} completed.`)}var r});var e=JSON.stringify(r);qr($h,`RPC '${o}' ${u} sending request:`,r),a.send(t,"POST",e,n,15)})}Ro(i,e,t){const s=Kh(),n=[this.wo,"/","google.firestore.v1.Firestore","/",i,"/channel"],r=new Jn,a=Tr(),o={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling};this.useFetchStreams&&(o.xmlHttpFactory=new Cr({})),this.To(o.initMessageHeaders,e,t),o.encodeInitMessageHeaders=!0;var u=n.join("");qr($h,`Creating RPC '${i}' stream ${s}: ${u}`,o);const c=r.createWebChannel(u,o);let h=!1,l=!1;const d=new zh({io:e=>{l?qr($h,`Not sending because RPC '${i}' stream ${s} is closed:`,e):(h||(qr($h,`Opening RPC '${i}' stream ${s} transport.`),c.open(),h=!0),qr($h,`RPC '${i}' stream ${s} sending:`,e),c.send(e))},ro:()=>c.close()}),f=(e,t,n)=>{e.listen(t,e=>{try{n(e)}catch(e){setTimeout(()=>{throw e},0)}})};return f(c,Nr.EventType.OPEN,()=>{l||qr($h,`RPC '${i}' stream ${s} transport opened.`)}),f(c,Nr.EventType.CLOSE,()=>{l||(l=!0,qr($h,`RPC '${i}' stream ${s} transport closed`),d.fo())}),f(c,Nr.EventType.ERROR,e=>{l||(l=!0,Ur($h,`RPC '${i}' stream ${s} transport errored:`,e),d.fo(new $r(zr.UNAVAILABLE,"The operation could not be completed")))}),f(c,Nr.EventType.MESSAGE,n=>{if(!l){var e=n.data[0];Gr(!!e);var r=e.error||(null===(r=e[0])||void 0===r?void 0:r.error);if(r){qr($h,`RPC '${i}' stream ${s} received error:`,r);const n=r.status;let e=function(e){var t=Er[e];if(void 0!==t)return qo(t)}(n),t=r.message;void 0===e&&(e=zr.INTERNAL,t="Unknown error status: "+n+" with message "+r.message),l=!0,d.fo(new $r(e,t)),c.close()}else qr($h,`RPC '${i}' stream ${s} received:`,e),d._o(e)}}),f(a,xr.STAT_EVENT,e=>{e.stat===Dr?qr($h,`RPC '${i}' stream ${s} detected buffering proxy`):e.stat===Ar&&qr($h,`RPC '${i}' stream ${s} detected no buffering proxy`)}),setTimeout(()=>{d.lo()},0),d}}function Hh(){return"undefined"!=typeof window?window:null}function Wh(){return"undefined"!=typeof document?document:null}function Xh(e){return new au(e,!0)}class Yh{constructor(e,t,n=1e3,r=1.5,i=6e4){this.si=e,this.timerId=t,this.vo=n,this.Po=r,this.bo=i,this.Vo=0,this.So=null,this.Do=Date.now(),this.reset()}reset(){this.Vo=0}Co(){this.Vo=this.bo}xo(e){this.cancel();var t=Math.floor(this.Vo+this.No()),n=Math.max(0,Date.now()-this.Do),r=Math.max(0,t-n);0<r&&qr("ExponentialBackoff",`Backing off for ${r} ms (base delay: ${this.Vo} ms, delay with jitter: ${t} ms, last attempt: ${n} ms ago)`),this.So=this.si.enqueueAfterDelay(this.timerId,r,()=>(this.Do=Date.now(),e())),this.Vo*=this.Po,this.Vo<this.vo&&(this.Vo=this.vo),this.Vo>this.bo&&(this.Vo=this.bo)}ko(){null!==this.So&&(this.So.skipDelay(),this.So=null)}cancel(){null!==this.So&&(this.So.cancel(),this.So=null)}No(){return(Math.random()-.5)*this.Vo}}class Jh{constructor(e,t,n,r,i,s,a,o){this.si=e,this.Mo=n,this.Oo=r,this.connection=i,this.authCredentialsProvider=s,this.appCheckCredentialsProvider=a,this.listener=o,this.state=0,this.$o=0,this.Fo=null,this.Bo=null,this.stream=null,this.Lo=new Yh(e,t)}qo(){return 1===this.state||5===this.state||this.Uo()}Uo(){return 2===this.state||3===this.state}start(){4!==this.state?this.auth():this.Ko()}async stop(){this.qo()&&await this.close(0)}Go(){this.state=0,this.Lo.reset()}Qo(){this.Uo()&&null===this.Fo&&(this.Fo=this.si.enqueueAfterDelay(this.Mo,6e4,()=>this.jo()))}zo(e){this.Wo(),this.stream.send(e)}async jo(){if(this.Uo())return this.close(0)}Wo(){this.Fo&&(this.Fo.cancel(),this.Fo=null)}Ho(){this.Bo&&(this.Bo.cancel(),this.Bo=null)}async close(e,t){this.Wo(),this.Ho(),this.Lo.cancel(),this.$o++,4!==e?this.Lo.reset():t&&t.code===zr.RESOURCE_EXHAUSTED?(Br(t.toString()),Br("Using maximum backoff delay to prevent overloading the backend."),this.Lo.Co()):t&&t.code===zr.UNAUTHENTICATED&&3!==this.state&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),null!==this.stream&&(this.Jo(),this.stream.close(),this.stream=null),this.state=e,await this.listener.co(t)}Jo(){}auth(){this.state=1;const e=this.Yo(this.$o),n=this.$o;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([e,t])=>{this.$o===n&&this.Xo(e,t)},t=>{e(()=>{var e=new $r(zr.UNKNOWN,"Fetching auth token failed: "+t.message);return this.Zo(e)})})}Xo(e,t){const n=this.Yo(this.$o);this.stream=this.tu(e,t),this.stream.oo(()=>{n(()=>(this.state=2,this.Bo=this.si.enqueueAfterDelay(this.Oo,1e4,()=>(this.Uo()&&(this.state=3),Promise.resolve())),this.listener.oo()))}),this.stream.co(e=>{n(()=>this.Zo(e))}),this.stream.onMessage(e=>{n(()=>this.onMessage(e))})}Ko(){this.state=5,this.Lo.xo(async()=>{this.state=0,this.start()})}Zo(e){return qr("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}Yo(t){return e=>{this.si.enqueueAndForget(()=>this.$o===t?e():(qr("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class Zh extends Jh{constructor(e,t,n,r,i,s){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,n,r,s),this.serializer=i}tu(e,t){return this.connection.Ro("Listen",e,t)}onMessage(e){this.Lo.reset();var t=function(e,t){let n;if("targetChange"in t){t.targetChange;var r="NO_CHANGE"===(f=t.targetChange.targetChangeType||"NO_CHANGE")?0:"ADD"===f?1:"REMOVE"===f?2:"CURRENT"===f?3:"RESET"===f?4:Kr(),i=t.targetChange.targetIds||[],s=(f=t.targetChange.resumeToken,e.useProto3Json?(Gr(void 0===f||"string"==typeof f),xs.fromBase64String(f||"")):(Gr(void 0===f||f instanceof Uint8Array),xs.fromUint8Array(f||new Uint8Array))),a=t.targetChange.cause,o=a&&(o=void 0===(f=a).code?zr.UNKNOWN:qo(f.code),new $r(o,f.message||""));n=new Jo(r,i,s,o||null)}else if("documentChange"in t){t.documentChange;var u=t.documentChange;u.document,u.document.name,u.document.updateTime;var s=gu(e,u.document.name),o=hu(u.document.updateTime),c=u.document.createTime?hu(u.document.createTime):oi.min(),h=new ea({mapValue:{fields:u.document.fields}}),c=ta.newFoundDocument(s,o,c,h),h=u.targetIds||[],u=u.removedTargetIds||[];n=new Xo(h,u,c.key,c)}else if("documentDelete"in t){t.documentDelete;h=t.documentDelete;h.document;u=gu(e,h.document),c=h.readTime?hu(h.readTime):oi.min(),c=ta.newNoDocument(u,c),h=h.removedTargetIds||[];n=new Xo([],h,c.key,c)}else if("documentRemove"in t){t.documentRemove;var l=t.documentRemove;l.document;var d=gu(e,l.document),l=l.removedTargetIds||[];n=new Xo([],l,d,null)}else{if(!("filter"in t))return Kr();{t.filter;const e=t.filter;e.targetId;var{count:l=0,unchangedNames:d}=e,l=new Po(l,d),d=e.targetId;n=new Yo(d,l)}}var o,f;return n}(this.serializer,e),n=function(e){if(!("targetChange"in e))return oi.min();var t=e.targetChange;return(!t.targetIds||!t.targetIds.length)&&t.readTime?hu(t.readTime):oi.min()}(e);return this.listener.eu(t,n)}nu(e){const t={};t.database=yu(this.serializer),t.addTarget=function(e,t){let n;const r=t.target;if(n=Da(r)?{documents:Tu(e,r)}:{query:_u(e,r)},n.targetId=t.targetId,0<t.resumeToken.approximateByteSize()){n.resumeToken=cu(e,t.resumeToken);const r=ou(e,t.expectedCount);null!==r&&(n.expectedCount=r)}else if(0<t.snapshotVersion.compareTo(oi.min())){n.readTime=uu(e,t.snapshotVersion.toTimestamp());const r=ou(e,t.expectedCount);null!==r&&(n.expectedCount=r)}return n}(this.serializer,e);var n,r,r=(this.serializer,n=e,null==(r=function(){switch(n.purpose){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return Kr()}}())?null:{"goog-listen-tags":r});r&&(t.labels=r),this.zo(t)}su(e){const t={};t.database=yu(this.serializer),t.removeTarget=e,this.zo(t)}}class el extends Jh{constructor(e,t,n,r,i,s){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,n,r,s),this.serializer=i,this.iu=!1}get ru(){return this.iu}start(){this.iu=!1,this.lastStreamToken=void 0,super.start()}Jo(){this.iu&&this.ou([])}tu(e,t){return this.connection.Ro("Write",e,t)}onMessage(e){if(Gr(!!e.streamToken),this.lastStreamToken=e.streamToken,this.iu){this.Lo.reset();var t=(r=e.writeResults,i=e.commitTime,r&&0<r.length?(Gr(void 0!==i),r.map(e=>function(e,t){let n=e.updateTime?hu(e.updateTime):hu(t);return n.isEqual(oi.min())&&(n=hu(t)),new wo(n,e.transformResults||[])}(e,i))):[]),n=hu(e.commitTime);return this.listener.uu(n,t)}var r,i;return Gr(!e.writeResults||0===e.writeResults.length),this.iu=!0,this.listener.cu()}au(){const e={};e.database=yu(this.serializer),this.zo(e)}ou(e){var t={streamToken:this.lastStreamToken,writes:e.map(e=>Iu(this.serializer,e))};this.zo(t)}}class tl extends class{}{constructor(e,t,n,r){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=n,this.serializer=r,this.hu=!1}lu(){if(this.hu)throw new $r(zr.FAILED_PRECONDITION,"The client has already been terminated.")}po(n,r,i){return this.lu(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([e,t])=>this.connection.po(n,r,i,e,t)).catch(e=>{throw"FirebaseError"===e.name?(e.code===zr.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new $r(zr.UNKNOWN,e.toString())})}Ao(n,r,i,s){return this.lu(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([e,t])=>this.connection.Ao(n,r,i,e,t,s)).catch(e=>{throw"FirebaseError"===e.name?(e.code===zr.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new $r(zr.UNKNOWN,e.toString())})}terminate(){this.hu=!0}}class nl{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.du=0,this._u=null,this.wu=!0}mu(){0===this.du&&(this.gu("Unknown"),this._u=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this._u=null,this.yu("Backend didn't respond within 10 seconds."),this.gu("Offline"),Promise.resolve())))}pu(e){"Online"===this.state?this.gu("Unknown"):(this.du++,1<=this.du&&(this.Iu(),this.yu(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.gu("Offline")))}set(e){this.Iu(),this.du=0,"Online"===e&&(this.wu=!1),this.gu(e)}gu(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}yu(e){var t=`Could not reach Cloud Firestore backend. ${e}\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.wu?(Br(t),this.wu=!1):qr("OnlineStateTracker",t)}Iu(){null!==this._u&&(this._u.cancel(),this._u=null)}}class rl{constructor(e,t,n,r,i){this.localStore=e,this.datastore=t,this.asyncQueue=n,this.remoteSyncer={},this.Tu=[],this.Eu=new Map,this.Au=new Set,this.Ru=[],this.vu=i,this.vu.Jr(e=>{n.enqueueAndForget(async()=>{dl(this)&&(qr("RemoteStore","Restarting streams for network reachability change."),await async function(e){const t=e;t.Au.add(4),await sl(t),t.Pu.set("Unknown"),t.Au.delete(4),await il(t)}(this))})}),this.Pu=new nl(n,r)}}async function il(e){if(dl(e))for(const t of e.Ru)await t(!0)}async function sl(e){for(const t of e.Ru)await t(!1)}function al(e,t){const n=e;n.Eu.has(t.targetId)||(n.Eu.set(t.targetId,t),ll(n)?hl(n):Il(n).Uo()&&ul(n,t))}function ol(e,t){const n=e,r=Il(n);n.Eu.delete(t),r.Uo()&&cl(n,t),0===n.Eu.size&&(r.Uo()?r.Qo():dl(n)&&n.Pu.set("Unknown"))}function ul(e,t){var n;e.bu.Lt(t.targetId),(0<t.resumeToken.approximateByteSize()||0<t.snapshotVersion.compareTo(oi.min()))&&(n=e.remoteSyncer.getRemoteKeysForTarget(t.targetId).size,t=t.withExpectedCount(n)),Il(e).nu(t)}function cl(e,t){e.bu.Lt(t),Il(e).su(t)}function hl(t){t.bu=new eu({getRemoteKeysForTarget:e=>t.remoteSyncer.getRemoteKeysForTarget(e),he:e=>t.Eu.get(e)||null,oe:()=>t.datastore.serializer.databaseId}),Il(t).start(),t.Pu.mu()}function ll(e){return dl(e)&&!Il(e).qo()&&0<e.Eu.size}function dl(e){return 0===e.Au.size}function fl(e){e.bu=void 0}async function gl(e,t,n){if(!Ni(t))throw t;e.Au.add(1),await sl(e),e.Pu.set("Offline"),n=n||(()=>Ih(e.localStore)),e.asyncQueue.enqueueRetryable(async()=>{qr("RemoteStore","Retrying IndexedDB access"),await n(),e.Au.delete(1),await il(e)})}function ml(t,n){return n().catch(e=>gl(t,e,n))}async function pl(e){const t=e,n=El(t);let r=0<t.Tu.length?t.Tu[t.Tu.length-1].batchId:-1;for(;dl(i=t)&&i.Tu.length<10;)try{const e=await function(e,t){const n=e;return n.persistence.runTransaction("Get next mutation batch","readonly",e=>(void 0===t&&(t=-1),n.mutationQueue.getNextMutationBatchAfterBatchId(e,t)))}(t.localStore,r);if(null===e){0===t.Tu.length&&n.Qo();break}r=e.batchId,function(e,t){e.Tu.push(t);const n=El(e);n.Uo()&&n.ru&&n.ou(t.mutations)}(t,e)}catch(e){await gl(t,e)}var i;yl(t)&&vl(t)}function yl(e){return dl(e)&&!El(e).qo()&&0<e.Tu.length}function vl(e){El(e).start()}async function wl(e,t){const n=e;n.asyncQueue.verifyOperationInProgress(),qr("RemoteStore","RemoteStore received new credentials");var r=dl(n);n.Au.add(3),await sl(n),r&&n.Pu.set("Unknown"),await n.remoteSyncer.handleCredentialChange(t),n.Au.delete(3),await il(n)}async function bl(e,t){const n=e;t?(n.Au.delete(2),await il(n)):(n.Au.add(2),await sl(n),n.Pu.set("Unknown"))}function Il(t){return t.Vu||(t.Vu=function(e,t,n){const r=e;return r.lu(),new Zh(t,r.connection,r.authCredentials,r.appCheckCredentials,r.serializer,n)}(t.datastore,t.asyncQueue,{oo:(async function(n){n.Eu.forEach((e,t)=>{ul(n,e)})}).bind(null,t),co:(async function(e,t){fl(e),ll(e)?(e.Pu.pu(t),hl(e)):e.Pu.set("Unknown")}).bind(null,t),eu:(async function(e,r,t){if(e.Pu.set("Online"),r instanceof Jo&&2===r.state&&r.cause)try{await async function(e){var t=r.cause;for(const n of r.targetIds)e.Eu.has(n)&&(await e.remoteSyncer.rejectListen(n,t),e.Eu.delete(n),e.bu.removeTarget(n))}(e)}catch(t){qr("RemoteStore","Failed to remove targets %s: %s ",r.targetIds.join(","),t),await gl(e,t)}else if(r instanceof Xo?e.bu.Wt(r):r instanceof Yo?e.bu.ee(r):e.bu.Yt(r),!t.isEqual(oi.min()))try{const r=await Ih(e.localStore);0<=t.compareTo(r)&&await function(i,r){const e=i.bu.ue(r);return e.targetChanges.forEach((e,t)=>{if(0<e.resumeToken.approximateByteSize()){const n=i.Eu.get(t);n&&i.Eu.set(t,n.withResumeToken(e.resumeToken,r))}}),e.targetMismatches.forEach((e,t)=>{const n=i.Eu.get(e);var r;n&&(i.Eu.set(e,n.withResumeToken(xs.EMPTY_BYTE_STRING,n.snapshotVersion)),cl(i,e),r=new ku(n.target,e,t,n.sequenceNumber),ul(i,r))}),i.remoteSyncer.applyRemoteEvent(e)}(e,t)}catch(r){qr("RemoteStore","Failed to raise snapshot:",r),await gl(e,r)}}).bind(null,t)}),t.Ru.push(async e=>{e?(t.Vu.Go(),ll(t)?hl(t):t.Pu.set("Unknown")):(await t.Vu.stop(),fl(t))})),t.Vu}function El(t){return t.Su||(t.Su=function(e,t,n){const r=e;return r.lu(),new el(t,r.connection,r.authCredentials,r.appCheckCredentials,r.serializer,n)}(t.datastore,t.asyncQueue,{oo:(async function(e){El(e).au()}).bind(null,t),co:(async function(e,t){t&&El(e).ru&&await async function(e,t){if(Vo(n=t.code)&&n!==zr.ABORTED){const n=e.Tu.shift();El(e).Go(),await ml(e,()=>e.remoteSyncer.rejectFailedWrite(n.batchId,t)),await pl(e)}var n}(e,t),yl(e)&&vl(e)}).bind(null,t),cu:(async function(e){const t=El(e);for(const n of e.Tu)t.ou(n.mutations)}).bind(null,t),uu:(async function(e,t,n){const r=e.Tu.shift(),i=Lo.from(r,t,n);await ml(e,()=>e.remoteSyncer.applySuccessfulWrite(i)),await pl(e)}).bind(null,t)}),t.Ru.push(async e=>{e?(t.Su.Go(),await pl(t)):(await t.Su.stop(),0<t.Tu.length&&(qr("RemoteStore",`Stopping write stream with ${t.Tu.length} pending writes`),t.Tu=[]))})),t.Su}class Tl{constructor(e,t,n,r,i){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=n,this.op=r,this.removalCallback=i,this.deferred=new Qr,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(e=>{})}static createAndSchedule(e,t,n,r,i){const s=Date.now()+n,a=new Tl(e,t,s,r,i);return a.start(n),a}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new $r(zr.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function _l(e,t){if(Br("AsyncQueue",`${t}: ${e}`),Ni(e))return new $r(zr.UNAVAILABLE,`${t}: ${e}`);throw e}class Sl{constructor(n){this.comparator=n?(e,t)=>n(e,t)||di.comparator(e.key,t.key):(e,t)=>di.comparator(e.key,t.key),this.keyedMap=Ya(),this.sortedSet=new vs(this.comparator)}static emptySet(e){return new Sl(e.comparator)}has(e){return null!=this.keyedMap.get(e)}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){var t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(n){this.sortedSet.inorderTraversal((e,t)=>(n(e),!1))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){var t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof Sl))return!1;if(this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),n=e.sortedSet.getIterator();for(;t.hasNext();){const e=t.getNext().key,r=n.getNext().key;if(!e.isEqual(r))return!1}return!0}toString(){const t=[];return this.forEach(e=>{t.push(e.toString())}),0===t.length?"DocumentSet ()":"DocumentSet (\n  "+t.join("  \n")+"\n)"}copy(e,t){const n=new Sl;return n.comparator=this.comparator,n.keyedMap=e,n.sortedSet=t,n}}class xl{constructor(){this.Du=new vs(di.comparator)}track(e){var t=e.doc.key,n=this.Du.get(t);!n||0!==e.type&&3===n.type?this.Du=this.Du.insert(t,e):3===e.type&&1!==n.type?this.Du=this.Du.insert(t,{type:n.type,doc:e.doc}):2===e.type&&2===n.type?this.Du=this.Du.insert(t,{type:2,doc:e.doc}):2===e.type&&0===n.type?this.Du=this.Du.insert(t,{type:0,doc:e.doc}):1===e.type&&0===n.type?this.Du=this.Du.remove(t):1===e.type&&2===n.type?this.Du=this.Du.insert(t,{type:1,doc:n.doc}):0===e.type&&1===n.type?this.Du=this.Du.insert(t,{type:2,doc:e.doc}):Kr()}Cu(){const n=[];return this.Du.inorderTraversal((e,t)=>{n.push(t)}),n}}class Dl{constructor(e,t,n,r,i,s,a,o,u){this.query=e,this.docs=t,this.oldDocs=n,this.docChanges=r,this.mutatedKeys=i,this.fromCache=s,this.syncStateChanged=a,this.excludesMetadataChanges=o,this.hasCachedResults=u}static fromInitialDocuments(e,t,n,r,i){const s=[];return t.forEach(e=>{s.push({type:0,doc:e})}),new Dl(e,t,Sl.emptySet(t),s,n,r,!0,!1,i)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&ja(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,n=e.docChanges;if(t.length!==n.length)return!1;for(let r=0;r<t.length;r++)if(t[r].type!==n[r].type||!t[r].doc.isEqual(n[r].doc))return!1;return!0}}class Al{constructor(){this.xu=void 0,this.listeners=[]}}class Cl{constructor(){this.queries=new Ha(e=>Ka(e),ja),this.onlineState="Unknown",this.Nu=new Set}}async function Nl(e,t){const n=e,r=t.query;let i=!1,s=n.queries.get(r);if(s||(i=!0,s=new Al),i)try{s.xu=await n.onListen(r)}catch(e){const n=_l(e,`Initialization of query '${Ga(t.query)}' failed`);return void t.onError(n)}n.queries.set(r,s),s.listeners.push(t),t.ku(n.onlineState),!s.xu||t.Mu(s.xu)&&Rl(n)}async function kl(e,t){const n=e,r=t.query;let i=!1;const s=n.queries.get(r);if(s){const e=s.listeners.indexOf(t);0<=e&&(s.listeners.splice(e,1),i=0===s.listeners.length)}if(i)return n.queries.delete(r),n.onUnlisten(r)}function Rl(e){e.Nu.forEach(e=>{e.next()})}class Ml{constructor(e,t,n){this.query=e,this.Ou=t,this.$u=!1,this.Fu=null,this.onlineState="Unknown",this.options=n||{}}Mu(e){if(!this.options.includeMetadataChanges){const t=[];for(const n of e.docChanges)3!==n.type&&t.push(n);e=new Dl(e.query,e.docs,e.oldDocs,t,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.$u?this.Bu(e)&&(this.Ou.next(e),t=!0):this.Lu(e,this.onlineState)&&(this.qu(e),t=!0),this.Fu=e,t}onError(e){this.Ou.error(e)}ku(e){this.onlineState=e;let t=!1;return this.Fu&&!this.$u&&this.Lu(this.Fu,e)&&(this.qu(this.Fu),t=!0),t}Lu(e,t){return!e.fromCache||(!this.options.Uu||!("Offline"!==t))&&(!e.docs.isEmpty()||e.hasCachedResults||"Offline"===t)}Bu(e){if(0<e.docChanges.length)return!0;var t=this.Fu&&this.Fu.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&!0===this.options.includeMetadataChanges}qu(e){e=Dl.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.$u=!0,this.Ou.next(e)}}class Fl{constructor(e,t){this.Ku=e,this.byteLength=t}Gu(){return"metadata"in this.Ku}}class Ll{constructor(e){this.serializer=e}ir(e){return gu(this.serializer,e)}rr(e){return e.metadata.exists?bu(this.serializer,e.document,!1):ta.newNoDocument(this.ir(e.metadata.name),this.ur(e.metadata.readTime))}ur(e){return hu(e)}}class Ol{constructor(e,t,n){this.Qu=e,this.localStore=t,this.serializer=n,this.queries=[],this.documents=[],this.collectionGroups=new Set,this.progress=Pl(e)}ju(e){this.progress.bytesLoaded+=e.byteLength;let t=this.progress.documentsLoaded;if(e.Ku.namedQuery)this.queries.push(e.Ku.namedQuery);else if(e.Ku.documentMetadata){this.documents.push({metadata:e.Ku.documentMetadata}),e.Ku.documentMetadata.exists||++t;const n=ci.fromString(e.Ku.documentMetadata.name);this.collectionGroups.add(n.get(n.length-2))}else e.Ku.document&&(this.documents[this.documents.length-1].document=e.Ku.document,++t);return t!==this.progress.documentsLoaded?(this.progress.documentsLoaded=t,Object.assign({},this.progress)):null}zu(e){const t=new Map,n=new Ll(this.serializer);for(const i of e)if(i.metadata.queries){const e=n.ir(i.metadata.name);for(const n of i.metadata.queries){var r=(t.get(n)||no()).add(e);t.set(n,r)}}return t}async complete(){const e=await async function(e,t,n,r){const i=e;let s=no(),a=Wa;for(const e of n){const n=t.ir(e.metadata.name);e.document&&(s=s.add(n));const c=t.rr(e);c.setReadTime(t.ur(e.metadata.readTime)),a=a.insert(n,c)}const o=i.Xi.newChangeBuffer({trackRemovals:!0}),u=await _h(i,(r=r,qa(Ma(ci.fromString(`__bundle__/docs/${r}`)))));return i.persistence.runTransaction("Apply bundle documents","readwrite",t=>Th(t,o,a).next(e=>(o.apply(t),e)).next(e=>i.Fs.removeMatchingKeysForTargetId(t,u.targetId).next(()=>i.Fs.addMatchingKeys(t,s,u.targetId)).next(()=>i.localDocuments.getLocalViewOfDocuments(t,e.er,e.nr)).next(()=>e.er)))}(this.localStore,new Ll(this.serializer),this.documents,this.Qu.id),t=this.zu(this.documents);for(const e of this.queries)await async function(e,n,r=no()){const i=await _h(e,qa(Bu(n.bundledQuery))),s=e;return s.persistence.runTransaction("Save named query","readwrite",e=>{var t=hu(n.readTime);if(0<=i.snapshotVersion.compareTo(t))return s.Ls.saveNamedQuery(e,n);t=i.withResumeToken(xs.EMPTY_BYTE_STRING,t);return s.Hi=s.Hi.insert(t.targetId,t),s.Fs.updateTargetData(e,t).next(()=>s.Fs.removeMatchingKeysForTargetId(e,i.targetId)).next(()=>s.Fs.addMatchingKeys(e,r,i.targetId)).next(()=>s.Ls.saveNamedQuery(e,n))})}(this.localStore,e,t.get(e.name));return this.progress.taskState="Success",{progress:this.progress,Wu:this.collectionGroups,Hu:e}}}function Pl(e){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:e.totalDocuments,totalBytes:e.totalBytes}}class Vl{constructor(e){this.key=e}}class ql{constructor(e){this.key=e}}class Bl{constructor(e,t){this.query=e,this.Ju=t,this.Yu=null,this.hasCachedResults=!1,this.current=!1,this.Xu=no(),this.mutatedKeys=no(),this.Zu=Qa(e),this.tc=new Sl(this.Zu)}get ec(){return this.Ju}nc(e,t){const o=t?t.sc:new xl,u=(t||this).tc;let c=(t||this).mutatedKeys,h=u,l=!1;const d="F"===this.query.limitType&&u.size===this.query.limit?u.last():null,f="L"===this.query.limitType&&u.size===this.query.limit?u.first():null;if(e.inorderTraversal((e,t)=>{const n=u.get(e),r=za(this.query,t)?t:null,i=!!n&&this.mutatedKeys.has(n.key),s=!!r&&(r.hasLocalMutations||this.mutatedKeys.has(r.key)&&r.hasCommittedMutations);let a=!1;n&&r?n.data.isEqual(r.data)?i!==s&&(o.track({type:3,doc:r}),a=!0):this.ic(n,r)||(o.track({type:2,doc:r}),a=!0,(d&&0<this.Zu(r,d)||f&&this.Zu(r,f)<0)&&(l=!0)):!n&&r?(o.track({type:0,doc:r}),a=!0):n&&!r&&(o.track({type:1,doc:n}),a=!0,(d||f)&&(l=!0)),a&&(c=r?(h=h.add(r),s?c.add(e):c.delete(e)):(h=h.delete(e),c.delete(e)))}),null!==this.query.limit)for(;h.size>this.query.limit;){const e="F"===this.query.limitType?h.last():h.first();h=h.delete(e.key),c=c.delete(e.key),o.track({type:1,doc:e})}return{tc:h,sc:o,ji:l,mutatedKeys:c}}ic(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,n){var r=this.tc;this.tc=e.tc,this.mutatedKeys=e.mutatedKeys;const i=e.sc.Cu();i.sort((e,t)=>function(e,t){var n=e=>{switch(e){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return Kr()}};return n(e)-n(t)}(e.type,t.type)||this.Zu(e.doc,t.doc)),this.rc(n);var s=t?this.oc():[],a=0===this.Xu.size&&this.current?1:0,o=a!==this.Yu;return this.Yu=a,0!==i.length||o?{snapshot:new Dl(this.query,e.tc,r,i,e.mutatedKeys,0==a,o,!1,!!n&&0<n.resumeToken.approximateByteSize()),uc:s}:{uc:s}}ku(e){return this.current&&"Offline"===e?(this.current=!1,this.applyChanges({tc:this.tc,sc:new xl,mutatedKeys:this.mutatedKeys,ji:!1},!1)):{uc:[]}}cc(e){return!this.Ju.has(e)&&!!this.tc.has(e)&&!this.tc.get(e).hasLocalMutations}rc(e){e&&(e.addedDocuments.forEach(e=>this.Ju=this.Ju.add(e)),e.modifiedDocuments.forEach(e=>{}),e.removedDocuments.forEach(e=>this.Ju=this.Ju.delete(e)),this.current=e.current)}oc(){if(!this.current)return[];const t=this.Xu;this.Xu=no(),this.tc.forEach(e=>{this.cc(e.key)&&(this.Xu=this.Xu.add(e.key))});const n=[];return t.forEach(e=>{this.Xu.has(e)||n.push(new ql(e))}),this.Xu.forEach(e=>{t.has(e)||n.push(new Vl(e))}),n}ac(e){this.Ju=e.sr,this.Xu=no();var t=this.nc(e.documents);return this.applyChanges(t,!0)}hc(){return Dl.fromInitialDocuments(this.query,this.tc,this.mutatedKeys,0===this.Yu,this.hasCachedResults)}}class Ul{constructor(e,t,n){this.query=e,this.targetId=t,this.view=n}}class jl{constructor(e){this.key=e,this.lc=!1}}class Kl{constructor(e,t,n,r,i,s){this.localStore=e,this.remoteStore=t,this.eventManager=n,this.sharedClientState=r,this.currentUser=i,this.maxConcurrentLimboResolutions=s,this.fc={},this.dc=new Ha(e=>Ka(e),ja),this._c=new Map,this.wc=new Set,this.mc=new vs(di.comparator),this.gc=new Map,this.yc=new eh,this.Ic={},this.Tc=new Map,this.Ec=Nc.kn(),this.onlineState="Unknown",this.Ac=void 0}get isPrimaryClient(){return!0===this.Ac}}async function Gl(n,e,t,r,i){n.Rc=(e,s,t)=>async function(e,t,n){let r=t.view.nc(s);r.ji&&(r=await xh(e.localStore,t.query,!1).then(({documents:e})=>t.view.nc(e,r)));var i=n&&n.targetChanges.get(t.targetId),i=t.view.applyChanges(r,e.isPrimaryClient,i);return Zl(e,t.targetId,i.uc),i.snapshot}(n,e,t);const s=await xh(n.localStore,e,!0),a=new Bl(e,s.sr),o=a.nc(s.documents),u=Wo.createSynthesizedTargetChangeForCurrentChange(t,r&&"Offline"!==n.onlineState,i),c=a.applyChanges(o,n.isPrimaryClient,u);Zl(n,t,c.uc);var h=new Ul(e,t,a);return n.dc.set(e,h),n._c.has(t)?n._c.get(t).push(e):n._c.set(t,[e]),c.snapshot}async function zl(e,t,n){const r=ad(e);try{const e=await function(e,i){const s=e,a=ai.now(),o=i.reduce((e,t)=>e.add(t.key),no());let u,c;return s.persistence.runTransaction("Locally write mutations","readwrite",n=>{let t=Wa,r=no();return s.Xi.getEntries(n,o).next(e=>{t=e,t.forEach((e,t)=>{t.isValidDocument()||(r=r.add(e))})}).next(()=>s.localDocuments.getOverlayedDocuments(n,t)).next(e=>{u=e;const t=[];for(const n of i){const i=function(e,t){let n=null;for(const r of e.fieldTransforms){const e=t.data.field(r.field),i=uo(r.transform,e||null);null!=i&&(null===n&&(n=ea.empty()),n.set(r.field,i))}return n||null}(n,u.get(n.key).overlayedDocument);null!=i&&t.push(new Ao(n.key,i,function r(e){const i=[];return ps(e.fields,(e,t)=>{const n=new li([e]);if(Ws(t)){const e=r(t.mapValue).fields;if(0===e.length)i.push(n);else for(const t of e)i.push(n.child(t))}else i.push(n)}),new _s(i)}(i.value.mapValue),bo.exists(!0)))}return s.mutationQueue.addMutationBatch(n,a,t,i)}).next(e=>{var t=(c=e).applyToLocalDocumentSet(u,r);return s.documentOverlayCache.saveOverlays(n,e.batchId,t)})}).then(()=>({batchId:c.batchId,changes:Ja(u)}))}(r.localStore,t);r.sharedClientState.addPendingMutation(e.batchId),function(e,t,n){let r=e.Ic[e.currentUser.toKey()];r=r||new vs(ri),r=r.insert(t,n),e.Ic[e.currentUser.toKey()]=r}(r,e.batchId,n),await td(r,e.changes),await pl(r.remoteStore)}catch(e){const t=_l(e,"Failed to persist write");n.reject(t)}}async function $l(e,t){const r=e;try{const e=await Eh(r.localStore,t);t.targetChanges.forEach((e,t)=>{const n=r.gc.get(t);n&&(Gr(e.addedDocuments.size+e.modifiedDocuments.size+e.removedDocuments.size<=1),0<e.addedDocuments.size?n.lc=!0:0<e.modifiedDocuments.size?Gr(n.lc):0<e.removedDocuments.size&&(Gr(n.lc),n.lc=!1))}),await td(r,e,t)}catch(e){await _i(e)}}function Ql(r,i,e){const t=r;if(t.isPrimaryClient&&0===e||!t.isPrimaryClient&&1===e){const r=[];t.dc.forEach((e,t)=>{var n=t.view.ku(i);n.snapshot&&r.push(n.snapshot)}),function(e,n){const t=e;t.onlineState=n;let r=!1;t.queries.forEach((e,t)=>{for(const e of t.listeners)e.ku(n)&&(r=!0)}),r&&Rl(t)}(t.eventManager,i),r.length&&t.fc.eu(r),t.onlineState=i,t.isPrimaryClient&&t.sharedClientState.setOnlineState(i)}}async function Hl(e,t){const n=e,r=t.batch.batchId;try{const e=await function(e,r){const i=e;return i.persistence.runTransaction("Acknowledge batch","readwrite-primary",e=>{const t=r.batch.keys(),n=i.Xi.newChangeBuffer({trackRemovals:!0});return function(e,t,r,i){const s=r.batch,n=s.keys();let a=Si.resolve();return n.forEach(n=>{a=a.next(()=>i.getEntry(t,n)).next(e=>{var t=r.docVersions.get(n);Gr(null!==t),e.version.compareTo(t)<0&&(s.applyToRemoteDocument(e,r),e.isValidDocument()&&(e.setReadTime(r.commitVersion),i.addEntry(e)))})}),a.next(()=>e.mutationQueue.removeMutationBatch(t,s))}(i,e,r,n).next(()=>n.apply(e)).next(()=>i.mutationQueue.performConsistencyCheck(e)).next(()=>i.documentOverlayCache.removeOverlaysForBatchId(e,t,r.batch.batchId)).next(()=>i.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,function(e){let t=no();for(let n=0;n<e.mutationResults.length;++n)0<e.mutationResults[n].transformResults.length&&(t=t.add(e.batch.mutations[n].key));return t}(r))).next(()=>i.localDocuments.getDocuments(e,t))})}(n.localStore,t);Xl(n,r,null),Wl(n,r),n.sharedClientState.updateMutationState(r,"acknowledged"),await td(n,e)}catch(e){await _i(e)}}function Wl(e,t){(e.Tc.get(t)||[]).forEach(e=>{e.resolve()}),e.Tc.delete(t)}function Xl(e,t,n){const r=e;let i=r.Ic[r.currentUser.toKey()];if(i){const e=i.get(t);e&&(n?e.reject(n):e.resolve(),i=i.remove(t)),r.Ic[r.currentUser.toKey()]=i}}function Yl(t,e,n=null){t.sharedClientState.removeLocalQueryTarget(e);for(const r of t._c.get(e))t.dc.delete(r),n&&t.fc.vc(r,n);t._c.delete(e),t.isPrimaryClient&&t.yc.ps(e).forEach(e=>{t.yc.containsKey(e)||Jl(t,e)})}function Jl(e,t){e.wc.delete(t.path.canonicalString());var n=e.mc.get(t);null!==n&&(ol(e.remoteStore,n),e.mc=e.mc.remove(t),e.gc.delete(n),ed(e))}function Zl(e,t,n){for(const r of n)r instanceof Vl?(e.yc.addReference(r.key,t),function(e,t){const n=t.key,r=n.path.canonicalString();e.mc.get(n)||e.wc.has(r)||(qr("SyncEngine","New document in limbo: "+n),e.wc.add(r),ed(e))}(e,r)):r instanceof ql?(qr("SyncEngine","Document no longer in limbo: "+r.key),e.yc.removeReference(r.key,t),e.yc.containsKey(r.key)||Jl(e,r.key)):Kr()}function ed(e){for(;0<e.wc.size&&e.mc.size<e.maxConcurrentLimboResolutions;){var t=e.wc.values().next().value;e.wc.delete(t);var n=new di(ci.fromString(t)),t=e.Ec.next();e.gc.set(t,new jl(n)),e.mc=e.mc.insert(n,t),al(e.remoteStore,new ku(qa(Ma(n.path)),t,"TargetPurposeLimboResolution",Pi.ct))}}async function td(e,t,r){const i=e,s=[],a=[],o=[];i.dc.isEmpty()||(i.dc.forEach((e,n)=>{o.push(i.Rc(n,t,r).then(e=>{var t;(e||r)&&i.isPrimaryClient&&i.sharedClientState.updateQueryState(n.targetId,null!=e&&e.fromCache?"not-current":"current"),e&&(s.push(e),t=ph.Bi(n.targetId,e),a.push(t))}))}),await Promise.all(o),i.fc.eu(s),await async function(e,t){const r=e;try{await r.persistence.runTransaction("notifyLocalViewChanges","readwrite",n=>Si.forEach(t,t=>Si.forEach(t.$i,e=>r.persistence.referenceDelegate.addReference(n,t.targetId,e)).next(()=>Si.forEach(t.Fi,e=>r.persistence.referenceDelegate.removeReference(n,t.targetId,e)))))}catch(e){if(!Ni(e))throw e;qr("LocalStore","Failed to update sequence numbers: "+e)}for(const e of t){const t=e.targetId;if(!e.fromCache){const e=r.Hi.get(t),n=e.snapshotVersion,i=e.withLastLimboFreeSnapshotVersion(n);r.Hi=r.Hi.insert(t,i)}}}(i.localStore,a))}async function nd(r,e){const i=r;if(sd(i),ad(i),!0===e&&!0!==i.Ac){const r=i.sharedClientState.getAllActiveQueryTargets(),e=await rd(i,r.toArray());i.Ac=!0,await bl(i.remoteStore,!0);for(const r of e)al(i.remoteStore,r)}else if(!1===e&&!1!==i.Ac){const r=[];let n=Promise.resolve();i._c.forEach((e,t)=>{i.sharedClientState.isLocalQueryTarget(t)?r.push(t):n=n.then(()=>(Yl(i,t),Sh(i.localStore,t,!0))),ol(i.remoteStore,t)}),await n,await rd(i,r),function(){const n=i;n.gc.forEach((e,t)=>{ol(n.remoteStore,t)}),n.yc.Is(),n.gc=new Map,n.mc=new vs(di.comparator)}(),i.Ac=!1,await bl(i.remoteStore,!1)}}async function rd(t,n){const r=t,i=[],s=[];for(const t of n){let e;const h=r._c.get(t);if(h&&0!==h.length){e=await _h(r.localStore,qa(h[0]));for(const t of h){const n=r.dc.get(t),h=(a=r,o=n,c=u=void 0,c=await xh((u=a).localStore,o.query,!0),c=o.view.ac(c),u.isPrimaryClient&&Zl(u,o.targetId,c.uc),await c);h.snapshot&&s.push(h.snapshot)}}else{const h=await Dh(r.localStore,t);e=await _h(r.localStore,h),await Gl(r,id(h),t,!1,e.resumeToken)}i.push(e)}var a,o,u,c;return r.fc.eu(s),i}function id(e){return Ra(e.path,e.collectionGroup,e.orderBy,e.filters,e.limit,"F",e.startAt,e.endAt)}function sd(e){const t=e;return t.remoteStore.remoteSyncer.applyRemoteEvent=$l.bind(null,t),t.remoteStore.remoteSyncer.getRemoteKeysForTarget=(function(e,t){const n=e,r=n.gc.get(t);if(r&&r.lc)return no().add(r.key);{let e=no();const r=n._c.get(t);if(!r)return e;for(const t of r){const r=n.dc.get(t);e=e.unionWith(r.view.ec)}return e}}).bind(null,t),t.remoteStore.remoteSyncer.rejectListen=(async function(e,t,n){const r=e;r.sharedClientState.updateQueryState(t,"rejected",n);const i=r.gc.get(t),s=i&&i.key;if(s){let e=new vs(di.comparator);e=e.insert(s,ta.newNoDocument(s,oi.min()));const n=no().add(s),i=new Ho(oi.min(),new Map,new vs(ri),e,n);await $l(r,i),r.mc=r.mc.remove(s),r.gc.delete(t),ed(r)}else await Sh(r.localStore,t,!1).then(()=>Yl(r,t,n)).catch(_i)}).bind(null,t),t.fc.eu=(function(e,t){const n=e;let r=!1;for(const e of t){const t=e.query,i=n.queries.get(t);if(i){for(const t of i.listeners)t.Mu(e)&&(r=!0);i.xu=e}}r&&Rl(n)}).bind(null,t.eventManager),t.fc.vc=(function(e,t,n){const r=e,i=r.queries.get(t);if(i)for(const e of i.listeners)e.onError(n);r.queries.delete(t)}).bind(null,t.eventManager),t}function ad(e){const t=e;return t.remoteStore.remoteSyncer.applySuccessfulWrite=Hl.bind(null,t),t.remoteStore.remoteSyncer.rejectFailedWrite=(async function(e,t,n){const r=e;try{const e=await function(e,r){const i=e;return i.persistence.runTransaction("Reject batch","readwrite-primary",t=>{let n;return i.mutationQueue.lookupMutationBatch(t,r).next(e=>(Gr(null!==e),n=e.keys(),i.mutationQueue.removeMutationBatch(t,e))).next(()=>i.mutationQueue.performConsistencyCheck(t)).next(()=>i.documentOverlayCache.removeOverlaysForBatchId(t,n,r)).next(()=>i.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(t,n)).next(()=>i.localDocuments.getDocuments(t,n))})}(r.localStore,t);Xl(r,t,n),Wl(r,t),r.sharedClientState.updateMutationState(t,"rejected",n),await td(r,e)}catch(n){await _i(n)}}).bind(null,t),t}class od{constructor(){this.synchronizeTabs=!1}async initialize(e){this.serializer=Xh(e.databaseInfo.databaseId),this.sharedClientState=this.createSharedClientState(e),this.persistence=this.createPersistence(e),await this.persistence.start(),this.localStore=this.createLocalStore(e),this.gcScheduler=this.createGarbageCollectionScheduler(e,this.localStore),this.indexBackfillerScheduler=this.createIndexBackfillerScheduler(e,this.localStore)}createGarbageCollectionScheduler(e,t){return null}createIndexBackfillerScheduler(e,t){return null}createLocalStore(e){return wh(this.persistence,new yh,e.initialUser,this.serializer)}createPersistence(e){return new ah(uh.js,this.serializer)}createSharedClientState(e){return new qh}async terminate(){this.gcScheduler&&this.gcScheduler.stop(),await this.sharedClientState.shutdown(),await this.persistence.shutdown()}}class ud extends od{constructor(e,t,n){super(),this.bc=e,this.cacheSizeBytes=t,this.forceOwnership=n,this.synchronizeTabs=!1}async initialize(e){await super.initialize(e),await this.bc.initialize(this,e),await ad(this.bc.syncEngine),await pl(this.bc.remoteStore),await this.persistence.pi(()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve()))}createLocalStore(e){return wh(this.persistence,new yh,e.initialUser,this.serializer)}createGarbageCollectionScheduler(e,t){var n=this.persistence.referenceDelegate.garbageCollector;return new Pc(n,e.asyncQueue,t)}createIndexBackfillerScheduler(e,t){var n=new Oi(t,this.persistence);return new Li(e.asyncQueue,n)}createPersistence(e){var t=mh(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),n=void 0!==this.cacheSizeBytes?Ec.withCacheSize(this.cacheSizeBytes):Ec.DEFAULT;return new dh(this.synchronizeTabs,t,e.clientId,n,e.asyncQueue,Hh(),Wh(),this.serializer,this.sharedClientState,!!this.forceOwnership)}createSharedClientState(e){return new qh}}class cd extends ud{constructor(e,t){super(e,t,!1),this.bc=e,this.cacheSizeBytes=t,this.synchronizeTabs=!0}async initialize(e){await super.initialize(e);var t=this.bc.syncEngine;this.sharedClientState instanceof Vh&&(this.sharedClientState.syncEngine={Qr:(async function(e,t,n,r){var i=e,s=await function(e,n){const r=e,i=r.mutationQueue;return r.persistence.runTransaction("Lookup mutation documents","readonly",t=>i.Vn(t,n).next(e=>e?r.localDocuments.getDocuments(t,e):Si.resolve(null)))}(i.localStore,t);null!==s?("pending"===n?await pl(i.remoteStore):"acknowledged"===n||"rejected"===n?(Xl(i,t,r||null),Wl(i,t),i.localStore.mutationQueue.Dn(t)):Kr(),await td(i,s)):qr("SyncEngine","Cannot apply mutation batch with id: "+t)}).bind(null,t),jr:(async function(e,t,n,r){const i=e;if(i.Ac)qr("SyncEngine","Ignoring unexpected query state notification.");else{var s=i._c.get(t);if(s&&0<s.length)switch(n){case"current":case"not-current":{const e=await Ah(i.localStore,$a(s[0])),r=Ho.createSynthesizedRemoteEventForCurrentChange(t,"current"===n,xs.EMPTY_BYTE_STRING);await td(i,e,r);break}case"rejected":await Sh(i.localStore,t,!0),Yl(i,t,r);break;default:Kr()}}}).bind(null,t),zr:(async function(e,t,n){const r=sd(e);if(r.Ac){for(const e of t)if(r._c.has(e))qr("SyncEngine","Adding an already active target "+e);else{const t=await Dh(r.localStore,e),n=await _h(r.localStore,t);await Gl(r,id(t),n.targetId,!1,n.resumeToken),al(r.remoteStore,n)}for(const e of n)r._c.has(e)&&await Sh(r.localStore,e,!1).then(()=>{ol(r.remoteStore,e),Yl(r,e)}).catch(_i)}}).bind(null,t),Mi:(function(e){return e.localStore.persistence.Mi()}).bind(null,t),Gr:(async function(e,t){const n=e;return Ah(n.localStore,t).then(e=>td(n,e))}).bind(null,t)},await this.sharedClientState.start()),await this.persistence.pi(async e=>{await nd(this.bc.syncEngine,e),this.gcScheduler&&(e&&!this.gcScheduler.started?this.gcScheduler.start():e||this.gcScheduler.stop()),this.indexBackfillerScheduler&&(e&&!this.indexBackfillerScheduler.started?this.indexBackfillerScheduler.start():e||this.indexBackfillerScheduler.stop())})}createSharedClientState(e){var t=Hh();if(!Vh.D(t))throw new $r(zr.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");var n=mh(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey);return new Vh(t,e.asyncQueue,n,e.clientId,e.initialUser)}}class hd{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=e=>Ql(this.syncEngine,e,1),this.remoteStore.remoteSyncer.handleCredentialChange=(async function(e,t){const n=e;if(!n.currentUser.isEqual(t)){qr("SyncEngine","User change. New user:",t.toKey());const r=await bh(n.localStore,t);n.currentUser=t,(e=n).Tc.forEach(e=>{e.forEach(e=>{e.reject(new $r(zr.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))})}),e.Tc.clear(),n.sharedClientState.handleUserChange(t,r.removedBatchIds,r.addedBatchIds),await td(n,r.tr)}}).bind(null,this.syncEngine),await bl(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return new Cl}createDatastore(e){var t,n,r,i,s=Xh(e.databaseInfo.databaseId),t=(t=e.databaseInfo,new Qh(t));return n=e.authCredentials,r=e.appCheckCredentials,i=t,e=s,new tl(n,r,i,e)}createRemoteStore(e){return t=this.localStore,n=this.datastore,r=e.asyncQueue,i=e=>Ql(this.syncEngine,e,0),s=new(Uh.D()?Uh:Bh),new rl(t,n,r,i,s);var t,n,r,i,s}createSyncEngine(e,t){return function(e,t,n,r,i,s,a){const o=new Kl(e,t,n,r,i,s);return a&&(o.Ac=!0),o}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}terminate(){return async function(e){const t=e;qr("RemoteStore","RemoteStore shutting down."),t.Au.add(5),await sl(t),t.vu.shutdown(),t.Pu.set("Unknown")}(this.remoteStore)}}function ld(t,n=10240){let r=0;return{async read(){if(r<t.byteLength){var e={value:t.slice(r,r+n),done:!1};return r+=n,e}return{done:!0}},async cancel(){},releaseLock(){},closed:Promise.resolve()}}class dd{constructor(e){this.observer=e,this.muted=!1}next(e){this.observer.next&&this.Vc(this.observer.next,e)}error(e){this.observer.error?this.Vc(this.observer.error,e):Br("Uncaught Error in snapshot listener:",e.toString())}Sc(){this.muted=!0}Vc(e,t){this.muted||setTimeout(()=>{this.muted||e(t)},0)}}class fd{constructor(e,t){this.Dc=e,this.serializer=t,this.metadata=new Qr,this.buffer=new Uint8Array,this.Cc=new TextDecoder("utf-8"),this.xc().then(e=>{e&&e.Gu()?this.metadata.resolve(e.Ku.metadata):this.metadata.reject(new Error(`The first element of the bundle is not a metadata, it is\n             ${JSON.stringify(null==e?void 0:e.Ku)}`))},e=>this.metadata.reject(e))}close(){return this.Dc.cancel()}async getMetadata(){return this.metadata.promise}async Pc(){return await this.getMetadata(),this.xc()}async xc(){var e=await this.Nc();if(null===e)return null;var t=this.Cc.decode(e),n=Number(t);isNaN(n)&&this.kc(`length string (${t}) is not valid number`);t=await this.Mc(n);return new Fl(JSON.parse(t),e.length+n)}Oc(){return this.buffer.findIndex(e=>e==="{".charCodeAt(0))}async Nc(){for(;this.Oc()<0&&!await this.$c(););if(0===this.buffer.length)return null;var e=this.Oc();e<0&&this.kc("Reached the end of bundle when a length string is expected.");var t=this.buffer.slice(0,e);return this.buffer=this.buffer.slice(e),t}async Mc(e){for(;this.buffer.length<e;)await this.$c()&&this.kc("Reached the end of bundle when more is expected.");var t=this.Cc.decode(this.buffer.slice(0,e));return this.buffer=this.buffer.slice(e),t}kc(e){throw this.Dc.cancel(),new Error(`Invalid bundle format: ${e}`)}async $c(){var e=await this.Dc.read();if(!e.done){const t=new Uint8Array(this.buffer.length+e.value.length);t.set(this.buffer),t.set(e.value,this.buffer.length),this.buffer=t}return e.done}}class gd{constructor(e){this.datastore=e,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastWriteError=null,this.writtenDocs=new Set}async lookup(e){if(this.ensureCommitNotCalled(),0<this.mutations.length)throw new $r(zr.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes.");const t=await async function(e,t){const r=e,n=yu(r.serializer)+"/documents",i={documents:t.map(e=>fu(r.serializer,e))},s=await r.Ao("BatchGetDocuments",n,i,t.length),a=new Map;s.forEach(e=>{const t=(n=r.serializer,"found"in(e=e)?function(e,t){Gr(!!t.found),t.found.name,t.found.updateTime;var n=gu(e,t.found.name),r=hu(t.found.updateTime),i=t.found.createTime?hu(t.found.createTime):oi.min(),s=new ea({mapValue:{fields:t.found.fields}});return ta.newFoundDocument(n,r,i,s)}(n,e):"missing"in e?function(e,t){Gr(!!t.missing),Gr(!!t.readTime);var n=gu(e,t.missing),r=hu(t.readTime);return ta.newNoDocument(n,r)}(n,e):Kr());var n;a.set(t.key.toString(),t)});const o=[];return t.forEach(e=>{var t=a.get(e.toString());Gr(!!t),o.push(t)}),o}(this.datastore,e);return t.forEach(e=>this.recordVersion(e)),t}set(e,t){this.write(t.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}update(e,t){try{this.write(t.toMutation(e,this.preconditionForUpdate(e)))}catch(e){this.lastWriteError=e}this.writtenDocs.add(e.toString())}delete(e){this.write(new Ro(e,this.precondition(e))),this.writtenDocs.add(e.toString())}async commit(){if(this.ensureCommitNotCalled(),this.lastWriteError)throw this.lastWriteError;const t=this.readVersions;this.mutations.forEach(e=>{t.delete(e.key.toString())}),t.forEach((e,t)=>{var n=di.fromPath(t);this.mutations.push(new Mo(n,this.precondition(n)))}),await async function(e,t){const n=e,r=yu(n.serializer)+"/documents",i={writes:t.map(e=>Iu(n.serializer,e))};await n.po("Commit",r,i)}(this.datastore,this.mutations),this.committed=!0}recordVersion(e){let t;if(e.isFoundDocument())t=e.version;else{if(!e.isNoDocument())throw Kr();t=oi.min()}var n=this.readVersions.get(e.key.toString());if(n){if(!t.isEqual(n))throw new $r(zr.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),t)}precondition(e){const t=this.readVersions.get(e.toString());return!this.writtenDocs.has(e.toString())&&t?t.isEqual(oi.min())?bo.exists(!1):bo.updateTime(t):bo.none()}preconditionForUpdate(e){const t=this.readVersions.get(e.toString());if(this.writtenDocs.has(e.toString())||!t)return bo.exists(!0);if(t.isEqual(oi.min()))throw new $r(zr.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return bo.updateTime(t)}write(e){this.ensureCommitNotCalled(),this.mutations.push(e)}ensureCommitNotCalled(){}}class md{constructor(e,t,n,r,i){this.asyncQueue=e,this.datastore=t,this.options=n,this.updateFunction=r,this.deferred=i,this.Fc=n.maxAttempts,this.Lo=new Yh(this.asyncQueue,"transaction_retry")}run(){--this.Fc,this.Bc()}Bc(){this.Lo.xo(async()=>{const t=new gd(this.datastore),e=this.Lc(t);e&&e.then(e=>{this.asyncQueue.enqueueAndForget(()=>t.commit().then(()=>{this.deferred.resolve(e)}).catch(e=>{this.qc(e)}))}).catch(e=>{this.qc(e)})})}Lc(e){try{var t=this.updateFunction(e);return!Vi(t)&&t.catch&&t.then?t:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(e){return this.deferred.reject(e),null}}qc(e){0<this.Fc&&this.Uc(e)?(--this.Fc,this.asyncQueue.enqueueAndForget(()=>(this.Bc(),Promise.resolve()))):this.deferred.reject(e)}Uc(e){if("FirebaseError"!==e.name)return!1;var t=e.code;return"aborted"===t||"failed-precondition"===t||"already-exists"===t||!Vo(t)}}class pd{constructor(e,t,n,r){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=n,this.databaseInfo=r,this.user=Lr.UNAUTHENTICATED,this.clientId=ni.A(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this.authCredentials.start(n,async e=>{qr("FirestoreClient","Received user=",e.uid),await this.authCredentialListener(e),this.user=e}),this.appCheckCredentials.start(n,e=>(qr("FirestoreClient","Received new app check token=",e),this.appCheckCredentialListener(e,this.user)))}async getConfiguration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new $r(zr.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){this.asyncQueue.enterRestrictedMode();const n=new Qr;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),n.resolve()}catch(e){var t=_l(e,"Failed to shutdown persistence");n.reject(t)}}),n.promise}}async function yd(e,t){e.asyncQueue.verifyOperationInProgress(),qr("FirestoreClient","Initializing OfflineComponentProvider");var n=await e.getConfiguration();await t.initialize(n);let r=n.initialUser;e.setCredentialChangeListener(async e=>{r.isEqual(e)||(await bh(t.localStore,e),r=e)}),t.persistence.setDatabaseDeletedListener(()=>e.terminate()),e._offlineComponents=t}async function vd(e,n){e.asyncQueue.verifyOperationInProgress();var t=await bd(e);qr("FirestoreClient","Initializing OnlineComponentProvider");var r=await e.getConfiguration();await n.initialize(t,r),e.setCredentialChangeListener(e=>wl(n.remoteStore,e)),e.setAppCheckTokenChangeListener((e,t)=>wl(n.remoteStore,t)),e._onlineComponents=n}function wd(e){return"FirebaseError"===e.name?e.code===zr.FAILED_PRECONDITION||e.code===zr.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&e instanceof DOMException)||22===e.code||20===e.code||11===e.code}async function bd(t){if(!t._offlineComponents)if(t._uninitializedComponentsProvider){qr("FirestoreClient","Using user provided OfflineComponentProvider");try{await yd(t,t._uninitializedComponentsProvider._offline)}catch(e){var n=e;if(!wd(n))throw n;Ur("Error using user provided cache. Falling back to memory cache: "+n),await yd(t,new od)}}else qr("FirestoreClient","Using default OfflineComponentProvider"),await yd(t,new od);return t._offlineComponents}async function Id(e){return e._onlineComponents||(e._uninitializedComponentsProvider?(qr("FirestoreClient","Using user provided OnlineComponentProvider"),await vd(e,e._uninitializedComponentsProvider._online)):(qr("FirestoreClient","Using default OnlineComponentProvider"),await vd(e,new hd))),e._onlineComponents}function Ed(e){return bd(e).then(e=>e.persistence)}function Td(e){return bd(e).then(e=>e.localStore)}function _d(e){return Id(e).then(e=>e.remoteStore)}function Sd(e){return Id(e).then(e=>e.syncEngine)}async function xd(e){const t=await Id(e),n=t.eventManager;return n.onListen=(async function(e,t){const n=sd(e);let r,i;const s=n.dc.get(t);if(s)r=s.targetId,n.sharedClientState.addLocalQueryTarget(r),i=s.view.hc();else{const e=await _h(n.localStore,qa(t)),s=n.sharedClientState.addLocalQueryTarget(e.targetId);r=e.targetId,i=await Gl(n,t,r,"current"===s,e.resumeToken),n.isPrimaryClient&&al(n.remoteStore,e)}return i}).bind(null,t.syncEngine),n.onUnlisten=(async function(e,t){const n=e,r=n.dc.get(t),i=n._c.get(r.targetId);if(1<i.length)return n._c.set(r.targetId,i.filter(e=>!ja(e,t))),void n.dc.delete(t);n.isPrimaryClient?(n.sharedClientState.removeLocalQueryTarget(r.targetId),n.sharedClientState.isActiveQueryTarget(r.targetId)||await Sh(n.localStore,r.targetId,!1).then(()=>{n.sharedClientState.clearQueryState(r.targetId),ol(n.remoteStore,r.targetId),Yl(n,r.targetId)}).catch(_i)):(Yl(n,r.targetId),await Sh(n.localStore,r.targetId,!0))}).bind(null,t.syncEngine),n}function Dd(e,t,n={}){const r=new Qr;return e.asyncQueue.enqueueAndForget(async()=>function(n,r,i,s,a){const e=new dd({next:e=>{r.enqueueAndForget(()=>kl(n,o));var t=e.docs.has(i);!t&&e.fromCache?a.reject(new $r(zr.UNAVAILABLE,"Failed to get document because the client is offline.")):t&&e.fromCache&&s&&"server"===s.source?a.reject(new $r(zr.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):a.resolve(e)},error:e=>a.reject(e)}),o=new Ml(Ma(i.path),e,{includeMetadataChanges:!0,Uu:!0});return Nl(n,o)}(await xd(e),e.asyncQueue,t,n,r)),r.promise}function Ad(e,t,n={}){const r=new Qr;return e.asyncQueue.enqueueAndForget(async()=>function(t,n,e,r,i){const s=new dd({next:e=>{n.enqueueAndForget(()=>kl(t,a)),e.fromCache&&"server"===r.source?i.reject(new $r(zr.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):i.resolve(e)},error:e=>i.reject(e)}),a=new Ml(e,s,{includeMetadataChanges:!0,Uu:!0});return Nl(t,a)}(await xd(e),e.asyncQueue,t,n,r)),r.promise}function Cd(e,t,n,r){const i=(n=n,t=Xh(t),s="string"==typeof n?jo().encode(n):n,n=function(e){if(e instanceof Uint8Array)return ld(e,void 0);if(e instanceof ArrayBuffer)return ld(new Uint8Array(e),void 0);if(e instanceof ReadableStream)return e.getReader();throw new Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")}(s),t=t,new fd(n,t));var s;e.asyncQueue.enqueueAndForget(async()=>{!function(e,t,n){const r=e;!async function(t,n,r){try{var i=await n.getMetadata();if(await function(e,t){const n=e,r=hu(t.createTime);return n.persistence.runTransaction("hasNewerBundle","readonly",e=>n.Ls.getBundleMetadata(e,t.id)).then(e=>!!e&&0<=e.createTime.compareTo(r))}(t.localStore,i))return await n.close(),r._completeWith({taskState:"Success",documentsLoaded:i.totalDocuments,bytesLoaded:i.totalBytes,totalDocuments:i.totalDocuments,totalBytes:i.totalBytes}),Promise.resolve(new Set);r._updateProgress(Pl(i));const a=new Ol(i,t.localStore,n.serializer);let e=await n.Pc();for(;e;){const t=await a.ju(e);t&&r._updateProgress(t),e=await n.Pc()}var s=await a.complete();return await td(t,s.Hu,void 0),await function(e,t){const n=e;return n.persistence.runTransaction("Save bundle","readwrite",e=>n.Ls.saveBundleMetadata(e,t))}(t.localStore,i),r._completeWith(s.progress),Promise.resolve(s.Wu)}catch(t){return Ur("SyncEngine",`Loading bundle failed with ${t}`),r._failWith(t),Promise.resolve(new Set)}}(r,t,n).then(e=>{r.sharedClientState.notifyBundleLoaded(e)})}(await Sd(e),i,r)})}const Nd=new Map;function kd(e,t,n){if(!n)throw new $r(zr.INVALID_ARGUMENT,`Function ${e}() cannot be called with an empty ${t}.`)}function Rd(e,t,n,r){if(!0===t&&!0===r)throw new $r(zr.INVALID_ARGUMENT,`${e} and ${n} cannot be used together.`)}function Md(e){if(!di.isDocumentKey(e))throw new $r(zr.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${e} has ${e.length}.`)}function Fd(e){if(di.isDocumentKey(e))throw new $r(zr.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${e} has ${e.length}.`)}function Ld(e){if(void 0===e)return"undefined";if(null===e)return"null";if("string"==typeof e)return 20<e.length&&(e=`${e.substring(0,20)}...`),JSON.stringify(e);if("number"==typeof e||"boolean"==typeof e)return""+e;if("object"!=typeof e)return"function"==typeof e?"a function":Kr();if(e instanceof Array)return"an array";var t=(e=e).constructor?e.constructor.name:null;return t?`a custom ${t} object`:"an object"}function Od(e,t){if((e="_delegate"in e?e._delegate:e)instanceof t)return e;if(t.name===e.constructor.name)throw new $r(zr.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");var n=Ld(e);throw new $r(zr.INVALID_ARGUMENT,`Expected type '${t.name}', but it was: ${n}`)}function Pd(e,t){if(t<=0)throw new $r(zr.INVALID_ARGUMENT,`Function ${e}() requires a positive number, but it was: ${t}.`)}class Vd{constructor(e){var t;if(void 0===e.host){if(void 0!==e.ssl)throw new $r(zr.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=null===(t=e.ssl)||void 0===t||t;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.cache=e.localCache,void 0===e.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==e.cacheSizeBytes&&e.cacheSizeBytes<1048576)throw new $r(zr.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}Rd("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling||void 0===e.experimentalAutoDetectLongPolling?this.experimentalAutoDetectLongPolling=!1:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class qd{constructor(e,t,n,r){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=n,this._app=r,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Vd({}),this._settingsFrozen=!1}get app(){if(!this._app)throw new $r(zr.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return void 0!==this._terminateTask}_setSettings(e){if(this._settingsFrozen)throw new $r(zr.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Vd(e),void 0!==e.credentials&&(this._authCredentials=function(e){if(!e)return new Wr;switch(e.type){case"firstParty":return new Zr(e.sessionIndex||"0",e.iamToken||null,e.authTokenFactory||null);case"provider":return e.client;default:throw new $r(zr.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(e){const t=Nd.get(e);t&&(qr("ComponentProvider","Removing Datastore"),Nd.delete(e),t.terminate())}(this),Promise.resolve()}}function Bd(n,e,t,r={}){var i;const s=(n=Od(n,qd))._getSettings();if("firestore.googleapis.com"!==s.host&&s.host!==e&&Ur("Host has been set in both settings() and useEmulator(), emulator host will be used"),n._setSettings(Object.assign(Object.assign({},s),{host:`${e}:${t}`,ssl:!1})),r.mockUserToken){let e,t;if("string"==typeof r.mockUserToken)e=r.mockUserToken,t=Lr.MOCK_USER;else{e=function(e,t){if(e.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');var n=t||"demo-project",r=e.iat||0,i=e.sub||e.user_id;if(!i)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");return i=Object.assign({iss:`https://securetoken.google.com/${n}`,aud:n,iat:r,exp:r+3600,auth_time:r,sub:i,user_id:i,firebase:{sign_in_provider:"custom",identities:{}}},e),[a(JSON.stringify({alg:"none",type:"JWT"})),a(JSON.stringify(i)),""].join(".")}(r.mockUserToken,null===(i=n._app)||void 0===i?void 0:i.options.projectId);const s=r.mockUserToken.sub||r.mockUserToken.user_id;if(!s)throw new $r(zr.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");t=new Lr(s)}n._authCredentials=new Xr(new Hr(e,t))}}class Ud{constructor(e,t,n){this.converter=t,this._key=n,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Kd(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new Ud(this.firestore,e,this._key)}}class jd{constructor(e,t,n){this.converter=t,this._query=n,this.type="query",this.firestore=e}withConverter(e){return new jd(this.firestore,e,this._query)}}class Kd extends jd{constructor(e,t,n){super(e,t,Ma(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new Ud(this.firestore,null,new di(e))}withConverter(e){return new Kd(this.firestore,e,this._path)}}function Gd(e,t,...n){if(e=m(e),kd("collection","path",t),e instanceof qd){var r=ci.fromString(t,...n);return Fd(r),new Kd(e,null,r)}if(!(e instanceof Ud||e instanceof Kd))throw new $r(zr.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");r=e._path.child(ci.fromString(t,...n));return Fd(r),new Kd(e.firestore,null,r)}function zd(e,t,...n){if(e=m(e),kd("doc","path",t=1===arguments.length?ni.A():t),e instanceof qd){var r=ci.fromString(t,...n);return Md(r),new Ud(e,null,new di(r))}if(!(e instanceof Ud||e instanceof Kd))throw new $r(zr.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");r=e._path.child(ci.fromString(t,...n));return Md(r),new Ud(e.firestore,e instanceof Kd?e.converter:null,new di(r))}function $d(e,t){return e=m(e),t=m(t),(e instanceof Ud||e instanceof Kd)&&(t instanceof Ud||t instanceof Kd)&&e.firestore===t.firestore&&e.path===t.path&&e.converter===t.converter}function Qd(e,t){return e=m(e),t=m(t),e instanceof jd&&t instanceof jd&&e.firestore===t.firestore&&ja(e._query,t._query)&&e.converter===t.converter}class Hd{constructor(){this.Kc=Promise.resolve(),this.Gc=[],this.Qc=!1,this.jc=[],this.zc=null,this.Wc=!1,this.Hc=!1,this.Jc=[],this.Lo=new Yh(this,"async_queue_retry"),this.Yc=()=>{var e=Wh();e&&qr("AsyncQueue","Visibility state changed to "+e.visibilityState),this.Lo.ko()};const e=Wh();e&&"function"==typeof e.addEventListener&&e.addEventListener("visibilitychange",this.Yc)}get isShuttingDown(){return this.Qc}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.Xc(),this.Zc(e)}enterRestrictedMode(e){if(!this.Qc){this.Qc=!0,this.Hc=e||!1;const t=Wh();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this.Yc)}}enqueue(e){if(this.Xc(),this.Qc)return new Promise(()=>{});const t=new Qr;return this.Zc(()=>this.Qc&&this.Hc?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Gc.push(e),this.ta()))}async ta(){if(0!==this.Gc.length){try{await this.Gc[0](),this.Gc.shift(),this.Lo.reset()}catch(e){if(!Ni(e))throw e;qr("AsyncQueue","Operation failed with retryable error: "+e)}0<this.Gc.length&&this.Lo.xo(()=>this.ta())}}Zc(e){var t=this.Kc.then(()=>(this.Wc=!0,e().catch(e=>{throw this.zc=e,this.Wc=!1,Br("INTERNAL UNHANDLED ERROR: ",function(e){let t=e.message||"";return e.stack&&(t=e.stack.includes(e.message)?e.stack:e.message+"\n"+e.stack),t}(e)),e}).then(e=>(this.Wc=!1,e))));return this.Kc=t}enqueueAfterDelay(e,t,n){this.Xc(),-1<this.Jc.indexOf(e)&&(t=0);var r=Tl.createAndSchedule(this,e,t,n,e=>this.ea(e));return this.jc.push(r),r}Xc(){this.zc&&Kr()}verifyOperationInProgress(){}async na(){for(var e;await(e=this.Kc),e!==this.Kc;);}sa(e){for(const t of this.jc)if(t.timerId===e)return!0;return!1}ia(t){return this.na().then(()=>{this.jc.sort((e,t)=>e.targetTimeMs-t.targetTimeMs);for(const e of this.jc)if(e.skipDelay(),"all"!==t&&e.timerId===t)break;return this.na()})}ra(e){this.Jc.push(e)}ea(e){var t=this.jc.indexOf(e);this.jc.splice(t,1)}}function Wd(e){return function(e){if("object"==typeof e&&null!==e){var t=e;for(const e of["next","error","complete"])if(e in t&&"function"==typeof t[e])return 1}}(e)}class Xd{constructor(){this._progressObserver={},this._taskCompletionResolver=new Qr,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(e,t,n){this._progressObserver={next:e,error:t,complete:n}}catch(e){return this._taskCompletionResolver.promise.catch(e)}then(e,t){return this._taskCompletionResolver.promise.then(e,t)}_completeWith(e){this._updateProgress(e),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(e)}_failWith(e){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(e),this._taskCompletionResolver.reject(e)}_updateProgress(e){this._lastProgress=e,this._progressObserver.next&&this._progressObserver.next(e)}}var Yd,Jd,Zd;class ef extends qd{constructor(e,t,n,r){super(e,t,n,r),this.type="firestore",this._queue=new Hd,this._persistenceKey=(null==r?void 0:r.name)||"[DEFAULT]"}_terminate(){return this._firestoreClient||nf(this),this._firestoreClient.terminate()}}function tf(e){return e._firestoreClient||nf(e),e._firestoreClient.verifyNotTerminated(),e._firestoreClient}function nf(e){var t,n,r,i,s,a=e._freezeSettings(),o=(n=e._databaseId,r=(null===(o=e._app)||void 0===o?void 0:o.options.appId)||"",i=e._persistenceKey,s=a,new Fs(n,r,i,s.host,s.ssl,s.experimentalForceLongPolling,s.experimentalAutoDetectLongPolling,s.useFetchStreams));e._firestoreClient=new pd(e._authCredentials,e._appCheckCredentials,e._queue,o),null!==(o=a.cache)&&void 0!==o&&o._offlineComponentProvider&&null!==(t=a.cache)&&void 0!==t&&t._onlineComponentProvider&&(e._firestoreClient._uninitializedComponentsProvider={_offlineKind:a.cache.kind,_offline:a.cache._offlineComponentProvider,_online:a.cache._onlineComponentProvider})}function rf(e,t,n){const r=new Qr;return e.asyncQueue.enqueue(async()=>{try{await yd(e,n),await vd(e,t),r.resolve()}catch(e){const t=e;if(!wd(t))throw t;Ur("Error enabling indexeddb cache. Falling back to memory cache: "+t),r.reject(t)}}).then(()=>r.promise)}function sf(e){return function(e){const t=new Qr;return e.asyncQueue.enqueueAndForget(async()=>async function(e,t){const n=e;dl(n.remoteStore)||qr("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.");try{const e=await function(){const t=n.localStore;return t.persistence.runTransaction("Get highest unacknowledged batch id","readonly",e=>t.mutationQueue.getHighestUnacknowledgedBatchId(e))}();if(-1===e)return void t.resolve();const r=n.Tc.get(e)||[];r.push(t),n.Tc.set(e,r)}catch(e){const n=_l(e,"Initialization of waitForPendingWrites() operation failed");t.reject(n)}}(await Sd(e),t)),t.promise}(tf(e=Od(e,ef)))}function af(e){return(n=tf(e=Od(e,ef))).asyncQueue.enqueue(async()=>{const e=await Ed(n),t=await _d(n);return e.setNetworkEnabled(!0),function(){const e=t;return e.Au.delete(0),il(e)}()});var n}function of(e){return(n=tf(e=Od(e,ef))).asyncQueue.enqueue(async()=>{const e=await Ed(n),t=await _d(n);return e.setNetworkEnabled(!1),async function(){const e=t;e.Au.add(0),await sl(e),e.Pu.set("Offline")}()});var n}function uf(t,e){return n=tf(t=Od(t,ef)),r=e,n.asyncQueue.enqueue(async()=>function(e,t){const n=e;return n.persistence.runTransaction("Get named query","readonly",e=>n.Ls.getNamedQuery(e,t))}(await Td(n),r)).then(e=>e?new jd(t,null,e.query):null);var n,r}function cf(e){if(e._initialized||e._terminated)throw new $r(zr.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.")}class hf{constructor(e){this._byteString=e}static fromBase64String(e){try{return new hf(xs.fromBase64String(e))}catch(e){throw new $r(zr.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+e)}}static fromUint8Array(e){return new hf(xs.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}class lf{constructor(...e){for(let t=0;t<e.length;++t)if(0===e[t].length)throw new $r(zr.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new li(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}class df{constructor(e){this._methodName=e}}class ff{constructor(e,t){if(!isFinite(e)||e<-90||90<e)throw new $r(zr.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||180<t)throw new $r(zr.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return ri(this._lat,e._lat)||ri(this._long,e._long)}}const gf=/^__.*__$/;class mf{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return null!==this.fieldMask?new Ao(e,this.data,this.fieldMask,t,this.fieldTransforms):new Do(e,this.data,t,this.fieldTransforms)}}class pf{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return new Ao(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function yf(e){switch(e){case 0:case 2:case 1:return 1;case 3:case 4:return;default:throw Kr()}}class vf{constructor(e,t,n,r,i,s){this.settings=e,this.databaseId=t,this.serializer=n,this.ignoreUndefinedProperties=r,void 0===i&&this.oa(),this.fieldTransforms=i||[],this.fieldMask=s||[]}get path(){return this.settings.path}get ua(){return this.settings.ua}ca(e){return new vf(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}aa(e){var t;const n=null===(t=this.path)||void 0===t?void 0:t.child(e),r=this.ca({path:n,ha:!1});return r.la(e),r}fa(e){var t;const n=null===(t=this.path)||void 0===t?void 0:t.child(e),r=this.ca({path:n,ha:!1});return r.oa(),r}da(e){return this.ca({path:void 0,ha:!0})}_a(e){return Vf(e,this.settings.methodName,this.settings.wa||!1,this.path,this.settings.ma)}contains(t){return void 0!==this.fieldMask.find(e=>t.isPrefixOf(e))||void 0!==this.fieldTransforms.find(e=>t.isPrefixOf(e.field))}oa(){if(this.path)for(let e=0;e<this.path.length;e++)this.la(this.path.get(e))}la(e){if(0===e.length)throw this._a("Document fields must not be empty");if(yf(this.ua)&&gf.test(e))throw this._a('Document fields cannot begin and end with "__"')}}class wf{constructor(e,t,n){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=n||Xh(e)}ga(e,t,n,r=!1){return new vf({ua:e,methodName:t,ma:n,path:li.emptyPath(),ha:!1,wa:r},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function bf(e){var t=e._freezeSettings(),n=Xh(e._databaseId);return new wf(e._databaseId,!!t.ignoreUndefinedProperties,n)}function If(e,t,n,r,i,s={}){const a=e.ga(s.merge||s.mergeFields?2:0,t,n,i);Ff("Data must be an object, but it was:",a,r);var o=Rf(r,a);let u,c;if(s.merge)u=new _s(a.fieldMask),c=a.fieldTransforms;else if(s.mergeFields){const e=[];for(const r of s.mergeFields){const i=Lf(t,r,n);if(!a.contains(i))throw new $r(zr.INVALID_ARGUMENT,`Field '${i}' is specified in your field mask but missing from your input data.`);qf(e,i)||e.push(i)}u=new _s(e),c=a.fieldTransforms.filter(e=>u.covers(e.field))}else u=null,c=a.fieldTransforms;return new mf(new ea(o),u,c)}class Ef extends df{_toFieldTransform(e){if(2!==e.ua)throw 1===e.ua?e._a(`${this._methodName}() can only appear at the top level of your update data`):e._a(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof Ef}}function Tf(e,t,n){return new vf({ua:3,ma:t.settings.ma,methodName:e._methodName,ha:n},t.databaseId,t.serializer,t.ignoreUndefinedProperties)}class _f extends df{_toFieldTransform(e){return new vo(e.path,new co)}isEqual(e){return e instanceof _f}}class Sf extends df{constructor(e,t){super(e),this.ya=t}_toFieldTransform(e){const t=Tf(this,e,!0),n=this.ya.map(e=>kf(e,t)),r=new ho(n);return new vo(e.path,r)}isEqual(e){return this===e}}class xf extends df{constructor(e,t){super(e),this.ya=t}_toFieldTransform(e){const t=Tf(this,e,!0),n=this.ya.map(e=>kf(e,t)),r=new fo(n);return new vo(e.path,r)}isEqual(e){return this===e}}class Df extends df{constructor(e,t){super(e),this.pa=t}_toFieldTransform(e){var t=new mo(e.serializer,ao(e.serializer,this.pa));return new vo(e.path,t)}isEqual(e){return this===e}}function Af(e,i,s,t){const a=e.ga(1,i,s);Ff("Data must be an object, but it was:",a,t);const o=[],u=ea.empty();ps(t,(e,t)=>{var n=Pf(i,e,s);t=m(t);var r=a.fa(n);if(t instanceof Ef)o.push(n);else{const e=kf(t,r);null!=e&&(o.push(n),u.set(n,e))}});var n=new _s(o);return new pf(u,n,a.fieldTransforms)}function Cf(e,t,n,r,i,s){const a=e.ga(1,t,n),o=[Lf(t,r,n)],u=[i];if(s.length%2!=0)throw new $r(zr.INVALID_ARGUMENT,`Function ${t}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let f=0;f<s.length;f+=2)o.push(Lf(t,s[f])),u.push(s[f+1]);const c=[],h=ea.empty();for(let g=o.length-1;0<=g;--g)if(!qf(c,o[g])){const t=o[g];var l=m(l=u[g]);const r=a.fa(t);if(l instanceof Ef)c.push(t);else{const e=kf(l,r);null!=e&&(c.push(t),h.set(t,e))}}var d=new _s(c);return new pf(h,d,a.fieldTransforms)}function Nf(e,t,n,r=!1){return kf(n,e.ga(r?4:3,t))}function kf(s,e){if(Mf(s=m(s)))return Ff("Unsupported field value:",e,s),Rf(s,e);if(s instanceof df)return function(e,t){if(!yf(t.ua))throw t._a(`${e._methodName}() can only be used with update() and set()`);if(!t.path)throw t._a(`${e._methodName}() is not currently supported inside arrays`);var n=e._toFieldTransform(t);n&&t.fieldTransforms.push(n)}(s,e),null;if(void 0===s&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),s instanceof Array){if(e.settings.ha&&4!==e.ua)throw e._a("Nested arrays are not supported");return function(t){const n=[];let r=0;for(const i of s){let e=kf(i,t.da(r));null==e&&(e={nullValue:"NULL_VALUE"}),n.push(e),r++}return{arrayValue:{values:n}}}(e)}return function(e,t){if(null===(e=m(s)))return{nullValue:"NULL_VALUE"};if("number"==typeof e)return ao(t.serializer,e);if("boolean"==typeof e)return{booleanValue:e};if("string"==typeof e)return{stringValue:e};if(e instanceof Date){var n=ai.fromDate(e);return{timestampValue:uu(t.serializer,n)}}if(e instanceof ai){n=new ai(e.seconds,1e3*Math.floor(e.nanoseconds/1e3));return{timestampValue:uu(t.serializer,n)}}if(e instanceof ff)return{geoPointValue:{latitude:e.latitude,longitude:e.longitude}};if(e instanceof hf)return{bytesValue:cu(t.serializer,e._byteString)};if(e instanceof Ud){const r=t.databaseId,i=e.firestore._databaseId;if(!i.isEqual(r))throw t._a(`Document reference is for database ${i.projectId}/${i.database} but should be for database ${r.projectId}/${r.database}`);return{referenceValue:lu(e.firestore._databaseId||t.databaseId,e._key.path)}}throw t._a(`Unsupported field value: ${Ld(e)}`)}(0,e)}function Rf(e,r){const i={};return ys(e)?r.path&&0<r.path.length&&r.fieldMask.push(r.path):ps(e,(e,t)=>{var n=kf(t,r.aa(e));null!=n&&(i[e]=n)}),{mapValue:{fields:i}}}function Mf(e){return!("object"!=typeof e||null===e||e instanceof Array||e instanceof Date||e instanceof ai||e instanceof ff||e instanceof hf||e instanceof Ud||e instanceof df)}function Ff(e,t,n){if(!Mf(n)||("object"!=typeof(i=n)||null===i||Object.getPrototypeOf(i)!==Object.prototype&&null!==Object.getPrototypeOf(i))){var r=Ld(n);throw"an object"===r?t._a(e+" a custom object"):t._a(e+" "+r)}var i}function Lf(e,t,n){if((t=m(t))instanceof lf)return t._internalPath;if("string"==typeof t)return Pf(e,t);throw Vf("Field path arguments must be of type string or ",e,!1,void 0,n)}const Of=new RegExp("[~\\*/\\[\\]]");function Pf(t,n,r){if(0<=n.search(Of))throw Vf(`Invalid field path (${n}). Paths must not contain '~', '*', '/', '[', or ']'`,t,!1,void 0,r);try{return new lf(...n.split("."))._internalPath}catch(e){throw Vf(`Invalid field path (${n}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,t,!1,void 0,r)}}function Vf(e,t,n,r,i){var s=r&&!r.isEmpty(),a=void 0!==i;let o=`Function ${t}() called with invalid data`;n&&(o+=" (via `toFirestore()`)"),o+=". ";let u="";return(s||a)&&(u+=" (found",s&&(u+=` in field ${r}`),a&&(u+=` in document ${i}`),u+=")"),new $r(zr.INVALID_ARGUMENT,o+e+u)}function qf(e,t){return e.some(e=>e.isEqual(t))}class Bf{constructor(e,t,n,r,i){this._firestore=e,this._userDataWriter=t,this._key=n,this._document=r,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new Ud(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){var e=new Uf(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){var t=this._document.data.field(jf("DocumentSnapshot.get",e));if(null!==t)return this._userDataWriter.convertValue(t)}}}class Uf extends Bf{data(){return super.data()}}function jf(e,t){return"string"==typeof t?Pf(e,t):(t instanceof lf?t:t._delegate)._internalPath}function Kf(e){if("L"===e.limitType&&0===e.explicitOrderBy.length)throw new $r(zr.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class Gf{}class zf extends Gf{}function $f(e,t,...n){let r=[];t instanceof Gf&&r.push(t),r=r.concat(n),function(e){var t=e.filter(e=>e instanceof Hf).length,n=e.filter(e=>e instanceof Qf).length;if(1<t||0<t&&0<n)throw new $r(zr.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(r);for(const t of r)e=t._apply(e);return e}class Qf extends zf{constructor(e,t,n){super(),this._field=e,this._op=t,this._value=n,this.type="where"}static _create(e,t,n){return new Qf(e,t,n)}_apply(e){var t=this._parse(e);return ng(e._query,t),new jd(e.firestore,e.converter,Ba(e._query,t))}_parse(e){var t=bf(e.firestore);return function(e,t,n,r,i,s,a){let o;if(i.isKeyField()){if("array-contains"===s||"array-contains-any"===s)throw new $r(zr.INVALID_ARGUMENT,`Invalid Query. You can't perform '${s}' queries on documentId().`);if("in"===s||"not-in"===s){tg(a,s);const t=[];for(const n of a)t.push(eg(r,e,n));o={arrayValue:{values:t}}}else o=eg(r,e,a)}else"in"!==s&&"not-in"!==s&&"array-contains-any"!==s||tg(a,s),o=Nf(n,t,a,"in"===s||"not-in"===s);return oa.create(i,s,o)}(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value)}}class Hf extends Gf{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new Hf(e,t)}_parse(t){var e=this._queryConstraints.map(e=>e._parse(t)).filter(e=>0<e.getFilters().length);return 1===e.length?e[0]:ua.create(e,this._getOperator())}_apply(e){const n=this._parse(e);return 0===n.getFilters().length?e:(function(e){let t=e;for(const e of n.getFlattenedFilters())ng(t,e),t=Ba(t,e)}(e._query),new jd(e.firestore,e.converter,Ba(e._query,n)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return"and"===this.type?"and":"or"}}class Wf extends zf{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new Wf(e,t)}_apply(e){var t=function(e,t,n){if(null!==e.startAt)throw new $r(zr.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==e.endAt)throw new $r(zr.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");var r,i=new sa(t,n);return n=i,null!==La(e=e)||null!==(r=Oa(e))&&rg(0,r,n.field),i}(e._query,this._field,this._direction);return new jd(e.firestore,e.converter,(e=e._query,t=e.explicitOrderBy.concat([t]),new ka(e.path,e.collectionGroup,t,e.filters.slice(),e.limit,e.limitType,e.startAt,e.endAt)))}}class Xf extends zf{constructor(e,t,n){super(),this.type=e,this._limit=t,this._limitType=n}static _create(e,t,n){return new Xf(e,t,n)}_apply(e){return new jd(e.firestore,e.converter,Ua(e._query,this._limit,this._limitType))}}class Yf extends zf{constructor(e,t,n){super(),this.type=e,this._docOrFields=t,this._inclusive=n}static _create(e,t,n){return new Yf(e,t,n)}_apply(e){var t,n=Zf(e,this.type,this._docOrFields,this._inclusive);return new jd(e.firestore,e.converter,(t=e._query,e=n,new ka(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,e,t.endAt)))}}class Jf extends zf{constructor(e,t,n){super(),this.type=e,this._docOrFields=t,this._inclusive=n}static _create(e,t,n){return new Jf(e,t,n)}_apply(e){var t,n=Zf(e,this.type,this._docOrFields,this._inclusive);return new jd(e.firestore,e.converter,(t=e._query,e=n,new ka(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,e)))}}function Zf(e,t,n,r){if(n[0]=m(n[0]),n[0]instanceof Bf)return function(e,t,n,r,i){if(!r)throw new $r(zr.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${n}().`);const s=[];for(const n of Va(e))if(n.field.isKeyField())s.push(Gs(t,r.key));else{const e=r.data.field(n.field);if(ks(e))throw new $r(zr.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+n.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===e){const e=n.field.canonicalString();throw new $r(zr.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${e}' (used as the orderBy) does not exist.`)}s.push(e)}return new na(s,i)}(e._query,e.firestore._databaseId,t,n[0]._document,r);var i=bf(e.firestore);return function(e,t,n,r,i,s){const a=e.explicitOrderBy;if(i.length>a.length)throw new $r(zr.INVALID_ARGUMENT,`Too many arguments provided to ${r}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);const o=[];for(let u=0;u<i.length;u++){const c=i[u];if(a[u].field.isKeyField()){if("string"!=typeof c)throw new $r(zr.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${r}(), but got a ${typeof c}`);if(!Pa(e)&&-1!==c.indexOf("/"))throw new $r(zr.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${r}() must be a plain document ID, but '${c}' contains a slash.`);const n=e.path.child(ci.fromString(c));if(!di.isDocumentKey(n))throw new $r(zr.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${r}() must result in a valid document path, but '${n}' is not because it contains an odd number of segments.`);const i=new di(n);o.push(Gs(t,i))}else{const e=Nf(n,r,c);o.push(e)}}return new na(o,s)}(e._query,e.firestore._databaseId,i,t,n,r)}function eg(e,t,n){if("string"==typeof(n=m(n))){if(""===n)throw new $r(zr.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!Pa(t)&&-1!==n.indexOf("/"))throw new $r(zr.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${n}' contains a '/' character.`);var r=t.path.child(ci.fromString(n));if(!di.isDocumentKey(r))throw new $r(zr.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return Gs(e,new di(r))}if(n instanceof Ud)return Gs(e,n._key);throw new $r(zr.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${Ld(n)}.`)}function tg(e,t){if(!Array.isArray(e)||0===e.length)throw new $r(zr.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${t.toString()}' filters.`)}function ng(e,t){if(t.isInequality()){const r=Oa(e),i=t.field;if(null!==r&&!r.isEqual(i))throw new $r(zr.INVALID_ARGUMENT,`Invalid query. All where filters with an inequality (<, <=, !=, not-in, >, or >=) must be on the same field. But you have inequality filters on '${r.toString()}' and '${i.toString()}'`);var n=La(e);null!==n&&rg(0,i,n)}const r=function(e,t){for(const n of e)for(const e of n.getFlattenedFilters())if(0<=t.indexOf(e.op))return e.op;return null}(e.filters,function(){switch(t.op){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}());if(null!==r)throw r===t.op?new $r(zr.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${t.op.toString()}' filter.`):new $r(zr.INVALID_ARGUMENT,`Invalid query. You cannot use '${t.op.toString()}' filters with '${r.toString()}' filters.`)}function rg(e,t,n){if(!n.isEqual(t))throw new $r(zr.INVALID_ARGUMENT,`Invalid query. You have a where filter with an inequality (<, <=, !=, not-in, >, or >=) on field '${t.toString()}' and so you must also use '${t.toString()}' as your first argument to orderBy(), but your first orderBy() is on field '${n.toString()}' instead.`)}class ig{convertValue(e,t="none"){switch(Vs(e)){case 0:return null;case 1:return e.booleanValue;case 2:return Cs(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(Ns(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 10:return this.convertObject(e.mapValue,t);default:throw Kr()}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,n="none"){const r={};return ps(e,(e,t)=>{r[e]=this.convertValue(t,n)}),r}convertGeoPoint(e){return new ff(Cs(e.latitude),Cs(e.longitude))}convertArray(e,t){return(e.values||[]).map(e=>this.convertValue(e,t))}convertServerTimestamp(e,t){switch(t){case"previous":var n=Rs(e);return null==n?null:this.convertValue(n,t);case"estimate":return this.convertTimestamp(Ms(e));default:return null}}convertTimestamp(e){var t=As(e);return new ai(t.seconds,t.nanos)}convertDocumentKey(e,t){const n=ci.fromString(e);Gr(Nu(n));const r=new Ls(n.get(1),n.get(3)),i=new di(n.popFirst(5));return r.isEqual(t)||Br(`Document ${i} contains a document reference within a different database (${r.projectId}/${r.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),i}}function sg(e,t,n){return e?n&&(n.merge||n.mergeFields)?e.toFirestore(t,n):e.toFirestore(t):t}class ag extends ig{constructor(e){super(),this.firestore=e}convertBytes(e){return new hf(e)}convertReference(e){var t=this.convertDocumentKey(e,this.firestore._databaseId);return new Ud(this.firestore,null,t)}}class og{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class ug extends Bf{constructor(e,t,n,r,i,s){super(e,t,n,r,s),this._firestore=e,this._firestoreImpl=e,this.metadata=i}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){var t=new cg(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){var n=this._document.data.field(jf("DocumentSnapshot.get",e));if(null!==n)return this._userDataWriter.convertValue(n,t.serverTimestamps)}}}class cg extends ug{data(e={}){return super.data(e)}}class hg{constructor(e,t,n,r){this._firestore=e,this._userDataWriter=t,this._snapshot=r,this.metadata=new og(r.hasPendingWrites,r.fromCache),this.query=n}get docs(){const t=[];return this.forEach(e=>t.push(e)),t}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(t,n){this._snapshot.docs.forEach(e=>{t.call(n,new cg(this._firestore,this._userDataWriter,e.key,e,new og(this._snapshot.mutatedKeys.has(e.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){var t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new $r(zr.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(s,t){if(s._snapshot.oldDocs.isEmpty()){let n=0;return s._snapshot.docChanges.map(e=>{var t=new cg(s._firestore,s._userDataWriter,e.doc.key,e.doc,new og(s._snapshot.mutatedKeys.has(e.doc.key),s._snapshot.fromCache),s.query.converter);return e.doc,{type:"added",doc:t,oldIndex:-1,newIndex:n++}})}{let i=s._snapshot.oldDocs;return s._snapshot.docChanges.filter(e=>t||3!==e.type).map(e=>{var t=new cg(s._firestore,s._userDataWriter,e.doc.key,e.doc,new og(s._snapshot.mutatedKeys.has(e.doc.key),s._snapshot.fromCache),s.query.converter);let n=-1,r=-1;return 0!==e.type&&(n=i.indexOf(e.doc.key),i=i.delete(e.doc.key)),1!==e.type&&(i=i.add(e.doc),r=i.indexOf(e.doc.key)),{type:function(e){switch(e){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return Kr()}}(e.type),doc:t,oldIndex:n,newIndex:r}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}}function lg(e,t){return e instanceof ug&&t instanceof ug?e._firestore===t._firestore&&e._key.isEqual(t._key)&&(null===e._document?null===t._document:e._document.isEqual(t._document))&&e._converter===t._converter:e instanceof hg&&t instanceof hg&&e._firestore===t._firestore&&Qd(e.query,t.query)&&e.metadata.isEqual(t.metadata)&&e._snapshot.isEqual(t._snapshot)}class dg extends ig{constructor(e){super(),this.firestore=e}convertBytes(e){return new hf(e)}convertReference(e){var t=this.convertDocumentKey(e,this.firestore._databaseId);return new Ud(this.firestore,null,t)}}function fg(t){t=Od(t,Ud);const n=Od(t.firestore,ef),e=tf(n),r=new dg(n);return function(e,t){const n=new Qr;return e.asyncQueue.enqueueAndForget(async()=>async function(e,t,n){try{const i=await function(t){const n=e;return n.persistence.runTransaction("read document","readonly",e=>n.localDocuments.getDocument(e,t))}(t);i.isFoundDocument()?n.resolve(i):i.isNoDocument()?n.resolve(null):n.reject(new $r(zr.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(e){var r=_l(e,`Failed to get document '${t} from cache`);n.reject(r)}}(await Td(e),t,n)),n.promise}(e,t._key).then(e=>new ug(n,r,t._key,e,new og(null!==e&&e.hasLocalMutations,!0),t.converter))}function gg(t){t=Od(t,jd);const n=Od(t.firestore,ef),e=tf(n),r=new dg(n);return function(e,t){const n=new Qr;return e.asyncQueue.enqueueAndForget(async()=>async function(e,t,n){try{const i=await xh(e,t,!0),s=new Bl(t,i.sr),a=s.nc(i.documents),o=s.applyChanges(a,!1);n.resolve(o.snapshot)}catch(e){var r=_l(e,`Failed to execute query '${t} against cache`);n.reject(r)}}(await Td(e),t,n)),n.promise}(e,t._query).then(e=>new hg(n,r,t,e))}function mg(e,t,n){e=Od(e,Ud);var r=Od(e.firestore,ef),i=sg(e.converter,t,n);return wg(r,[If(bf(r),"setDoc",e._key,i,null!==e.converter,n).toMutation(e._key,bo.none())])}function pg(e,t,n,...r){e=Od(e,Ud);var i=Od(e.firestore,ef),s=bf(i);let a;return a="string"==typeof(t=m(t))||t instanceof lf?Cf(s,"updateDoc",e._key,t,n,r):Af(s,"updateDoc",e._key,t),wg(i,[a.toMutation(e._key,bo.exists(!0))])}function yg(t,...n){var e;t=m(t);let r={includeMetadataChanges:!1},i=0;"object"!=typeof n[i]||Wd(n[i])||(r=n[i],i++);var s={includeMetadataChanges:r.includeMetadataChanges};if(Wd(n[i])){const t=n[i];n[i]=null===(e=t.next)||void 0===e?void 0:e.bind(t),n[i+1]=null===(e=t.error)||void 0===e?void 0:e.bind(t),n[i+2]=null===(e=t.complete)||void 0===e?void 0:e.bind(t)}let a,o,u;if(t instanceof Ud)o=Od(t.firestore,ef),u=Ma(t._key.path),a={next:e=>{n[i]&&n[i](bg(o,t,e))},error:n[i+1],complete:n[i+2]};else{const c=Od(t,jd);o=Od(c.firestore,ef),u=c._query;const h=new dg(o);a={next:e=>{n[i]&&n[i](new hg(o,h,c,e))},error:n[i+1],complete:n[i+2]},Kf(t._query)}return function(e,t,n,r){const i=new dd(r),s=new Ml(t,i,n);return e.asyncQueue.enqueueAndForget(async()=>Nl(await xd(e),s)),()=>{i.Sc(),e.asyncQueue.enqueueAndForget(async()=>kl(await xd(e),s))}}(tf(o),u,s,a)}function vg(e,t){return function(e,t){const n=new dd(t);return e.asyncQueue.enqueueAndForget(async()=>function(e,t){e.Nu.add(t),t.next()}(await xd(e),n)),()=>{n.Sc(),e.asyncQueue.enqueueAndForget(async()=>function(e,t){e.Nu.delete(t)}(await xd(e),n))}}(tf(e=Od(e,ef)),Wd(t)?t:{next:t})}function wg(e,t){return function(e,t){const n=new Qr;return e.asyncQueue.enqueueAndForget(async()=>zl(await Sd(e),t,n)),n.promise}(tf(e),t)}function bg(e,t,n){var r=n.docs.get(t._key),i=new dg(e);return new ug(e,i,t._key,r,new og(n.hasPendingWrites,n.fromCache),t.converter)}const Ig={maxAttempts:5};class Eg{constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=bf(e)}set(e,t,n){this._verifyNotCommitted();const r=Tg(e,this._firestore),i=sg(r.converter,t,n),s=If(this._dataReader,"WriteBatch.set",r._key,i,null!==r.converter,n);return this._mutations.push(s.toMutation(r._key,bo.none())),this}update(e,t,n,...r){this._verifyNotCommitted();var i=Tg(e,this._firestore);let s;return s="string"==typeof(t=m(t))||t instanceof lf?Cf(this._dataReader,"WriteBatch.update",i._key,t,n,r):Af(this._dataReader,"WriteBatch.update",i._key,t),this._mutations.push(s.toMutation(i._key,bo.exists(!0))),this}delete(e){this._verifyNotCommitted();var t=Tg(e,this._firestore);return this._mutations=this._mutations.concat(new Ro(t._key,bo.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,0<this._mutations.length?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new $r(zr.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}function Tg(e,t){if((e=m(e)).firestore!==t)throw new $r(zr.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return e}class _g extends class{constructor(e,t){this._firestore=e,this._transaction=t,this._dataReader=bf(e)}get(e){const n=Tg(e,this._firestore),r=new ag(this._firestore);return this._transaction.lookup([n._key]).then(e=>{if(!e||1!==e.length)return Kr();const t=e[0];if(t.isFoundDocument())return new Bf(this._firestore,r,t.key,t,n.converter);if(t.isNoDocument())return new Bf(this._firestore,r,n._key,null,n.converter);throw Kr()})}set(e,t,n){var r=Tg(e,this._firestore),i=sg(r.converter,t,n),i=If(this._dataReader,"Transaction.set",r._key,i,null!==r.converter,n);return this._transaction.set(r._key,i),this}update(e,t,n,...r){var i=Tg(e,this._firestore),s="string"==typeof(t=m(t))||t instanceof lf?Cf(this._dataReader,"Transaction.update",i._key,t,n,r):Af(this._dataReader,"Transaction.update",i._key,t);return this._transaction.update(i._key,s),this}delete(e){var t=Tg(e,this._firestore);return this._transaction.delete(t._key),this}}{constructor(e,t){super(e,t),this._firestore=e}get(e){const t=Tg(e,this._firestore),n=new dg(this._firestore);return super.get(e).then(e=>new ug(this._firestore,n,t._key,e._document,new og(!1,!1),t.converter))}}function Sg(t,n,e){t=Od(t,ef);var r=Object.assign(Object.assign({},Ig),e);return function(){if(r.maxAttempts<1)throw new $r(zr.INVALID_ARGUMENT,"Max attempts must be at least 1")}(),function(t,n,r){const i=new Qr;return t.asyncQueue.enqueueAndForget(async()=>{var e=await Id(t).then(e=>e.datastore);new md(t.asyncQueue,e,r,n,i).run()}),i.promise}(tf(t),e=>n(new _g(t,e)),r)}Yd=Jg.SDK_VERSION,Or=Yd,Jg._registerComponent(new p("firestore",(e,{instanceIdentifier:t,options:n})=>{const r=e.getProvider("app").getImmediate(),i=new ef(new Yr(e.getProvider("auth-internal")),new ti(e.getProvider("app-check-internal")),function(e,t){if(!Object.prototype.hasOwnProperty.apply(e.options,["projectId"]))throw new $r(zr.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Ls(e.options.projectId,t)}(r,t),r);return n=Object.assign({useFetchStreams:!0},n),i._setSettings(n),i},"PUBLIC").setMultipleInstances(!0)),Jg.registerVersion(Fr,"3.11.0",void 0),Jg.registerVersion(Fr,"3.11.0","esm2017");function xg(e,t){if(void 0===t)return{merge:!1};if(void 0!==t.mergeFields&&void 0!==t.merge)throw new $r("invalid-argument",`Invalid options passed to function ${e}(): You cannot `+'specify both "merge" and "mergeFields".');return t}function Dg(){if("undefined"==typeof Uint8Array)throw new $r("unimplemented","Uint8Arrays are not available in this environment.")}function Ag(){if("undefined"==typeof atob)throw new $r("unimplemented","Blobs are unavailable in Firestore in this environment.")}class Cg{constructor(e){this._delegate=e}static fromBase64String(e){return Ag(),new Cg(hf.fromBase64String(e))}static fromUint8Array(e){return Dg(),new Cg(hf.fromUint8Array(e))}toBase64(){return Ag(),this._delegate.toBase64()}toUint8Array(){return Dg(),this._delegate.toUint8Array()}isEqual(e){return this._delegate.isEqual(e._delegate)}toString(){return"Blob(base64: "+this.toBase64()+")"}}function Ng(e){return function(e,t){if("object"!=typeof e||null===e)return;var n=e;for(const r of t)if(r in n&&"function"==typeof n[r])return 1;return}(e,["next","error","complete"])}class kg{enableIndexedDbPersistence(e,t){return function(e,t){cf(e=Od(e,ef));var n=tf(e);if(n._uninitializedComponentsProvider)throw new $r(zr.FAILED_PRECONDITION,"SDK cache is already specified.");Ur("enableIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");var r=e._freezeSettings(),i=new hd;return rf(n,i,new ud(i,r.cacheSizeBytes,null==t?void 0:t.forceOwnership))}(e._delegate,{forceOwnership:t})}enableMultiTabIndexedDbPersistence(e){return function(e){cf(e=Od(e,ef));var t=tf(e);if(t._uninitializedComponentsProvider)throw new $r(zr.FAILED_PRECONDITION,"SDK cache is already specified.");Ur("enableMultiTabIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");var n=e._freezeSettings(),r=new hd;return rf(t,r,new cd(r,n.cacheSizeBytes))}(e._delegate)}clearIndexedDbPersistence(e){return function(e){if(e._initialized&&!e._terminated)throw new $r(zr.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");const t=new Qr;return e._queue.enqueueAndForgetEvenWhileRestricted(async()=>{try{await async function(e){if(!Di.D())return Promise.resolve();var t=e+"main";await Di.delete(t)}(mh(e._databaseId,e._persistenceKey)),t.resolve()}catch(e){t.reject(e)}}),t.promise}(e._delegate)}}class Rg{constructor(e,t,n){this._delegate=t,this._persistenceProvider=n,this.INTERNAL={delete:()=>this.terminate()},e instanceof Ls||(this._appCompat=e)}get _databaseId(){return this._delegate._databaseId}settings(e){var t=this._delegate._getSettings();e.merge||t.host===e.host||Ur("You are overriding the original host. If you did not intend to override your settings, use {merge: true}."),e.merge&&delete(e=Object.assign(Object.assign({},t),e)).merge,this._delegate._setSettings(e)}useEmulator(e,t,n={}){Bd(this._delegate,e,t,n)}enableNetwork(){return af(this._delegate)}disableNetwork(){return of(this._delegate)}enablePersistence(e){let t=!1,n=!1;return e&&(t=!!e.synchronizeTabs,n=!!e.experimentalForceOwningTab,Rd("synchronizeTabs",t,"experimentalForceOwningTab",n)),t?this._persistenceProvider.enableMultiTabIndexedDbPersistence(this):this._persistenceProvider.enableIndexedDbPersistence(this,n)}clearPersistence(){return this._persistenceProvider.clearIndexedDbPersistence(this)}terminate(){return this._appCompat&&(this._appCompat._removeServiceInstance("firestore-compat"),this._appCompat._removeServiceInstance("firestore")),this._delegate._delete()}waitForPendingWrites(){return sf(this._delegate)}onSnapshotsInSync(e){return vg(this._delegate,e)}get app(){if(!this._appCompat)throw new $r("failed-precondition","Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._appCompat}collection(e){try{return new $g(this,Gd(this._delegate,e))}catch(e){throw Vg(e,"collection()","Firestore.collection()")}}doc(e){try{return new Pg(this,zd(this._delegate,e))}catch(e){throw Vg(e,"doc()","Firestore.doc()")}}collectionGroup(e){try{return new Kg(this,function(e,t){if(e=Od(e,qd),kd("collectionGroup","collection id",t),0<=t.indexOf("/"))throw new $r(zr.INVALID_ARGUMENT,`Invalid collection ID '${t}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new jd(e,null,(t=t,new ka(ci.emptyPath(),t)))}(this._delegate,e))}catch(e){throw Vg(e,"collectionGroup()","Firestore.collectionGroup()")}}runTransaction(t){return Sg(this._delegate,e=>t(new Fg(this,e)))}batch(){return tf(this._delegate),new Lg(new Eg(this._delegate,e=>wg(this._delegate,e)))}loadBundle(e){return t=this._delegate,e=e,n=tf(t=Od(t,ef)),r=new Xd,Cd(n,t._databaseId,e,r),r;var t,n,r}namedQuery(e){return uf(this._delegate,e).then(e=>e?new Kg(this,e):null)}}class Mg extends ig{constructor(e){super(),this.firestore=e}convertBytes(e){return new Cg(new hf(e))}convertReference(e){var t=this.convertDocumentKey(e,this.firestore._databaseId);return Pg.forKey(t,this.firestore,null)}}class Fg{constructor(e,t){this._firestore=e,this._delegate=t,this._userDataWriter=new Mg(e)}get(e){const t=Qg(e);return this._delegate.get(t).then(e=>new Ug(this._firestore,new ug(this._firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,t.converter)))}set(e,t,n){var r=Qg(e);return n?(xg("Transaction.set",n),this._delegate.set(r,t,n)):this._delegate.set(r,t),this}update(e,t,n,...r){var i=Qg(e);return 2===arguments.length?this._delegate.update(i,t):this._delegate.update(i,t,n,...r),this}delete(e){var t=Qg(e);return this._delegate.delete(t),this}}class Lg{constructor(e){this._delegate=e}set(e,t,n){var r=Qg(e);return n?(xg("WriteBatch.set",n),this._delegate.set(r,t,n)):this._delegate.set(r,t),this}update(e,t,n,...r){var i=Qg(e);return 2===arguments.length?this._delegate.update(i,t):this._delegate.update(i,t,n,...r),this}delete(e){var t=Qg(e);return this._delegate.delete(t),this}commit(){return this._delegate.commit()}}class Og{constructor(e,t,n){this._firestore=e,this._userDataWriter=t,this._delegate=n}fromFirestore(e,t){var n=new cg(this._firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,null);return this._delegate.fromFirestore(new jg(this._firestore,n),null!=t?t:{})}toFirestore(e,t){return t?this._delegate.toFirestore(e,t):this._delegate.toFirestore(e)}static getInstance(e,t){const n=Og.INSTANCES;let r=n.get(e);r||(r=new WeakMap,n.set(e,r));let i=r.get(t);return i||(i=new Og(e,new Mg(e),t),r.set(t,i)),i}}Og.INSTANCES=new WeakMap;class Pg{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new Mg(e)}static forPath(e,t,n){if(e.length%2!=0)throw new $r("invalid-argument","Invalid document reference. Document references must have an even number of segments, but "+`${e.canonicalString()} has ${e.length}`);return new Pg(t,new Ud(t._delegate,n,new di(e)))}static forKey(e,t,n){return new Pg(t,new Ud(t._delegate,n,e))}get id(){return this._delegate.id}get parent(){return new $g(this.firestore,this._delegate.parent)}get path(){return this._delegate.path}collection(e){try{return new $g(this.firestore,Gd(this._delegate,e))}catch(e){throw Vg(e,"collection()","DocumentReference.collection()")}}isEqual(e){return(e=m(e))instanceof Ud&&$d(this._delegate,e)}set(e,t){t=xg("DocumentReference.set",t);try{return t?mg(this._delegate,e,t):mg(this._delegate,e)}catch(e){throw Vg(e,"setDoc()","DocumentReference.set()")}}update(e,t,...n){try{return 1===arguments.length?pg(this._delegate,e):pg(this._delegate,e,t,...n)}catch(e){throw Vg(e,"updateDoc()","DocumentReference.update()")}}delete(){return wg(Od((e=this._delegate).firestore,ef),[new Ro(e._key,bo.none())]);var e}onSnapshot(...e){var t=qg(e),n=Bg(e,e=>new Ug(this.firestore,new ug(this.firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,this._delegate.converter)));return yg(this._delegate,t,n)}get(e){let t;return t=("cache"===(null==e?void 0:e.source)?fg:"server"===(null==e?void 0:e.source)?function(t){t=Od(t,Ud);const n=Od(t.firestore,ef);return Dd(tf(n),t._key,{source:"server"}).then(e=>bg(n,t,e))}:function(t){t=Od(t,Ud);const n=Od(t.firestore,ef);return Dd(tf(n),t._key).then(e=>bg(n,t,e))})(this._delegate),t.then(e=>new Ug(this.firestore,new ug(this.firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,this._delegate.converter)))}withConverter(e){return new Pg(this.firestore,e?this._delegate.withConverter(Og.getInstance(this.firestore,e)):this._delegate.withConverter(null))}}function Vg(e,t,n){return e.message=e.message.replace(t,n),e}function qg(e){for(const t of e)if("object"==typeof t&&!Ng(t))return t;return{}}function Bg(e,t){var n;let r;return r=Ng(e[0])?e[0]:Ng(e[1])?e[1]:"function"==typeof e[0]?{next:e[0],error:e[1],complete:e[2]}:{next:e[1],error:e[2],complete:e[3]},{next:e=>{r.next&&r.next(t(e))},error:null===(n=r.error)||void 0===n?void 0:n.bind(r),complete:null===(n=r.complete)||void 0===n?void 0:n.bind(r)}}class Ug{constructor(e,t){this._firestore=e,this._delegate=t}get ref(){return new Pg(this._firestore,this._delegate.ref)}get id(){return this._delegate.id}get metadata(){return this._delegate.metadata}get exists(){return this._delegate.exists()}data(e){return this._delegate.data(e)}get(e,t){return this._delegate.get(e,t)}isEqual(e){return lg(this._delegate,e._delegate)}}class jg extends Ug{data(e){var t=this._delegate.data(e);return void 0!==t||Kr(),t}}class Kg{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new Mg(e)}where(e,t,n){try{return new Kg(this.firestore,$f(this._delegate,(r=n,i=t,s=jf("where",e),Qf._create(s,i,r))))}catch(e){throw Vg(e,/(orderBy|where)\(\)/,"Query.$1()")}var r,i,s}orderBy(e,t){try{return new Kg(this.firestore,$f(this._delegate,([n,r="asc"]=[e,t],i=r,s=jf("orderBy",n),Wf._create(s,i))))}catch(e){throw Vg(e,/(orderBy|where)\(\)/,"Query.$1()")}var n,r,i,s}limit(e){try{return new Kg(this.firestore,$f(this._delegate,(Pd("limit",t=e),Xf._create("limit",t,"F"))))}catch(e){throw Vg(e,"limit()","Query.limit()")}var t}limitToLast(e){try{return new Kg(this.firestore,$f(this._delegate,(Pd("limitToLast",t=e),Xf._create("limitToLast",t,"L"))))}catch(e){throw Vg(e,"limitToLast()","Query.limitToLast()")}var t}startAt(...e){try{return new Kg(this.firestore,$f(this._delegate,function(...e){return Yf._create("startAt",e,!0)}(...e)))}catch(e){throw Vg(e,"startAt()","Query.startAt()")}}startAfter(...e){try{return new Kg(this.firestore,$f(this._delegate,function(...e){return Yf._create("startAfter",e,!1)}(...e)))}catch(e){throw Vg(e,"startAfter()","Query.startAfter()")}}endBefore(...e){try{return new Kg(this.firestore,$f(this._delegate,function(...e){return Jf._create("endBefore",e,!1)}(...e)))}catch(e){throw Vg(e,"endBefore()","Query.endBefore()")}}endAt(...e){try{return new Kg(this.firestore,$f(this._delegate,function(...e){return Jf._create("endAt",e,!0)}(...e)))}catch(e){throw Vg(e,"endAt()","Query.endAt()")}}isEqual(e){return Qd(this._delegate,e._delegate)}get(e){let t;return t=("cache"===(null==e?void 0:e.source)?gg:"server"===(null==e?void 0:e.source)?function(t){t=Od(t,jd);const n=Od(t.firestore,ef),e=tf(n),r=new dg(n);return Ad(e,t._query,{source:"server"}).then(e=>new hg(n,r,t,e))}:function(t){t=Od(t,jd);const n=Od(t.firestore,ef),e=tf(n),r=new dg(n);return Kf(t._query),Ad(e,t._query).then(e=>new hg(n,r,t,e))})(this._delegate),t.then(e=>new zg(this.firestore,new hg(this.firestore._delegate,this._userDataWriter,this._delegate,e._snapshot)))}onSnapshot(...e){var t=qg(e),n=Bg(e,e=>new zg(this.firestore,new hg(this.firestore._delegate,this._userDataWriter,this._delegate,e._snapshot)));return yg(this._delegate,t,n)}withConverter(e){return new Kg(this.firestore,e?this._delegate.withConverter(Og.getInstance(this.firestore,e)):this._delegate.withConverter(null))}}class Gg{constructor(e,t){this._firestore=e,this._delegate=t}get type(){return this._delegate.type}get doc(){return new jg(this._firestore,this._delegate.doc)}get oldIndex(){return this._delegate.oldIndex}get newIndex(){return this._delegate.newIndex}}class zg{constructor(e,t){this._firestore=e,this._delegate=t}get query(){return new Kg(this._firestore,this._delegate.query)}get metadata(){return this._delegate.metadata}get size(){return this._delegate.size}get empty(){return this._delegate.empty}get docs(){return this._delegate.docs.map(e=>new jg(this._firestore,e))}docChanges(e){return this._delegate.docChanges(e).map(e=>new Gg(this._firestore,e))}forEach(t,n){this._delegate.forEach(e=>{t.call(n,new jg(this._firestore,e))})}isEqual(e){return lg(this._delegate,e._delegate)}}class $g extends Kg{constructor(e,t){super(e,t),this.firestore=e,this._delegate=t}get id(){return this._delegate.id}get path(){return this._delegate.path}get parent(){var e=this._delegate.parent;return e?new Pg(this.firestore,e):null}doc(e){try{return void 0===e?new Pg(this.firestore,zd(this._delegate)):new Pg(this.firestore,zd(this._delegate,e))}catch(e){throw Vg(e,"doc()","CollectionReference.doc()")}}add(e){return function(e,t){const n=Od(e.firestore,ef),r=zd(e),i=sg(e.converter,t);return wg(n,[If(bf(e.firestore),"addDoc",r._key,i,null!==e.converter,{}).toMutation(r._key,bo.exists(!1))]).then(()=>r)}(this._delegate,e).then(e=>new Pg(this.firestore,e))}isEqual(e){return $d(this._delegate,e._delegate)}withConverter(e){return new $g(this.firestore,e?this._delegate.withConverter(Og.getInstance(this.firestore,e)):this._delegate.withConverter(null))}}function Qg(e){return Od(e,Ud)}const Hg={Firestore:Rg,GeoPoint:ff,Timestamp:ai,Blob:Cg,Transaction:Fg,WriteBatch:Lg,DocumentReference:Pg,DocumentSnapshot:Ug,Query:Kg,QueryDocumentSnapshot:jg,QuerySnapshot:zg,CollectionReference:$g,FieldPath:class Wg{constructor(...e){this._delegate=new lf(...e)}static documentId(){return new Wg(li.keyField().canonicalString())}isEqual(e){return(e=m(e))instanceof lf&&this._delegate._internalPath.isEqual(e._internalPath)}},FieldValue:class Xg{constructor(e){this._delegate=e}static serverTimestamp(){const e=new _f("serverTimestamp");return e._methodName="FieldValue.serverTimestamp",new Xg(e)}static delete(){const e=new Ef("deleteField");return e._methodName="FieldValue.delete",new Xg(e)}static arrayUnion(...e){const t=function(...e){return new Sf("arrayUnion",e)}(...e);return t._methodName="FieldValue.arrayUnion",new Xg(t)}static arrayRemove(...e){const t=function(...e){return new xf("arrayRemove",e)}(...e);return t._methodName="FieldValue.arrayRemove",new Xg(t)}static increment(e){const t=new Df("increment",e);return t._methodName="FieldValue.increment",new Xg(t)}isEqual(e){return this._delegate.isEqual(e._delegate)}},setLogLevel:function(e){e=e,Pr.setLogLevel(e)},CACHE_SIZE_UNLIMITED:-1};Jd=t.default,Zd=(e,t)=>new Rg(e,t,new kg),Jd.INTERNAL.registerComponent(new p("firestore-compat",e=>{var t=e.getProvider("app-compat").getImmediate(),n=e.getProvider("firestore").getImmediate();return Zd(t,n)},"PUBLIC").setServiceProps(Object.assign({},Hg))),Jd.registerVersion("@firebase/firestore-compat","0.3.8")}).apply(this,arguments)}catch(e){throw console.error(e),new Error("Cannot instantiate firebase-firestore-compat.js - be sure to load firebase-app.js first.")}});
//# sourceMappingURL=firebase-firestore-compat.js.map

const config = {
    apiKey: "AIzaSyCQIboBJ6h4EJ9Jy5psUj-_2z_khACnd40",
    authDomain: "webmario-2826a.firebaseapp.com",
    projectId: "webmario-2826a",
    storageBucket: "webmario-2826a.firebasestorage.app",
    messagingSenderId: "538095669496",
    appId: "1:538095669496:web:18adf9b7038b5d809dab0d",
    measurementId: "G-0FD5KM82FQ"
};

firebase.initializeApp(config);